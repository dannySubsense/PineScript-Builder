<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><script data-astro-exec="">
			const url = window.location.href;
			const expectedUrl = url.replace(
				/^https:\/\/(?!beta)(\w+\.)?tradingview\.com/,
				'https://www.tradingview.com',
			);
			if (url !== expectedUrl) {
				window.location.replace(expectedUrl);
			}
		</script><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="none"><link rel="icon" href="https://static.tradingview.com/static/images/favicon.ico"><link rel="icon" type="image/svg+xml" href="/pine-script-docs/favicon.svg"><title>Strategies</title><meta name="og:title" content="Strategies"><meta name="twitter:title" content="Strategies"><meta name="description" content="Everything you need to know about Pine Script®."><meta name="og:description" content="Everything you need to know about Pine Script®."><meta name="twitter:description" content="Everything you need to know about Pine Script®."><meta name="keywords" content="tradingview, pine, script, indicators, strategies"><meta name="og:image" content="/pine-script-docs/meta-image.png?1"><meta name="twitter:image" content="/pine-script-docs/meta-image.png?1"><meta name="og:image:width" content="1200"><meta name="og:image:height" content="630"><meta name="og:url" content="https://www.tradingview.com/pine-script-docs/faq/strategies/"><meta name="twitter:url" content="https://www.tradingview.com/pine-script-docs/faq/strategies/"><meta name="og:type" content="website"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@TradingView"><link rel="canonical" href="https://www.tradingview.com/pine-script-docs/faq/strategies/"><link rel="sitemap" href="/pine-script-docs/sitemap-index.xml"><link rel="stylesheet" href="/pine-script-docs/_astro/index.DfaRTfPD.css">
<link rel="stylesheet" href="/pine-script-docs/_astro/index.B9ah8c5K.css">
<style>.tv-spinner{display:none;position:absolute;margin:0 auto;border:0 solid rgb(149 152 161 / 20%);border-radius:50%;border-top-color:var(--tv-spinner-color, #2962ff);border-left-color:var(--tv-spinner-color, #2962ff);animation:tv-spinner-container-rotate .9s linear infinite}.tv-spinner-shown{display:block}.tv-spinner-size-large{top:calc(50% - 32px);left:calc(50% - 32px);width:56px;height:56px;border-width:4px}@keyframes tv-spinner-container-rotate{to{transform:rotate(360deg)}}:root{--page-background-color: #fff;background-color:var(--page-background-color)}:root[data-theme=dark]{--page-background-color: #000}body{background-color:var(--page-background-color)}#redirect-link{display:flex;position:absolute;inset:0;align-items:center;justify-content:center}#spinner{display:block;position:absolute;opacity:1;transition:opacity .2s}
.twitter-tweet:not(.twitter-tweet-rendered){padding:var(--tc-padding, 1em);border:1px solid var(--tc-border-color, #cfd9de)}.twitter-tweet:not(.twitter-tweet-rendered)>:first-child{margin-top:0}.twitter-tweet:not(.twitter-tweet-rendered)>:last-child{margin-bottom:0}lite-youtube{background-color:#000;position:relative;display:block;contain:content;background-position:center center;background-size:cover;cursor:pointer;max-width:720px}lite-youtube:before{content:attr(data-title);display:block;position:absolute;top:0;background-image:linear-gradient(180deg,#000000ab,#0000008a 14%,#00000026 54%,#0000000d 72%,#0000 94%);height:99px;width:100%;font-family:YouTube Noto,Roboto,Arial,Helvetica,sans-serif;color:#eee;text-shadow:0 0 2px rgba(0,0,0,.5);font-size:18px;padding:25px 20px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;box-sizing:border-box}lite-youtube:hover:before{color:#fff}lite-youtube:after{content:"";display:block;padding-bottom:56.25%}lite-youtube>iframe{width:100%;height:100%;position:absolute;top:0;left:0;border:0}lite-youtube>.lty-playbtn{display:block;width:100%;height:100%;background:no-repeat center/68px 48px;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 68 48"><path d="M66.52 7.74c-.78-2.93-2.49-5.41-5.42-6.19C55.79.13 34 0 34 0S12.21.13 6.9 1.55c-2.93.78-4.63 3.26-5.42 6.19C.06 13.05 0 24 0 24s.06 10.95 1.48 16.26c.78 2.93 2.49 5.41 5.42 6.19C12.21 47.87 34 48 34 48s21.79-.13 27.1-1.55c2.93-.78 4.64-3.26 5.42-6.19C67.94 34.95 68 24 68 24s-.06-10.95-1.48-16.26z" fill="red"/><path d="M45 24 27 14v20" fill="white"/></svg>');position:absolute;cursor:pointer;z-index:1;filter:grayscale(100%);transition:filter .1s cubic-bezier(0,0,.2,1);border:0}lite-youtube:hover>.lty-playbtn,lite-youtube .lty-playbtn:focus{filter:none}lite-youtube.lyt-activated{cursor:unset}lite-youtube.lyt-activated:before,lite-youtube.lyt-activated>.lty-playbtn{opacity:0;pointer-events:none}.lyt-visually-hidden{clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px}lite-youtube>iframe{all:unset!important;width:100%!important;height:100%!important;position:absolute!important;inset:0!important;border:0!important}lite-vimeo{font-size:10px;background-color:#000;position:relative;display:block;contain:content;background-position:center center;background-size:cover}lite-vimeo:after{content:"";display:block;padding-bottom:56.25%}lite-vimeo>iframe{all:unset!important;width:100%!important;height:100%!important;position:absolute!important;inset:0!important;border:0!important}lite-vimeo>.ltv-playbtn{content:"";position:absolute;inset:0;width:100%;background:transparent;outline:0;border:0;cursor:pointer}lite-vimeo>.ltv-playbtn:before{width:6.5em;height:4em;background:#172322bf;opacity:.8;border-radius:.25rem;transition:all .2s cubic-bezier(0,0,.2,1)}lite-vimeo>.ltv-playbtn:focus:before{outline:auto}lite-vimeo:hover>.ltv-playbtn:before{background-color:#00adef;background-color:var(--ltv-color, #00adef);opacity:1}lite-vimeo>.ltv-playbtn:after{border-style:solid;border-width:1em 0 1em 1.7em;border-color:transparent transparent transparent #fff}lite-vimeo>.ltv-playbtn:before,lite-vimeo>.ltv-playbtn:after{content:"";position:absolute;top:50%;left:50%;transform:translate3d(-50%,-50%,0)}lite-vimeo.ltv-activated:before,lite-vimeo.ltv-activated>.ltv-playbtn{cursor:unset;opacity:0;pointer-events:none}
</style><script type="module" src="/pine-script-docs/_astro/hoisted.wfEHaJbk.js" data-astro-exec=""></script><style id="tv-pine-light" type="text/css" media="screen">.monaco-editor-tv-pine-light { 
.mtk1 { color: #131722; }
.mtk2 { color: #ffffff; }
.mtk3 { color: #808080; }
.mtk4 { color: #ff0000; }
.mtk5 { color: #0451a5; }
.mtk6 { color: #0000ff; }
.mtk7 { color: #098658; }
.mtk8 { color: #008000; }
.mtk9 { color: #9598a1; }
.mtk10 { color: #dd0000; }
.mtk11 { color: #cc2929; }
.mtk12 { color: #f57f17; }
.mtk13 { color: #000000; }
.mtk14 { color: #383838; }
.mtk15 { color: #0c3299; }
.mtk16 { color: #2962ff; }
.mtk17 { color: #8e24aa; }
.mtk18 { color: #22ab94; }
.mtk19 { color: #cd3131; }
.mtk20 { color: #863b00; }
.mtk21 { color: #af00db; }
.mtk22 { color: #800000; }
.mtk23 { color: #e00000; }
.mtk24 { color: #3030c0; }
.mtk25 { color: #666666; }
.mtk26 { color: #778899; }
.mtk27 { color: #c700c7; }
.mtk28 { color: #a31515; }
.mtk29 { color: #388e3c; }
.mtk30 { color: #4f76ac; }
.mtk31 { color: #008080; }
.mtk32 { color: #001188; }
.mtk33 { color: #2a2e39; }
.mtk34 { color: #4864aa; }
.mtki { font-style: italic; }
.mtkb { font-weight: bold; }
.mtku { text-decoration: underline; text-underline-position: under; }
.mtks { text-decoration: line-through; }
.mtks.mtku { text-decoration: underline line-through; text-underline-position: under; } }</style></head> <body> <div id="search-content-blur" hidden=""></div> <script data-astro-exec="">
	/* eslint-disable @typescript-eslint/typedef */
	window.ThemeProvider = (() => {
		function getCurrent() {
			return (
				// eslint-disable-next-line no-restricted-syntax
				typeof localStorage !== 'undefined' &&
				localStorage.getItem('tv-docs-theme')
			);
		}
		const storedTheme = getCurrent();
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ?
				'light'
			:	'dark');
		document.documentElement.dataset.theme =
			theme === 'light' ? 'light' : 'dark';
		document.documentElement.classList.toggle(
			'theme-dark',
			theme === 'dark',
		); // add support for ui-lib themes
		document.documentElement.classList.toggle(
			'sl-theme-dark',
			theme === 'dark',
		); // add support for shoelace themes

		return {
			updatePickers(themeArg = storedTheme || 'auto') {
				let currentTheme = themeArg;
				if (currentTheme === 'unknown') {
					currentTheme = getCurrent() || 'auto';
				}
				document
					.querySelectorAll('docs-theme-select')
					.forEach((picker) => {
						const select = picker.querySelector('select');
						if (select) select.value = currentTheme;
						/** @type {HTMLTemplateElement | null} */
						const tmpl = document.querySelector(`#theme-icons`);
						const newIcon =
							tmpl &&
							tmpl.content.querySelector('.' + currentTheme);
						if (newIcon) {
							const oldIcon =
								picker.querySelector('svg.label-icon');
							if (oldIcon) {
								oldIcon.replaceChildren(
									...newIcon.cloneNode(true).childNodes,
								);
							}
						}
					});
			},
		};
	})();
	/* eslint-enable @typescript-eslint/typedef */
</script><template id="theme-icons"><svg width="16" height="16" viewBox="0 0 28 28" class="light" data-icon="theme/sun-28">  <symbol id="ai:local:theme/sun-28"><g fill="currentColor"><path d="M14 3h1.5v5H14zm0 18h1.5v5H14zm12-5.5V14h-5v1.5zM8 14v1.5H3V14zm15.3-7-1-1-3.6 3.6 1.1 1 3.5-3.5ZM9.5 18.7l1.1 1.1-3.5 3.5-1-1zM22 23.3l1-1-3.6-3.6-1 1.1 3.5 3.5ZM10.3 9.6l-1.1 1-3.5-3.5 1-1z"></path><path fill-rule="evenodd" d="M19 14.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0m-1.5 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0" clip-rule="evenodd"></path></g></symbol><use xlink:href="#ai:local:theme/sun-28"></use>  </svg><svg width="16" height="16" viewBox="0 0 28 28" class="dark" data-icon="theme/moon-28">  <symbol id="ai:local:theme/moon-28"><path fill="currentColor" fill-rule="evenodd" d="M21 7.02A9.23 9.23 0 0 0 15.2 5 9.1 9.1 0 0 0 6 14c0 4.97 4.12 9 9.2 9a9.33 9.33 0 0 0 5.8-2.02A7 7 0 0 1 14.36 14 7 7 0 0 1 21 7.02m-3.95-.3a8 8 0 0 0-1.85-.22A7.6 7.6 0 0 0 7.5 14a7.6 7.6 0 0 0 7.7 7.5 8 8 0 0 0 1.85-.22A8.46 8.46 0 0 1 12.86 14c0-3.1 1.69-5.8 4.19-7.28" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/moon-28"></use>  </svg><svg width="16" height="16" viewBox="0 0 28 28" class="auto" data-icon="theme/system-28">  <symbol id="ai:local:theme/system-28"><path fill="currentColor" d="M8 4h1v2H8zm0 9v2h1v-2zm6-3V9h-2v1zM3 9v1h2V9zm5.5 3a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5m4.2-6-.7-.7-1.4 1.4.7.7zM5 13.7l-.7-.7 1.4-1.4.7.7zm7.7-.7-.7.7-1.4-1.4.7-.7zM4.3 6l.7-.7 1.4 1.4-.7.7zm3 17 14-14 .8.7L8 23.7zm17.2-.1a3.5 3.5 0 0 1-3.4-5.9H21a4 4 0 1 0 3.5 5.9"></path></symbol><use xlink:href="#ai:local:theme/system-28"></use>  </svg></template> <div class="backdrop" data-mobile-menu-backdrop="" data-astro-cid-h2irkosh=""></div> <div class="menu-container" data-astro-cid-h2irkosh=""> <div class="header" data-astro-cid-h2irkosh=""> <div class="header-group" data-astro-cid-h2irkosh=""> <div id="version-select" data-astro-cid-kx7qoxgq=""> <label style="--sl-select-width: undefined; --sl-label-icon-size: 16px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq="">Version</span>  <select value="v6" data-has-border="" no-icon="true" data-astro-cid-lmznfliq=""> <option value="v6" selected="true" data-astro-cid-lmznfliq="">Version 6</option><option value="v5" data-astro-cid-lmznfliq="">Version 5</option><option value="v4" data-astro-cid-lmznfliq="">Version 4</option><option value="v3" data-astro-cid-lmznfliq="">Version 3</option> </select> <svg width="16" height="16" viewBox="0 0 24 24" class="icon caret" data-astro-cid-lmznfliq="" data-icon="theme/down-caret">  <symbol id="ai:local:theme/down-caret"><path fill="currentColor" d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1 1 0 0 0 1.42 0L17 10.59a1 1 0 0 0 0-1.42"></path></symbol><use xlink:href="#ai:local:theme/down-caret"></use>  </svg> </label>  </div>   <docs-theme-select class="" data-astro-cid-3wpspbi7=""> <label style="--sl-select-width: 48px; --sl-label-icon-size: 28px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq="">Theme</span> <svg width="28" height="28" viewBox="0 0 28 28" class="icon label-icon" data-button="" data-round="" data-astro-cid-lmznfliq="" data-icon="theme/system-28">  <symbol id="ai:local:theme/system-28"><path fill="currentColor" d="M8 4h1v2H8zm0 9v2h1v-2zm6-3V9h-2v1zM3 9v1h2V9zm5.5 3a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5m4.2-6-.7-.7-1.4 1.4.7.7zM5 13.7l-.7-.7 1.4-1.4.7.7zm7.7-.7-.7.7-1.4-1.4.7-.7zM4.3 6l.7-.7 1.4 1.4-.7.7zm3 17 14-14 .8.7L8 23.7zm17.2-.1a3.5 3.5 0 0 1-3.4-5.9H21a4 4 0 1 0 3.5 5.9"></path></symbol><use xlink:href="#ai:local:theme/system-28"></use>  </svg> <select value="auto" data-button="" data-astro-cid-lmznfliq=""> <option value="dark" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Dark&nbsp;&nbsp;</option><option value="light" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Light&nbsp;&nbsp;</option><option value="auto" selected="true" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Auto&nbsp;&nbsp;</option> </select>  </label>  </docs-theme-select>   <script data-astro-exec="">
	ThemeProvider.updatePickers('unknown');
</script>  </div> <div class="header-group" data-astro-cid-h2irkosh="">  <div class="not-content" style="stroke-width:2px" data-astro-cid-pkzv2hgs=""> <button id="mobile-menu-back-button" title="Close menu" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-primary stvb-icon">  <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-h2irkosh="" data-icon="theme/arrow-back">  <symbol id="ai:local:theme/arrow-back"><g fill="none"><g clip-path="url(#a)"><path stroke="var(--arrow-fill-color, #131722)" d="m17 20-6-6 6-6"></path></g><defs><clipPath id="a"><path fill="#fff" d="M28 28H0V0h28z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/arrow-back"></use>  </svg>  </button> </div>  </div> </div> <aside id="nav" class="keep-visible" style="--navbar-right-border-width: 0px" data-astro-cid-sa57sq6l=""> <div class="sidebar-viewport slick-scroll" data-astro-cid-sa57sq6l=""> <div class="sidebar" data-mobile="" data-astro-cid-sa57sq6l=""> <ul class="toc" aria-label="Docs sidebar" data-astro-cid-sa57sq6l=""> <li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/welcome" data-astro-cid-omxx3dey="">Welcome to Pine Script® v6</a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Pine Script® primer</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-steps" data-astro-cid-omxx3dey="">First steps</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-indicator" data-astro-cid-omxx3dey="">First indicator</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/next-steps" data-astro-cid-omxx3dey="">Next steps</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Language</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/execution-model" data-astro-cid-omxx3dey="">Execution model</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/type-system" data-astro-cid-omxx3dey="">Type system</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/script-structure" data-astro-cid-omxx3dey="">Script structure</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/identifiers" data-astro-cid-omxx3dey="">Identifiers</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/variable-declarations" data-astro-cid-omxx3dey="">Variable declarations</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/operators" data-astro-cid-omxx3dey="">Operators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/conditional-structures" data-astro-cid-omxx3dey="">Conditional structures</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/loops" data-astro-cid-omxx3dey="">Loops</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/built-ins" data-astro-cid-omxx3dey="">Built-ins</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/user-defined-functions" data-astro-cid-omxx3dey="">User-defined functions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/objects" data-astro-cid-omxx3dey="">Objects</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/enums" data-astro-cid-omxx3dey="">Enums</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/methods" data-astro-cid-omxx3dey="">Methods</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/arrays" data-astro-cid-omxx3dey="">Arrays</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/matrices" data-astro-cid-omxx3dey="">Matrices</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/maps" data-astro-cid-omxx3dey="">Maps</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Visuals</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/overview" data-astro-cid-omxx3dey="">Overview</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/backgrounds" data-astro-cid-omxx3dey="">Backgrounds</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/bar-coloring" data-astro-cid-omxx3dey="">Bar coloring</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/bar-plotting" data-astro-cid-omxx3dey="">Bar plotting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/colors" data-astro-cid-omxx3dey="">Colors</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/fills" data-astro-cid-omxx3dey="">Fills</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/levels" data-astro-cid-omxx3dey="">Levels</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/lines-and-boxes" data-astro-cid-omxx3dey="">Lines and boxes</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/plots" data-astro-cid-omxx3dey="">Plots</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/tables" data-astro-cid-omxx3dey="">Tables</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/text-and-shapes" data-astro-cid-omxx3dey="">Text and shapes</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Concepts</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/alerts" data-astro-cid-omxx3dey="">Alerts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-states" data-astro-cid-omxx3dey="">Bar states</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/chart-information" data-astro-cid-omxx3dey="">Chart information</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/inputs" data-astro-cid-omxx3dey="">Inputs</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/libraries" data-astro-cid-omxx3dey="">Libraries</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/non-standard-charts-data" data-astro-cid-omxx3dey="">Non-standard charts data</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/other-timeframes-and-data" data-astro-cid-omxx3dey="">Other timeframes and data</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/repainting" data-astro-cid-omxx3dey="">Repainting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/sessions" data-astro-cid-omxx3dey="">Sessions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strategies" data-astro-cid-omxx3dey="">Strategies</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strings" data-astro-cid-omxx3dey="">Strings</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/time" data-astro-cid-omxx3dey="">Time</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/timeframes" data-astro-cid-omxx3dey="">Timeframes</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Writing scripts</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/style-guide" data-astro-cid-omxx3dey="">Style guide</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/debugging" data-astro-cid-omxx3dey="">Debugging</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/profiling-and-optimization" data-astro-cid-omxx3dey="">Profiling and optimization</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/publishing" data-astro-cid-omxx3dey="">Publishing scripts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/limitations" data-astro-cid-omxx3dey="">Limitations</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details open="" data-is-parent="" data-is-on-path="" data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">FAQ</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/general" data-astro-cid-omxx3dey="">General</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/alerts" data-astro-cid-omxx3dey="">Alerts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/data-structures" data-astro-cid-omxx3dey="">Data structures</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/functions" data-astro-cid-omxx3dey="">Functions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/indicators" data-astro-cid-omxx3dey="">Indicators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/other-data-and-timeframes" data-astro-cid-omxx3dey="">Other data and timeframes</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/programming" data-astro-cid-omxx3dey="">Programming</a></li><li class="item" data-current="" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/strategies" data-astro-cid-omxx3dey="">Strategies</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/strings-and-formatting" data-astro-cid-omxx3dey="">Strings and formatting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/techniques" data-astro-cid-omxx3dey="">Techniques</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/times-dates-and-sessions" data-astro-cid-omxx3dey="">Times, dates, and sessions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/variables-and-operators" data-astro-cid-omxx3dey="">Variables and operators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/visuals" data-astro-cid-omxx3dey="">Visuals</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/error-messages" data-astro-cid-omxx3dey="">Error messages</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/release-notes" data-astro-cid-omxx3dey="">Release notes</a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Migration guides</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/overview" data-astro-cid-omxx3dey="">Overview</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-6" data-astro-cid-omxx3dey="">To Pine Script® version 6</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-5" data-astro-cid-omxx3dey="">To Pine Script® version 5</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-4" data-astro-cid-omxx3dey="">To Pine Script® version 4</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-3" data-astro-cid-omxx3dey="">To Pine Script® version 3</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-2" data-astro-cid-omxx3dey="">To Pine Script® version 2</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/where-can-i-get-more-information" data-astro-cid-omxx3dey="">Where can I get more information?</a></li> </ul> <div class="toc-bottom" data-astro-cid-sa57sq6l=""></div> </div> </div> </aside>  </div>   <header class="header" data-astro-cid-d74r2unp=""> <nav role="navigation" aria-label="Main Navigation" data-astro-cid-d74r2unp=""> <mobile-menu-button id="mobile-menu-button-wc" data-astro-cid-oojooh3d=""> <!-- Annoyingly I need to wrap this. TODO: improve this --> <div id="mobile-menu-button-header" data-astro-cid-oojooh3d=""> <div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <button title="Open navigation menu" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-secondary stvb-icon stvb-icon-force-color stvb-force-no-border">  <svg width="28" height="28" viewBox="0 0 24 24" data-astro-cid-oojooh3d="" data-icon="theme/bars">  <symbol id="ai:local:theme/bars"><path fill="currentColor" d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2m18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2m0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2"></path></symbol><use xlink:href="#ai:local:theme/bars"></use>  </svg>  </button> </div>  </div> </mobile-menu-button>   <div data-hide-when-search="" data-astro-cid-d74r2unp=""> <div class="header-logo" data-astro-cid-tycb33lk=""> <a href="/pine-script-docs/" aria-label="Home button" data-astro-cid-tycb33lk=""> <div class="documentation-logo logo" data-astro-cid-tycb33lk=""><!-- Old Christmas icon -->
<!-- 
<svg width="184" height="44" viewBox="0 0 184 44" fill="none" xmlns="http://www.w3.org/2000/svg">
	<path fill-rule="evenodd" clip-rule="evenodd" d="M33.8209 5.1219C33.885 4.95937 34.115 4.95937 34.1791 5.1219L35.2253 7.77465L37.8781 8.82088C38.0406 8.88499 38.0406 9.11501 37.8781 9.17912L35.2253 10.2253L34.1791 12.8781C34.115 13.0406 33.885 13.0406 33.8209 12.8781L32.7747 10.2253L30.1219 9.17912C29.9594 9.11501 29.9594 8.88499 30.1219 8.82088L32.7747 7.77465L33.8209 5.1219Z" fill="#F9A825"/>
    <path d="M5.30092 15.1478C5.37479 14.9605 5.63986 14.9605 5.71373 15.1478L6.60557 17.4091L8.86685 18.3009C9.05415 18.3748 9.05415 18.6399 8.86685 18.7137L6.60557 19.6056L5.71373 21.8669C5.63986 22.0541 5.37479 22.0541 5.30092 21.8669L4.40908 19.6056L2.1478 18.7137C1.9605 18.6399 1.9605 18.3748 2.1478 18.3009L4.40908 17.4091L5.30092 15.1478Z" fill="#F9A825"/>
    <path d="M11.8231 3.12041C11.8864 2.95986 12.1136 2.95986 12.1769 3.12041L12.9414 5.05865L14.8796 5.82308C15.0401 5.8864 15.0401 6.1136 14.8796 6.17692L12.9414 6.94135L12.1769 8.87959C12.1136 9.04014 11.8864 9.04014 11.8231 8.87959L11.0586 6.94135L9.12041 6.17692C8.95986 6.1136 8.95986 5.8864 9.12041 5.82308L11.0586 5.05865L11.8231 3.12041Z" fill="#F9A825"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M22.6478 7.35459L34.7627 21.6923C35.1531 22.1543 35.0472 22.8544 34.5376 23.1802L26.9989 28.0001L18.4281 20.7531L11.3382 23.2611C10.402 23.5923 9.60771 22.5041 10.2085 21.7134L21.0877 7.39502C21.4749 6.88536 22.2346 6.86567 22.6478 7.35459ZM33.432 28.0842L38.3592 34.7471C38.7427 35.2657 38.3724 36 37.7274 36H6.27248C5.62746 36 5.25722 35.2657 5.64074 34.7471L10.8523 27.6996C10.9484 27.5697 11.0822 27.4725 11.2356 27.4214L17.6878 25.2707C17.9285 25.1904 18.1932 25.2314 18.3984 25.3806L26.2854 31.1166C26.5445 31.3051 26.8922 31.3173 27.1639 31.1475L32.3838 27.885C32.7316 27.6677 33.1881 27.7544 33.432 28.0842Z" fill="#089981"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M17.6363 11.9375C20.7386 12.451 23.1213 11.505 24.9187 10.0422L25.8869 11.1881C23.6236 13.0379 20.553 14.1584 16.6261 13.267L17.6363 11.9375ZM34.0572 20.8573C30.0669 21.363 26.2864 20.8179 23.1264 19.7076C20.7393 18.8689 18.6873 17.7013 17.155 16.3997C16.5283 15.8674 15.9767 15.3021 15.5241 14.7174L16.4708 13.4713C16.8706 14.0544 17.4225 14.6588 18.1262 15.2565C19.5001 16.4237 21.3856 17.5061 23.6236 18.2924C26.3235 19.241 29.5087 19.7493 32.8863 19.4716L34.0572 20.8573ZM9.06812 30.1123C15.4775 33.3909 23.0493 33.8897 29.0345 32.0941C31.0827 31.4796 32.9275 30.6019 34.4713 29.4897L35.3633 30.6959C33.6586 31.9268 31.6497 32.8756 29.4655 33.5309C23.053 35.4546 14.9758 34.8964 8.16479 31.3339L9.06812 30.1123Z" fill="#45E5CB"/>
    <path d="M55.56 13.96C59.016 13.96 61.536 16.456 61.536 19.696C61.536 22.936 59.016 25.432 55.56 25.432H53.376V31H49.896V13.96H55.56ZM55.512 22.168C57.096 22.168 58.152 21.088 58.152 19.696C58.152 18.304 57.096 17.224 55.512 17.224H53.376V22.168H55.512ZM66.8636 14.944C66.8636 16.096 65.9276 17.032 64.7516 17.032C63.6236 17.032 62.6636 16.096 62.6636 14.944C62.6636 13.792 63.6236 12.856 64.7516 12.856C65.9276 12.856 66.8636 13.792 66.8636 14.944ZM63.1196 31V19H66.4076V31H63.1196ZM69.0849 31V19H72.3729V20.368C72.9969 19.408 74.2449 18.736 75.8049 18.736C78.7089 18.736 80.4369 20.848 80.4369 23.968V31H77.1489V24.52C77.1489 22.792 76.4049 21.736 75.0369 21.736C73.5249 21.736 72.3729 22.84 72.3729 25.144V31H69.0849ZM82.2041 25C82.2041 21.448 84.8681 18.736 88.5161 18.736C91.6601 18.736 94.4201 20.752 94.4201 24.64C94.4201 24.928 94.4201 25.264 94.3721 25.768H85.3961C85.5881 27.376 87.0041 28.264 88.5881 28.264C90.0761 28.264 91.1561 27.568 91.6841 26.752L94.1321 28.576C93.0281 30.184 91.0841 31.264 88.5641 31.264C84.9881 31.264 82.2041 28.792 82.2041 25ZM88.4201 21.448C87.1961 21.448 85.8281 22.072 85.5161 23.536H91.1321C90.8441 22.12 89.6441 21.448 88.4201 21.448ZM100.412 28.24L103.076 26.008C103.916 27.28 105.38 28.024 106.772 28.024C108.14 28.024 109.052 27.352 109.052 26.368C109.052 25.408 108.356 24.736 106.676 24.16L105.236 23.656C102.5 22.696 101.036 21.112 101.036 18.784C101.036 15.568 103.484 13.672 106.796 13.672C108.884 13.672 110.708 14.392 112.172 16.024L109.868 18.4C109.052 17.416 107.996 16.936 106.82 16.936C105.644 16.936 104.54 17.44 104.54 18.448C104.54 19.48 105.38 19.936 107.18 20.584L108.548 21.088C111.044 22 112.604 23.584 112.604 26.152C112.58 29.2 110.156 31.288 106.628 31.288C103.916 31.288 101.636 30.112 100.412 28.24ZM125.859 27.808C124.827 29.872 122.667 31.264 120.171 31.264C116.619 31.264 113.811 28.624 113.811 25C113.811 21.376 116.619 18.736 120.171 18.736C122.667 18.736 124.827 20.128 125.859 22.192L123.003 23.728C122.523 22.624 121.491 21.808 120.171 21.808C118.443 21.808 117.123 23.152 117.123 25C117.123 26.848 118.443 28.192 120.171 28.192C121.491 28.192 122.523 27.376 123.003 26.272L125.859 27.808ZM127.482 31V19H130.77V20.92C131.178 19.744 132.402 18.856 133.746 18.856C134.082 18.856 134.442 18.88 134.85 19V22.336C134.346 22.168 133.89 22.072 133.362 22.072C131.802 22.072 130.77 23.296 130.77 25.264V31H127.482ZM140.215 14.944C140.215 16.096 139.279 17.032 138.103 17.032C136.975 17.032 136.015 16.096 136.015 14.944C136.015 13.792 136.975 12.856 138.103 12.856C139.279 12.856 140.215 13.792 140.215 14.944ZM136.471 31V19H139.759V31H136.471ZM142.436 36.016V19H145.724V20.344C146.276 19.576 147.548 18.736 149.204 18.736C152.396 18.736 154.844 21.592 154.844 25C154.844 28.408 152.396 31.264 149.204 31.264C147.548 31.264 146.276 30.424 145.724 29.656V36.016H142.436ZM151.508 25C151.508 23.128 150.284 21.736 148.484 21.736C146.684 21.736 145.46 23.128 145.46 25C145.46 26.872 146.684 28.264 148.484 28.264C150.284 28.264 151.508 26.872 151.508 25ZM164.407 30.88C163.879 31.048 163.231 31.144 162.319 31.144C159.775 31.144 157.735 29.728 157.735 26.8V21.88H155.311V19H157.735V15.664H161.023V19H164.407V21.88H161.023V26.152C161.023 27.616 161.647 28.192 163.063 28.192C163.591 28.192 164.023 28.12 164.407 27.976V30.88ZM173.626 22.648V13.96H175.978L177.874 16.888L179.746 13.96H182.122V22.648H179.698V18.184L177.874 20.968L176.026 18.136V22.648H173.626ZM167.386 22.648V16.456H165.058V13.96H172.258V16.456H169.93V22.648H167.386Z" fill="currentColor"/>
</svg> -->



<!-- Regular icon -->

<svg width="177" height="44" viewBox="0 0 177 44" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M17.6876 25.2705C17.9283 25.1902 18.1933 25.2316 18.3985 25.3808L26.2852 31.1162C26.5444 31.3047 26.8924 31.3173 27.1641 31.1474L32.3839 27.8847C32.7316 27.6675 33.1878 27.7545 33.4317 28.084L38.3594 34.7471C38.7428 35.2656 38.3725 35.9999 37.7276 36H6.27253C5.62754 36 5.25723 35.2657 5.64069 34.7471L10.8526 27.6992C10.9486 27.5695 11.0824 27.4729 11.2354 27.4219L17.6876 25.2705ZM21.088 7.39451C21.4752 6.88532 22.2345 6.8659 22.6475 7.35448L34.7628 21.6924C35.1531 22.1544 35.0468 22.8548 34.5372 23.1806L26.9991 28L18.4278 20.7529L11.338 23.2607C10.4021 23.5917 9.60809 22.5044 10.2081 21.7139L21.088 7.39451ZM13.8243 20.2597L17.7608 18.8672C18.4309 18.6301 19.1771 18.7667 19.7198 19.2256L27.1641 25.5205L32.4981 22.1103L21.9259 9.59862L13.8243 20.2597Z" fill="currentColor"></path>
<path d="M147.308 16.959C150.499 16.959 152.948 19.8149 152.948 23.2227C152.948 26.6307 150.5 29.4873 147.308 29.4873C145.652 29.4872 144.38 28.6469 143.828 27.8789V34.2393H140.54V17.2227H143.828V18.5674C144.38 17.7994 145.652 16.9591 147.308 16.959ZM104.9 11.8955C106.988 11.8956 108.812 12.6152 110.276 14.2471L107.972 16.623C107.156 15.6392 106.1 15.1592 104.924 15.1592C103.748 15.1592 102.645 15.6631 102.645 16.6709C102.645 17.7029 103.484 18.1596 105.284 18.8076L106.652 19.3115C109.148 20.2235 110.708 21.8072 110.708 24.375C110.684 27.4229 108.26 29.5106 104.732 29.5107C102.02 29.5107 99.7396 28.3349 98.5156 26.4629L101.18 24.2314C102.02 25.5034 103.484 26.247 104.876 26.2471C106.244 26.2471 107.156 25.5748 107.156 24.5908C107.156 23.631 106.46 22.9587 104.78 22.3828L103.34 21.8789C100.604 20.9189 99.1396 19.3348 99.1396 17.0068C99.1398 13.791 101.588 11.8955 104.9 11.8955ZM86.6201 16.959C89.7641 16.959 92.5244 18.9753 92.5244 22.8633C92.5244 23.1513 92.5246 23.4873 92.4766 23.9912H83.5C83.692 25.5992 85.1084 26.4873 86.6924 26.4873C88.18 26.4872 89.26 25.7914 89.7881 24.9756L92.2363 26.7988C91.1323 28.4068 89.188 29.4873 86.668 29.4873C83.092 29.4872 80.3086 27.0146 80.3086 23.2227C80.3088 19.6709 82.9723 16.959 86.6201 16.959ZM118.275 16.959C120.771 16.9591 122.931 18.3512 123.963 20.415L121.107 21.9512C120.627 20.8473 119.595 20.0314 118.275 20.0312C116.548 20.0312 115.227 21.3749 115.227 23.2227C115.227 25.0707 116.547 26.415 118.275 26.415C119.595 26.4149 120.627 25.599 121.107 24.4951L123.963 26.0312C122.931 28.0951 120.771 29.4872 118.275 29.4873C114.723 29.4873 111.915 26.8467 111.915 23.2227C111.915 19.5989 114.724 16.959 118.275 16.959ZM159.127 17.2227H162.511V20.1035H159.127V24.375C159.127 25.839 159.751 26.415 161.167 26.415C161.695 26.415 162.127 26.3432 162.511 26.1992V29.1035C161.983 29.2715 161.335 29.3672 160.423 29.3672C157.879 29.3672 155.839 27.9512 155.839 25.0234V20.1035H153.415V17.2227H155.839V13.8867H159.127V17.2227ZM53.6641 12.1836C57.12 12.1836 59.6395 14.6791 59.6396 17.9189C59.6396 21.1589 57.12 23.6552 53.6641 23.6553H51.4805V29.2227H48V12.1836H53.6641ZM64.5117 29.2227H61.2236V17.2227H64.5117V29.2227ZM73.9092 16.959C76.813 16.9591 78.541 19.0715 78.541 22.1914V29.2227H75.2529V22.7432C75.2529 21.0152 74.5086 19.959 73.1406 19.959C71.6288 19.9591 70.4766 21.0633 70.4766 23.3672V29.2227H67.1885V17.2227H70.4766V18.5908C71.1006 17.6308 72.3492 16.959 73.9092 16.959ZM131.85 17.0791C132.186 17.0791 132.546 17.1027 132.954 17.2227V20.5596C132.45 20.3916 131.994 20.2949 131.466 20.2949C129.906 20.2949 128.874 21.5193 128.874 23.4873V29.2227H125.586V17.2227H128.874V19.1436C129.282 17.9676 130.506 17.0792 131.85 17.0791ZM137.862 29.2227H134.574V17.2227H137.862V29.2227ZM146.588 19.959C144.788 19.959 143.564 21.3509 143.563 23.2227C143.563 25.0947 144.788 26.4873 146.588 26.4873C148.388 26.4873 149.612 25.0947 149.612 23.2227C149.612 21.3509 148.388 19.959 146.588 19.959ZM169.993 9.76074C170.876 9.76079 171.697 9.9237 172.455 10.25C173.213 10.5764 173.881 11.0326 174.457 11.6182C175.043 12.1942 175.499 12.8617 175.825 13.6201C176.151 14.3783 176.314 15.1991 176.314 16.082C176.314 16.9556 176.152 17.7769 175.825 18.5449C175.499 19.3032 175.043 19.975 174.457 20.5605C173.881 21.1365 173.208 21.5877 172.44 21.9141C171.682 22.2404 170.867 22.4042 169.993 22.4043C169.12 22.4043 168.298 22.2405 167.53 21.9141C166.772 21.5877 166.1 21.1365 165.515 20.5605C164.939 19.975 164.488 19.3032 164.161 18.5449C163.835 17.7769 163.671 16.9556 163.671 16.082C163.671 15.2086 163.835 14.393 164.161 13.6348C164.488 12.8668 164.939 12.1942 165.515 11.6182C166.1 11.0327 166.772 10.5764 167.53 10.25C168.298 9.92362 169.12 9.76074 169.993 9.76074ZM86.5244 19.6709C85.3005 19.6709 83.9323 20.295 83.6201 21.7588H89.2363C88.9482 20.3431 87.7482 19.671 86.5244 19.6709ZM169.993 11.1865C169.312 11.1865 168.672 11.3109 168.077 11.5605C167.492 11.8101 166.974 12.1612 166.522 12.6123C166.071 13.0635 165.72 13.5865 165.471 14.1816C165.221 14.7671 165.097 15.4006 165.097 16.082C165.097 16.7634 165.221 17.402 165.471 17.9971C165.72 18.5827 166.071 19.1015 166.522 19.5527C166.974 20.0038 167.492 20.3539 168.077 20.6035C168.672 20.8531 169.312 20.9785 169.993 20.9785C170.675 20.9785 171.308 20.8531 171.894 20.6035C172.489 20.3539 173.012 20.0038 173.463 19.5527C173.914 19.1015 174.265 18.5827 174.515 17.9971C174.764 17.402 174.889 16.7634 174.889 16.082C174.889 15.4006 174.764 14.7671 174.515 14.1816C174.265 13.5865 173.914 13.0635 173.463 12.6123C173.012 12.1611 172.489 11.8101 171.894 11.5605C171.308 11.311 170.675 11.1866 169.993 11.1865ZM51.4805 20.3916H53.6162C55.2001 20.3915 56.2559 19.3109 56.2559 17.9189C56.2558 16.5271 55.2 15.4474 53.6162 15.4473H51.4805V20.3916ZM169.878 13.2314C170.406 13.2315 170.838 13.2932 171.174 13.418C171.519 13.5332 171.773 13.7163 171.937 13.9658C172.1 14.2154 172.182 14.5271 172.182 14.9014C172.182 15.2469 172.09 15.5494 171.908 15.8086C171.726 16.0581 171.481 16.2646 171.174 16.4277L172.815 18.9336H171.217L169.964 16.8027H169.445V18.9336H168.034V13.2314H169.878ZM169.445 15.751H169.849C170.127 15.751 170.348 15.6932 170.511 15.5781C170.674 15.4533 170.756 15.247 170.756 14.959C170.756 14.7383 170.684 14.5703 170.54 14.4551C170.396 14.3399 170.165 14.2822 169.849 14.2822H169.445V15.751ZM62.8555 11.0791C64.0314 11.0791 64.9677 12.0151 64.9678 13.167C64.9678 14.319 64.0315 15.2549 62.8555 15.2549C61.7275 15.2548 60.7676 14.3189 60.7676 13.167C60.7677 12.0151 61.7276 11.0792 62.8555 11.0791ZM136.207 11.0791C137.383 11.0793 138.318 12.0152 138.318 13.167C138.318 14.3188 137.383 15.2546 136.207 15.2549C135.079 15.2549 134.118 14.319 134.118 13.167C134.118 12.0151 135.079 11.0791 136.207 11.0791Z" fill="currentColor"></path>
</svg>
</div> </a> </div>  </div> <div class="flex" data-astro-cid-d74r2unp=""></div> <div class="flex" data-astro-cid-d74r2unp=""> <div class="search-container" data-astro-cid-fg37foga=""> <div class="search-wrapper" data-astro-cid-fg37foga=""> <input class="search-input" type="text" placeholder="Search docs" name="s" value="" data-astro-cid-fg37foga="" data-has-input-listener="true"> <svg width="28" height="28" viewBox="0 0 28 28" class="search-button" data-astro-cid-fg37foga="" data-icon="theme/search">  <symbol id="ai:local:theme/search"><path fill="currentColor" fill-rule="evenodd" d="M18.5 12.5a6 6 0 1 1-12 0 6 6 0 0 1 12 0m-1.25 5.8a7.5 7.5 0 1 1 1.06-1.06l4.22 4.23.53.53L22 23.06l-.53-.53-4.22-4.22Z" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/search"></use>  </svg> <button class="search-clear" type="button" title="Reset" data-search-clear="" data-astro-cid-fg37foga="">Clear</button> <span class="divider" data-astro-cid-fg37foga=""></span> <button class="search-close" type="button" title="Close" data-search-close="" data-astro-cid-fg37foga=""> <svg width="18" height="18" viewBox="0 0 18 18" data-astro-cid-fg37foga="" data-icon="theme/cross-18">  <use xlink:href="#ai:local:theme/cross-18"></use>  </svg> </button> </div> <div id="search-results-wrapper" data-astro-cid-fg37foga=""> <aside id="search-results" hidden="" data-astro-cid-fg37foga="" data-has-button-listener="true"> <!-- Don't use h1 because when built it will be used as the first heading on the page --> <div class="heading" data-astro-cid-fg37foga="">Search results</div> <div id="search-results-contents" data-astro-cid-fg37foga=""></div> </aside> </div> </div>   </div> <ul class="links" data-astro-cid-d74r2unp="">  </ul> <div class="flex" data-astro-cid-d74r2unp=""></div> <div data-hide-when-search="" data-astro-cid-d74r2unp=""> <div id="version-select" data-hideable="true" data-astro-cid-kx7qoxgq=""> <label style="--sl-select-width: undefined; --sl-label-icon-size: 16px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq="">Version</span>  <select value="v6" data-has-border="" no-icon="true" data-astro-cid-lmznfliq=""> <option value="v6" selected="true" data-astro-cid-lmznfliq="">Version 6</option><option value="v5" data-astro-cid-lmznfliq="">Version 5</option><option value="v4" data-astro-cid-lmznfliq="">Version 4</option><option value="v3" data-astro-cid-lmznfliq="">Version 3</option> </select> <svg width="16" height="16" viewBox="0 0 24 24" class="icon caret" data-astro-cid-lmznfliq="" data-icon="theme/down-caret">  <use xlink:href="#ai:local:theme/down-caret"></use>  </svg> </label>  </div>   </div> <button id="search-button" data-astro-cid-6zeqadij="" data-has-listener="true"> <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-6zeqadij="" data-icon="theme/search">  <use xlink:href="#ai:local:theme/search"></use>  </svg> </button>  <script data-base-url="/pine-script-docs" data-astro-exec="">
	async function loadPageFind() {
		const base = document.currentScript.getAttribute('data-base-url');
		const pageFindBundleUrl = `${base}/pagefind/`;
		const pagefind = await import(`${pageFindBundleUrl}pagefind.js`);
		await pagefind.options({
			bundlePath: pageFindBundleUrl,
		});
		window.pagefind = pagefind;
	}
	loadPageFind().catch();
</script>  <docs-theme-select class="hide-with-breakpoint-568" data-astro-cid-3wpspbi7=""> <label style="--sl-select-width: 48px; --sl-label-icon-size: 28px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq="">Theme</span> <svg width="28" height="28" viewBox="0 0 28 28" class="icon label-icon" data-button="" data-round="" data-astro-cid-lmznfliq="" data-icon="theme/system-28">  <symbol id="ai:local:theme/system-28"><path fill="currentColor" d="M8 4h1v2H8zm0 9v2h1v-2zm6-3V9h-2v1zM3 9v1h2V9zm5.5 3a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5m4.2-6-.7-.7-1.4 1.4.7.7zM5 13.7l-.7-.7 1.4-1.4.7.7zm7.7-.7-.7.7-1.4-1.4.7-.7zM4.3 6l.7-.7 1.4 1.4-.7.7zm3 17 14-14 .8.7L8 23.7zm17.2-.1a3.5 3.5 0 0 1-3.4-5.9H21a4 4 0 1 0 3.5 5.9"></path></symbol><use xlink:href="#ai:local:theme/system-28"></use>  </svg> <select value="auto" data-button="" data-astro-cid-lmznfliq=""> <option value="dark" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Dark&nbsp;&nbsp;</option><option value="light" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Light&nbsp;&nbsp;</option><option value="auto" selected="true" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Auto&nbsp;&nbsp;</option> </select>  </label>  </docs-theme-select>   <script data-astro-exec="">
	ThemeProvider.updatePickers('unknown');
</script>  </nav> </header>        <div id="image-lightbox" class="not-content" hidden="" data-astro-cid-kws7taxh=""> <div class="button-wrapper" data-astro-cid-kws7taxh=""> <div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <button id="lightbox-close-button" title="Close image preview" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-black stvb-medium stvb-secondary stvb-icon stvb-force-no-border">  <svg width="24" height="24" viewBox="0 0 18 18" data-astro-cid-kws7taxh="" data-icon="theme/cross-18">  <symbol id="ai:local:theme/cross-18"><g fill="none"><g clip-path="url(#a)"><path fill="currentColor" fill-rule="evenodd" d="M5.53 4.47 4.47 5.53 7.94 9l-3.47 3.47 1.06 1.06L9 10.06l3.47 3.47 1.06-1.06L10.06 9l3.47-3.47-1.06-1.06L9 7.94z" clip-rule="evenodd"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h18v18H0z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/cross-18"></use>  </svg>  </button> </div>  </div> <img id="lightbox-image" src="" data-astro-cid-kws7taxh=""> </div>   <div id="page-container" data-astro-cid-xgirumru=""> <aside id="nav" class="" style="" data-astro-cid-sa57sq6l=""> <div class="sidebar-viewport slick-scroll" data-astro-cid-sa57sq6l=""> <div class="sidebar" data-astro-cid-sa57sq6l=""> <ul class="toc" aria-label="Docs sidebar" data-astro-cid-sa57sq6l=""> <li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/welcome" data-astro-cid-omxx3dey="">Welcome to Pine Script® v6</a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Pine Script® primer</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <symbol id="ai:local:theme/right-caret"><path fill="currentColor" d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1 1 0 0 0 0-1.42"></path></symbol><use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-steps" data-astro-cid-omxx3dey="">First steps</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-indicator" data-astro-cid-omxx3dey="">First indicator</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/next-steps" data-astro-cid-omxx3dey="">Next steps</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Language</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/execution-model" data-astro-cid-omxx3dey="">Execution model</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/type-system" data-astro-cid-omxx3dey="">Type system</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/script-structure" data-astro-cid-omxx3dey="">Script structure</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/identifiers" data-astro-cid-omxx3dey="">Identifiers</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/variable-declarations" data-astro-cid-omxx3dey="">Variable declarations</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/operators" data-astro-cid-omxx3dey="">Operators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/conditional-structures" data-astro-cid-omxx3dey="">Conditional structures</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/loops" data-astro-cid-omxx3dey="">Loops</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/built-ins" data-astro-cid-omxx3dey="">Built-ins</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/user-defined-functions" data-astro-cid-omxx3dey="">User-defined functions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/objects" data-astro-cid-omxx3dey="">Objects</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/enums" data-astro-cid-omxx3dey="">Enums</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/methods" data-astro-cid-omxx3dey="">Methods</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/arrays" data-astro-cid-omxx3dey="">Arrays</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/matrices" data-astro-cid-omxx3dey="">Matrices</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/maps" data-astro-cid-omxx3dey="">Maps</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Visuals</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/overview" data-astro-cid-omxx3dey="">Overview</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/backgrounds" data-astro-cid-omxx3dey="">Backgrounds</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/bar-coloring" data-astro-cid-omxx3dey="">Bar coloring</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/bar-plotting" data-astro-cid-omxx3dey="">Bar plotting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/colors" data-astro-cid-omxx3dey="">Colors</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/fills" data-astro-cid-omxx3dey="">Fills</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/levels" data-astro-cid-omxx3dey="">Levels</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/lines-and-boxes" data-astro-cid-omxx3dey="">Lines and boxes</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/plots" data-astro-cid-omxx3dey="">Plots</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/tables" data-astro-cid-omxx3dey="">Tables</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/text-and-shapes" data-astro-cid-omxx3dey="">Text and shapes</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Concepts</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/alerts" data-astro-cid-omxx3dey="">Alerts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-states" data-astro-cid-omxx3dey="">Bar states</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/chart-information" data-astro-cid-omxx3dey="">Chart information</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/inputs" data-astro-cid-omxx3dey="">Inputs</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/libraries" data-astro-cid-omxx3dey="">Libraries</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/non-standard-charts-data" data-astro-cid-omxx3dey="">Non-standard charts data</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/other-timeframes-and-data" data-astro-cid-omxx3dey="">Other timeframes and data</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/repainting" data-astro-cid-omxx3dey="">Repainting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/sessions" data-astro-cid-omxx3dey="">Sessions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strategies" data-astro-cid-omxx3dey="">Strategies</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strings" data-astro-cid-omxx3dey="">Strings</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/time" data-astro-cid-omxx3dey="">Time</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/timeframes" data-astro-cid-omxx3dey="">Timeframes</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Writing scripts</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/style-guide" data-astro-cid-omxx3dey="">Style guide</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/debugging" data-astro-cid-omxx3dey="">Debugging</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/profiling-and-optimization" data-astro-cid-omxx3dey="">Profiling and optimization</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/publishing" data-astro-cid-omxx3dey="">Publishing scripts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/limitations" data-astro-cid-omxx3dey="">Limitations</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details open="" data-is-parent="" data-is-on-path="" data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">FAQ</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/general" data-astro-cid-omxx3dey="">General</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/alerts" data-astro-cid-omxx3dey="">Alerts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/data-structures" data-astro-cid-omxx3dey="">Data structures</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/functions" data-astro-cid-omxx3dey="">Functions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/indicators" data-astro-cid-omxx3dey="">Indicators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/other-data-and-timeframes" data-astro-cid-omxx3dey="">Other data and timeframes</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/programming" data-astro-cid-omxx3dey="">Programming</a></li><li class="item" data-current="" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/strategies" data-astro-cid-omxx3dey="">Strategies</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/strings-and-formatting" data-astro-cid-omxx3dey="">Strings and formatting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/techniques" data-astro-cid-omxx3dey="">Techniques</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/times-dates-and-sessions" data-astro-cid-omxx3dey="">Times, dates, and sessions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/variables-and-operators" data-astro-cid-omxx3dey="">Variables and operators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/visuals" data-astro-cid-omxx3dey="">Visuals</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/error-messages" data-astro-cid-omxx3dey="">Error messages</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/release-notes" data-astro-cid-omxx3dey="">Release notes</a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Migration guides</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/overview" data-astro-cid-omxx3dey="">Overview</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-6" data-astro-cid-omxx3dey="">To Pine Script® version 6</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-5" data-astro-cid-omxx3dey="">To Pine Script® version 5</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-4" data-astro-cid-omxx3dey="">To Pine Script® version 4</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-3" data-astro-cid-omxx3dey="">To Pine Script® version 3</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-2" data-astro-cid-omxx3dey="">To Pine Script® version 2</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/where-can-i-get-more-information" data-astro-cid-omxx3dey="">Where can I get more information?</a></li> </ul> <div class="toc-bottom" data-astro-cid-sa57sq6l=""></div> </div> </div> </aside>  <main class="main-pane" data-page-type="md" data-astro-cid-xgirumru=""> <a id="top" data-astro-cid-xgirumru=""></a> <main class="content" data-toc-shown="" data-astro-cid-ju3wuhkz="">  <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-pagefind-ignore="" data-astro-cid-wlavna2o=""> <a href="/pine-script-docs" aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o=""> <span data-astro-cid-wlavna2o="">User Manual</span>  </a>  <span class="divider" data-astro-cid-wlavna2o="">/</span> <a href="/pine-script-docs/faq" data-astro-cid-wlavna2o="">FAQ</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Strategies</span> </div>     </div> <div id="slot-container" data-astro-cid-xgirumru=""> <h1 id="strategies" class="md-heading"><a href="#strategies"> <span class="fancy-wrap">Strategies<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h1>
<p>Using Pine Script® strategy scripts, users can test <em>simulated</em> trades on historical and realtime data, to backtest and forward test trading systems. Strategies are similar to indicators, but with added capabilities such as placing, modifying, and canceling simulated orders and analyzing their results. Scripts that use the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy">strategy()</a> function as their <a href="/pine-script-docs/language/script-structure/#declaration-statement">declaration statement</a> gain access to the <code dir="auto">strategy.*</code> namespace, which contains functions and variables for simulating orders and retrieving strategy information.</p>
<p>When a user applies a strategy that uses <a href="/pine-script-docs/concepts/strategies/#order-placement-and-cancellation">order placement commands</a> to the chart, the strategy uses the <a href="/pine-script-docs/concepts/strategies/#broker-emulator">broker emulator</a> to calculate simulated trades, and displays the results in the <a href="/pine-script-docs/concepts/strategies/#strategy-tester">Strategy Tester</a> tab.</p>
<p>Strategies support <a href="/pine-script-docs/concepts/strategies/#order-types">various types of orders</a> including market, limit, stop, and stop-limit orders, allowing programmers to simulate different trading scenarios. Strategy order commands can send alerts when <a href="/pine-script-docs/concepts/alerts/#order-fill-events">order fill events</a> occur. An <em>order fill event</em> is triggered by the broker emulator when it executes a simulated order in realtime.</p>
<p>For a thorough exploration of strategy features, capabilities, and usage, refer to the <a href="/pine-script-docs/concepts/strategies/">Strategies</a> section in the User Manual.</p>
<h2 id="strategy-basics" class="md-heading"><a href="#strategy-basics">Strategy <span class="fancy-wrap">basics<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<h3 id="how-can-i-turn-my-indicator-into-a-strategy" class="md-heading"><a href="#how-can-i-turn-my-indicator-into-a-strategy">How can I turn my indicator into a <span class="fancy-wrap">strategy?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>To convert an indicator to a strategy, begin by replacing the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_indicator">indicator()</a> declaration with the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy">strategy()</a> declaration. This designates the script as a strategy.</p>
<p>Add <a href="/pine-script-docs/concepts/strategies/#order-placement-and-cancellation">order placement commands</a> for simulating orders. Use logical conditions from the initial indicator to trigger the commands in the converted strategy.</p>
<p>The following example includes two scripts: an initial indicator script and a strategy script converted from the indicator. We use a simple RSI oscillator as a momentum indicator to gauge the direction of a market’s momentum, with values above 50 indicating an upward (bullish) trend and values below 50 signaling a downward (bearish) trend:</p>
<p><img src="/pine-script-docs/_astro/Strategies-Strategy-basics-How-can-i-turn-my-indicator-into-a-strategy-1.gVd2FK1g_2s7IB7.webp" alt="image" width="1720" height="1444" loading="lazy" decoding="async"></p>
<p>The initial indicator colors the plot line and the bars on the chart in a lime color when the RSI is greater than 50 and fuchsia when less than 50. We use <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plotshape">plotshape()</a> to plot triangles at the top and bottom of the oscillator on bars where the RSI crosses over or under the 50 level.</p>
<div class="pine-colorizer not-content colorized" data-id="4z2"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Example&nbsp;RSI&nbsp;indicator"</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.rsi</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"RSI"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.lime</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.fuchsia</span><span class="mtk13">)</span></span><br><span><span class="mtk16">hline</span><span class="mtk13">(</span><span class="mtk12">50</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Middle&nbsp;line"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linestyle</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">hline.style_solid</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plotshape</span><span class="mtk13">(</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Cross&nbsp;up"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk11">shape.arrowup</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk11">location.bottom</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.lime</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plotshape</span><span class="mtk13">(</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Cross&nbsp;Down"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">shape.arrowdown</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">location.top</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">color.fuchsia</span><span class="mtk13">)</span></span><br><span><span class="mtk16">barcolor</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.lime</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.fuchsia</span><span class="mtk13">)</span></span><br></code></div>
<p>In the converted strategy version, we maintain the same RSI crossover and crossunder conditions used in the indicator script. These conditions, which previously only drew the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plotshape">plotshape()</a> triangles, now also trigger entry orders for long and short positions using the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.entry">strategy.entry()</a> function. A long entry is called when the RSI crosses over 50, and a short entry is initiated when it crosses under 50. A long entry cancels a short trade, and vice-versa.</p>
<div class="pine-colorizer not-content colorized" data-id="302"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Example&nbsp;RSI&nbsp;strategy"</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.rsi</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"RSI"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.lime</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.fuchsia</span><span class="mtk13">)</span></span><br><span><span class="mtk16">hline</span><span class="mtk13">(</span><span class="mtk12">50</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Middle&nbsp;line"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linestyle</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">hline.style_solid</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plotshape</span><span class="mtk13">(</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Cross&nbsp;up"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk11">shape.triangleup</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk11">location.bottom</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.lime</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plotshape</span><span class="mtk13">(</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Cross&nbsp;Down"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">shape.triangledown</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">location.top</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">color.fuchsia</span><span class="mtk13">)</span></span><br><span><span class="mtk16">barcolor</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.lime</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.fuchsia</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">comment</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Long"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Short"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">comment</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Short"</span><span class="mtk13">)</span></span><br></code></div>
<h3 id="how-do-i-set-a-basic-stop-loss-order" class="md-heading"><a href="#how-do-i-set-a-basic-stop-loss-order">How do I set a basic stop-loss <span class="fancy-wrap">order?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Stop losses are a risk management method that traders use to limit potential losses. The <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> function sets an order to exit a trade once it hits a specified price, thus preventing the loss from exceeding a predetermined amount.</p>
<p>To implement a basic stop loss in Pine Script, use the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> function with either the <code dir="auto">stop</code> or the <code dir="auto">loss</code> parameter. The <code dir="auto">stop</code> parameter specifies the <em>price</em> for the stop loss order, while the <code dir="auto">loss</code> parameter sets the stop loss a certain number of <em>ticks</em> away from the entry order’s price. Similarly, to set a take-profit level, use either the <code dir="auto">limit</code> parameter, specifying the exact price for taking profit, or the <code dir="auto">profit</code> parameter, defining the profit
size in ticks from the entry price.</p>
<p>If a <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> call includes both the <code dir="auto">stop</code> <em>and</em> <code dir="auto">loss</code> parameters, or both the <code dir="auto">limit</code> <em>and</em> <code dir="auto">profit</code> parameters, the function uses the price level that is expected to trigger an exit first.</p>
<p>The following example script uses the tick-based <code dir="auto">loss</code> parameter for long positions and the price-based <code dir="auto">stop</code> parameter for short positions, and plots these stop levels on the chart.
The script enters positions on the crossover or crossunder of two simple moving averages.</p>
<p><img src="/pine-script-docs/_astro/Strategies-Strategy-basics-How-do-i-set-a-stop-loss-1.BKHhl7z6_A7KbA.webp" alt="image" width="1720" height="1444" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="6jp"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Stop&nbsp;using&nbsp;`loss`&nbsp;and&nbsp;`stop`"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lossTicksInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">60</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Stop&nbsp;loss&nbsp;in&nbsp;ticks&nbsp;(for&nbsp;longs)"</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">atrMultInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"ATR&nbsp;multiplier&nbsp;(for&nbsp;shorts)"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">minval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;ATR&nbsp;value,&nbsp;adjusted&nbsp;by&nbsp;the&nbsp;multip</span><span class="mtk9">lier,&nbsp;for&nbsp;setting&nbsp;dynamic&nbsp;stop&nbsp;loss&nbsp;levels&nbsp;on&nbsp;shor</span><span class="mtk9">t&nbsp;positions.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">atr</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.atr</span><span class="mtk13">(</span><span class="mtk12">14</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">atrMultInput</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;A&nbsp;persistent&nbsp;short&nbsp;stop&nbsp;loss&nbsp;level,&nbsp;updated&nbsp;bas</span><span class="mtk9">ed&nbsp;on&nbsp;short&nbsp;entry&nbsp;signals.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortStopLevel</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Define&nbsp;conditions&nbsp;for&nbsp;entering&nbsp;long&nbsp;and&nbsp;short&nbsp;p</span><span class="mtk9">ositions&nbsp;based&nbsp;on&nbsp;the&nbsp;crossover&nbsp;and&nbsp;crossunder&nbsp;of&nbsp;</span><span class="mtk9">two&nbsp;SMAs.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk12">28</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">longCondition</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk33">ma1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">ma2</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk33">ma1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;On&nbsp;detecting&nbsp;a&nbsp;long&nbsp;condition,&nbsp;place&nbsp;a&nbsp;long&nbsp;ent</span><span class="mtk9">ry.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">longCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;For&nbsp;a&nbsp;short&nbsp;condition,&nbsp;place&nbsp;a&nbsp;short&nbsp;entry&nbsp;and&nbsp;</span><span class="mtk9">set&nbsp;the&nbsp;stop&nbsp;loss&nbsp;level&nbsp;by&nbsp;adding&nbsp;the&nbsp;ATR&nbsp;value&nbsp;to</span><span class="mtk9">&nbsp;the&nbsp;closing&nbsp;price.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Short"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">shortStopLevel</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">atr</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Apply&nbsp;a&nbsp;fixed-size&nbsp;stop&nbsp;loss&nbsp;for&nbsp;long&nbsp;positions</span><span class="mtk9">&nbsp;using&nbsp;the&nbsp;specified&nbsp;input&nbsp;tick&nbsp;size&nbsp;in&nbsp;the&nbsp;`loss`</span><span class="mtk9">&nbsp;parameter.</span></span><br><span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk33">id</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Long&nbsp;Exit"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">from_entry</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">loss</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">lossTicksInput</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;For&nbsp;short&nbsp;positions,&nbsp;set&nbsp;the&nbsp;stop&nbsp;loss&nbsp;at&nbsp;the&nbsp;c</span><span class="mtk9">alculated&nbsp;price&nbsp;level&nbsp;using&nbsp;the&nbsp;`stop`&nbsp;parameter.</span></span><br><span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk33">id</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Short&nbsp;Exit"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">from_entry</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Short"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortStopLevel</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;long&nbsp;stop&nbsp;loss&nbsp;price&nbsp;by&nbsp;subtracti</span><span class="mtk9">ng&nbsp;the&nbsp;loss&nbsp;size&nbsp;from&nbsp;the&nbsp;average&nbsp;entry&nbsp;price.</span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;the&nbsp;price&nbsp;to&nbsp;`na`&nbsp;if&nbsp;the&nbsp;strategy&nbsp;is&nbsp;not&nbsp;in</span><span class="mtk9">&nbsp;a&nbsp;long&nbsp;position.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">longStopPlot</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_avg_price</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">lossTicksInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk11">syminfo.mintick</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//&nbsp;The&nbsp;short&nbsp;stop&nbsp;price&nbsp;is&nbsp;already&nbsp;calculated.&nbsp;Set</span><span class="mtk9">&nbsp;to&nbsp;`na`&nbsp;if&nbsp;the&nbsp;strategy&nbsp;is&nbsp;not&nbsp;in&nbsp;a&nbsp;short&nbsp;positio</span><span class="mtk9">n.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortStopPlot</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortStopLevel</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;moving&nbsp;averages&nbsp;and&nbsp;stop&nbsp;loss&nbsp;levels.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">ma1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"MA&nbsp;1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.lime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk12">50</span><span class="mtk13">))</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">ma2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"MA&nbsp;2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.fuchsia</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">))</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">longStopPlot</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk29">"Long&nbsp;Stop"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_steplinebr</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">shortStopPlot</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Short&nbsp;Stop"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_steplinebr</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Color&nbsp;the&nbsp;background&nbsp;when&nbsp;long&nbsp;or&nbsp;short&nbsp;conditi</span><span class="mtk9">ons&nbsp;are&nbsp;met.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">longCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.aqua</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">90</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>In this example, we include <code dir="auto">from_entry</code> arguments in the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> calls so that each exit order closes only open trades with the corresponding entry ID. Without this argument, the exit intended for long positions would apply to both long <em>and</em> short positions, and the exit intended for short positions would likewise attempt to close any open position.</li>
</ul>
<p>For more information, see the entry in the User Manual on <a href="/pine-script-docs/concepts/strategies/#strategyexit">strategy.exit()</a>.</p>
<h3 id="how-do-i-set-an-advanced-stop-loss-order" class="md-heading"><a href="#how-do-i-set-an-advanced-stop-loss-order">How do I set an advanced stop-loss <span class="fancy-wrap">order?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Scripts can use different types of exits that are more advanced than simply closing the position at a predetermined level.</p>
<p><strong>Bracket orders</strong></p>
<p class="spacer-wrapper"><spacer></spacer>A bracket order is a pair of orders that close the position if price moves far enough in either direction. Scripts can combine a stop-loss and take-profit order within a single <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> function call. See the FAQ entry about <a href="/pine-script-docs/faq/strategies/#how-can-i-configure-a-bracket-order-with-a-specific-risk-to-reward-rr-ratio">bracket orders</a> for more details.</p>
<p><strong>Trailing stop losses</strong></p>
<p class="spacer-wrapper"><spacer></spacer>A trailing stop loss is a stop loss that moves with price, but in the profitable direction only. To create a trailing stop, either adjust the stop price with each new bar, or use the built-in trailing stop parameters in the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> function. Refer to the FAQ on implementing a
<a href="/pine-script-docs/faq/strategies/#how-do-i-place-a-trailing-stop-loss">trailing stop loss</a> for information and examples.</p>
<p><strong>Scaled exits</strong></p>
<p class="spacer-wrapper"><spacer></spacer>Scaled exits use multiple exit orders at varied price levels. When using tiered exit strategies, which progressively scale out of a position, ensure that the total quantity of all exit orders does not surpass the size of the initial entry position. Consult the FAQ on <a href="/pine-script-docs/faq/strategies/#how-can-i-use-multiple-take-profit-levels-to-close-a-position">multiple exits</a> for more information.</p>
<p><strong>Moving a stop loss to breakeven</strong></p>
<p class="spacer-wrapper"><spacer></spacer>Adjusting a stop loss to the breakeven point once a specific condition is met can help in risk management. Details can be found in the FAQ on <a href="/pine-script-docs/faq/strategies/#how-do-i-move-my-stop-loss-order-to-breakeven">moving stop losses to breakeven</a>.</p>
<p><strong>Adjusting position size based on stop loss</strong></p>
<p class="spacer-wrapper"><spacer></spacer>Modify the position size relative to the stop loss to maintain a constant risk percentage of total equity. For more insights, see the FAQ on <a href="/pine-script-docs/faq/strategies/#how-can-i-risk-a-fixed-percentage-of-my-equity-per-trade">position sizing</a>.</p>
<h3 id="how-can-i-save-the-entry-price-in-a-strategy" class="md-heading"><a href="#how-can-i-save-the-entry-price-in-a-strategy">How can I save the entry price in a <span class="fancy-wrap">strategy?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Scripts can access the entry price for a <em>specific trade</em>, or the average entry price for a <em>position</em>.</p>
<p><strong>Average entry price</strong></p>
<p class="spacer-wrapper"><spacer></spacer>The <a href="https://www.tradingview.com/pine-script-reference/v6/#var_strategy.position_avg_price">strategy.position_avg_price</a> variable automatically updates to the average entry price of the current position. If the position consist of only one trade, the average price of the position is equal to the entry price of that single trade.
If a strategy closes a market position that consists of multiple trades, trades are closed in the order they were opened, by default. Since the average price of the open position changes according to which positions are still open, be aware of the order in which trades are closed, and if necessary, configure it using the <code dir="auto">close_entries_rule</code> parameter of the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy">strategy()</a> declaration function.</p>
<p><strong>Specific entry price</strong></p>
<p class="spacer-wrapper"><spacer></spacer>The <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.opentrades.entry_price">strategy.opentrades.entry_price()</a> function returns the entry price for a given trade ID. To find the entry price for the most recent open trade, and remembering that the trade indexes start at zero, use <code dir="auto">float entryPrice = strategy.opentrades.entry_price(strategy.opentrades - 1)</code>.</p>
<h3 id="how-do-i-filter-trades-by-a-date-or-time-range" class="md-heading"><a href="#how-do-i-filter-trades-by-a-date-or-time-range">How do I filter trades by a date or time <span class="fancy-wrap">range?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Using a date and time range filter in a strategy allows trades to be simulated only during a certain time period. Such filters can be useful to backtest specific historical periods, or to focus on particular times of the trading day.</p>
<p>Additionally, if the strategy sends signals for live trading, consider excluding all trades earlier than the trading start date and time, to ensure that the broker emulator starts in a neutral state.</p>
<p>The following example script restricts trading if a bar falls within a defined <code dir="auto">startTime</code> and <code dir="auto">endTime</code>, or outside of an optional intraday session window. The script colors the background red for bars that fall outside the time windows. On the screenshot, we’ve limited the trading range from June 1st 2024 to June 10th 2024, and additionally forbidden trading from 0000-0300 UTC:</p>
<p><img src="/pine-script-docs/_astro/Strategies-Strategy-basics-How-do-i-implement-date-time-range-filtering-in-strategies-1.D00x6Oy9_Z1drnkX.webp" alt="image" width="1720" height="1444" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5zo"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Date/time&nbsp;filtering&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Timezone&nbsp;setting&nbsp;for&nbsp;date&nbsp;and&nbsp;time&nbsp;calculations</span><span class="mtk9">.&nbsp;Adjust&nbsp;to&nbsp;the&nbsp;chart&nbsp;timezone.</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">TZ</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"GMT+0"</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Define&nbsp;the&nbsp;date&nbsp;window,&nbsp;an&nbsp;intraday&nbsp;time&nbsp;sessio</span><span class="mtk9">n&nbsp;to&nbsp;exclude,&nbsp;and&nbsp;the&nbsp;filtering&nbsp;to&nbsp;apply.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">useDateFilterInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.bool</span><span class="mtk13">(</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Allow&nbsp;trades&nbsp;only&nbsp;between&nbsp;the&nbsp;following&nbsp;dates&nbsp;("</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">TZ</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">")"</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">startTimeInput</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.time</span><span class="mtk13">(</span><span class="mtk16">timestamp</span><span class="mtk13">(</span><span class="mtk29">"01&nbsp;Jan&nbsp;2000&nbsp;00:00&nbsp;"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">TZ</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"  Start&nbsp;date"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">confirm</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">endTimeInput</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.time</span><span class="mtk13">(</span><span class="mtk16">timestamp</span><span class="mtk13">(</span><span class="mtk29">"01&nbsp;Jan&nbsp;2099&nbsp;00:00&nbsp;"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">TZ</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"  End&nbsp;date"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">confirm</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">useTimeFilterInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.bool</span><span class="mtk13">(</span><span class="mtk11">false</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Restrict&nbsp;trades&nbsp;during&nbsp;the&nbsp;following&nbsp;times&nbsp;("</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">TZ</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">")"</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">sessionStringInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.session</span><span class="mtk13">(</span><span class="mtk29">"0000-0300"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Determines&nbsp;whether&nbsp;the&nbsp;current&nbsp;bar</span><span class="mtk9">&nbsp;falls&nbsp;within&nbsp;a&nbsp;specified&nbsp;date&nbsp;and&nbsp;time&nbsp;range.</span></span><br><span><span class="mtk9">//&nbsp;</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;startTime&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)&nbsp;A&nbsp;timestamp&nbsp;marking&nbsp;the&nbsp;s</span><span class="mtk9">tart&nbsp;of&nbsp;the&nbsp;time&nbsp;window.</span></span><br><span><span class="mtk9">//&nbsp;</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;endTime&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)&nbsp;A&nbsp;timestamp&nbsp;marking&nbsp;the&nbsp;e</span><span class="mtk9">nd&nbsp;of&nbsp;the&nbsp;time&nbsp;window.</span></span><br><span><span class="mtk9">//&nbsp;</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;useDateFilter&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(bool)&nbsp;Whether&nbsp;to&nbsp;filter&nbsp;betwee</span><span class="mtk9">n&nbsp;`startTime`&nbsp;and&nbsp;`endTime`.&nbsp;Optional.</span></span><br><span><span class="mtk9">//&nbsp;</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;useTimeFilter&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(bool)&nbsp;Whether&nbsp;to&nbsp;restrict&nbsp;trad</span><span class="mtk9">es&nbsp;in&nbsp;the&nbsp;time&nbsp;session.&nbsp;Optional.</span></span><br><span><span class="mtk9">//&nbsp;</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;timeSession&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(string)&nbsp;Session&nbsp;time&nbsp;range&nbsp;in&nbsp;</span><span class="mtk9">'HHMM-HHMM'&nbsp;format,&nbsp;used&nbsp;if&nbsp;`useTimeFilter`&nbsp;is&nbsp;tru</span><span class="mtk9">e.</span></span><br><span><span class="mtk9">//&nbsp;</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;timeZone&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(string)&nbsp;Timezone&nbsp;for&nbsp;the&nbsp;sessi</span><span class="mtk9">on&nbsp;time,&nbsp;used&nbsp;if&nbsp;`useTimeFilter`&nbsp;is&nbsp;true.</span></span><br><span><span class="mtk9">//&nbsp;</span><span class="mtk9 mtkb">@returns</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(bool)&nbsp;`true`&nbsp;if&nbsp;the&nbsp;current&nbsp;bar&nbsp;</span><span class="mtk9">is&nbsp;within&nbsp;the&nbsp;specified&nbsp;date&nbsp;and&nbsp;time&nbsp;range.</span></span><br><span><span class="mtk15">timeWithinAllowedRange</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">startTime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">endTime</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">useDateFilter</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">useTimeFilter</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">false</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">timeSession</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"0000-0000"</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">timeZone</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"GMT-0"</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">isOutsideTime</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk16">time</span><span class="mtk13">(</span><span class="mtk11">timeframe.period</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">timeSession</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">timeZone</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">timeIsAllowed</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">useTimeFilter</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk33">isOutsideTime</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk18">not</span><span class="mtk1">&nbsp;</span><span class="mtk33">useTimeFilter</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">dateIsAllowed</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">time</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">startTime</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">time</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">endTime</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk18">not</span><span class="mtk1">&nbsp;</span><span class="mtk33">useDateFilter</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">result</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">timeIsAllowed</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk33">dateIsAllowed</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Determine&nbsp;if&nbsp;each&nbsp;bar&nbsp;falls&nbsp;within&nbsp;the&nbsp;date&nbsp;win</span><span class="mtk9">dow&nbsp;or&nbsp;outside&nbsp;the&nbsp;ignored&nbsp;time&nbsp;session.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">isWithinTime</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">timeWithinAllowedRange</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk33">startTimeInput</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">endTimeInput</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">useDateFilterInput</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">useTimeFilterInput</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">sessionStringInput</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">TZ</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Calculate&nbsp;RSI&nbsp;for&nbsp;simple&nbsp;trading&nbsp;signals.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.rsi</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Generate&nbsp;trading&nbsp;signals&nbsp;based&nbsp;on&nbsp;RSI&nbsp;condition</span><span class="mtk9">s,&nbsp;provided&nbsp;they&nbsp;occur&nbsp;within&nbsp;the&nbsp;permissible&nbsp;date</span><span class="mtk9">/time&nbsp;range.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">enterLong</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk33">isWithinTime</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">enterShort</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk33">isWithinTime</span></span><br><span><span class="mtk9">//&nbsp;Simulate&nbsp;trades&nbsp;only&nbsp;if&nbsp;they&nbsp;meet&nbsp;the&nbsp;filtering</span><span class="mtk9">&nbsp;criteria.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">enterLong</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">enterShort</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Short"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Color&nbsp;the&nbsp;background&nbsp;red&nbsp;for&nbsp;bars&nbsp;falling&nbsp;outsi</span><span class="mtk9">de&nbsp;the&nbsp;specified&nbsp;date/time&nbsp;range.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">isWithinTime</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Exempt&nbsp;times"</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>We use the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_time">time()</a> function to calculate whether bars are outside the user-defined session times. For additional details on integrating session data in Pine Script, refer to the <a href="/pine-script-docs/concepts/sessions/">Sessions</a> section in the User Manual.</li>
<li>We set the <code dir="auto">confirm</code> argument to <code dir="auto">true</code> for the inputs that define the time range. When the script is first added to the chart, it prompts the user to confirm the values by clicking on the chart.</li>
<li>We use a constant string <code dir="auto">TZ</code> in our script to represent the time zone (set to <code dir="auto">"GMT+0"</code> by default). Adjust this string to the local time zone or the exchange’s time zone. We use a constant rather than an input so that we can include the time zone in input titles.</li>
</ul>
<h2 id="order-execution-and-management" class="md-heading"><a href="#order-execution-and-management">Order execution and <span class="fancy-wrap">management<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<h3 id="why-are-my-orders-executed-on-the-bar-following-my-triggers" class="md-heading"><a href="#why-are-my-orders-executed-on-the-bar-following-my-triggers">Why are my orders executed on the bar following my <span class="fancy-wrap">triggers?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Each historical bar in a chart is composed of a single set of <a href="https://www.tradingview.com/pine-script-reference/v6/#var_open">open</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_low">low</a> and <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> (OHLC) data. Pine scripts execute on this data once per historical bar, at the <strong>close</strong> of the bar.</p>
<p>So that results are consistent between historical and realtime bars, strategies also execute at the close of realtime bars. The next possible moment for an order to be filled is the beginning of the next bar.</p>
<p>Users can <a href="/pine-script-docs/concepts/strategies/#altering-calculation-behavior">alter a strategy’s calculation behavior</a> by configuring strategies to process orders at the close of the signal bar instead, by selecting the “Fill orders/On bar close” setting in the “Settings/Properties” tab. Programmers can do the same by setting the <a href="/pine-script-docs/concepts/strategies/#process_orders_on_close">process_orders_on_close</a> parameter to <code dir="auto">true</code> in the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy">strategy()</a> declaration statement:</p>
<div class="pine-colorizer not-content colorized" data-id="11r"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"My&nbsp;Strategy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">process_orders_on_close</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;...)</span></span><br></code></div>
<p>An alternative method is to specify the <code dir="auto">immediately</code> parameter as <code dir="auto">true</code> in a <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.close">strategy.close()</a> or <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.close_all">strategy.close_all</a> function call. This setting causes the broker emulator to close a position on the same tick that the strategy creates the close order — meaning, when bar closes instead of the beginning of the next one. The <a href="/pine-script-docs/concepts/strategies/#process_orders_on_close">process_orders_on_close</a> parameter affects all closing orders in the strategy, whereas the <code dir="auto">immediately</code> parameter affects only the close order in which it is used.</p>
<p>However, processing orders on close might not give accurate results. For instance, if an alert occurs at the close of the session’s last bar, the actual order can be executed only on the next trading day, since the bar is already closed. In contrast, the emulator would simulate the order being filled at the previous day’s close. This discrepancy can lead to repainting, where the behavior of the strategy’s simulation on historical bars differs from that seen in live trading.</p>
<h3 id="how-can-i-use-multiple-take-profit-levels-to-close-a-position" class="md-heading"><a href="#how-can-i-use-multiple-take-profit-levels-to-close-a-position">How can I use multiple take-profit levels to close a <span class="fancy-wrap">position?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Setting up a strategy with multiple take profit levels enables traders to scale out of trades in segments to secure profits incrementally.</p>
<p>There are two main methods for scaling out at varying levels:</p>
<ul>
<li>Multiple <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit</a> calls. This method is most suitable when each take-profit level has a corresponding stop loss.</li>
<li>An <a href="/pine-script-docs/concepts/strategies/#strategyocareduce">OCA reduce group</a>. This method is ideal for a different number of take-profit levels and stop losses.</li>
</ul>
<h4 id="multiple-strategyexit-functions" class="md-heading"><a href="#multiple-strategyexit-functions"><span>Multiple ​<code dir="auto">strategy.exit()</code>​ functions</span><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></a></h4>
<p>Each <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> call can set a bracket order for a specific take-profit and stop-loss level.
However, if a strategy uses multiple <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> functions with the <strong>same</strong> stop level, each function call triggers a <em>separate</em> order (and therefore multiple order alerts). If order alerts are configured to trigger real trades, ensure that the trade system handles multiple alerts at the same stop level appropriately.</p>
<p>The following example script uses two separate <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> functions, each with its own stop-loss and take-profit levels. The quantity for the first bracket order is set to 50% of the total position size. This combination of orders creates a scaled exit with distinct stop levels.</p>
<p><img src="/pine-script-docs/_astro/Strategies-Order-execution-and-management-How-can-i-set-up-multiple-take-profit-levels-to-gradually-close-out-a-position-1.B0Hj7Z0J_Z25ph33.webp" alt="image" width="1720" height="1444" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5kw"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Multiple&nbsp;exit&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPercentInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Exit&nbsp;%"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">minval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">maxval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">99</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPercent</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPercentInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;on&nbsp;every&nbsp;100th&nbsp;bar.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Exit&nbsp;levels&nbsp;for&nbsp;`Exit1`</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Exit&nbsp;levels&nbsp;for&nbsp;`Exit2`</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;orders&nbsp;when&nbsp;`buyCondition`&nbsp;is&nbsp;true&nbsp;and&nbsp;we</span><span class="mtk9">&nbsp;are&nbsp;not&nbsp;in&nbsp;a&nbsp;position.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopLoss1</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPercent</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit1</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPercent</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Update&nbsp;the&nbsp;levels&nbsp;based&nbsp;on&nbsp;the&nbsp;current&nbsp;price</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopLoss2</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPercent</span><span class="mtk13">))</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit2</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPercent</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"Exit1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">qty_percent</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"Exit2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;`stopLoss1`&nbsp;and&nbsp;`takeProfit1`&nbsp;to&nbsp;`na`&nbsp;when&nbsp;</span><span class="mtk9">price&nbsp;touches&nbsp;either.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss1</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopLoss1</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">takeProfit1</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;`stopLoss2`&nbsp;and&nbsp;`takeProfit2`&nbsp;to&nbsp;`na`&nbsp;when&nbsp;</span><span class="mtk9">price&nbsp;touches&nbsp;either.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss2</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit2</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopLoss2</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">takeProfit2</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">stopLoss1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"SL1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_circles</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">stopLoss2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"SL2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_circles</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">takeProfit1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"TP1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_circles</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">takeProfit2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"TP2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_circles</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>We use persistent global variables for the take-profit and stop-loss levels so that we can plot them. Otherwise, declaring the variables in the first <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_if">if</a> block would be simpler.</li>
</ul>
<h4 id="using-strategyocareduce" class="md-heading"><a href="#using-strategyocareduce"><span>Using ​<code dir="auto">strategy.oca.reduce</code>​</span><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></a></h4>
<p>Creating exit orders as a group, using the <a href="/pine-script-docs/concepts/strategies/#strategyocareduce">strategy.oca.reduce</a> type, ensures that when one exit order from the group is filled, the quantity of the remaining orders is reduced accordingly. This method is ideal in scripts that have an unequal number of take-profit levels to stops.</p>
<p>When using a group of orders whose OCA type is <a href="/pine-script-docs/concepts/strategies/#strategyocareduce">strategy.oca.reduce</a>, we recommend ensuring that the total size of all exit orders, after any reductions, matches the size of the initial entry orders. Matching the sizes guarantees that the strategy closes the position entirely without leaving any part open or inadvertently opening a new position in the opposite direction.</p>
<p>The following example script uses two take-profit levels but only one stop level. All three sell orders have the same <code dir="auto">oca_name</code>, which means they form a group. They have <code dir="auto">oca_type = strategy.oca.reduce</code> set, so that filling one of the limit orders reduces the quantity of the remaining orders. The total quantity of the exit orders matches the entry order quantity, preventing the strategy from trading an excessive number of units and causing a reversal.</p>
<p><img src="/pine-script-docs/_astro/Strategies-Order-execution-and-management-How-can-i-set-up-multiple-take-profit-levels-to-gradually-close-out-a-position-2.aS_yB9mZ_1TxPpG.webp" alt="image" width="1720" height="1444" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="49d"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Multiple&nbsp;TP,&nbsp;one&nbsp;stop&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPercentInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Exit&nbsp;%"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">minval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">maxval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">99</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPercent</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPercentInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span></span><br><span><span></span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Is&nbsp;`true`&nbsp;on&nbsp;every&nbsp;100th&nbsp;bar.</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;orders&nbsp;when&nbsp;`buyCondition`&nbsp;is&nbsp;true&nbsp;and&nbsp;we</span><span class="mtk9">&nbsp;are&nbsp;not&nbsp;in&nbsp;a&nbsp;position.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPercent</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">limit1</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPercent</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">limit2</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPercent</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">6</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;All&nbsp;three&nbsp;sell&nbsp;orders&nbsp;use&nbsp;the&nbsp;"Bracket"&nbsp;OCA&nbsp;gro</span><span class="mtk9">up;&nbsp;filling&nbsp;one&nbsp;order&nbsp;reduces&nbsp;the&nbsp;quantity&nbsp;of&nbsp;the&nbsp;</span><span class="mtk9">remaining&nbsp;orders.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.order</span><span class="mtk13">(</span><span class="mtk29">"Stop"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">6</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">oca_name</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Bracket"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">oca_type</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.oca.reduce</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.order</span><span class="mtk13">(</span><span class="mtk29">"Limit&nbsp;1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">oca_name</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Bracket"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">oca_type</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.oca.reduce</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.order</span><span class="mtk13">(</span><span class="mtk29">"Limit&nbsp;2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">6</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">oca_name</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Bracket"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">oca_type</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.oca.reduce</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;`limit1`&nbsp;to&nbsp;`na`&nbsp;when&nbsp;price&nbsp;exceeds&nbsp;it.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">limit1</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;`stop`,&nbsp;`limit11`,&nbsp;and&nbsp;`limit2`&nbsp;to&nbsp;`na`&nbsp;whe</span><span class="mtk9">n&nbsp;price&nbsp;surpasses&nbsp;either&nbsp;the&nbsp;last&nbsp;take-profit,&nbsp;or&nbsp;</span><span class="mtk9">the&nbsp;stop.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit2</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit1</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit2</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">stop</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Stop"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">limit1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Limit&nbsp;1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">limit2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Limit&nbsp;2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br></code></div>
<h3 id="how-can-i-execute-a-trade-partway-through-a-bar" class="md-heading"><a href="#how-can-i-execute-a-trade-partway-through-a-bar">How can I execute a trade partway through a <span class="fancy-wrap">bar?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>On <a href="/pine-script-docs/language/execution-model/#executions-on-historical-bars">historical bars</a>, Pine scripts can access only a single set of <a href="https://www.tradingview.com/pine-script-reference/v6/#var_open">open</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_low">low</a> and <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> (OHLC) data per bar.
Consequently, strategies are calculated once, at the close of each bar. This limitation means it’s not possible to evaluate logical conditions that occur mid-bar, such as a price cross, on historical data.</p>
<h4 id="using-calc_on_every_tick" class="md-heading"><a href="#using-calc_on_every_tick"><span>Using ​<code dir="auto">calc_on_every_tick</code>​</span><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></a></h4>
<p>Strategies running on <a href="/pine-script-docs/language/execution-model/#executions-on-realtime-bars">realtime bars</a> can simulate orders partway through a bar by enabling the <a href="/pine-script-docs/concepts/strategies/#calc_on_every_tick">calc_on_every_tick</a> parameter. This setting allows the strategy to process each tick (incoming price update) and execute trades on the tick after a logical condition occurs.</p>
<aside aria-label="Notice" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice</span>In contrast to realtime bars, historical bars do not contain data for each incoming tick. Those bars contain only confirmed price data. Consequently, a strategy that enables calculation on every tick might <a href="/pine-script-docs/concepts/repainting/">repaint</a> on elapsed realtime bars after reloading, because those bars become <em>historical</em> and no longer contain data for each tick before their close. Therefore, we recommend setting <code dir="auto">calc_on_every_tick</code> to <code dir="auto">false</code> while backtesting.</p></div></aside>
<h4 id="using-predefined-prices" class="md-heading"><a href="#using-predefined-prices">Using predefined <span class="fancy-wrap">prices<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p>Stop or limit orders at predefined prices <em>can</em> execute orders partway through a bar, even when the strategy does not enable the <code dir="auto">calc_on_every_tick</code> parameter. This method is effective on both realtime <em>and</em> historical data. Even though orders are processed on the close of historical bars, the broker emulator simulates an order fill at the predefined price level, if the broker determines that price has hit that level during the bar.
For information about the assumptions that the broker emulator makes about price movements, see the <a href="/pine-script-docs/concepts/strategies/#broker-emulator">Broker emulator</a> section of the User Manual.</p>
<p>The following example script uses stop and limit orders to exit a trade partway through a bar. The script calls the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> function with the <code dir="auto">stop</code> and <code dir="auto">limit</code> parameters, determining the specific price levels at which the trade will exit.</p>
<p><img src="/pine-script-docs/_astro/Strategies-Order-execution-and-management-How-can-i-execute-a-trade-midway-through-a-bar-before-it-fully-closes-1.D1Kusv4G_7Dxa1.webp" alt="image" width="1720" height="1444" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="4i2"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Predefined&nbsp;price&nbsp;exit&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPercentInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Exit&nbsp;%"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">minval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">maxval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">99</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPercent</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPercentInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;on&nbsp;every&nbsp;100th&nbsp;bar.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;orders&nbsp;when&nbsp;`buyCondition`&nbsp;is&nbsp;true&nbsp;and&nbsp;we</span><span class="mtk9">&nbsp;are&nbsp;not&nbsp;in&nbsp;a&nbsp;position.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPercent</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPercent</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"exit"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;`stopLoss`&nbsp;and&nbsp;`takeProfit`&nbsp;to&nbsp;`na`&nbsp;when&nbsp;pr</span><span class="mtk9">ice&nbsp;touches&nbsp;either,&nbsp;i.e.,&nbsp;when&nbsp;the&nbsp;strategy&nbsp;simula</span><span class="mtk9">tes&nbsp;an&nbsp;exit.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">stopLoss</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"SL"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">takeProfit</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"TP"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br></code></div>
<h3 id="how-can-i-exit-a-trade-in-the-same-bar-as-it-opens" class="md-heading"><a href="#how-can-i-exit-a-trade-in-the-same-bar-as-it-opens">How can I exit a trade in the same bar as it <span class="fancy-wrap">opens?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Sometimes, strategy testers want to be able to exit a trade in the same bar as the entry. By default, if an exit condition occurs during the same bar that a trade is opened, the broker emulator closes the trade at the open of the <em>next</em> bar. To learn why this happens, refer to <a href="/pine-script-docs/faq/strategies/#why-are-my-orders-executed-on-the-bar-following-my-triggers">this FAQ entry</a>.</p>
<p>To override this default behavior, either specify exit prices, or exit with a market order at the bar close.</p>
<h4 id="specifying-exit-prices" class="md-heading"><a href="#specifying-exit-prices">Specifying exit <span class="fancy-wrap">prices<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p>If the entry command also sets stop-loss or take-profit orders to trigger an exit when certain price levels are reached, then the trade can exit during the same bar that it opens.</p>
<p>In the following example script, the trade exits within the same bar <em>if</em> the price hits either of the defined profit or loss levels. Setting small profit and loss values increases the likelihood of triggering an exit within the entry bar, although the trade could hit those levels for the first time in a subsequent bar instead.</p>
<div class="pine-colorizer not-content colorized" data-id="sx"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Exit&nbsp;on&nbsp;entry&nbsp;bar&nbsp;with&nbsp;specific&nbsp;price"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitTickSizeInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Exit&nbsp;if&nbsp;price&nbsp;moves&nbsp;this&nbsp;many&nbsp;ticks"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">minval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;on&nbsp;every&nbsp;100th&nbsp;bar.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;orders&nbsp;when&nbsp;`buyCondition`&nbsp;is&nbsp;true&nbsp;and&nbsp;we</span><span class="mtk9">&nbsp;are&nbsp;not&nbsp;in&nbsp;a&nbsp;position.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"exit"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">profit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitTickSizeInput</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">loss</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitTickSizeInput</span><span class="mtk13">)</span></span><br></code></div>
<h4 id="using-a-market-order-at-bar-close" class="md-heading"><a href="#using-a-market-order-at-bar-close">Using a market order at bar <span class="fancy-wrap">close<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p>Another method to exit a trade in the same bar that it opens is to use a market order at the bar’s close, by setting the <code dir="auto">immediately</code> argument to <code dir="auto">true</code> in the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.close">strategy.close()</a> function.</p>
<p>In the following example script, if the buy order is opened, the strategy closes the position at the end of the entry bar. Scripts can call the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.close">strategy.close()</a> function conditionally within a local block if necessary. For simplicity, in this example we apply the command to every entry.</p>
<div class="pine-colorizer not-content colorized" data-id="6e6"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Exit&nbsp;on&nbsp;entry&nbsp;bar&nbsp;with&nbsp;market&nbsp;order"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;on&nbsp;every&nbsp;100th&nbsp;bar.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;orders&nbsp;when&nbsp;`buyCondition`&nbsp;is&nbsp;true&nbsp;and&nbsp;we</span><span class="mtk9">&nbsp;are&nbsp;not&nbsp;in&nbsp;a&nbsp;position.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk16">strategy.close</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">immediately</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br></code></div>
<aside aria-label="Notice" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice</span>The <code dir="auto">immediately</code> parameter operates in a similar way to <a href="/pine-script-docs/concepts/strategies/#process_orders_on_close">process_orders_on_close</a>, but it is specific to the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.close">strategy.close()</a> and <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.close_all">strategy.close_all()</a> functions. The emulator calculates the close order using bar closing prices, but the same prices might not always be attainable in realtime trading. Additionally, this behavior can cause <a href="/pine-script-docs/concepts/repainting/">repainting</a>.</p></div></aside>
<h2 id="advanced-order-types-and-conditions" class="md-heading"><a href="#advanced-order-types-and-conditions">Advanced order types and <span class="fancy-wrap">conditions<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<h3 id="how-can-i-set-stop-loss-and-take-profit-levels-as-a-percentage-from-my-entry-point" class="md-heading"><a href="#how-can-i-set-stop-loss-and-take-profit-levels-as-a-percentage-from-my-entry-point">How can I set stop-loss and take-profit levels as a percentage from my entry <span class="fancy-wrap">point?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>To set exit orders as a percentage from the entry price, the script needs the average entry price calculated by the broker emulator (which is affected by conditions including multiple entries and slippage). However, the built-in variable <a href="https://www.tradingview.com/pine-script-reference/v6/#var_strategy.position_avg_price">strategy.position_avg_price</a> returns <a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a> until the close of the entry bar. This means that take-profit and stop-loss orders based on the entry price can only be placed during the <em>next</em> bar.</p>
<p>If programmers want strategies to be able to close trades on the same bar that they are opened, there are two workarounds, each of which have their own benefits and limitations: altering the emulator behavior and using a different, fixed value.</p>
<h4 id="using-calc_on_order_fills" class="md-heading"><a href="#using-calc_on_order_fills"><span>Using ​<code dir="auto">calc_on_order_fills</code>​</span><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></a></h4>
<p>Setting the <a href="/pine-script-docs/concepts/strategies/#calc_on_order_fills">calc_on_order_fills</a> argument of the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy">strategy()</a> declaration function to <code dir="auto">true</code> recalculates the strategy immediately after simulating an order fill. This setting provides access to data such as the current average price of a position on an unconfirmed bar.</p>
<aside aria-label="Notice" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice</span>Enabling <code dir="auto">calc_on_order_fills</code> for some strategies might lead to unrealistic results on historical bars. During the extra script execution after an order fills, the script has access to the <em>confirmed</em> OHLC values for the historical bar, but those values would not be available in the real world until the bar’s closing time. For an explanation of this form of <em>lookahead bias</em>, see <a href="https://www.tradingview.com/support/solutions/43000614705-strategy-produces-unrealistically-good-results-by-peeking-into-the-future/">this Help Center article</a>.</p></div></aside>
<p>The following example script sets take-profit and stop-loss orders during the entry bar, based on the entry price <a href="https://www.tradingview.com/pine-script-reference/v6/#var_strategy.position_avg_price">strategy.position_avg_price</a>. The script uses the <code dir="auto">calc_on_order_fills</code> setting to enable this behavior.</p>
<div class="pine-colorizer not-content colorized" data-id="297"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Exit&nbsp;demo&nbsp;using&nbsp;`calc_on_order_fills`"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">calc_on_order_fills</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopSizeInput</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"SL&nbsp;%"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">minval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk12">100.0</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">profitSizeInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"TP&nbsp;%"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">minval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk12">100.0</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;on&nbsp;every&nbsp;100th&nbsp;bar.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Stop-loss&nbsp;price&nbsp;for&nbsp;exit&nbsp;commands.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Take-profit&nbsp;price&nbsp;for&nbsp;exit&nbsp;commands.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;orders&nbsp;when&nbsp;`buyCondition`&nbsp;is&nbsp;true&nbsp;and&nbsp;we</span><span class="mtk9">&nbsp;are&nbsp;not&nbsp;in&nbsp;a&nbsp;position.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;If&nbsp;we&nbsp;are&nbsp;in&nbsp;a&nbsp;position,&nbsp;set&nbsp;the&nbsp;exit&nbsp;orders.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">!=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_avg_price</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopSizeInput</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_avg_price</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">profitSizeInput</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"exit"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;`stopLoss`&nbsp;and&nbsp;`takeProfit`&nbsp;to&nbsp;`na`&nbsp;when&nbsp;pr</span><span class="mtk9">ice&nbsp;touches&nbsp;either,&nbsp;i.e.,&nbsp;when&nbsp;the&nbsp;strategy&nbsp;simula</span><span class="mtk9">tes&nbsp;an&nbsp;exit.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">stopLoss</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"SL"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">takeProfit</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"TP"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>If we change <code dir="auto">calc_on_order_fills</code> to <code dir="auto">false</code> in this script, the exit orders are placed on the bar <em>after</em> the entry bar, and can fill at very different levels depending on the movement of price.</li>
</ul>
<h4 id="using-predefined-prices-1" class="md-heading"><a href="#using-predefined-prices-1">Using predefined <span class="fancy-wrap">prices<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p>The following example script calculates the stop and limit orders based on the <em>closing price</em> of the signal bar. The disadvantage of this approach is that the close price might not match the average opening price exactly. The advantage is that this method doesn’t introduce potential <em>lookahead bias</em> like using <code dir="auto">calc_on_order_fills</code>.</p>
<div class="pine-colorizer not-content colorized" data-id="7ku"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Exit&nbsp;demo&nbsp;using&nbsp;predefined&nbsp;prices"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopSizeInput</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"SL&nbsp;%"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">minval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk12">100.0</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">profitSizeInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"TP&nbsp;%"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">minval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk12">100.0</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;on&nbsp;every&nbsp;100th&nbsp;bar.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Stop-loss&nbsp;price&nbsp;for&nbsp;exit&nbsp;commands.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Take-profit&nbsp;price&nbsp;for&nbsp;exit&nbsp;commands.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;orders&nbsp;when&nbsp;`buyCondition`&nbsp;is&nbsp;true&nbsp;and&nbsp;we</span><span class="mtk9">&nbsp;are&nbsp;not&nbsp;in&nbsp;a&nbsp;position.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopSizeInput</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">profitSizeInput</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"exit"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;`stopLoss`&nbsp;and&nbsp;`takeProfit`&nbsp;to&nbsp;`na`&nbsp;when&nbsp;pr</span><span class="mtk9">ice&nbsp;touches&nbsp;either,&nbsp;i.e.,&nbsp;when&nbsp;the&nbsp;strategy&nbsp;simula</span><span class="mtk9">tes&nbsp;an&nbsp;exit.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">stopLoss</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"SL"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">takeProfit</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"TP"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br></code></div>
<h3 id="how-do-i-move-my-stop-loss-order-to-breakeven" class="md-heading"><a href="#how-do-i-move-my-stop-loss-order-to-breakeven">How do I move my stop-loss order to <span class="fancy-wrap">breakeven?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Moving a stop-loss order to breakeven can be a useful technique to manage risk.</p>
<p>The following example script sets a persistent <code dir="auto">stopLoss</code> variable when the strategy enters a position. The script then updates the stop price to the entry price when the market price gets halfway to the take-profit level. The script calls the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> function on every bar to ensure that the broker emulator receives any updates made to the <code dir="auto">stopLoss</code> value. Lastly, it plots the average price according to the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_strategy.position_avg_price">strategy.position_avg_price</a> variable for reference.</p>
<p><img src="/pine-script-docs/_astro/Strategies-Advanced-order-types-and-conditions-How-do-i-move-my-stop-loss-to-breakeven-1.IzyaMOFu_1VWlEM.webp" alt="image" width="1720" height="1444" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5p0"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Move&nbsp;stop&nbsp;to&nbsp;breakeven"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopSizeInput</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">5.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"SL&nbsp;%"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">minval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk12">100.0</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">profitSizeInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">5.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"TP&nbsp;%"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">minval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk12">100.0</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">breakEvenInput</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">50</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk29">"BE&nbsp;%"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">minval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">maxval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk12">100.0</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;on&nbsp;every&nbsp;100th&nbsp;bar.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Stop-loss&nbsp;price&nbsp;for&nbsp;exit&nbsp;commands.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Take-profit&nbsp;price&nbsp;for&nbsp;exit&nbsp;commands.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Price&nbsp;that,&nbsp;if&nbsp;breached,&nbsp;sets&nbsp;the&nbsp;stop&nbsp;to&nbsp;breakev</span><span class="mtk9">en.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">breakEvenThreshold</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;orders&nbsp;when&nbsp;`buyCondition`&nbsp;is&nbsp;true&nbsp;and&nbsp;we</span><span class="mtk9">&nbsp;are&nbsp;not&nbsp;in&nbsp;a&nbsp;position.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopSizeInput</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">profitSizeInput</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Set&nbsp;the&nbsp;breakeven&nbsp;threshold.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">breakEvenThreshold</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">profitSizeInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">breakEvenInput</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;If&nbsp;the&nbsp;breakeven&nbsp;threshold&nbsp;is&nbsp;exceeded&nbsp;while&nbsp;in</span><span class="mtk9">&nbsp;a&nbsp;position,&nbsp;set&nbsp;the&nbsp;stop&nbsp;to&nbsp;the&nbsp;entry&nbsp;price.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">breakEvenThreshold</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">!=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_avg_price</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;on&nbsp;the&nbsp;bar&nbsp;on&nbsp;which&nbsp;a&nbsp;trade&nbsp;exits.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">isExitBar</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.closedtrades.exit_bar_index</span><span class="mtk13">(</span><span class="mtk11">strategy.closedtrades</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Condition&nbsp;to&nbsp;determine&nbsp;when&nbsp;plots&nbsp;are&nbsp;displayed.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">showPlots</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">!=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk33">isExitBar</span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;entry&nbsp;price,&nbsp;stop&nbsp;loss,&nbsp;take-profit,&nbsp;a</span><span class="mtk9">nd&nbsp;the&nbsp;breakeven&nbsp;threshold.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">strategy.position_avg_price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"BE"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">showPlots</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"SL"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">showPlots</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"TP"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">showPlots</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">breakEvenThreshold</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"TG"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_circles</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;a&nbsp;bracket&nbsp;order&nbsp;using&nbsp;the&nbsp;`stopLoss`&nbsp;and&nbsp;</span><span class="mtk9">`takeProfit`&nbsp;values.</span></span><br><span><span class="mtk9">//&nbsp;We&nbsp;call&nbsp;it&nbsp;on&nbsp;every&nbsp;bar&nbsp;so&nbsp;that&nbsp;the&nbsp;stop&nbsp;level&nbsp;</span><span class="mtk9">is&nbsp;updated&nbsp;when&nbsp;the&nbsp;breakeven&nbsp;threshold&nbsp;is&nbsp;exceede</span><span class="mtk9">d.</span></span><br><span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"exit"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLoss</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfit</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>This strategy uses <a href="https://www.tradingview.com/pine-script-reference/v6/#var_strategy.position_avg_price">strategy.position_avg_price</a> as the breakeven level. However, the real breakeven price of a trade is affected by slippage and commission.</li>
</ul>
<h3 id="how-do-i-place-a-trailing-stop-loss" class="md-heading"><a href="#how-do-i-place-a-trailing-stop-loss">How do I place a trailing stop <span class="fancy-wrap">loss?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>A trailing stop loss limits a trader’s losses while allowing a position to remain open as long as the price moves favorably.</p>
<p>Strategies can create trailing stops either by using the built-in functionality of the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> function or by creating custom trailing stop-loss logic.</p>
<p>Trailing stops set in the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> use live price updates in realtime but <a href="/pine-script-docs/concepts/strategies/#broker-emulator">assumed price movements</a> for historical bars. These assumptions can cause <a href="/pine-script-docs/concepts/repainting/">repainting</a>. This type of trailing stop is therefore potentially more responsive but less accurate.</p>
<p>Custom trailing stop values are typically updated at the close of each bar, and so do not capture realtime intrabar price movements with the same responsiveness. This delay helps to avoid repainting strategy results.</p>
<h4 id="using-built-in-trailing-stop-functionality" class="md-heading"><a href="#using-built-in-trailing-stop-functionality">Using built-in trailing stop <span class="fancy-wrap">functionality<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p>To set a trailing stop in the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> function, specify both <em>when</em> the trail should activate and <em>how far</em> behind price it should trail.</p>
<p><strong>Activation level</strong></p>
<p class="spacer-wrapper"><spacer></spacer>When price crosses this level, the trailing stop activates. The activation level can be set as a number of ticks past the entry price via the <code dir="auto">trail_points</code> parameter, or as a price value via the <code dir="auto">trail_price</code> parameter.</p>
<p><strong>Trail offset</strong></p>
<p class="spacer-wrapper"><spacer></spacer>After it activates, the stop loss trails behind the bar’s <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a> or <a href="https://www.tradingview.com/pine-script-reference/v6/#var_low">low</a> price by this distance, defined in ticks using the <code dir="auto">trail_offset</code> parameter.</p>
<p>In the following long-only example script, the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> function uses the <code dir="auto">trail_points</code> and <code dir="auto">trail_offset</code> parameters to set a trailing stop. The
stop-loss trails the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a>, minus the offset points, after it activates. The script creates and plots a separate <code dir="auto">trailingStop</code> variable to visualize the trailing stop price that the function calculates internally, although this is not necessary for the trailing stop to function. We also set a separate stop-loss order to close trades that go too low before they trigger the trailing stop.</p>
<p><img src="/pine-script-docs/_astro/Strategies-Advanced-order-types-and-conditions-How-do-i-implement-a-trailing-stop-loss-1.CmsIKens_Zkm5Ho.webp" alt="image" width="1720" height="1444" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="yn"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Trailing&nbsp;stop&nbsp;order&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">TT_SO</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"The&nbsp;trailing&nbsp;stop&nbsp;offset&nbsp;in&nbsp;ticks.&nbsp;Also&nbsp;used&nbsp;as&nbsp;t</span><span class="mtk29">he&nbsp;initial&nbsp;stop&nbsp;loss&nbsp;distance&nbsp;from&nbsp;the&nbsp;entry&nbsp;price</span><span class="mtk29">."</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;activation&nbsp;level&nbsp;is&nbsp;this&nbsp;number&nbsp;of&nbsp;ticks&nbsp;abov</span><span class="mtk9">e&nbsp;the&nbsp;entry&nbsp;price.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">activationOffsetInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">1000</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Activation&nbsp;Level&nbsp;Offset&nbsp;(in&nbsp;ticks)"</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;trailing&nbsp;stop&nbsp;trails&nbsp;this&nbsp;many&nbsp;ticks&nbsp;below&nbsp;th</span><span class="mtk9">e&nbsp;high&nbsp;price.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopOffsetInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">2000</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Stop&nbsp;Offset&nbsp;(in&nbsp;ticks)"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">tooltip</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">TT_SO</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;price&nbsp;at&nbsp;which&nbsp;the&nbsp;trailing&nbsp;stop&nbsp;activates.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">trailPriceActivationLevel</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">activationOffsetInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk11">syminfo.mintick</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_avg_price</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;price&nbsp;at&nbsp;which&nbsp;the&nbsp;trailing&nbsp;stop&nbsp;itself&nbsp;is&nbsp;lo</span><span class="mtk9">cated.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">trailingStop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Calculate&nbsp;a&nbsp;fast&nbsp;and&nbsp;slow&nbsp;Simple&nbsp;Moving&nbsp;Average</span><span class="mtk9">.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">28</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;`ma1`&nbsp;crosses&nbsp;over&nbsp;`ma2`&nbsp;and&nbsp;we&nbsp;ar</span><span class="mtk9">e&nbsp;not&nbsp;in&nbsp;a&nbsp;position.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">longCondition</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk33">ma1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">ma2</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;on&nbsp;the&nbsp;bar&nbsp;that&nbsp;a&nbsp;trade&nbsp;exits.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">isExitBar</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.closedtrades.exit_bar_index</span><span class="mtk13">(</span><span class="mtk11">strategy.closedtrades</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.closedtrades.exit_price</span><span class="mtk13">(</span><span class="mtk11">strategy.closedtrades</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Generate&nbsp;a&nbsp;long&nbsp;market&nbsp;order&nbsp;when&nbsp;`longConditio</span><span class="mtk9">n`&nbsp;is&nbsp;`true`.</span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;a&nbsp;static&nbsp;abd&nbsp;trailing&nbsp;stop&nbsp;loss.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">longCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"Stop"</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">from_entry</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Long"</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">trail_points</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">activationOffsetInput</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">trail_offset</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopOffsetInput</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">loss</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopOffsetInput</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;If&nbsp;the&nbsp;high&nbsp;exceeds&nbsp;the&nbsp;activation&nbsp;level,&nbsp;set&nbsp;t</span><span class="mtk9">he&nbsp;`trailingStop`&nbsp;to&nbsp;whichever&nbsp;is&nbsp;higher:</span></span><br><span><span class="mtk9">//&nbsp;the&nbsp;current&nbsp;high&nbsp;minus&nbsp;the&nbsp;price&nbsp;equivalent&nbsp;of&nbsp;</span><span class="mtk9">`stopOffsetInput`&nbsp;or&nbsp;the&nbsp;previous&nbsp;`trailingStop`&nbsp;v</span><span class="mtk9">alue.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">trailPriceActivationLevel</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk33">isExitBar</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk33">exitPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">trailingStop</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">trailingStop</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopOffsetInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk11">syminfo.mintick</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">nz</span><span class="mtk13">(</span><span class="mtk33">trailingStop</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;price&nbsp;of&nbsp;the&nbsp;active&nbsp;stop&nbsp;price,&nbsp;using&nbsp;the&nbsp;tra</span><span class="mtk9">iling&nbsp;stop&nbsp;when&nbsp;activated,&nbsp;or&nbsp;a&nbsp;static&nbsp;stop&nbsp;loss&nbsp;o</span><span class="mtk9">therwise.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLevel</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk33">trailingStop</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_avg_price</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopOffsetInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk11">syminfo.mintick</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk33">trailingStop</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Visualize&nbsp;the&nbsp;movement&nbsp;of&nbsp;the&nbsp;trailing&nbsp;stop&nbsp;and</span><span class="mtk9">&nbsp;the&nbsp;activation&nbsp;level.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">stopLevel</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Stop&nbsp;Level"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">trailPriceActivationLevel</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Activation&nbsp;level"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.aqua</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;two&nbsp;simple&nbsp;moving&nbsp;averages&nbsp;on&nbsp;the&nbsp;c</span><span class="mtk9">hart.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">ma1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"MA&nbsp;1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.lime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk12">60</span><span class="mtk13">))</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">ma2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"MA&nbsp;2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.fuchsia</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">60</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Mark&nbsp;the&nbsp;point&nbsp;where&nbsp;the&nbsp;trailing&nbsp;stop&nbsp;is&nbsp;activ</span><span class="mtk9">ated&nbsp;with&nbsp;a&nbsp;shape&nbsp;and&nbsp;text.</span></span><br><span><span class="mtk16">plotshape</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">trailPriceActivationLevel</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk33">trailingStop</span><span class="mtk13">)[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Trail&nbsp;Activated"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">shape.triangledown</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.small</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.aqua</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Trailing&nbsp;stop\nactivated"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.aqua</span></span><br><span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;the&nbsp;trailing&nbsp;stop&nbsp;to&nbsp;`na`&nbsp;when&nbsp;not&nbsp;in&nbsp;a&nbsp;pos</span><span class="mtk9">ition.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">trailingStop</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br></code></div>
<h4 id="coding-a-custom-trailing-stop" class="md-heading"><a href="#coding-a-custom-trailing-stop">Coding a custom trailing <span class="fancy-wrap">stop<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p>A custom trailing stop can use different activation conditions, and can trail in a different way, to the trailing stop built into the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> function. To work correctly, a custom trailing stop must calculate the stop price on each bar that the stop is active, and call the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> function on each bar to set the <code dir="auto">stop</code> price.</p>
<p>The following example script triggers long and short trades based on crosses of two moving averages. A custom function calculates the trailing stop using the highest or lowest price from the last five bars, adjusted by an <a href="https://www.tradingview.com/support/solutions/43000501823-average-true-range-atr/">Average True Range (ATR)</a> buffer. This method of distancing the stop by a measure of average price movement attempts to reduce premature stop triggers in volatile conditions.</p>
<div class="pine-colorizer not-content colorized" data-id="11k"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"ATR&nbsp;trailing&nbsp;stop&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;the&nbsp;lookback&nbsp;period&nbsp;in&nbsp;bars&nbsp;to&nbsp;identify&nbsp;the</span><span class="mtk9">&nbsp;highest&nbsp;or&nbsp;lowest&nbsp;point&nbsp;for&nbsp;trailing&nbsp;stop&nbsp;calcula</span><span class="mtk9">tions.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">SWING_LOOKBACK</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Calculates&nbsp;a&nbsp;dynamic&nbsp;trailing&nbsp;stop</span><span class="mtk9">&nbsp;by&nbsp;adjusting&nbsp;the&nbsp;highest</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(bearish)&nbsp;or&nbsp;lowest&nbsp;(b</span><span class="mtk9">ullish)&nbsp;swing&nbsp;points&nbsp;over&nbsp;a&nbsp;set&nbsp;`length`</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;bars&nbsp;using&nbsp;the&nbsp;ATR,</span><span class="mtk9">&nbsp;for&nbsp;a&nbsp;stop&nbsp;distance&nbsp;proportional&nbsp;to&nbsp;average&nbsp;bar&nbsp;s</span><span class="mtk9">ize.</span></span><br><span><span class="mtk9">//&nbsp;</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;calcStop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(series&nbsp;bool)&nbsp;A&nbsp;condition&nbsp;that&nbsp;</span><span class="mtk9">activates&nbsp;the&nbsp;trailing&nbsp;stop,&nbsp;e.g.,&nbsp;being&nbsp;in&nbsp;a&nbsp;trad</span><span class="mtk9">e.</span></span><br><span><span class="mtk9">//&nbsp;</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;length&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(simple&nbsp;int)&nbsp;The&nbsp;number&nbsp;of&nbsp;bars</span><span class="mtk9">&nbsp;to&nbsp;look&nbsp;back&nbsp;to&nbsp;determine&nbsp;the&nbsp;highest&nbsp;or&nbsp;lowest&nbsp;p</span><span class="mtk9">oint&nbsp;for</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;trailing&nbsp;stop&nbsp;calc</span><span class="mtk9">ulation.</span></span><br><span><span class="mtk9">//&nbsp;</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;isLong&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(simple&nbsp;bool)&nbsp;Indicator&nbsp;of&nbsp;the&nbsp;</span><span class="mtk9">trailing&nbsp;stop's&nbsp;orientation:&nbsp;true&nbsp;for&nbsp;long&nbsp;trades</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(stop&nbsp;below&nbsp;price)&nbsp;and</span><span class="mtk9">&nbsp;false&nbsp;for&nbsp;short&nbsp;trades&nbsp;(stop&nbsp;above&nbsp;price).</span></span><br><span><span class="mtk9">//&nbsp;</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;atrMultiplier&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(simple&nbsp;float)&nbsp;The&nbsp;multiplier&nbsp;a</span><span class="mtk9">pplied&nbsp;to&nbsp;the&nbsp;ATR,&nbsp;adjusting&nbsp;the&nbsp;stop's&nbsp;distance&nbsp;f</span><span class="mtk9">rom&nbsp;the</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;identified&nbsp;extreme&nbsp;pri</span><span class="mtk9">ce&nbsp;point.&nbsp;Optional.&nbsp;Default&nbsp;is&nbsp;1.0,&nbsp;or&nbsp;100%&nbsp;of&nbsp;the</span><span class="mtk9">&nbsp;ATR&nbsp;value.</span></span><br><span><span class="mtk9">//&nbsp;</span><span class="mtk9 mtkb">@returns</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(float)&nbsp;The&nbsp;trailing&nbsp;stop&nbsp;price,&nbsp;</span><span class="mtk9">or&nbsp;`na`&nbsp;if&nbsp;`calcStop`&nbsp;is&nbsp;false.</span></span><br><span><span class="mtk15">atrTrailingStop</span><span class="mtk13">(</span><span class="mtk18 mtkb">series</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">calcStop</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">simple</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">length</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">simple</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">isLong</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">simple</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">atrMultiplier</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1.0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">trailPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">m</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">isLong</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk12">-1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">atr</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.atr</span><span class="mtk13">(</span><span class="mtk12">14</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">atrMultiplier</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">swingPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk18">switch</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">isLong</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.lowest</span><span class="mtk13">(</span><span class="mtk33">length</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">atr</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">ta.highest</span><span class="mtk13">(</span><span class="mtk33">length</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">atr</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">trailPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk18">switch</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">calcStop</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk18">not</span><span class="mtk1">&nbsp;</span><span class="mtk33">calcStop</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">swingPoint</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">calcStop</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk18">not</span><span class="mtk1">&nbsp;</span><span class="mtk33">calcStop</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk33">trailPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">swingPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">m</span></span><br><span><span></span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Calculate&nbsp;a&nbsp;fast&nbsp;and&nbsp;slow&nbsp;simple&nbsp;moving&nbsp;average</span><span class="mtk9">.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">28</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Conditions&nbsp;for&nbsp;long/short&nbsp;entries&nbsp;on&nbsp;MA&nbsp;crossov</span><span class="mtk9">er/crossunder,&nbsp;if&nbsp;we&nbsp;are&nbsp;not&nbsp;in&nbsp;a&nbsp;position.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">longCondition</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk33">ma1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">ma2</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk33">ma1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma2</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Determine&nbsp;when&nbsp;to&nbsp;calculate&nbsp;trailing&nbsp;stops&nbsp;for&nbsp;</span><span class="mtk9">long/short&nbsp;positions,&nbsp;based&nbsp;on&nbsp;entries&nbsp;and&nbsp;positio</span><span class="mtk9">n.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">isExitBar</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.closedtrades.exit_bar_index</span><span class="mtk13">(</span><span class="mtk11">strategy.closedtrades</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">isLong</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">longCondition</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk33">isExitBar</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">isBear</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk33">isExitBar</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Use&nbsp;`atrTrailingStop()`&nbsp;to&nbsp;calculate&nbsp;trailing&nbsp;s</span><span class="mtk9">tops&nbsp;for&nbsp;both&nbsp;long&nbsp;and&nbsp;short&nbsp;positions.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">longStop</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">atrTrailingStop</span><span class="mtk13">(</span><span class="mtk33">isLong</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">SWING_LOOKBACK</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortStop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">atrTrailingStop</span><span class="mtk13">(</span><span class="mtk33">isBear</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">SWING_LOOKBACK</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">false</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;long&nbsp;entry&nbsp;order&nbsp;when&nbsp;`longCondition`&nbsp;occ</span><span class="mtk9">urs.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">longCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;short&nbsp;entry&nbsp;order&nbsp;when&nbsp;`shortCondition`&nbsp;o</span><span class="mtk9">ccurs.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"short"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Create&nbsp;exit&nbsp;orders&nbsp;for&nbsp;long/short&nbsp;trades&nbsp;with&nbsp;A</span><span class="mtk9">TR&nbsp;trailing&nbsp;stop,&nbsp;called&nbsp;on&nbsp;each&nbsp;bar&nbsp;to&nbsp;update&nbsp;to&nbsp;</span><span class="mtk9">the&nbsp;latest&nbsp;price.</span></span><br><span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"long&nbsp;exit"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk29">"long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">longStop</span><span class="mtk13">)</span></span><br><span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"short&nbsp;exit"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"short"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortStop</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;two&nbsp;simple&nbsp;moving&nbsp;averages&nbsp;and&nbsp;stop</span><span class="mtk9">&nbsp;levels&nbsp;on&nbsp;the&nbsp;chart.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">ma1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"MA&nbsp;1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.lime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk12">60</span><span class="mtk13">))</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">ma2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"MA&nbsp;2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.fuchsia</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">60</span><span class="mtk13">))</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">isExitBar</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">longStop</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk33">longStop</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk29">"Long&nbsp;Stop"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">isExitBar</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortStop</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortStop</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Short&nbsp;Stop"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>Because strategies run once per bar, the trailing stop price in this example script updates at the close of each bar. During realtime bars the <em>previous</em> bar’s stop value is used. This approach, while slightly delayed compared to using the built-in trailing stop described in the FAQ entry about how to place a trailing stop loss <a href="/pine-script-docs/faq/strategies/#using-built-in-trailing-stop-functionality">using built-in trailing stop functionality</a>, ensures that the
trailing stop price is not subject to assumptions about intrabar price movements, and thus avoids repainting.</li>
</ul>
<h3 id="how-can-i-set-a-time-based-condition-to-close-out-a-position" class="md-heading"><a href="#how-can-i-set-a-time-based-condition-to-close-out-a-position">How can I set a time-based condition to close out a <span class="fancy-wrap">position?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>To close positions after a certain amount of time has passed, track the entry time for each trade and close the position using <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.close">strategy.close()</a> after the timeout.</p>
<p>Because strategies calculate at the close of each bar on historical data, time-based conditions can only be evaluated at the close, so <strong>trade times are assessed in multiples of the chart bar’s duration</strong>. Further, if the timeout value is not divisible by the duration of a chart bar, each trade will last at least one additional chart bar. For instance, setting a timeout of 100 seconds on a 1-minute chart effectively means a minimum of two bars before a position can be closed.</p>
<p>In realtime, the same logic applies unless the strategy uses the <a href="/pine-script-docs/concepts/strategies/#calc_on_every_tick">calc_on_every_tick</a> parameter, in which case the trade closes as soon as the first tick exceeds the timeout value. Remember that <a href="/pine-script-docs/concepts/strategies/#altering-calculation-behavior">altering emulator behavior</a> typically introduces <a href="/pine-script-docs/concepts/repainting/">repainting</a>.</p>
<p>The following example script calculates the duration of each open trade by comparing the current time against the trade entry time. If a trade’s duration exceeds the specified timeout, the script closes the trade and marks the event with a comment on the chart including the trade’s duration in seconds.</p>
<p><img src="/pine-script-docs/_astro/Strategies-Advanced-order-types-and-conditions-How-can-i-set-a-time-based-condition-to-close-out-a-position-1.n6VCruKe_1KxO3E.webp" alt="image" width="1720" height="1444" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="1km"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Close&nbsp;position&nbsp;by&nbsp;timeout"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Automatically&nbsp;closes&nbsp;all&nbsp;positions</span><span class="mtk9">&nbsp;that&nbsp;have&nbsp;been&nbsp;open&nbsp;for&nbsp;longer&nbsp;than&nbsp;a&nbsp;specified&nbsp;p</span><span class="mtk9">eriod.</span></span><br><span><span class="mtk9">//&nbsp;</span><span class="mtk9 mtkb">@param</span><span class="mtk9">&nbsp;timeoutInSeconds&nbsp;&nbsp;(int)&nbsp;The&nbsp;maximum&nbsp;allowed&nbsp;durat</span><span class="mtk9">ion&nbsp;for&nbsp;an&nbsp;open&nbsp;trade,&nbsp;measured&nbsp;in&nbsp;seconds.</span></span><br><span><span class="mtk9">//&nbsp;</span><span class="mtk9 mtkb">@returns</span><span class="mtk9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(void)&nbsp;The&nbsp;function&nbsp;has&nbsp;no&nbsp;explic</span><span class="mtk9">it&nbsp;return.</span></span><br><span><span class="mtk15">closePositionsAfter</span><span class="mtk13">(</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">timeoutInSeconds</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.opentrades</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.opentrades</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">timeNow</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isrealtime</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">timenow</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">time_close</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">tradeDurationInSeconds</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">timeNow</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.opentrades.entry_time</span><span class="mtk13">(</span><span class="mtk33">i</span><span class="mtk13">))</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk12">1000</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">tradeDurationInSeconds</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">timeoutInSeconds</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">entryName</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.opentrades.entry_id</span><span class="mtk13">(</span><span class="mtk33">i</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">tradeComment</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.format</span><span class="mtk13">(</span><span class="mtk29">"Close&nbsp;\"{0}\"&nbsp;by&nbsp;timeout&nbsp;{1}s"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">entryName</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">tradeDurationInSeconds</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.close</span><span class="mtk13">(</span><span class="mtk33">entryName</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">comment</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">tradeComment</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">immediately</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Create&nbsp;long&nbsp;and&nbsp;short&nbsp;conditions&nbsp;based&nbsp;on&nbsp;the&nbsp;c</span><span class="mtk9">rossover/under&nbsp;of&nbsp;2&nbsp;moving&nbsp;averages.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">longCondition</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">28</span><span class="mtk13">))</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">28</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;long&nbsp;entry&nbsp;order&nbsp;upon&nbsp;`longCondition`.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">longCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;short&nbsp;entry&nbsp;order&nbsp;upon&nbsp;`shortCondition`.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"short"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Close&nbsp;positions&nbsp;after&nbsp;a&nbsp;configurable&nbsp;number&nbsp;of&nbsp;</span><span class="mtk9">seconds.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><br><span><span class="mtk15">closePositionsAfter</span><span class="mtk13">(</span><span class="mtk16">input</span><span class="mtk13">(</span><span class="mtk12">1200</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Timeout&nbsp;(seconds)"</span><span class="mtk13">))</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>The script uses either the time of the bar’s close using the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_time_close">time_close</a> variable, or the current time from the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_timenow">timenow</a> variable (if the strategy uses the <a href="/pine-script-docs/concepts/strategies/#calc_on_every_tick">calc_on_every_tick</a> parameter).</li>
<li>The script uses the <a href="/pine-script-docs/language/built-ins">built-in</a> functions <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.opentrades.entry_time">strategy.opentrades.entry_time()</a> and <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.opentrades.entry_id">strategy.opentrades.entry_id()</a> to measure trade duration and identify individual trades.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.close">strategy.close()</a> function uses the <code dir="auto">immediately</code> argument to simulate trades at the end of the bar that exceeds the timer, rather than waiting for the opening of the next bar. Consequently, when a 120-second timeout is applied and the script runs on a 1-minute chart, it gives the appearance that trades last exactly two bars.</li>
</ul>
<h3 id="how-can-i-configure-a-bracket-order-with-a-specific-risk-to-reward-rr-ratio" class="md-heading"><a href="#how-can-i-configure-a-bracket-order-with-a-specific-risk-to-reward-rr-ratio">How can I configure a bracket order with a specific risk-to-reward (R:R
) <span class="fancy-wrap">ratio?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>To create a bracket order, define a stop-loss and a take-profit order using a single <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> call.
To apply a specific risk-to-reward ratio, calculate the distance between the entry point and the stop-loss level. This stop distance represents the “risk”. Then place the take-profit order a certain multiple of the stop distance away. The distance to the take-profit order represents the “reward”, and the ratio between them is the risk:reward
 (R:R
) ratio.</p>
<p>The following example script simulates long and short trades using inputs to define the stop distance in ticks and the R:R
 ratio. The <code dir="auto">loss</code> parameter of the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> function is simply the stop distance. The <code dir="auto">profit</code> parameter is the stop distance multiplied by the R:R
 ratio. The script fills the areas between the entry and stop-loss points, and between the entry and take-profit points, to illustrate the risk and reward.</p>
<p><img src="/pine-script-docs/_astro/Strategies-Advanced-order-types-and-conditions-How-can-i-configure-a-bracket-order-with-a-specific-risk-to-reward-rr-ratio-1.Dy3U4-6N_Z1Gtg5z.webp" alt="image" width="1720" height="1444" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="4pc"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"R:R&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Declare&nbsp;the&nbsp;stop&nbsp;size&nbsp;in&nbsp;ticks&nbsp;and&nbsp;the&nbsp;risk-to-</span><span class="mtk9">reward&nbsp;ratio&nbsp;as&nbsp;inputs.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">lossSizeInput</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">300</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Loss&nbsp;size&nbsp;(in&nbsp;ticks)"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">minval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">riskRewardInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">2.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Risk/Reward&nbsp;multiple"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">minval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Create&nbsp;long&nbsp;and&nbsp;short&nbsp;entry&nbsp;conditions&nbsp;on&nbsp;MA&nbsp;cr</span><span class="mtk9">ossover/crossunder,&nbsp;as&nbsp;long&nbsp;as&nbsp;we&nbsp;are&nbsp;not&nbsp;in&nbsp;a&nbsp;pos</span><span class="mtk9">ition.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">28</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk33">ma1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">ma2</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">sellCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk33">ma1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma2</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;orders&nbsp;when&nbsp;`buyCondition`&nbsp;or&nbsp;`sellCondit</span><span class="mtk9">ion`&nbsp;is&nbsp;true.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">sellCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"sell"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Define&nbsp;exit&nbsp;point&nbsp;for&nbsp;the&nbsp;entries&nbsp;based&nbsp;on&nbsp;a&nbsp;pr</span><span class="mtk9">edefined&nbsp;loss&nbsp;size.</span></span><br><span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;profit&nbsp;target&nbsp;by&nbsp;multiplying&nbsp;the&nbsp;</span><span class="mtk9">loss&nbsp;size&nbsp;with&nbsp;the&nbsp;user-defined&nbsp;risk-to-reward&nbsp;rat</span><span class="mtk9">io.</span></span><br><span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"exit"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">loss</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">lossSizeInput</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">profit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">lossSizeInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">riskRewardInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;price&nbsp;equivalent&nbsp;of&nbsp;the&nbsp;profit&nbsp;an</span><span class="mtk9">d&nbsp;loss&nbsp;level.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">tradeBias</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.sign</span><span class="mtk13">(</span><span class="mtk11">strategy.position_size</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLossPrice</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_avg_price</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">tradeBias</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">lossSizeInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk11">syminfo.mintick</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">takeProfitPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_avg_price</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">tradeBias</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">lossSizeInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk11">syminfo.mintick</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">riskRewardInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;entry&nbsp;price,&nbsp;the&nbsp;stop&nbsp;price,&nbsp;and&nbsp;the&nbsp;p</span><span class="mtk9">rice&nbsp;of&nbsp;the&nbsp;take-profit&nbsp;order.</span></span><br><span><span class="mtk33">plotEntry</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">strategy.position_avg_price</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Entry&nbsp;price"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.gray</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br><span><span class="mtk33">plotStop</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">stopLossPrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Stop-loss&nbsp;price"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br><span><span class="mtk33">plotTP</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">takeProfitPrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Take-profit&nbsp;price"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;R:R&nbsp;ratio&nbsp;by&nbsp;shading&nbsp;the&nbsp;area&nbsp;bet</span><span class="mtk9">ween&nbsp;the&nbsp;entry&nbsp;and&nbsp;the&nbsp;stop&nbsp;and&nbsp;the&nbsp;entry&nbsp;and&nbsp;the&nbsp;</span><span class="mtk9">take-profit.</span></span><br><span><span class="mtk16">fill</span><span class="mtk13">(</span><span class="mtk33">plotStop</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">plotEntry</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk12">80</span><span class="mtk13">))</span></span><br><span><span class="mtk16">fill</span><span class="mtk13">(</span><span class="mtk33">plotTP</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">plotEntry</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">))</span></span><br></code></div>
<h3 id="how-can-i-risk-a-fixed-percentage-of-my-equity-per-trade" class="md-heading"><a href="#how-can-i-risk-a-fixed-percentage-of-my-equity-per-trade">How can I risk a fixed percentage of my equity per <span class="fancy-wrap">trade?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Adjusting the position size to risk a fixed percentage of equity normalizes risk exposure, regardless of equity fluctuations, and helps avoid disproportionate risks across a strategy’s trading history.</p>
<p>Calculate the position size so that as the stop distance increases, the position size decreases, and vice-versa, to maintain a constant risk percentage:</p>
<ol>
<li>
<p>Calculate monetary <em>risk per contract</em> by multiplying the stop distance in ticks by the monetary value of each tick (<a href="https://www.tradingview.com/pine-script-reference/v6/#var_syminfo.mintick">syminfo.mintick</a>) and by the number of units each contract represents (<a href="https://www.tradingview.com/pine-script-reference/v6/#var_syminfo.pointvalue">syminfo.pointvalue</a>).</p>
</li>
<li>
<p>Determine <em>risk amount</em> by multiplying the current equity (<a href="https://www.tradingview.com/pine-script-reference/v6/#var_strategy.equity">strategy.equity</a>) by the percentage of equity that you want to risk.</p>
</li>
<li>
<p>Calculate position size by dividing the <em>risk amount</em> by the <em>risk per contract</em>.</p>
</li>
</ol>
<aside aria-label="Tip" class="tv-informer not-content" style="--informer-header-color:#089981;--informer-back-color-light:#DAF2EE;--informer-back-color-dark:#082621"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16Zm3.87-12.15c.36.2.49.66.28 1.02l-4 7a.75.75 0 0 1-1.18.16l-3-3a.75.75 0 1 1 1.06-1.06l2.3 2.3 3.52-6.14a.75.75 0 0 1 1.02-.28Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Tip</span>Smaller stop distances require larger position sizes to achieve a specific fixed risk. In some cases, the strategy might require increased <em>leverage</em> to achieve the required sizes. To prevent the strategy from entering trades with increased leverage, set the strategy’s <em>margin</em> requirements to 100% by passing a value of 100 (default) to the <code dir="auto">margin_long</code> and <code dir="auto">margin_short</code> parameters of the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy">strategy()</a> declaration statement. Alternatively, set the “Margin for long/short positions” inputs to 100 in the script’s “Settings/Properties” tab. To learn more about leverage and margin in strategies, see <a href="https://www.tradingview.com/support/solutions/43000717375-how-do-i-simulate-trading-with-leverage/">this Help Center article</a>.</p></div></aside>
<p>The following example script uses moving average crosses to generate long and short orders. The stop distance, risk:reward
 ratio, and percentage of equity to risk are all configurable via inputs.
The script plots the current equity, the current value of a new position, and the percentage change in equity to the Data Window. Note that the actual exposure level can be less than intended if the available capital does not divide neatly by the unit value, particularly with small equity amounts, high unit prices, or assets such as stocks where trading partial shares is not possible.</p>
<p>Additionally, we display lines on the chart for the current total equity (in green) and the value of a position needed for the specified risk exposure at the current price (in blue). If the position value exceeds the total equity, the strategy requires leverage to achieve the required exposure, and the script colors the background red and displays the minimum leverage ratio needed in the data window.</p>
<p><img src="/pine-script-docs/_astro/Strategies-Advanced-order-types-and-conditions-How-can-i-adjust-my-position-size-to-ensure-that-i-risk-a-fixed-percentage-of-my-equity-1.yi_EPCoj_Z101Tu2.webp" alt="image" width="1720" height="1444" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="2p9"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Fixed&nbsp;risk"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">false</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">initial_capital</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100000</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Specify&nbsp;the&nbsp;desired&nbsp;stop&nbsp;distance&nbsp;(in&nbsp;ticks),&nbsp;t</span><span class="mtk9">he&nbsp;trade&nbsp;R:R&nbsp;ratio,&nbsp;and&nbsp;the&nbsp;percentage&nbsp;of&nbsp;equity&nbsp;t</span><span class="mtk9">o&nbsp;risk.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">lossSizeInput</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">300</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Loss&nbsp;size&nbsp;(in&nbsp;ticks)"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">minval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">riskRewardInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">2.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Risk/Reward&nbsp;multiple"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">minval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">pctRiskInput</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">1.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"%&nbsp;of&nbsp;equity&nbsp;to&nbsp;risk"</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Create&nbsp;conditions&nbsp;for&nbsp;long/short&nbsp;entries&nbsp;on&nbsp;MA&nbsp;</span><span class="mtk9">crossover/crossunder,&nbsp;if&nbsp;we&nbsp;are&nbsp;not&nbsp;in&nbsp;a&nbsp;position.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">28</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk33">ma1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">ma2</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">sellCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk33">ma1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma2</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Store&nbsp;the&nbsp;equity&nbsp;value&nbsp;at&nbsp;each&nbsp;trade&nbsp;entry,&nbsp;in&nbsp;</span><span class="mtk9">order&nbsp;to&nbsp;calculate&nbsp;the&nbsp;percent&nbsp;change&nbsp;in&nbsp;equity.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">equityAtEntry</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;risk&nbsp;per&nbsp;contract&nbsp;of&nbsp;the&nbsp;instrume</span><span class="mtk9">nt.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">riskPerContract</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">lossSizeInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk11">syminfo.mintick</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk11">syminfo.pointvalue</span></span><br><span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;amount&nbsp;of&nbsp;equity&nbsp;to&nbsp;risk.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">equityToRisk</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.equity</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">pctRiskInput</span></span><br><span><span class="mtk9">//&nbsp;Determine&nbsp;the&nbsp;position&nbsp;size&nbsp;necessary&nbsp;to&nbsp;risk&nbsp;t</span><span class="mtk9">he&nbsp;specified&nbsp;percentage&nbsp;of&nbsp;the&nbsp;equity.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">positionSize</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">equityToRisk</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">riskPerContract</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;orders&nbsp;when&nbsp;`buyCondition`&nbsp;or&nbsp;`sellCondit</span><span class="mtk9">ion`&nbsp;is&nbsp;true.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">buyCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">positionSize</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">equityAtEntry</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.equity</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Set&nbsp;the&nbsp;`equityAtEntry`&nbsp;variable&nbsp;to&nbsp;the&nbsp;current</span><span class="mtk9">&nbsp;equity&nbsp;on&nbsp;each&nbsp;entry.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">sellCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"sell"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">positionSize</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">equityAtEntry</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.equity</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Stop-loss&nbsp;level&nbsp;is&nbsp;from&nbsp;the&nbsp;user&nbsp;input.&nbsp;Profit&nbsp;</span><span class="mtk9">target&nbsp;is&nbsp;the&nbsp;multiple&nbsp;of&nbsp;the&nbsp;loss&nbsp;size&nbsp;with&nbsp;the&nbsp;r</span><span class="mtk9">isk-to-reward&nbsp;ratio.</span></span><br><span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"exit"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">loss</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">lossSizeInput</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">profit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">lossSizeInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">riskRewardInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;percent&nbsp;equity&nbsp;change&nbsp;between&nbsp;the</span><span class="mtk9">&nbsp;current&nbsp;equity&nbsp;and&nbsp;the&nbsp;equity&nbsp;at&nbsp;entry.</span></span><br><span><span class="mtk9">//&nbsp;On&nbsp;the&nbsp;exit&nbsp;bar&nbsp;of&nbsp;each&nbsp;trade,&nbsp;this&nbsp;value&nbsp;can&nbsp;b</span><span class="mtk9">e&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;percentage&nbsp;of&nbsp;equity&nbsp;risked.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">equityChgPercent</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk11">strategy.equity</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">equityAtEntry</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">equityAtEntry</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">equityChgColor</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">equityChgPercent</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Display&nbsp;current&nbsp;equity&nbsp;and&nbsp;current&nbsp;value&nbsp;of&nbsp;a&nbsp;n</span><span class="mtk9">ew&nbsp;position&nbsp;on&nbsp;the&nbsp;chart,&nbsp;and&nbsp;%&nbsp;change&nbsp;in&nbsp;equity&nbsp;t</span><span class="mtk9">o&nbsp;the&nbsp;Data&nbsp;Window.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">strategy.equity</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Current&nbsp;Total&nbsp;Equity"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.all</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.pane</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">positionSize</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Value&nbsp;of&nbsp;New&nbsp;Position&nbsp;at&nbsp;Current&nbsp;Price"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.aqua</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.all</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.pane</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">equityChgPercent</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"%&nbsp;Change&nbsp;in&nbsp;Equity&nbsp;per&nbsp;Trade"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">equityChgColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.data_window</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">format</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">format.percent</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Color&nbsp;the&nbsp;background&nbsp;red&nbsp;if&nbsp;the&nbsp;calculated&nbsp;risk</span><span class="mtk9">&nbsp;value&nbsp;exceeds&nbsp;the&nbsp;available&nbsp;equity&nbsp;(leverage&nbsp;requ</span><span class="mtk9">ired).</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk11">strategy.equity</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">positionSize</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;minimum&nbsp;leverage&nbsp;multiple&nbsp;required&nbsp;to&nbsp;</span><span class="mtk9">open&nbsp;the&nbsp;position,&nbsp;applicable&nbsp;only&nbsp;if&nbsp;leverage&nbsp;is&nbsp;</span><span class="mtk9">necessary.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">strategy.equity</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">positionSize</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">positionSize</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.equity</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Leverage&nbsp;multiple&nbsp;required"</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.data_window</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>The stop distance in our example script is set to a constant value for demonstration purposes. In practice, the stop distance normally varies for each trade.</li>
</ul>
<h2 id="strategy-optimization-and-testing" class="md-heading"><a href="#strategy-optimization-and-testing">Strategy optimization and <span class="fancy-wrap">testing<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<h3 id="why-did-my-trade-results-change-dramatically-overnight" class="md-heading"><a href="#why-did-my-trade-results-change-dramatically-overnight">Why did my trade results change dramatically <span class="fancy-wrap">overnight?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Strategy results can vary over time depending on where the historical data starts. The starting point of the data set aligns with the start of the nearest day, week, month or year, depending on the chart timeframe. Additionally, different TradingView plans provide access to varying amounts of historical bars. Refer to the User Manual entry on <a href="/pine-script-docs/concepts/repainting/#starting-points">starting points</a> for a discussion of these factors.</p>
<p>For strategies, this means the historical results seen today might change as the dataset’s starting point moves. This can lead to a natural <a href="/pine-script-docs/concepts/repainting/">repainting</a> of strategy results over time. To reduce the effect of these changes on backtesting, follow these tips:</p>
<p><strong>Export strategy results</strong></p>
<p class="spacer-wrapper"><spacer></spacer>Regularly <a href="https://www.tradingview.com/support/solutions/43000613680-how-can-i-export-strategy-data/">exporting strategy results</a> to file maintains a record of performance over time despite changes in historical data. Use the “Export Data” option in the top of the <a href="/pine-script-docs/concepts/strategies/#strategy-tester">Strategy Tester</a> to export data.</p>
<p><strong>Use Deep Backtesting</strong></p>
<p class="spacer-wrapper"><spacer></spacer>Users with <a href="https://www.tradingview.com/pricing/">Premium and higher plans</a> have access to the <a href="https://www.tradingview.com/support/folders/43000584695/">Deep Backtesting</a> feature, which provides results from the entire available dataset of a symbol. Deep Backtesting results are displayed in the Strategy Tester but are not visible on the chart.</p>
<p><strong>Use Bar Replay</strong></p>
<p class="spacer-wrapper"><spacer></spacer>Use the Bar Replay feature on the first chart bar to extend the dataset backward, allowing a strategy to run on an additional full dataset prior to the current range. This process can be repeated a few times to analyze multiple datasets.</p>
<h3 id="why-is-backtesting-on-heikin-ashi-and-other-non-standard-charts-not-recommended" class="md-heading"><a href="#why-is-backtesting-on-heikin-ashi-and-other-non-standard-charts-not-recommended">Why is backtesting on Heikin Ashi and other non-standard charts not <span class="fancy-wrap">recommended?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Non-standard charts like
<a href="https://www.tradingview.com/support/solutions/43000619436-heikin-ashi/">Heikin Ashi</a>,
<a href="https://www.tradingview.com/support/solutions/43000502284-renko-charts/">Renko</a>,
<a href="https://www.tradingview.com/support/solutions/43000502273-line-break-charts/">Line Break</a>,
<a href="https://www.tradingview.com/support/solutions/43000502272-kagi-charts/">Kagi</a>,
<a href="https://www.tradingview.com/support/solutions/43000502276-point-and-figure-pnf-charts/">Point &amp; Figure</a>, and
<a href="https://www.tradingview.com/support/solutions/43000474007-what-s-range-interval-and-how-do-i-select-it/">Range Charts</a>
offer unique perspectives on price action. However, these chart types are not suited for <a href="/pine-script-docs/concepts/strategies/#notes-on-testing-strategies">strategy backtesting</a> or automated trading systems execution, because the prices and time intervals do not match market prices and times.</p>
<p><a href="https://www.tradingview.com/support/solutions/43000502284-renko-charts/">Renko</a>,
<a href="https://www.tradingview.com/support/solutions/43000502273-line-break-charts/">Line Break</a>,
<a href="https://www.tradingview.com/support/solutions/43000502272-kagi-charts/">Kagi</a>,
<a href="https://www.tradingview.com/support/solutions/43000502276-point-and-figure-pnf-charts/">Point &amp; Figure</a>, and
<a href="https://www.tradingview.com/support/solutions/43000474007-what-s-range-interval-and-how-do-i-select-it/">Range Charts</a>
simplify price action, losing some price detail. <a href="https://www.tradingview.com/support/solutions/43000619436-heikin-ashi/">Heikin Ashi</a> charts calculate synthetic prices for each bar’s
<a href="https://www.tradingview.com/pine-script-reference/v6/#var_open">open</a>,
<a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a>,
<a href="https://www.tradingview.com/pine-script-reference/v6/#var_low">low</a>,
and <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a>
(OHLC) values based on averages.</p>
<p>Further, all non-standard chart types with the exception of <a href="https://www.tradingview.com/support/solutions/43000619436-heikin-ashi/">Heikin Ashi</a> charts form new price units based on price movement only and omit the element of time.</p>
<p>Both the distortion of price data and the omission of time in non-standard charts lead to unrealistic and potentially misleading backtesting results.</p>
<p>Programmers can specify the <code dir="auto">fill_orders_on_standard_ohlc</code> parameter of the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy">strategy</a> declaration, which causes the strategy to calculate on standard chart data even if the current view is of Heikin Ashi candles. The user can do the same thing by by enabling the “Fill orders on standard OHLC” option in the strategy’s <a href="https://www.tradingview.com/support/solutions/43000628599">properties</a>. This option has no effect on other non-standard chart types, because they use non-standard time as well as price.</p>
<p>For a more detailed analysis of how non-standard chart types affect strategy results, refer to <a href="https://www.tradingview.com/script/q9laJNG9-Backtesting-on-Non-Standard-Charts-Caution-PineCoders-FAQ/">this script</a> from the <a href="https://www.tradingview.com/u/PineCoders/">PineCoders</a> account.</p>
<h3 id="how-can-i-backtest-deeper-into-history" class="md-heading"><a href="#how-can-i-backtest-deeper-into-history">How can I backtest deeper into <span class="fancy-wrap">history?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Different TradingView <a href="https://www.tradingview.com/pricing/">plans</a> give access to different amounts of historical information. To conduct more comprehensive backtesting in Pine Script, exploring further into an asset’s historical data, use Bar Replay or Deep Backtesting.</p>
<p><strong>Bar Replay</strong></p>
<p class="spacer-wrapper"><spacer></spacer>Starting the <a href="https://www.tradingview.com/support/solutions/43000712747-what-is-bar-replay/">Bar Replay</a> from the first chart bar in history effectively rolls back the dataset to an earlier point in time. Each iteration of the bar replay extends the dataset further back, offering analysis of multiple historical datasets. However, there is a limit to the number of times this process can be repeated. This method has the added benefit of visualizing the strategy’s performance directly on the chart, which can be insightful for understanding trade entries, exits, and behavior during specific historical market conditions.</p>
<p><strong>Deep Backtesting</strong></p>
<p class="spacer-wrapper"><spacer></spacer>For TradingView users with <a href="https://www.tradingview.com/pricing/">Premium and higher plans</a>, the <a href="https://www.tradingview.com/support/folders/43000584695/">Deep Backtesting</a> feature calculates the strategy on <em>all</em> historical data available for the selected symbol. The results are displayed in the Strategy Tester but are not visible on the chart. The results from Deep Backtesting might be different from results from the <a href="/pine-script-docs/concepts/strategies/#strategy-tester">Strategy Tester</a> in regular mode, as explained in <a href="https://www.tradingview.com/support/solutions/43000666266/">this Help Center article</a>.</p>
<h3 id="how-can-i-backtest-multiple-symbols" class="md-heading"><a href="#how-can-i-backtest-multiple-symbols">How can I backtest multiple <span class="fancy-wrap">symbols?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Each Pine Script strategy runs on one symbol at a time. To evaluate a strategy across various markets or instruments:</p>
<ul>
<li>Apply the strategy to the chart and then switch the chart to the desired symbol.</li>
<li>Use TradingView’s watchlist feature to organize and quickly access different symbols.</li>
<li>Export the results from the <a href="/pine-script-docs/concepts/strategies/#strategy-tester">Strategy Tester</a> and use external tools such as spreadsheet software to compare the performance of a strategy on different symbols.</li>
</ul>
<h3 id="what-does-bar-magnifier-do" class="md-heading"><a href="#what-does-bar-magnifier-do">What does Bar Magnifier <span class="fancy-wrap">do?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>The <a href="/pine-script-docs/concepts/strategies/#bar-magnifier">Bar Magnifier</a> feature, available for TradingView <a href="https://www.tradingview.com/pricing/">Premium and Ultimate</a> account holders, significantly enhances the accuracy of order fills in strategy backtests. This tool uses data from lower timeframes to obtain more detailed price movement within a bar, which can result in more precise
order fills. When selected, Bar Magnifier mode replaces the assumptions that the <a href="/pine-script-docs/concepts/strategies/#broker-emulator">broker emulator</a> must make about price movement using only a single set of OHLC values for each historical bar.</p>
<p>The Bar Magnifier chooses the lower timeframe based on the chart timeframe:</p>

























































<table><thead><tr><th>Chart Timeframe</th><th>Intrabar Timeframe</th></tr></thead><tbody><tr><td>1S</td><td>1S</td></tr><tr><td>30S</td><td>5S</td></tr><tr><td>1</td><td>10S</td></tr><tr><td>5</td><td>30S</td></tr><tr><td>10</td><td>1</td></tr><tr><td>15</td><td>2</td></tr><tr><td>30</td><td>5</td></tr><tr><td>60</td><td>10</td></tr><tr><td>240</td><td>30</td></tr><tr><td>1D</td><td>60</td></tr><tr><td>3D</td><td>240</td></tr><tr><td>1W</td><td>1D</td></tr></tbody></table>
<p>To fully appreciate the effectiveness of Bar Magnifier, refer to the script demonstrations in the section about <a href="/pine-script-docs/concepts/strategies/#bar-magnifier">Bar Magnifier</a> in the User Manual.</p>
<h2 id="advanced-features-and-integration" class="md-heading"><a href="#advanced-features-and-integration">Advanced features and <span class="fancy-wrap">integration<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<h3 id="can-my-strategy-script-place-orders-with-tradingview-brokers" class="md-heading"><a href="#can-my-strategy-script-place-orders-with-tradingview-brokers">Can my strategy script place orders with TradingView <span class="fancy-wrap">brokers?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Pine Script strategies and indicators cannot directly place orders on exchanges.
Traders can use external tools or platforms that can interpret alert signals from Pine scripts using <a href="https://www.tradingview.com/support/solutions/43000529348-about-webhooks/">webhooks</a> and execute trades accordingly.</p>
<h3 id="how-can-i-add-a-time-delay-between-orders" class="md-heading"><a href="#how-can-i-add-a-time-delay-between-orders">How can I add a time delay between <span class="fancy-wrap">orders?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Adding a time delay between orders can help to prevent too many trades in a short time. Strategies can also prevent trading for a time after a series of losses. Here’s how to set up a time delay between orders:</p>
<ul>
<li>Define the delay duration, whether in time units (minutes, hours, days) or a number of bars. For time-based delays, convert the chosen time unit into milliseconds, because Pine <a href="/pine-script-docs/concepts/time/#time-variables">time variables</a> use milliseconds.</li>
<li>Check the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_time">time</a> or <a href="https://www.tradingview.com/pine-script-reference/v6/#var_bar_index">bar_index</a> of the last trade using <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.closedtrades.exit_time">strategy.closedtrades.exit_time()</a> or <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.closedtrades.exit_bar_index">strategy.closedtrades.exit_bar_index()</a>.</li>
<li>If the difference between the current bar <code dir="auto">time</code> or <code dir="auto">bar_index</code> and that of the last trade’s exit exceeds the delay duration, set a boolean flag to allow new orders. Make sure to include the flag in the strategy entry conditions.</li>
</ul>
<p>The following example script provides two methods for delaying orders: a time-based delay or a specified number of bars. The strategy creates a long entry order when either the <code dir="auto">time</code> of a bar or its <code dir="auto">bar_index</code> exceeds the set delay from the last active trade bar. No other conditions are used for entry in this demonstration, but users can add their own logic to these conditions.</p>
<p>To keep the chart clean, the script calls the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.close">strategy.close()</a> function to close active trades after they have been open for 10 bars. The script uses background shading, labels and arrows to illustrate the trade entries and exits.</p>
<p><img src="/pine-script-docs/_astro/Strategies-Advanced-features-and-integration-How-can-i-implement-a-time-delay-between-orders-1.Ln04vrEQ_Z1yPkca.webp" alt="image" width="1720" height="1444" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="4ii"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Time-delayed&nbsp;orders"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk18">=</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_labels_count</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_lines_count</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">import</span><span class="mtk1">&nbsp;</span><span class="mtk16">PineCoders/Time/4</span><span class="mtk1">&nbsp;</span><span class="mtk18">as</span><span class="mtk1">&nbsp;</span><span class="mtk17">PCtime</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Constants</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">TU1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"seconds"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">TU2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"minutes"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">TU3</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"hours"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">TU4</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"days"</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">TU5</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"weeks"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">TU6</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"months"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">DT1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"bars"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">DT2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"time"</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Tooltips&nbsp;for&nbsp;inputs</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">D_TT</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Delay&nbsp;orders&nbsp;for&nbsp;a&nbsp;specific&nbsp;number&nbsp;of&nbsp;bars&nbsp;or&nbsp;a&nbsp;s</span><span class="mtk29">pecific&nbsp;duration&nbsp;of&nbsp;time&nbsp;since&nbsp;the&nbsp;last&nbsp;trade."</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">N_TT</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Specify&nbsp;the&nbsp;number&nbsp;of&nbsp;bars&nbsp;or&nbsp;time&nbsp;units&nbsp;for&nbsp;the&nbsp;</span><span class="mtk29">delay."</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">U_TT</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Unit&nbsp;of&nbsp;time;&nbsp;relevant&nbsp;only&nbsp;if&nbsp;the&nbsp;delay&nbsp;type&nbsp;is&nbsp;</span><span class="mtk29">'time'."</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;User&nbsp;inputs&nbsp;for&nbsp;delay&nbsp;type,&nbsp;number&nbsp;of&nbsp;units/bar</span><span class="mtk9">s,&nbsp;and&nbsp;time&nbsp;units.</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">delayTypeInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.string</span><span class="mtk13">(</span><span class="mtk33">DT2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Delay&nbsp;type"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">tooltip</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">D_TT</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">options</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk13">[</span><span class="mtk33">DT1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">DT2</span><span class="mtk13">])</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">nInput</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">15</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Number&nbsp;of&nbsp;bars&nbsp;or&nbsp;time&nbsp;units"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">tooltip</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">N_TT</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">unitsInput</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.string</span><span class="mtk13">(</span><span class="mtk33">TU2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Time&nbsp;units"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">tooltip</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">U_TT</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">options</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk13">[</span><span class="mtk33">TU1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">TU2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">TU3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">TU4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">TU5</span><span class="mtk13">])</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Convert&nbsp;the&nbsp;time&nbsp;unit&nbsp;string&nbsp;input&nbsp;to&nbsp;a&nbsp;value&nbsp;i</span><span class="mtk9">n&nbsp;milliseconds&nbsp;for&nbsp;use&nbsp;in&nbsp;the&nbsp;time&nbsp;delay&nbsp;calculati</span><span class="mtk9">on.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">mult</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk18">switch</span><span class="mtk1">&nbsp;</span><span class="mtk33">unitsInput</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">TU1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">1000</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">TU2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">60000</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">TU3</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">3600000</span><span class="mtk1">&nbsp;&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">TU4</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">86400000</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">TU5</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">604800000</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk12">2628003000</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">useTimeDelay</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">delayTypeInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk33">DT2</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Use&nbsp;time&nbsp;delay&nbsp;or&nbsp;not.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">timeOfExit</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.closedtrades.exit_time</span><span class="mtk13">(</span><span class="mtk11">strategy.closedtrades</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Time&nbsp;of&nbsp;last&nbsp;trade&nbsp;exit.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">barOfExit</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.closedtrades.exit_bar_index</span><span class="mtk13">(</span><span class="mtk11">strategy.closedtrades</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Bar&nbsp;index&nbsp;of&nbsp;last&nbsp;trade&nbsp;exit.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">timeSinceExit</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">time</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">timeOfExit</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;time&nbsp;since&nbsp;the&nbsp;last&nbsp;trade.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">barsSinceExit</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">barOfExit</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;number&nbsp;of&nbsp;bars&nbsp;since&nbsp;the&nbsp;last&nbsp;tra</span><span class="mtk9">de.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">timeAllowed</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">timeSinceExit</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">nInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">mult</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk33">timeOfExit</span><span class="mtk13">))</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk33">useTimeDelay</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">barAllowed</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">barOfExit</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">nInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk33">barOfExit</span><span class="mtk13">))</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk18">not</span><span class="mtk1">&nbsp;</span><span class="mtk33">useTimeDelay</span></span><br><span><span class="mtk9">//&nbsp;Allow&nbsp;entry&nbsp;of&nbsp;a&nbsp;trade&nbsp;if&nbsp;the&nbsp;delay&nbsp;has&nbsp;passed&nbsp;</span><span class="mtk9">and&nbsp;we're&nbsp;not&nbsp;in&nbsp;a&nbsp;position.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">entryCondition</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">timeAllowed</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk33">barAllowed</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">tradeExited</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">barOfExit</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Did&nbsp;the&nbsp;trade&nbsp;exit&nbsp;on&nbsp;the&nbsp;current&nbsp;bar?</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">entryCondition</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Enter&nbsp;the&nbsp;trade&nbsp;if&nbsp;conditions&nbsp;allow.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Set&nbsp;label&nbsp;text:&nbsp;format&nbsp;time&nbsp;or&nbsp;show&nbsp;bar&nbsp;count&nbsp;s</span><span class="mtk9">ince&nbsp;last&nbsp;trade.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelTxt</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">useTimeDelay</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">PCtime</span><span class="mtk1">.</span><span class="mtk15">formattedNoOfPeriods</span><span class="mtk13">(</span><span class="mtk33">timeSinceExit</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">unitsInput</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.format</span><span class="mtk13">(</span><span class="mtk29">"{0}&nbsp;bars"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">barsSinceExit</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelTxt</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.lime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.lime</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_up</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk33">timeOfExit</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">time</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">xloc.bar_time</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.lime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">line.style_arrow_left</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Close&nbsp;any&nbsp;open&nbsp;position&nbsp;on&nbsp;every&nbsp;tenth&nbsp;bar.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.close</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk13">)</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">entryCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.lime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">85</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk33">tradeExited</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.fuchsia</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">85</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br></code></div>
<p>Consider the following limitations when adding time-based delays.</p>
<p><strong>Historical bars</strong></p>
<p class="spacer-wrapper"><spacer></spacer>Strategies calculate at the close of each bar, so they can only evaluate time-based conditions at that moment. This constraint entails that on historical bars, <strong>delay times are assessed in increments equal to the chart bar’s duration</strong>.</p>
<p><strong>Session times</strong></p>
<p class="spacer-wrapper"><spacer></spacer>Strategies cannot evaluate delays when the market is closed, because there are no price updates to trigger script execution. This means that if a delay extends beyond the end of a trading session, the delay condition cannot be identified until the script runs again on the next session, resulting in a longer-than-anticipated time between orders.</p>
<p><strong>Delay duration on different timeframes</strong></p>
<p class="spacer-wrapper"><spacer></spacer>If the delay value is not divisible by the duration of a chart bar, each delay lasts at least one additional chart bar. For instance, setting a delay of 100 seconds on a 1-minute chart effectively means a minimum of two bars before the delay is exceeded.</p>
<h3 id="how-can-i-calculate-custom-statistics-in-a-strategy" class="md-heading"><a href="#how-can-i-calculate-custom-statistics-in-a-strategy">How can I calculate custom statistics in a <span class="fancy-wrap">strategy?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>To track metrics other than the default metrics that the Strategy Tester tracks, strategies can calculate custom statistics. These calculations might need to detect order executions, track closed trades, monitor entries into trades, and assess whether a trade is active. Changes in <a href="/pine-script-docs/language/built-ins/#built-in-variables">built-in</a> variables such as <a href="https://www.tradingview.com/pine-script-reference/v6/#var_strategy.opentrades">strategy.opentrades</a> and <a href="https://www.tradingview.com/pine-script-reference/v6/#var_strategy.closedtrades">strategy.closedtrades</a> can track the execution of orders.</p>
<p>The following example script uses a moving average crossover strategy to generate orders. It calculates custom metrics, including the price risk at entry, average position size, and the average percentage of bars involved in trades across the dataset, and plots the custom metrics and some built-in variables to the Data Window. Users can view the history of values plotted in the Data Window by moving the cursor over any bar. In contrast, the Strategy Tester summarizes data over the entire testing period.</p>
<p><img src="/pine-script-docs/_astro/Strategies-Advanced-features-and-integration-How-can-i-calculate-custom-statistics-in-a-strategy-1.BCecXRri_nz4Cu.webp" alt="image" width="1720" height="1444" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="17"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Custom&nbsp;strategy&nbsp;metrics"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">initial_capital</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">10000</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">commission_type</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.commission.percent</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">commission_value</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.075</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_bars_back</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1000</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">default_qty_type</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.percent_of_equity</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">default_qty_value</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Calculate&nbsp;entry&nbsp;conditions.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">c</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.round_to_mintick</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Round&nbsp;OHLC&nbsp;to&nbsp;chart&nbsp;prices.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">maF</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.round_to_mintick</span><span class="mtk13">(</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">hlc3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk13">))</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">maS</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.round_to_mintick</span><span class="mtk13">(</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">hlc3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">60</span><span class="mtk13">))</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">enterLong</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk33">maF</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">maS</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">enterShort</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk33">maF</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">maS</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Entry&nbsp;conditions.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLong</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.lowest</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk13">)[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopShort</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.highest</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk13">)[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Stop-loss&nbsp;order&nbsp;levels.</span></span><br><span><span class="mtk9">//&nbsp;Enter&nbsp;a&nbsp;new&nbsp;position&nbsp;or&nbsp;reverse,&nbsp;unless&nbsp;stop&nbsp;co</span><span class="mtk9">uld&nbsp;not&nbsp;be&nbsp;calculated&nbsp;yet.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">enterLong</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk18">not</span><span class="mtk1">&nbsp;</span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk33">stopLong</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">comment</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"►Long"</span><span class="mtk13">)</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">enterShort</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk18">not</span><span class="mtk1">&nbsp;</span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk33">stopShort</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Short"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">comment</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"►Short"</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Modify&nbsp;existing&nbsp;exit&nbsp;orders&nbsp;using&nbsp;the&nbsp;current&nbsp;s</span><span class="mtk9">top&nbsp;value.</span></span><br><span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"◄Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLong</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"◄Short"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Short"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopShort</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Generate&nbsp;custom&nbsp;statistics.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">riskOnEntry</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.abs</span><span class="mtk13">(</span><span class="mtk33">c</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">enterLong</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLong</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk33">enterShort</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopShort</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">))</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Trade&nbsp;risk&nbsp;at&nbsp;entry.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">changeInClosedTrades</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.change</span><span class="mtk13">(</span><span class="mtk11">strategy.closedtrades</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">changeInOpenTrades</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.change</span><span class="mtk13">(</span><span class="mtk11">strategy.opentrades</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">tradeWasClosed</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">changeInClosedTrades</span><span class="mtk1">&nbsp;</span><span class="mtk18">!=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">tradeWasEntered</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">changeInOpenTrades</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk11">strategy.opentrades</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.opentrades</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk33">tradeWasClosed</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span></span><br><span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">changeInClosedTrades</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">tradeIsActive</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.opentrades</span><span class="mtk1">&nbsp;</span><span class="mtk18">!=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Check&nbsp;if&nbsp;a&nbsp;trade&nbsp;is&nbsp;currently&nbsp;active.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">barsInTradePct</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.cum</span><span class="mtk13">(</span><span class="mtk33">tradeIsActive</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Percentage&nbsp;of&nbsp;bars&nbsp;on&nbsp;which&nbsp;a&nbsp;trade&nbsp;was&nbsp;open.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">tradesEntered</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.cum</span><span class="mtk13">(</span><span class="mtk33">tradeWasEntered</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">positionSize</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.abs</span><span class="mtk13">(</span><span class="mtk11">strategy.position_size</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">avgPositionSize</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.cum</span><span class="mtk13">(</span><span class="mtk16">nz</span><span class="mtk13">(</span><span class="mtk33">positionSize</span><span class="mtk13">))[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">tradesEntered</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Calculate&nbsp;average&nbsp;position&nbsp;size.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">positionValue</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">positionSize</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Position&nbsp;monetary&nbsp;value</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceRiskPct</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">riskOnEntry</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Risk&nbsp;percentage&nbsp;of&nbsp;trade&nbsp;relative&nbsp;to&nbsp;entry&nbsp;pric</span><span class="mtk9">e.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">tradeRiskPct</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">positionSize</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">riskOnEntry</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Monetary&nbsp;risk&nbsp;of&nbsp;the&nbsp;trade.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLong</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopShort</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;MAs,&nbsp;stop&nbsp;price,&nbsp;and&nbsp;markers&nbsp;for&nbsp;entri</span><span class="mtk9">es&nbsp;and&nbsp;exits&nbsp;to&nbsp;the&nbsp;chart.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">maF</span><span class="mtk18">,</span><span class="mtk29">"MA&nbsp;Fast"</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">maS</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk29">"MA&nbsp;Slow"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.silver</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">stop</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Stop"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.fuchsia</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_circles</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plotchar</span><span class="mtk13">(</span><span class="mtk33">tradeWasClosed</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk29">"tradeWasClosed"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk29">"—"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">location.bottom</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.fuchsia</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.tiny</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plotchar</span><span class="mtk13">(</span><span class="mtk33">tradeWasEntered</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"tradeWasEntered"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"+"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">location.top</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">color.lime</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.tiny</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;background&nbsp;while&nbsp;long&nbsp;and&nbsp;short&nbsp;p</span><span class="mtk9">ositions&nbsp;are&nbsp;active.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.teal</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.maroon</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;statistics&nbsp;to&nbsp;the&nbsp;Data&nbsp;Window.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"════════&nbsp;&nbsp;Built-ins"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.data_window</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">strategy.opentrades</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"strategy.opentrades"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.data_window</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">strategy.closedtrades</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk29">"strategy.closedtrades"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.data_window</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">strategy.position_size</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"strategy.position_size"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.data_window</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">strategy.equity</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Equity"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.data_window</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"════════&nbsp;&nbsp;Custom&nbsp;Metrics"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.data_window</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">riskOnEntry</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Risk&nbsp;On&nbsp;Entry"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.data_window</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">positionSize</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Position&nbsp;Size"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.data_window</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">tradesEntered</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"tradesEntered"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.data_window</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">barsInTradePct</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"barsInTradePct"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.data_window</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">avgPositionSize</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"avgPositionSize"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.data_window</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">positionValue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Position&nbsp;Value"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.data_window</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">priceRiskPct</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Price&nbsp;Risk&nbsp;%"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.data_window</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">tradeRiskPct</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Trade&nbsp;Risk&nbsp;Value"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">display</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">display.data_window</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>The strategy incorporates <a href="/pine-script-docs/concepts/strategies/#simulating-trading-costs">trading costs</a>. Failing to account for these costs can lead to an unrealistic perception of strategy performance and diminish the credibility of test results.</li>
<li>We round the
<a href="https://www.tradingview.com/pine-script-reference/v6/#var_open">open</a>,
<a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a>,
<a href="https://www.tradingview.com/pine-script-reference/v6/#var_low">low</a> and
<a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a>
(OHLC) built-in variables to the symbol’s precision. This rounding ensures that any statistics the script calculates align within the <a href="/pine-script-docs/concepts/strategies/#strategy-tester">Strategy Tester</a> and with strategy order-related built-in variables.</li>
<li>The script creates global variables for the changes in built-in variables for open and closed trades so that the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.change">ta.change</a> function is called on every bar for consistency.</li>
</ul>
<h3 id="how-do-i-incorporate-leverage-into-my-strategy" class="md-heading"><a href="#how-do-i-incorporate-leverage-into-my-strategy">How do I incorporate leverage into my <span class="fancy-wrap">strategy?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Trading with <em>leverage</em> means borrowing capital from a broker to control larger position sizes than the amount of capital risked. This amplifies both potential profits and losses, making it a powerful but risky tool. The amount of the trader’s capital that they risk is called the <em>margin</em>.</p>
<p>For example, setting a 20% margin ratio means that the trader’s balance funds only 20% of the position’s value, allowing positions up to five times the account balance. A margin ratio of 20% is therefore the same as 5:1 leverage. With an available balance of $10,000 and a 20% margin setting, a strategy can open positions up to $50,000 in value.</p>
<p>Pine Script strategies can simulate trading with leverage by specifying margin requirements for long and short positions. Users can adjust the “Margin for long positions” and Margin for short positions” in the strategy’s “Properties” tab. Programmers can set the default margin in the script using the <code dir="auto">margin_long</code> and <code dir="auto">margin_short</code> parameters in the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy">strategy()</a> declaration function.</p>
<aside aria-label="Notice" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice</span>If a leveraged trade, or even a short trade with 1:1 leverage, incurs significant losses that cause the strategy’s account balance to drop below the required margin, the broker emulator initiates a <em>margin call</em> event by liquidating <em>four times</em> the amount required to cover the loss. This behavior helps prevent constant margin calls on subsequent bars.</p></div></aside>
<p>For more information on using leverage in strategies, see the Help Center article <a href="https://www.tradingview.com/support/solutions/43000717375-how-do-i-simulate-trading-with-leverage/">How do I simulate trading with leverage?</a></p>
<h3 id="can-you-hedge-in-a-pine-script-strategy" class="md-heading"><a href="#can-you-hedge-in-a-pine-script-strategy">Can you hedge in a Pine Script <span class="fancy-wrap">strategy?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>When traders offset the risk of one position by opening another position at the same time, this is called <em>hedging</em>.</p>
<p>The main ways to hedge an open position are:</p>
<ul>
<li>By opening a second position in a related asset that is expected to move in the opposite direction to the first asset.</li>
<li>By opening a short position to offset a long position or vice-versa.</li>
<li>By using derivatives such as options.</li>
</ul>
<p>Strategies cannot use these methods, because Pine strategies can only have positions open in one direction at a time, either long or short. Pine strategies run on only the chart asset and cannot open positions in different assets.</p>
<h3 id="can-i-connect-my-strategies-to-my-paper-trading-account" class="md-heading"><a href="#can-i-connect-my-strategies-to-my-paper-trading-account">Can I connect my strategies to my paper trading <span class="fancy-wrap">account?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Pine Script does not support placing orders using the brokers integrated via the Trading Panel, or using TradingView’s built-in <a href="https://www.tradingview.com/support/solutions/43000516466-paper-trading-main-functionality/">paper trading account</a>. The Strategy Tester closely mimics a paper trading account by simulating orders and tracking theoretical positions and capital in a risk-free environment.</p>
<p>Strategies can customize <a href="/pine-script-docs/concepts/strategies/#strategy-alerts">order fill alerts</a> to include detailed results and performance metrics in the alert strings, providing a record of the strategy’s theoretical fills and overall performance in realtime.</p>
<aside aria-label="Tip" class="tv-informer not-content" style="--informer-header-color:#089981;--informer-back-color-light:#DAF2EE;--informer-back-color-dark:#082621"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16Zm3.87-12.15c.36.2.49.66.28 1.02l-4 7a.75.75 0 0 1-1.18.16l-3-3a.75.75 0 1 1 1.06-1.06l2.3 2.3 3.52-6.14a.75.75 0 0 1 1.02-.28Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Tip</span>When configuring alerts for forward testing, it is often helpful to restrict the strategy’s logic to remove the effects of historical trades by using a <a href="/pine-script-docs/faq/strategies/#how-do-i-filter-trades-by-a-date-or-time-range">date filter</a> set to today’s date.</p></div></aside>
<h2 id="troubleshooting-and-specific-issues" class="md-heading"><a href="#troubleshooting-and-specific-issues">Troubleshooting and specific <span class="fancy-wrap">issues<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<h3 id="why-are-no-trades-executed-after-i-add-the-strategy-to-the-chart" class="md-heading"><a href="#why-are-no-trades-executed-after-i-add-the-strategy-to-the-chart">Why are no trades executed after I add the strategy to the <span class="fancy-wrap">chart?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>If a strategy that is running on the chart does not place any orders, the Strategy Tester’s “Overview” tab displays the message, “This strategy did not generate any orders throughout the testing range.”
By contrast, while no strategy is loaded and visible on the chart, the Strategy Tester displays a different message: “To test a strategy, apply it to the chart.”</p>
<p>If a valid script that uses the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy">strategy()</a> declaration statement is running but is not placing any orders, consider the following potential problems and their solutions:</p>
<p><strong>Lack of order placement commands</strong></p>
<p class="spacer-wrapper"><spacer></spacer>The strategy must use either the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.order">strategy.order()</a> or <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.entry">strategy.entry()</a> order <a href="/pine-script-docs/concepts/strategies/#order-placement-and-cancellation">placement commands</a> to place orders. Add <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_log.info">log.info</a> messages and review the Pine Logs to check whether the conditions to run the commands are met.</p>
<p><strong>Insufficient capital</strong></p>
<p class="spacer-wrapper"><spacer></spacer>Verify that the strategy has enough initial capital to cover the position sizes it attempts to open. Remember, the cost of entering a futures contract position is the chart price multiplied by the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_syminfo.pointvalue">syminfo.pointvalue</a>, which can be significantly greater than the chart price. For a quick fix, increase the initial capital to a very high value in the <em>Properties</em> tab.</p>
<p><strong>Runtime errors</strong></p>
<p class="spacer-wrapper"><spacer></spacer>Check for runtime errors indicated by a red exclamation mark on the chart pane next to the script’s title. Resolve any issues by correcting the script as necessary.</p>
<p>For more detailed guidance and troubleshooting tips, refer to the dedicated article on this topic in the <a href="https://www.tradingview.com/support/solutions/43000478450-i-ve-successfully-added-a-strategy-to-my-chart-but-it-doesn-t-generate-orders/">Help Center</a>.</p>
<h3 id="why-does-my-strategy-not-place-any-orders-on-recent-bars" class="md-heading"><a href="#why-does-my-strategy-not-place-any-orders-on-recent-bars">Why does my strategy not place any orders on recent <span class="fancy-wrap">bars?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>If a strategy places one or more orders early in the testing range but then stops placing orders, check the following issues.</p>
<p><strong>Total account loss</strong></p>
<p class="spacer-wrapper"><spacer></spacer>Check whether the simulated account balance experienced a total loss of equity earlier in the available history. As a result, the account might lack sufficient capital to continue trading the symbol and fail to show trades only in the chart’s recent history.</p>
<p><strong>No exit condition</strong></p>
<p class="spacer-wrapper"><spacer></spacer>Some programmers define entry conditions that rely on having no positions currently open. Make sure to explicitly close trades by specifying corresponding exit conditions for all trades. Without explicit instructions to close an open position using <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.close">strategy.close()</a> or <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> commands, the strategy might display only a single entry order early in the chart’s history and in the <em>List of Trades</em> tab. If trades are not closed, they do not generate results in the <em>Overview</em>.</p>
<h3 id="why-is-my-strategy-repainting" class="md-heading"><a href="#why-is-my-strategy-repainting">Why is my strategy <span class="fancy-wrap">repainting?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Pine scripts <em>repaint</em> if they behave differently on historical and realtime bars. If strategies repaint, their backtesting results are not reliable because they do not accurately represent the strategy’s behavior in realtime.</p>
<p>Some strategy properties cause repainting:</p>
<ul>
<li>The <a href="/pine-script-docs/concepts/strategies/#calc_on_every_tick">calc_on_every_tick</a> setting causes a strategy to recalculate with every price update, which may cause orders and alerts to trigger during the formation of a bar in realtime. By contrast, on historical bars, calculations are performed at the close of the bar.</li>
<li>The <a href="/pine-script-docs/concepts/strategies/#calc_on_order_fills">calc_on_order_fills</a> setting causes a strategy to recalculate immediately after simulating an order fill. For example, this feature is particularly useful for strategies that rely on entry prices to set exit prices on the entry bar, rather than waiting for the bar to close, such as the first example script in the FAQ entry <a href="/pine-script-docs/faq/strategies/#using-calc_on_order_fills">How can I set stop-loss and take-profit levels as a percentage from my entry point using <code dir="auto">calc_on_order_fills</code>?</a> However, using this setting can introduce <em>lookahead bias</em> into the strategy, leading to potentially unrealistic outcomes. For instance, if a strategy’s entry conditions are met within a bar that also triggers an exit, the strategy would execute an entry order within the same bar on the next tick. On historical bars, such entries could occur at any of the bar’s <a href="https://www.tradingview.com/pine-script-reference/v6/#var_open">open</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_low">low</a>, or <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> (OHLC) prices, resulting in entry prices that are unrealistically favorable.</li>
<li>Since strategies and their alerts execute at the close of a historical bar, the next possible moment for an entry order to be filled is the beginning of the next bar. However, the <a href="/pine-script-docs/concepts/strategies/#process_orders_on_close">process_orders_on_close</a> setting causes the strategy to use the close price of the bar where the condition is met for its order prices instead. See the FAQ entry <a href="/pine-script-docs/faq/strategies/#why-are-my-orders-executed-on-the-bar-following-my-triggers">Why are my orders executed on the bar following my triggers?</a> for more information.</li>
</ul>
<p>To avoid repainting, set the <a href="/pine-script-docs/concepts/strategies/#calc_on_every_tick">calc_on_every_tick</a>, <a href="/pine-script-docs/concepts/strategies/#calc_on_order_fills">calc_on_order_fills</a>, and <a href="/pine-script-docs/concepts/strategies/#process_orders_on_close">process_orders_on_close</a> parameters to <code dir="auto">false</code> in the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy">strategy()</a> declaration statement.</p>
<p>Additionally, using unfixed data from a higher timeframe can cause repainting. If the data from the higher timeframe changes during the higher timeframe bar, this can change the script’s oputput for historical bars.
Ensure that strategies use only fixed values from a higher timeframe, as described in <a href="/pine-script-docs/concepts/other-timeframes-and-data/#avoiding-repainting">Avoiding repainting</a>.</p>
<p>Although these are the most common causes of repainting in strategies, they are not the only causes. For additional information, refer to the section on <a href="/pine-script-docs/concepts/repainting/">repainting</a> in the User Manual.</p>
<h3 id="how-do-i-turn-off-alerts-for-stop-loss-and-take-profit-orders" class="md-heading"><a href="#how-do-i-turn-off-alerts-for-stop-loss-and-take-profit-orders">How do I turn off alerts for stop loss and take profit <span class="fancy-wrap">orders?<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>In automated trading strategies, it is common practice to set stop-loss and take-profit orders at the same time as an entry order, using the alert from the entry order as a trigger. In this case, sending alerts for the stop-loss and take-profit order fills can be unnecessary or even problematic. To disable alerts for a specific order placement command, set the <code dir="auto">disable_alert</code> parameter to <code dir="auto">true</code>. The broker emulator still simulates the fills for these orders, but sends no alerts for them.</p>
<p>Here is an example of an order fill command with this parameter set:</p>
<div class="pine-colorizer not-content colorized" data-id="2ks"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"Exit"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">stopLevel</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">limitLevel</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">disable_alert</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br></code></div>      </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a href="/pine-script-docs/faq/programming" class="pagination-card" data-pagefind-ignore="" data-astro-cid-assl6cvf=""> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-assl6cvf="" data-icon="theme/arrow-back">  <use xlink:href="#ai:local:theme/arrow-back"></use>  </svg> Programming  </h4> </a>  <a href="/pine-script-docs/faq/strings-and-formatting" class="pagination-card" data-pagefind-ignore="" data-astro-cid-assl6cvf=""> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Strings and formatting <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-assl6cvf="" data-icon="theme/arrow">  <symbol id="ai:local:theme/arrow"><path fill="none" stroke="var(--arrow-fill-color, #131722)" d="m11 8 6 6-6 6"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use>  </svg> </h4> </a>  </div>  </main>   <div id="toc" data-pagefind-ignore="all" data-astro-cid-oor6cujd=""><aside class="document-toc-container ml-4 w-48" data-astro-cid-oor6cujd=""><section id="toc-scroll-section" class="slick-scroll" data-astro-cid-oor6cujd=""><header data-astro-cid-oor6cujd=""><h2 class="toc-header" data-astro-cid-oor6cujd="">On this page</h2></header><ul class="" id="toc-entries" data-astro-cid-oor6cujd=""><a href="#strategies" aria-current="true" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-current="" data-astro-cid-oor6cujd="">Overview</li></a><a href="#strategy-basics" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">Strategy basics</li></a><a href="#how-can-i-turn-my-indicator-into-a-strategy" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">How can I turn my indicator into a strategy?</li></a><a href="#how-do-i-set-a-basic-stop-loss-order" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">How do I set a basic stop-loss order?</li></a><a href="#how-do-i-set-an-advanced-stop-loss-order" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">How do I set an advanced stop-loss order?</li></a><a href="#how-can-i-save-the-entry-price-in-a-strategy" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">How can I save the entry price in a strategy?</li></a><a href="#how-do-i-filter-trades-by-a-date-or-time-range" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">How do I filter trades by a date or time range?</li></a><a href="#order-execution-and-management" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">Order execution and management</li></a><a href="#why-are-my-orders-executed-on-the-bar-following-my-triggers" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Why are my orders executed on the bar following my triggers?</li></a><a href="#how-can-i-use-multiple-take-profit-levels-to-close-a-position" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">How can I use multiple take-profit levels to close a position?</li></a><a href="#multiple-strategyexit-functions" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd="">Multiple <code>strategy.exit()</code> functions</li></a><a href="#using-strategyocareduce" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd="">Using <code>strategy.oca.reduce</code></li></a><a href="#how-can-i-execute-a-trade-partway-through-a-bar" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">How can I execute a trade partway through a bar?</li></a><a href="#using-calc_on_every_tick" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd="">Using <code>calc_on_every_tick</code></li></a><a href="#using-predefined-prices" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd="">Using predefined prices</li></a><a href="#how-can-i-exit-a-trade-in-the-same-bar-as-it-opens" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">How can I exit a trade in the same bar as it opens?</li></a><a href="#specifying-exit-prices" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd="">Specifying exit prices</li></a><a href="#using-a-market-order-at-bar-close" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd="">Using a market order at bar close</li></a><a href="#advanced-order-types-and-conditions" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">Advanced order types and conditions</li></a><a href="#how-can-i-set-stop-loss-and-take-profit-levels-as-a-percentage-from-my-entry-point" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">How can I set stop-loss and take-profit levels as a percentage from my entry point?</li></a><a href="#using-calc_on_order_fills" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd="">Using <code>calc_on_order_fills</code></li></a><a href="#using-predefined-prices-1" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd="">Using predefined prices</li></a><a href="#how-do-i-move-my-stop-loss-order-to-breakeven" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">How do I move my stop-loss order to breakeven?</li></a><a href="#how-do-i-place-a-trailing-stop-loss" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">How do I place a trailing stop loss?</li></a><a href="#using-built-in-trailing-stop-functionality" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd="">Using built-in trailing stop functionality</li></a><a href="#coding-a-custom-trailing-stop" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd="">Coding a custom trailing stop</li></a><a href="#how-can-i-set-a-time-based-condition-to-close-out-a-position" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">How can I set a time-based condition to close out a position?</li></a><a href="#how-can-i-configure-a-bracket-order-with-a-specific-risk-to-reward-rr-ratio" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">How can I configure a bracket order with a specific risk-to-reward (R:R
) ratio?</li></a><a href="#how-can-i-risk-a-fixed-percentage-of-my-equity-per-trade" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">How can I risk a fixed percentage of my equity per trade?</li></a><a href="#strategy-optimization-and-testing" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">Strategy optimization and testing</li></a><a href="#why-did-my-trade-results-change-dramatically-overnight" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Why did my trade results change dramatically overnight?</li></a><a href="#why-is-backtesting-on-heikin-ashi-and-other-non-standard-charts-not-recommended" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Why is backtesting on Heikin Ashi and other non-standard charts not recommended?</li></a><a href="#how-can-i-backtest-deeper-into-history" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">How can I backtest deeper into history?</li></a><a href="#how-can-i-backtest-multiple-symbols" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">How can I backtest multiple symbols?</li></a><a href="#what-does-bar-magnifier-do" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">What does Bar Magnifier do?</li></a><a href="#advanced-features-and-integration" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">Advanced features and integration</li></a><a href="#can-my-strategy-script-place-orders-with-tradingview-brokers" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Can my strategy script place orders with TradingView brokers?</li></a><a href="#how-can-i-add-a-time-delay-between-orders" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">How can I add a time delay between orders?</li></a><a href="#how-can-i-calculate-custom-statistics-in-a-strategy" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">How can I calculate custom statistics in a strategy?</li></a><a href="#how-do-i-incorporate-leverage-into-my-strategy" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">How do I incorporate leverage into my strategy?</li></a><a href="#can-you-hedge-in-a-pine-script-strategy" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Can you hedge in a Pine Script strategy?</li></a><a href="#can-i-connect-my-strategies-to-my-paper-trading-account" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Can I connect my strategies to my paper trading account?</li></a><a href="#troubleshooting-and-specific-issues" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">Troubleshooting and specific issues</li></a><a href="#why-are-no-trades-executed-after-i-add-the-strategy-to-the-chart" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Why are no trades executed after I add the strategy to the chart?</li></a><a href="#why-does-my-strategy-not-place-any-orders-on-recent-bars" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Why does my strategy not place any orders on recent bars?</li></a><a href="#why-is-my-strategy-repainting" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Why is my strategy repainting?</li></a><a href="#how-do-i-turn-off-alerts-for-stop-loss-and-take-profit-orders" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">How do I turn off alerts for stop loss and take profit orders?</li></a></ul></section><div class="toc-bottom-fade" data-astro-cid-oor6cujd=""></div><div class="back-top-space" data-astro-cid-oor6cujd=""><div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <a id="back-top-button" title="Back to top" href="#top" data-astro-cid-pkzv2hgs="" class="floating-button not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-secondary stvb-icon stvb-icon-force-color stvb-force-no-border"> <svg width="18" height="18" viewBox="0 0 18 18" data-astro-cid-oor6cujd="" data-icon="theme/arrow-up">  <symbol id="ai:local:theme/arrow-up"><g fill="none"><g clip-path="url(#a)"><path fill="currentColor" fill-rule="evenodd" d="m9 3.5.5.44 4 3.5-1 1.12-2.75-2.4V14h-1.5V6.15L5.49 8.56l-.98-1.12 4-3.5z" clip-rule="evenodd"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h18v18H0z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/arrow-up"></use>  </svg> </a> </div> </div></aside></div> </main> </div>   <footer data-astro-cid-b6pf7ola=""> <div class="footer-content" data-astro-cid-b6pf7ola="">  <ul data-astro-cid-b6pf7ola=""> <li data-astro-cid-b6pf7ola=""> <a href="https://www.tradingview.com/chat/#BfmVowG1TZkKO235" data-astro-cid-b6pf7ola="">Pine Q&amp;A chat</a>  </li><li data-astro-cid-b6pf7ola=""> <a href="https://stackoverflow.com/questions/tagged/pine-script" data-astro-cid-b6pf7ola="">Stack Overflow</a>  ↗ </li><li data-astro-cid-b6pf7ola=""> <a href="https://t.me/PineCodersQA" data-astro-cid-b6pf7ola="">Telegram</a>  ↗ </li><li data-astro-cid-b6pf7ola=""> <a href="https://www.reddit.com/r/TradingView/" data-astro-cid-b6pf7ola="">Reddit</a>  ↗ </li> </ul> <div class="flex" data-astro-cid-b6pf7ola=""></div> <div class="copyright" data-astro-cid-b6pf7ola="">Copyright © 2025 TradingView, Inc.</div> </div> </footer>         </body></html>