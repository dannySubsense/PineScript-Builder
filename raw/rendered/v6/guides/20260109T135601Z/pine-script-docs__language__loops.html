<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><script data-astro-exec="">
			const url = window.location.href;
			const expectedUrl = url.replace(
				/^https:\/\/(?!beta)(\w+\.)?tradingview\.com/,
				'https://www.tradingview.com',
			);
			if (url !== expectedUrl) {
				window.location.replace(expectedUrl);
			}
		</script><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="none"><link rel="icon" href="https://static.tradingview.com/static/images/favicon.ico"><link rel="icon" type="image/svg+xml" href="/pine-script-docs/favicon.svg"><title>Language / Loops</title><meta name="og:title" content="Language / Loops"><meta name="twitter:title" content="Language / Loops"><meta name="description" content="Everything you need to know about Pine Script®."><meta name="og:description" content="Everything you need to know about Pine Script®."><meta name="twitter:description" content="Everything you need to know about Pine Script®."><meta name="keywords" content="tradingview, pine, script, indicators, strategies"><meta name="og:image" content="/pine-script-docs/meta-image.png?1"><meta name="twitter:image" content="/pine-script-docs/meta-image.png?1"><meta name="og:image:width" content="1200"><meta name="og:image:height" content="630"><meta name="og:url" content="https://www.tradingview.com/pine-script-docs/language/loops/"><meta name="twitter:url" content="https://www.tradingview.com/pine-script-docs/language/loops/"><meta name="og:type" content="website"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@TradingView"><link rel="canonical" href="https://www.tradingview.com/pine-script-docs/language/loops/"><link rel="sitemap" href="/pine-script-docs/sitemap-index.xml"><link rel="stylesheet" href="/pine-script-docs/_astro/index.DfaRTfPD.css">
<link rel="stylesheet" href="/pine-script-docs/_astro/index.B9ah8c5K.css">
<style>.tv-spinner{display:none;position:absolute;margin:0 auto;border:0 solid rgb(149 152 161 / 20%);border-radius:50%;border-top-color:var(--tv-spinner-color, #2962ff);border-left-color:var(--tv-spinner-color, #2962ff);animation:tv-spinner-container-rotate .9s linear infinite}.tv-spinner-shown{display:block}.tv-spinner-size-large{top:calc(50% - 32px);left:calc(50% - 32px);width:56px;height:56px;border-width:4px}@keyframes tv-spinner-container-rotate{to{transform:rotate(360deg)}}:root{--page-background-color: #fff;background-color:var(--page-background-color)}:root[data-theme=dark]{--page-background-color: #000}body{background-color:var(--page-background-color)}#redirect-link{display:flex;position:absolute;inset:0;align-items:center;justify-content:center}#spinner{display:block;position:absolute;opacity:1;transition:opacity .2s}
.twitter-tweet:not(.twitter-tweet-rendered){padding:var(--tc-padding, 1em);border:1px solid var(--tc-border-color, #cfd9de)}.twitter-tweet:not(.twitter-tweet-rendered)>:first-child{margin-top:0}.twitter-tweet:not(.twitter-tweet-rendered)>:last-child{margin-bottom:0}lite-youtube{background-color:#000;position:relative;display:block;contain:content;background-position:center center;background-size:cover;cursor:pointer;max-width:720px}lite-youtube:before{content:attr(data-title);display:block;position:absolute;top:0;background-image:linear-gradient(180deg,#000000ab,#0000008a 14%,#00000026 54%,#0000000d 72%,#0000 94%);height:99px;width:100%;font-family:YouTube Noto,Roboto,Arial,Helvetica,sans-serif;color:#eee;text-shadow:0 0 2px rgba(0,0,0,.5);font-size:18px;padding:25px 20px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;box-sizing:border-box}lite-youtube:hover:before{color:#fff}lite-youtube:after{content:"";display:block;padding-bottom:56.25%}lite-youtube>iframe{width:100%;height:100%;position:absolute;top:0;left:0;border:0}lite-youtube>.lty-playbtn{display:block;width:100%;height:100%;background:no-repeat center/68px 48px;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 68 48"><path d="M66.52 7.74c-.78-2.93-2.49-5.41-5.42-6.19C55.79.13 34 0 34 0S12.21.13 6.9 1.55c-2.93.78-4.63 3.26-5.42 6.19C.06 13.05 0 24 0 24s.06 10.95 1.48 16.26c.78 2.93 2.49 5.41 5.42 6.19C12.21 47.87 34 48 34 48s21.79-.13 27.1-1.55c2.93-.78 4.64-3.26 5.42-6.19C67.94 34.95 68 24 68 24s-.06-10.95-1.48-16.26z" fill="red"/><path d="M45 24 27 14v20" fill="white"/></svg>');position:absolute;cursor:pointer;z-index:1;filter:grayscale(100%);transition:filter .1s cubic-bezier(0,0,.2,1);border:0}lite-youtube:hover>.lty-playbtn,lite-youtube .lty-playbtn:focus{filter:none}lite-youtube.lyt-activated{cursor:unset}lite-youtube.lyt-activated:before,lite-youtube.lyt-activated>.lty-playbtn{opacity:0;pointer-events:none}.lyt-visually-hidden{clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px}lite-youtube>iframe{all:unset!important;width:100%!important;height:100%!important;position:absolute!important;inset:0!important;border:0!important}lite-vimeo{font-size:10px;background-color:#000;position:relative;display:block;contain:content;background-position:center center;background-size:cover}lite-vimeo:after{content:"";display:block;padding-bottom:56.25%}lite-vimeo>iframe{all:unset!important;width:100%!important;height:100%!important;position:absolute!important;inset:0!important;border:0!important}lite-vimeo>.ltv-playbtn{content:"";position:absolute;inset:0;width:100%;background:transparent;outline:0;border:0;cursor:pointer}lite-vimeo>.ltv-playbtn:before{width:6.5em;height:4em;background:#172322bf;opacity:.8;border-radius:.25rem;transition:all .2s cubic-bezier(0,0,.2,1)}lite-vimeo>.ltv-playbtn:focus:before{outline:auto}lite-vimeo:hover>.ltv-playbtn:before{background-color:#00adef;background-color:var(--ltv-color, #00adef);opacity:1}lite-vimeo>.ltv-playbtn:after{border-style:solid;border-width:1em 0 1em 1.7em;border-color:transparent transparent transparent #fff}lite-vimeo>.ltv-playbtn:before,lite-vimeo>.ltv-playbtn:after{content:"";position:absolute;top:50%;left:50%;transform:translate3d(-50%,-50%,0)}lite-vimeo.ltv-activated:before,lite-vimeo.ltv-activated>.ltv-playbtn{cursor:unset;opacity:0;pointer-events:none}
</style><script type="module" src="/pine-script-docs/_astro/hoisted.wfEHaJbk.js" data-astro-exec=""></script><style id="tv-pine-light" type="text/css" media="screen">.monaco-editor-tv-pine-light { 
.mtk1 { color: #131722; }
.mtk2 { color: #ffffff; }
.mtk3 { color: #808080; }
.mtk4 { color: #ff0000; }
.mtk5 { color: #0451a5; }
.mtk6 { color: #0000ff; }
.mtk7 { color: #098658; }
.mtk8 { color: #008000; }
.mtk9 { color: #9598a1; }
.mtk10 { color: #dd0000; }
.mtk11 { color: #cc2929; }
.mtk12 { color: #f57f17; }
.mtk13 { color: #000000; }
.mtk14 { color: #383838; }
.mtk15 { color: #0c3299; }
.mtk16 { color: #2962ff; }
.mtk17 { color: #8e24aa; }
.mtk18 { color: #22ab94; }
.mtk19 { color: #cd3131; }
.mtk20 { color: #863b00; }
.mtk21 { color: #af00db; }
.mtk22 { color: #800000; }
.mtk23 { color: #e00000; }
.mtk24 { color: #3030c0; }
.mtk25 { color: #666666; }
.mtk26 { color: #778899; }
.mtk27 { color: #c700c7; }
.mtk28 { color: #a31515; }
.mtk29 { color: #388e3c; }
.mtk30 { color: #4f76ac; }
.mtk31 { color: #008080; }
.mtk32 { color: #001188; }
.mtk33 { color: #2a2e39; }
.mtk34 { color: #4864aa; }
.mtki { font-style: italic; }
.mtkb { font-weight: bold; }
.mtku { text-decoration: underline; text-underline-position: under; }
.mtks { text-decoration: line-through; }
.mtks.mtku { text-decoration: underline line-through; text-underline-position: under; } }</style></head> <body> <div id="search-content-blur" hidden=""></div> <script data-astro-exec="">
	/* eslint-disable @typescript-eslint/typedef */
	window.ThemeProvider = (() => {
		function getCurrent() {
			return (
				// eslint-disable-next-line no-restricted-syntax
				typeof localStorage !== 'undefined' &&
				localStorage.getItem('tv-docs-theme')
			);
		}
		const storedTheme = getCurrent();
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ?
				'light'
			:	'dark');
		document.documentElement.dataset.theme =
			theme === 'light' ? 'light' : 'dark';
		document.documentElement.classList.toggle(
			'theme-dark',
			theme === 'dark',
		); // add support for ui-lib themes
		document.documentElement.classList.toggle(
			'sl-theme-dark',
			theme === 'dark',
		); // add support for shoelace themes

		return {
			updatePickers(themeArg = storedTheme || 'auto') {
				let currentTheme = themeArg;
				if (currentTheme === 'unknown') {
					currentTheme = getCurrent() || 'auto';
				}
				document
					.querySelectorAll('docs-theme-select')
					.forEach((picker) => {
						const select = picker.querySelector('select');
						if (select) select.value = currentTheme;
						/** @type {HTMLTemplateElement | null} */
						const tmpl = document.querySelector(`#theme-icons`);
						const newIcon =
							tmpl &&
							tmpl.content.querySelector('.' + currentTheme);
						if (newIcon) {
							const oldIcon =
								picker.querySelector('svg.label-icon');
							if (oldIcon) {
								oldIcon.replaceChildren(
									...newIcon.cloneNode(true).childNodes,
								);
							}
						}
					});
			},
		};
	})();
	/* eslint-enable @typescript-eslint/typedef */
</script><template id="theme-icons"><svg width="16" height="16" viewBox="0 0 28 28" class="light" data-icon="theme/sun-28">  <symbol id="ai:local:theme/sun-28"><g fill="currentColor"><path d="M14 3h1.5v5H14zm0 18h1.5v5H14zm12-5.5V14h-5v1.5zM8 14v1.5H3V14zm15.3-7-1-1-3.6 3.6 1.1 1 3.5-3.5ZM9.5 18.7l1.1 1.1-3.5 3.5-1-1zM22 23.3l1-1-3.6-3.6-1 1.1 3.5 3.5ZM10.3 9.6l-1.1 1-3.5-3.5 1-1z"></path><path fill-rule="evenodd" d="M19 14.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0m-1.5 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0" clip-rule="evenodd"></path></g></symbol><use xlink:href="#ai:local:theme/sun-28"></use>  </svg><svg width="16" height="16" viewBox="0 0 28 28" class="dark" data-icon="theme/moon-28">  <symbol id="ai:local:theme/moon-28"><path fill="currentColor" fill-rule="evenodd" d="M21 7.02A9.23 9.23 0 0 0 15.2 5 9.1 9.1 0 0 0 6 14c0 4.97 4.12 9 9.2 9a9.33 9.33 0 0 0 5.8-2.02A7 7 0 0 1 14.36 14 7 7 0 0 1 21 7.02m-3.95-.3a8 8 0 0 0-1.85-.22A7.6 7.6 0 0 0 7.5 14a7.6 7.6 0 0 0 7.7 7.5 8 8 0 0 0 1.85-.22A8.46 8.46 0 0 1 12.86 14c0-3.1 1.69-5.8 4.19-7.28" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/moon-28"></use>  </svg><svg width="16" height="16" viewBox="0 0 28 28" class="auto" data-icon="theme/system-28">  <symbol id="ai:local:theme/system-28"><path fill="currentColor" d="M8 4h1v2H8zm0 9v2h1v-2zm6-3V9h-2v1zM3 9v1h2V9zm5.5 3a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5m4.2-6-.7-.7-1.4 1.4.7.7zM5 13.7l-.7-.7 1.4-1.4.7.7zm7.7-.7-.7.7-1.4-1.4.7-.7zM4.3 6l.7-.7 1.4 1.4-.7.7zm3 17 14-14 .8.7L8 23.7zm17.2-.1a3.5 3.5 0 0 1-3.4-5.9H21a4 4 0 1 0 3.5 5.9"></path></symbol><use xlink:href="#ai:local:theme/system-28"></use>  </svg></template> <div class="backdrop" data-mobile-menu-backdrop="" data-astro-cid-h2irkosh=""></div> <div class="menu-container" data-astro-cid-h2irkosh=""> <div class="header" data-astro-cid-h2irkosh=""> <div class="header-group" data-astro-cid-h2irkosh=""> <div id="version-select" data-astro-cid-kx7qoxgq=""> <label style="--sl-select-width: undefined; --sl-label-icon-size: 16px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq="">Version</span>  <select value="v6" data-has-border="" no-icon="true" data-astro-cid-lmznfliq=""> <option value="v6" selected="true" data-astro-cid-lmznfliq="">Version 6</option><option value="v5" data-astro-cid-lmznfliq="">Version 5</option><option value="v4" data-astro-cid-lmznfliq="">Version 4</option><option value="v3" data-astro-cid-lmznfliq="">Version 3</option> </select> <svg width="16" height="16" viewBox="0 0 24 24" class="icon caret" data-astro-cid-lmznfliq="" data-icon="theme/down-caret">  <symbol id="ai:local:theme/down-caret"><path fill="currentColor" d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1 1 0 0 0 1.42 0L17 10.59a1 1 0 0 0 0-1.42"></path></symbol><use xlink:href="#ai:local:theme/down-caret"></use>  </svg> </label>  </div>   <docs-theme-select class="" data-astro-cid-3wpspbi7=""> <label style="--sl-select-width: 48px; --sl-label-icon-size: 28px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq="">Theme</span> <svg width="28" height="28" viewBox="0 0 28 28" class="icon label-icon" data-button="" data-round="" data-astro-cid-lmznfliq="" data-icon="theme/system-28">  <symbol id="ai:local:theme/system-28"><path fill="currentColor" d="M8 4h1v2H8zm0 9v2h1v-2zm6-3V9h-2v1zM3 9v1h2V9zm5.5 3a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5m4.2-6-.7-.7-1.4 1.4.7.7zM5 13.7l-.7-.7 1.4-1.4.7.7zm7.7-.7-.7.7-1.4-1.4.7-.7zM4.3 6l.7-.7 1.4 1.4-.7.7zm3 17 14-14 .8.7L8 23.7zm17.2-.1a3.5 3.5 0 0 1-3.4-5.9H21a4 4 0 1 0 3.5 5.9"></path></symbol><use xlink:href="#ai:local:theme/system-28"></use>  </svg> <select value="auto" data-button="" data-astro-cid-lmznfliq=""> <option value="dark" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Dark&nbsp;&nbsp;</option><option value="light" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Light&nbsp;&nbsp;</option><option value="auto" selected="true" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Auto&nbsp;&nbsp;</option> </select>  </label>  </docs-theme-select>   <script data-astro-exec="">
	ThemeProvider.updatePickers('unknown');
</script>  </div> <div class="header-group" data-astro-cid-h2irkosh="">  <div class="not-content" style="stroke-width:2px" data-astro-cid-pkzv2hgs=""> <button id="mobile-menu-back-button" title="Close menu" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-primary stvb-icon">  <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-h2irkosh="" data-icon="theme/arrow-back">  <symbol id="ai:local:theme/arrow-back"><g fill="none"><g clip-path="url(#a)"><path stroke="var(--arrow-fill-color, #131722)" d="m17 20-6-6 6-6"></path></g><defs><clipPath id="a"><path fill="#fff" d="M28 28H0V0h28z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/arrow-back"></use>  </svg>  </button> </div>  </div> </div> <aside id="nav" class="keep-visible" style="--navbar-right-border-width: 0px" data-astro-cid-sa57sq6l=""> <div class="sidebar-viewport slick-scroll" data-astro-cid-sa57sq6l=""> <div class="sidebar" data-mobile="" data-astro-cid-sa57sq6l=""> <ul class="toc" aria-label="Docs sidebar" data-astro-cid-sa57sq6l=""> <li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/welcome" data-astro-cid-omxx3dey="">Welcome to Pine Script® v6</a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Pine Script® primer</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-steps" data-astro-cid-omxx3dey="">First steps</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-indicator" data-astro-cid-omxx3dey="">First indicator</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/next-steps" data-astro-cid-omxx3dey="">Next steps</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details open="" data-is-parent="" data-is-on-path="" data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Language</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/execution-model" data-astro-cid-omxx3dey="">Execution model</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/type-system" data-astro-cid-omxx3dey="">Type system</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/script-structure" data-astro-cid-omxx3dey="">Script structure</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/identifiers" data-astro-cid-omxx3dey="">Identifiers</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/variable-declarations" data-astro-cid-omxx3dey="">Variable declarations</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/operators" data-astro-cid-omxx3dey="">Operators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/conditional-structures" data-astro-cid-omxx3dey="">Conditional structures</a></li><li class="item" data-current="" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/loops" data-astro-cid-omxx3dey="">Loops</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/built-ins" data-astro-cid-omxx3dey="">Built-ins</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/user-defined-functions" data-astro-cid-omxx3dey="">User-defined functions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/objects" data-astro-cid-omxx3dey="">Objects</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/enums" data-astro-cid-omxx3dey="">Enums</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/methods" data-astro-cid-omxx3dey="">Methods</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/arrays" data-astro-cid-omxx3dey="">Arrays</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/matrices" data-astro-cid-omxx3dey="">Matrices</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/maps" data-astro-cid-omxx3dey="">Maps</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Visuals</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/overview" data-astro-cid-omxx3dey="">Overview</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/backgrounds" data-astro-cid-omxx3dey="">Backgrounds</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/bar-coloring" data-astro-cid-omxx3dey="">Bar coloring</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/bar-plotting" data-astro-cid-omxx3dey="">Bar plotting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/colors" data-astro-cid-omxx3dey="">Colors</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/fills" data-astro-cid-omxx3dey="">Fills</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/levels" data-astro-cid-omxx3dey="">Levels</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/lines-and-boxes" data-astro-cid-omxx3dey="">Lines and boxes</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/plots" data-astro-cid-omxx3dey="">Plots</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/tables" data-astro-cid-omxx3dey="">Tables</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/text-and-shapes" data-astro-cid-omxx3dey="">Text and shapes</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Concepts</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/alerts" data-astro-cid-omxx3dey="">Alerts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-states" data-astro-cid-omxx3dey="">Bar states</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/chart-information" data-astro-cid-omxx3dey="">Chart information</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/inputs" data-astro-cid-omxx3dey="">Inputs</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/libraries" data-astro-cid-omxx3dey="">Libraries</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/non-standard-charts-data" data-astro-cid-omxx3dey="">Non-standard charts data</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/other-timeframes-and-data" data-astro-cid-omxx3dey="">Other timeframes and data</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/repainting" data-astro-cid-omxx3dey="">Repainting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/sessions" data-astro-cid-omxx3dey="">Sessions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strategies" data-astro-cid-omxx3dey="">Strategies</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strings" data-astro-cid-omxx3dey="">Strings</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/time" data-astro-cid-omxx3dey="">Time</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/timeframes" data-astro-cid-omxx3dey="">Timeframes</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Writing scripts</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/style-guide" data-astro-cid-omxx3dey="">Style guide</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/debugging" data-astro-cid-omxx3dey="">Debugging</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/profiling-and-optimization" data-astro-cid-omxx3dey="">Profiling and optimization</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/publishing" data-astro-cid-omxx3dey="">Publishing scripts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/limitations" data-astro-cid-omxx3dey="">Limitations</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">FAQ</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/general" data-astro-cid-omxx3dey="">General</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/alerts" data-astro-cid-omxx3dey="">Alerts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/data-structures" data-astro-cid-omxx3dey="">Data structures</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/functions" data-astro-cid-omxx3dey="">Functions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/indicators" data-astro-cid-omxx3dey="">Indicators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/other-data-and-timeframes" data-astro-cid-omxx3dey="">Other data and timeframes</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/programming" data-astro-cid-omxx3dey="">Programming</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/strategies" data-astro-cid-omxx3dey="">Strategies</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/strings-and-formatting" data-astro-cid-omxx3dey="">Strings and formatting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/techniques" data-astro-cid-omxx3dey="">Techniques</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/times-dates-and-sessions" data-astro-cid-omxx3dey="">Times, dates, and sessions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/variables-and-operators" data-astro-cid-omxx3dey="">Variables and operators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/visuals" data-astro-cid-omxx3dey="">Visuals</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/error-messages" data-astro-cid-omxx3dey="">Error messages</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/release-notes" data-astro-cid-omxx3dey="">Release notes</a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Migration guides</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/overview" data-astro-cid-omxx3dey="">Overview</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-6" data-astro-cid-omxx3dey="">To Pine Script® version 6</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-5" data-astro-cid-omxx3dey="">To Pine Script® version 5</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-4" data-astro-cid-omxx3dey="">To Pine Script® version 4</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-3" data-astro-cid-omxx3dey="">To Pine Script® version 3</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-2" data-astro-cid-omxx3dey="">To Pine Script® version 2</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/where-can-i-get-more-information" data-astro-cid-omxx3dey="">Where can I get more information?</a></li> </ul> <div class="toc-bottom" data-astro-cid-sa57sq6l=""></div> </div> </div> </aside>  </div>   <header class="header" data-astro-cid-d74r2unp=""> <nav role="navigation" aria-label="Main Navigation" data-astro-cid-d74r2unp=""> <mobile-menu-button id="mobile-menu-button-wc" data-astro-cid-oojooh3d=""> <!-- Annoyingly I need to wrap this. TODO: improve this --> <div id="mobile-menu-button-header" data-astro-cid-oojooh3d=""> <div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <button title="Open navigation menu" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-secondary stvb-icon stvb-icon-force-color stvb-force-no-border">  <svg width="28" height="28" viewBox="0 0 24 24" data-astro-cid-oojooh3d="" data-icon="theme/bars">  <symbol id="ai:local:theme/bars"><path fill="currentColor" d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2m18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2m0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2"></path></symbol><use xlink:href="#ai:local:theme/bars"></use>  </svg>  </button> </div>  </div> </mobile-menu-button>   <div data-hide-when-search="" data-astro-cid-d74r2unp=""> <div class="header-logo" data-astro-cid-tycb33lk=""> <a href="/pine-script-docs/" aria-label="Home button" data-astro-cid-tycb33lk=""> <div class="documentation-logo logo" data-astro-cid-tycb33lk=""><!-- Old Christmas icon -->
<!-- 
<svg width="184" height="44" viewBox="0 0 184 44" fill="none" xmlns="http://www.w3.org/2000/svg">
	<path fill-rule="evenodd" clip-rule="evenodd" d="M33.8209 5.1219C33.885 4.95937 34.115 4.95937 34.1791 5.1219L35.2253 7.77465L37.8781 8.82088C38.0406 8.88499 38.0406 9.11501 37.8781 9.17912L35.2253 10.2253L34.1791 12.8781C34.115 13.0406 33.885 13.0406 33.8209 12.8781L32.7747 10.2253L30.1219 9.17912C29.9594 9.11501 29.9594 8.88499 30.1219 8.82088L32.7747 7.77465L33.8209 5.1219Z" fill="#F9A825"/>
    <path d="M5.30092 15.1478C5.37479 14.9605 5.63986 14.9605 5.71373 15.1478L6.60557 17.4091L8.86685 18.3009C9.05415 18.3748 9.05415 18.6399 8.86685 18.7137L6.60557 19.6056L5.71373 21.8669C5.63986 22.0541 5.37479 22.0541 5.30092 21.8669L4.40908 19.6056L2.1478 18.7137C1.9605 18.6399 1.9605 18.3748 2.1478 18.3009L4.40908 17.4091L5.30092 15.1478Z" fill="#F9A825"/>
    <path d="M11.8231 3.12041C11.8864 2.95986 12.1136 2.95986 12.1769 3.12041L12.9414 5.05865L14.8796 5.82308C15.0401 5.8864 15.0401 6.1136 14.8796 6.17692L12.9414 6.94135L12.1769 8.87959C12.1136 9.04014 11.8864 9.04014 11.8231 8.87959L11.0586 6.94135L9.12041 6.17692C8.95986 6.1136 8.95986 5.8864 9.12041 5.82308L11.0586 5.05865L11.8231 3.12041Z" fill="#F9A825"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M22.6478 7.35459L34.7627 21.6923C35.1531 22.1543 35.0472 22.8544 34.5376 23.1802L26.9989 28.0001L18.4281 20.7531L11.3382 23.2611C10.402 23.5923 9.60771 22.5041 10.2085 21.7134L21.0877 7.39502C21.4749 6.88536 22.2346 6.86567 22.6478 7.35459ZM33.432 28.0842L38.3592 34.7471C38.7427 35.2657 38.3724 36 37.7274 36H6.27248C5.62746 36 5.25722 35.2657 5.64074 34.7471L10.8523 27.6996C10.9484 27.5697 11.0822 27.4725 11.2356 27.4214L17.6878 25.2707C17.9285 25.1904 18.1932 25.2314 18.3984 25.3806L26.2854 31.1166C26.5445 31.3051 26.8922 31.3173 27.1639 31.1475L32.3838 27.885C32.7316 27.6677 33.1881 27.7544 33.432 28.0842Z" fill="#089981"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M17.6363 11.9375C20.7386 12.451 23.1213 11.505 24.9187 10.0422L25.8869 11.1881C23.6236 13.0379 20.553 14.1584 16.6261 13.267L17.6363 11.9375ZM34.0572 20.8573C30.0669 21.363 26.2864 20.8179 23.1264 19.7076C20.7393 18.8689 18.6873 17.7013 17.155 16.3997C16.5283 15.8674 15.9767 15.3021 15.5241 14.7174L16.4708 13.4713C16.8706 14.0544 17.4225 14.6588 18.1262 15.2565C19.5001 16.4237 21.3856 17.5061 23.6236 18.2924C26.3235 19.241 29.5087 19.7493 32.8863 19.4716L34.0572 20.8573ZM9.06812 30.1123C15.4775 33.3909 23.0493 33.8897 29.0345 32.0941C31.0827 31.4796 32.9275 30.6019 34.4713 29.4897L35.3633 30.6959C33.6586 31.9268 31.6497 32.8756 29.4655 33.5309C23.053 35.4546 14.9758 34.8964 8.16479 31.3339L9.06812 30.1123Z" fill="#45E5CB"/>
    <path d="M55.56 13.96C59.016 13.96 61.536 16.456 61.536 19.696C61.536 22.936 59.016 25.432 55.56 25.432H53.376V31H49.896V13.96H55.56ZM55.512 22.168C57.096 22.168 58.152 21.088 58.152 19.696C58.152 18.304 57.096 17.224 55.512 17.224H53.376V22.168H55.512ZM66.8636 14.944C66.8636 16.096 65.9276 17.032 64.7516 17.032C63.6236 17.032 62.6636 16.096 62.6636 14.944C62.6636 13.792 63.6236 12.856 64.7516 12.856C65.9276 12.856 66.8636 13.792 66.8636 14.944ZM63.1196 31V19H66.4076V31H63.1196ZM69.0849 31V19H72.3729V20.368C72.9969 19.408 74.2449 18.736 75.8049 18.736C78.7089 18.736 80.4369 20.848 80.4369 23.968V31H77.1489V24.52C77.1489 22.792 76.4049 21.736 75.0369 21.736C73.5249 21.736 72.3729 22.84 72.3729 25.144V31H69.0849ZM82.2041 25C82.2041 21.448 84.8681 18.736 88.5161 18.736C91.6601 18.736 94.4201 20.752 94.4201 24.64C94.4201 24.928 94.4201 25.264 94.3721 25.768H85.3961C85.5881 27.376 87.0041 28.264 88.5881 28.264C90.0761 28.264 91.1561 27.568 91.6841 26.752L94.1321 28.576C93.0281 30.184 91.0841 31.264 88.5641 31.264C84.9881 31.264 82.2041 28.792 82.2041 25ZM88.4201 21.448C87.1961 21.448 85.8281 22.072 85.5161 23.536H91.1321C90.8441 22.12 89.6441 21.448 88.4201 21.448ZM100.412 28.24L103.076 26.008C103.916 27.28 105.38 28.024 106.772 28.024C108.14 28.024 109.052 27.352 109.052 26.368C109.052 25.408 108.356 24.736 106.676 24.16L105.236 23.656C102.5 22.696 101.036 21.112 101.036 18.784C101.036 15.568 103.484 13.672 106.796 13.672C108.884 13.672 110.708 14.392 112.172 16.024L109.868 18.4C109.052 17.416 107.996 16.936 106.82 16.936C105.644 16.936 104.54 17.44 104.54 18.448C104.54 19.48 105.38 19.936 107.18 20.584L108.548 21.088C111.044 22 112.604 23.584 112.604 26.152C112.58 29.2 110.156 31.288 106.628 31.288C103.916 31.288 101.636 30.112 100.412 28.24ZM125.859 27.808C124.827 29.872 122.667 31.264 120.171 31.264C116.619 31.264 113.811 28.624 113.811 25C113.811 21.376 116.619 18.736 120.171 18.736C122.667 18.736 124.827 20.128 125.859 22.192L123.003 23.728C122.523 22.624 121.491 21.808 120.171 21.808C118.443 21.808 117.123 23.152 117.123 25C117.123 26.848 118.443 28.192 120.171 28.192C121.491 28.192 122.523 27.376 123.003 26.272L125.859 27.808ZM127.482 31V19H130.77V20.92C131.178 19.744 132.402 18.856 133.746 18.856C134.082 18.856 134.442 18.88 134.85 19V22.336C134.346 22.168 133.89 22.072 133.362 22.072C131.802 22.072 130.77 23.296 130.77 25.264V31H127.482ZM140.215 14.944C140.215 16.096 139.279 17.032 138.103 17.032C136.975 17.032 136.015 16.096 136.015 14.944C136.015 13.792 136.975 12.856 138.103 12.856C139.279 12.856 140.215 13.792 140.215 14.944ZM136.471 31V19H139.759V31H136.471ZM142.436 36.016V19H145.724V20.344C146.276 19.576 147.548 18.736 149.204 18.736C152.396 18.736 154.844 21.592 154.844 25C154.844 28.408 152.396 31.264 149.204 31.264C147.548 31.264 146.276 30.424 145.724 29.656V36.016H142.436ZM151.508 25C151.508 23.128 150.284 21.736 148.484 21.736C146.684 21.736 145.46 23.128 145.46 25C145.46 26.872 146.684 28.264 148.484 28.264C150.284 28.264 151.508 26.872 151.508 25ZM164.407 30.88C163.879 31.048 163.231 31.144 162.319 31.144C159.775 31.144 157.735 29.728 157.735 26.8V21.88H155.311V19H157.735V15.664H161.023V19H164.407V21.88H161.023V26.152C161.023 27.616 161.647 28.192 163.063 28.192C163.591 28.192 164.023 28.12 164.407 27.976V30.88ZM173.626 22.648V13.96H175.978L177.874 16.888L179.746 13.96H182.122V22.648H179.698V18.184L177.874 20.968L176.026 18.136V22.648H173.626ZM167.386 22.648V16.456H165.058V13.96H172.258V16.456H169.93V22.648H167.386Z" fill="currentColor"/>
</svg> -->



<!-- Regular icon -->

<svg width="177" height="44" viewBox="0 0 177 44" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M17.6876 25.2705C17.9283 25.1902 18.1933 25.2316 18.3985 25.3808L26.2852 31.1162C26.5444 31.3047 26.8924 31.3173 27.1641 31.1474L32.3839 27.8847C32.7316 27.6675 33.1878 27.7545 33.4317 28.084L38.3594 34.7471C38.7428 35.2656 38.3725 35.9999 37.7276 36H6.27253C5.62754 36 5.25723 35.2657 5.64069 34.7471L10.8526 27.6992C10.9486 27.5695 11.0824 27.4729 11.2354 27.4219L17.6876 25.2705ZM21.088 7.39451C21.4752 6.88532 22.2345 6.8659 22.6475 7.35448L34.7628 21.6924C35.1531 22.1544 35.0468 22.8548 34.5372 23.1806L26.9991 28L18.4278 20.7529L11.338 23.2607C10.4021 23.5917 9.60809 22.5044 10.2081 21.7139L21.088 7.39451ZM13.8243 20.2597L17.7608 18.8672C18.4309 18.6301 19.1771 18.7667 19.7198 19.2256L27.1641 25.5205L32.4981 22.1103L21.9259 9.59862L13.8243 20.2597Z" fill="currentColor"></path>
<path d="M147.308 16.959C150.499 16.959 152.948 19.8149 152.948 23.2227C152.948 26.6307 150.5 29.4873 147.308 29.4873C145.652 29.4872 144.38 28.6469 143.828 27.8789V34.2393H140.54V17.2227H143.828V18.5674C144.38 17.7994 145.652 16.9591 147.308 16.959ZM104.9 11.8955C106.988 11.8956 108.812 12.6152 110.276 14.2471L107.972 16.623C107.156 15.6392 106.1 15.1592 104.924 15.1592C103.748 15.1592 102.645 15.6631 102.645 16.6709C102.645 17.7029 103.484 18.1596 105.284 18.8076L106.652 19.3115C109.148 20.2235 110.708 21.8072 110.708 24.375C110.684 27.4229 108.26 29.5106 104.732 29.5107C102.02 29.5107 99.7396 28.3349 98.5156 26.4629L101.18 24.2314C102.02 25.5034 103.484 26.247 104.876 26.2471C106.244 26.2471 107.156 25.5748 107.156 24.5908C107.156 23.631 106.46 22.9587 104.78 22.3828L103.34 21.8789C100.604 20.9189 99.1396 19.3348 99.1396 17.0068C99.1398 13.791 101.588 11.8955 104.9 11.8955ZM86.6201 16.959C89.7641 16.959 92.5244 18.9753 92.5244 22.8633C92.5244 23.1513 92.5246 23.4873 92.4766 23.9912H83.5C83.692 25.5992 85.1084 26.4873 86.6924 26.4873C88.18 26.4872 89.26 25.7914 89.7881 24.9756L92.2363 26.7988C91.1323 28.4068 89.188 29.4873 86.668 29.4873C83.092 29.4872 80.3086 27.0146 80.3086 23.2227C80.3088 19.6709 82.9723 16.959 86.6201 16.959ZM118.275 16.959C120.771 16.9591 122.931 18.3512 123.963 20.415L121.107 21.9512C120.627 20.8473 119.595 20.0314 118.275 20.0312C116.548 20.0312 115.227 21.3749 115.227 23.2227C115.227 25.0707 116.547 26.415 118.275 26.415C119.595 26.4149 120.627 25.599 121.107 24.4951L123.963 26.0312C122.931 28.0951 120.771 29.4872 118.275 29.4873C114.723 29.4873 111.915 26.8467 111.915 23.2227C111.915 19.5989 114.724 16.959 118.275 16.959ZM159.127 17.2227H162.511V20.1035H159.127V24.375C159.127 25.839 159.751 26.415 161.167 26.415C161.695 26.415 162.127 26.3432 162.511 26.1992V29.1035C161.983 29.2715 161.335 29.3672 160.423 29.3672C157.879 29.3672 155.839 27.9512 155.839 25.0234V20.1035H153.415V17.2227H155.839V13.8867H159.127V17.2227ZM53.6641 12.1836C57.12 12.1836 59.6395 14.6791 59.6396 17.9189C59.6396 21.1589 57.12 23.6552 53.6641 23.6553H51.4805V29.2227H48V12.1836H53.6641ZM64.5117 29.2227H61.2236V17.2227H64.5117V29.2227ZM73.9092 16.959C76.813 16.9591 78.541 19.0715 78.541 22.1914V29.2227H75.2529V22.7432C75.2529 21.0152 74.5086 19.959 73.1406 19.959C71.6288 19.9591 70.4766 21.0633 70.4766 23.3672V29.2227H67.1885V17.2227H70.4766V18.5908C71.1006 17.6308 72.3492 16.959 73.9092 16.959ZM131.85 17.0791C132.186 17.0791 132.546 17.1027 132.954 17.2227V20.5596C132.45 20.3916 131.994 20.2949 131.466 20.2949C129.906 20.2949 128.874 21.5193 128.874 23.4873V29.2227H125.586V17.2227H128.874V19.1436C129.282 17.9676 130.506 17.0792 131.85 17.0791ZM137.862 29.2227H134.574V17.2227H137.862V29.2227ZM146.588 19.959C144.788 19.959 143.564 21.3509 143.563 23.2227C143.563 25.0947 144.788 26.4873 146.588 26.4873C148.388 26.4873 149.612 25.0947 149.612 23.2227C149.612 21.3509 148.388 19.959 146.588 19.959ZM169.993 9.76074C170.876 9.76079 171.697 9.9237 172.455 10.25C173.213 10.5764 173.881 11.0326 174.457 11.6182C175.043 12.1942 175.499 12.8617 175.825 13.6201C176.151 14.3783 176.314 15.1991 176.314 16.082C176.314 16.9556 176.152 17.7769 175.825 18.5449C175.499 19.3032 175.043 19.975 174.457 20.5605C173.881 21.1365 173.208 21.5877 172.44 21.9141C171.682 22.2404 170.867 22.4042 169.993 22.4043C169.12 22.4043 168.298 22.2405 167.53 21.9141C166.772 21.5877 166.1 21.1365 165.515 20.5605C164.939 19.975 164.488 19.3032 164.161 18.5449C163.835 17.7769 163.671 16.9556 163.671 16.082C163.671 15.2086 163.835 14.393 164.161 13.6348C164.488 12.8668 164.939 12.1942 165.515 11.6182C166.1 11.0327 166.772 10.5764 167.53 10.25C168.298 9.92362 169.12 9.76074 169.993 9.76074ZM86.5244 19.6709C85.3005 19.6709 83.9323 20.295 83.6201 21.7588H89.2363C88.9482 20.3431 87.7482 19.671 86.5244 19.6709ZM169.993 11.1865C169.312 11.1865 168.672 11.3109 168.077 11.5605C167.492 11.8101 166.974 12.1612 166.522 12.6123C166.071 13.0635 165.72 13.5865 165.471 14.1816C165.221 14.7671 165.097 15.4006 165.097 16.082C165.097 16.7634 165.221 17.402 165.471 17.9971C165.72 18.5827 166.071 19.1015 166.522 19.5527C166.974 20.0038 167.492 20.3539 168.077 20.6035C168.672 20.8531 169.312 20.9785 169.993 20.9785C170.675 20.9785 171.308 20.8531 171.894 20.6035C172.489 20.3539 173.012 20.0038 173.463 19.5527C173.914 19.1015 174.265 18.5827 174.515 17.9971C174.764 17.402 174.889 16.7634 174.889 16.082C174.889 15.4006 174.764 14.7671 174.515 14.1816C174.265 13.5865 173.914 13.0635 173.463 12.6123C173.012 12.1611 172.489 11.8101 171.894 11.5605C171.308 11.311 170.675 11.1866 169.993 11.1865ZM51.4805 20.3916H53.6162C55.2001 20.3915 56.2559 19.3109 56.2559 17.9189C56.2558 16.5271 55.2 15.4474 53.6162 15.4473H51.4805V20.3916ZM169.878 13.2314C170.406 13.2315 170.838 13.2932 171.174 13.418C171.519 13.5332 171.773 13.7163 171.937 13.9658C172.1 14.2154 172.182 14.5271 172.182 14.9014C172.182 15.2469 172.09 15.5494 171.908 15.8086C171.726 16.0581 171.481 16.2646 171.174 16.4277L172.815 18.9336H171.217L169.964 16.8027H169.445V18.9336H168.034V13.2314H169.878ZM169.445 15.751H169.849C170.127 15.751 170.348 15.6932 170.511 15.5781C170.674 15.4533 170.756 15.247 170.756 14.959C170.756 14.7383 170.684 14.5703 170.54 14.4551C170.396 14.3399 170.165 14.2822 169.849 14.2822H169.445V15.751ZM62.8555 11.0791C64.0314 11.0791 64.9677 12.0151 64.9678 13.167C64.9678 14.319 64.0315 15.2549 62.8555 15.2549C61.7275 15.2548 60.7676 14.3189 60.7676 13.167C60.7677 12.0151 61.7276 11.0792 62.8555 11.0791ZM136.207 11.0791C137.383 11.0793 138.318 12.0152 138.318 13.167C138.318 14.3188 137.383 15.2546 136.207 15.2549C135.079 15.2549 134.118 14.319 134.118 13.167C134.118 12.0151 135.079 11.0791 136.207 11.0791Z" fill="currentColor"></path>
</svg>
</div> </a> </div>  </div> <div class="flex" data-astro-cid-d74r2unp=""></div> <div class="flex" data-astro-cid-d74r2unp=""> <div class="search-container" data-astro-cid-fg37foga=""> <div class="search-wrapper" data-astro-cid-fg37foga=""> <input class="search-input" type="text" placeholder="Search docs" name="s" value="" data-astro-cid-fg37foga="" data-has-input-listener="true"> <svg width="28" height="28" viewBox="0 0 28 28" class="search-button" data-astro-cid-fg37foga="" data-icon="theme/search">  <symbol id="ai:local:theme/search"><path fill="currentColor" fill-rule="evenodd" d="M18.5 12.5a6 6 0 1 1-12 0 6 6 0 0 1 12 0m-1.25 5.8a7.5 7.5 0 1 1 1.06-1.06l4.22 4.23.53.53L22 23.06l-.53-.53-4.22-4.22Z" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/search"></use>  </svg> <button class="search-clear" type="button" title="Reset" data-search-clear="" data-astro-cid-fg37foga="">Clear</button> <span class="divider" data-astro-cid-fg37foga=""></span> <button class="search-close" type="button" title="Close" data-search-close="" data-astro-cid-fg37foga=""> <svg width="18" height="18" viewBox="0 0 18 18" data-astro-cid-fg37foga="" data-icon="theme/cross-18">  <use xlink:href="#ai:local:theme/cross-18"></use>  </svg> </button> </div> <div id="search-results-wrapper" data-astro-cid-fg37foga=""> <aside id="search-results" hidden="" data-astro-cid-fg37foga="" data-has-button-listener="true"> <!-- Don't use h1 because when built it will be used as the first heading on the page --> <div class="heading" data-astro-cid-fg37foga="">Search results</div> <div id="search-results-contents" data-astro-cid-fg37foga=""></div> </aside> </div> </div>   </div> <ul class="links" data-astro-cid-d74r2unp="">  </ul> <div class="flex" data-astro-cid-d74r2unp=""></div> <div data-hide-when-search="" data-astro-cid-d74r2unp=""> <div id="version-select" data-hideable="true" data-astro-cid-kx7qoxgq=""> <label style="--sl-select-width: undefined; --sl-label-icon-size: 16px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq="">Version</span>  <select value="v6" data-has-border="" no-icon="true" data-astro-cid-lmznfliq=""> <option value="v6" selected="true" data-astro-cid-lmznfliq="">Version 6</option><option value="v5" data-astro-cid-lmznfliq="">Version 5</option><option value="v4" data-astro-cid-lmznfliq="">Version 4</option><option value="v3" data-astro-cid-lmznfliq="">Version 3</option> </select> <svg width="16" height="16" viewBox="0 0 24 24" class="icon caret" data-astro-cid-lmznfliq="" data-icon="theme/down-caret">  <use xlink:href="#ai:local:theme/down-caret"></use>  </svg> </label>  </div>   </div> <button id="search-button" data-astro-cid-6zeqadij="" data-has-listener="true"> <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-6zeqadij="" data-icon="theme/search">  <use xlink:href="#ai:local:theme/search"></use>  </svg> </button>  <script data-base-url="/pine-script-docs" data-astro-exec="">
	async function loadPageFind() {
		const base = document.currentScript.getAttribute('data-base-url');
		const pageFindBundleUrl = `${base}/pagefind/`;
		const pagefind = await import(`${pageFindBundleUrl}pagefind.js`);
		await pagefind.options({
			bundlePath: pageFindBundleUrl,
		});
		window.pagefind = pagefind;
	}
	loadPageFind().catch();
</script>  <docs-theme-select class="hide-with-breakpoint-568" data-astro-cid-3wpspbi7=""> <label style="--sl-select-width: 48px; --sl-label-icon-size: 28px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq="">Theme</span> <svg width="28" height="28" viewBox="0 0 28 28" class="icon label-icon" data-button="" data-round="" data-astro-cid-lmznfliq="" data-icon="theme/system-28">  <symbol id="ai:local:theme/system-28"><path fill="currentColor" d="M8 4h1v2H8zm0 9v2h1v-2zm6-3V9h-2v1zM3 9v1h2V9zm5.5 3a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5m4.2-6-.7-.7-1.4 1.4.7.7zM5 13.7l-.7-.7 1.4-1.4.7.7zm7.7-.7-.7.7-1.4-1.4.7-.7zM4.3 6l.7-.7 1.4 1.4-.7.7zm3 17 14-14 .8.7L8 23.7zm17.2-.1a3.5 3.5 0 0 1-3.4-5.9H21a4 4 0 1 0 3.5 5.9"></path></symbol><use xlink:href="#ai:local:theme/system-28"></use>  </svg> <select value="auto" data-button="" data-astro-cid-lmznfliq=""> <option value="dark" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Dark&nbsp;&nbsp;</option><option value="light" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Light&nbsp;&nbsp;</option><option value="auto" selected="true" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Auto&nbsp;&nbsp;</option> </select>  </label>  </docs-theme-select>   <script data-astro-exec="">
	ThemeProvider.updatePickers('unknown');
</script>  </nav> </header>        <div id="image-lightbox" class="not-content" hidden="" data-astro-cid-kws7taxh=""> <div class="button-wrapper" data-astro-cid-kws7taxh=""> <div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <button id="lightbox-close-button" title="Close image preview" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-black stvb-medium stvb-secondary stvb-icon stvb-force-no-border">  <svg width="24" height="24" viewBox="0 0 18 18" data-astro-cid-kws7taxh="" data-icon="theme/cross-18">  <symbol id="ai:local:theme/cross-18"><g fill="none"><g clip-path="url(#a)"><path fill="currentColor" fill-rule="evenodd" d="M5.53 4.47 4.47 5.53 7.94 9l-3.47 3.47 1.06 1.06L9 10.06l3.47 3.47 1.06-1.06L10.06 9l3.47-3.47-1.06-1.06L9 7.94z" clip-rule="evenodd"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h18v18H0z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/cross-18"></use>  </svg>  </button> </div>  </div> <img id="lightbox-image" src="" data-astro-cid-kws7taxh=""> </div>   <div id="page-container" data-astro-cid-xgirumru=""> <aside id="nav" class="" style="" data-astro-cid-sa57sq6l=""> <div class="sidebar-viewport slick-scroll" data-astro-cid-sa57sq6l=""> <div class="sidebar" data-astro-cid-sa57sq6l=""> <ul class="toc" aria-label="Docs sidebar" data-astro-cid-sa57sq6l=""> <li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/welcome" data-astro-cid-omxx3dey="">Welcome to Pine Script® v6</a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Pine Script® primer</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <symbol id="ai:local:theme/right-caret"><path fill="currentColor" d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1 1 0 0 0 0-1.42"></path></symbol><use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-steps" data-astro-cid-omxx3dey="">First steps</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-indicator" data-astro-cid-omxx3dey="">First indicator</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/next-steps" data-astro-cid-omxx3dey="">Next steps</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details open="" data-is-parent="" data-is-on-path="" data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Language</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/execution-model" data-astro-cid-omxx3dey="">Execution model</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/type-system" data-astro-cid-omxx3dey="">Type system</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/script-structure" data-astro-cid-omxx3dey="">Script structure</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/identifiers" data-astro-cid-omxx3dey="">Identifiers</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/variable-declarations" data-astro-cid-omxx3dey="">Variable declarations</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/operators" data-astro-cid-omxx3dey="">Operators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/conditional-structures" data-astro-cid-omxx3dey="">Conditional structures</a></li><li class="item" data-current="" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/loops" data-astro-cid-omxx3dey="">Loops</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/built-ins" data-astro-cid-omxx3dey="">Built-ins</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/user-defined-functions" data-astro-cid-omxx3dey="">User-defined functions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/objects" data-astro-cid-omxx3dey="">Objects</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/enums" data-astro-cid-omxx3dey="">Enums</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/methods" data-astro-cid-omxx3dey="">Methods</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/arrays" data-astro-cid-omxx3dey="">Arrays</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/matrices" data-astro-cid-omxx3dey="">Matrices</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/maps" data-astro-cid-omxx3dey="">Maps</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Visuals</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/overview" data-astro-cid-omxx3dey="">Overview</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/backgrounds" data-astro-cid-omxx3dey="">Backgrounds</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/bar-coloring" data-astro-cid-omxx3dey="">Bar coloring</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/bar-plotting" data-astro-cid-omxx3dey="">Bar plotting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/colors" data-astro-cid-omxx3dey="">Colors</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/fills" data-astro-cid-omxx3dey="">Fills</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/levels" data-astro-cid-omxx3dey="">Levels</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/lines-and-boxes" data-astro-cid-omxx3dey="">Lines and boxes</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/plots" data-astro-cid-omxx3dey="">Plots</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/tables" data-astro-cid-omxx3dey="">Tables</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/text-and-shapes" data-astro-cid-omxx3dey="">Text and shapes</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Concepts</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/alerts" data-astro-cid-omxx3dey="">Alerts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-states" data-astro-cid-omxx3dey="">Bar states</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/chart-information" data-astro-cid-omxx3dey="">Chart information</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/inputs" data-astro-cid-omxx3dey="">Inputs</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/libraries" data-astro-cid-omxx3dey="">Libraries</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/non-standard-charts-data" data-astro-cid-omxx3dey="">Non-standard charts data</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/other-timeframes-and-data" data-astro-cid-omxx3dey="">Other timeframes and data</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/repainting" data-astro-cid-omxx3dey="">Repainting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/sessions" data-astro-cid-omxx3dey="">Sessions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strategies" data-astro-cid-omxx3dey="">Strategies</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strings" data-astro-cid-omxx3dey="">Strings</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/time" data-astro-cid-omxx3dey="">Time</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/timeframes" data-astro-cid-omxx3dey="">Timeframes</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Writing scripts</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/style-guide" data-astro-cid-omxx3dey="">Style guide</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/debugging" data-astro-cid-omxx3dey="">Debugging</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/profiling-and-optimization" data-astro-cid-omxx3dey="">Profiling and optimization</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/publishing" data-astro-cid-omxx3dey="">Publishing scripts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/limitations" data-astro-cid-omxx3dey="">Limitations</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">FAQ</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/general" data-astro-cid-omxx3dey="">General</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/alerts" data-astro-cid-omxx3dey="">Alerts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/data-structures" data-astro-cid-omxx3dey="">Data structures</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/functions" data-astro-cid-omxx3dey="">Functions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/indicators" data-astro-cid-omxx3dey="">Indicators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/other-data-and-timeframes" data-astro-cid-omxx3dey="">Other data and timeframes</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/programming" data-astro-cid-omxx3dey="">Programming</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/strategies" data-astro-cid-omxx3dey="">Strategies</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/strings-and-formatting" data-astro-cid-omxx3dey="">Strings and formatting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/techniques" data-astro-cid-omxx3dey="">Techniques</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/times-dates-and-sessions" data-astro-cid-omxx3dey="">Times, dates, and sessions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/variables-and-operators" data-astro-cid-omxx3dey="">Variables and operators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/visuals" data-astro-cid-omxx3dey="">Visuals</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/error-messages" data-astro-cid-omxx3dey="">Error messages</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/release-notes" data-astro-cid-omxx3dey="">Release notes</a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Migration guides</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/overview" data-astro-cid-omxx3dey="">Overview</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-6" data-astro-cid-omxx3dey="">To Pine Script® version 6</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-5" data-astro-cid-omxx3dey="">To Pine Script® version 5</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-4" data-astro-cid-omxx3dey="">To Pine Script® version 4</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-3" data-astro-cid-omxx3dey="">To Pine Script® version 3</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-2" data-astro-cid-omxx3dey="">To Pine Script® version 2</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/where-can-i-get-more-information" data-astro-cid-omxx3dey="">Where can I get more information?</a></li> </ul> <div class="toc-bottom" data-astro-cid-sa57sq6l=""></div> </div> </div> </aside>  <main class="main-pane" data-page-type="md" data-astro-cid-xgirumru=""> <a id="top" data-astro-cid-xgirumru=""></a> <main class="content" data-toc-shown="" data-astro-cid-ju3wuhkz="">  <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-pagefind-ignore="" data-astro-cid-wlavna2o=""> <a href="/pine-script-docs" aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o=""> <span data-astro-cid-wlavna2o="">User Manual</span>  </a>  <span class="divider" data-astro-cid-wlavna2o="">/</span> <a href="/pine-script-docs/language/execution-model" data-astro-cid-wlavna2o="">Language</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Loops</span> </div>     </div> <div id="slot-container" data-astro-cid-xgirumru=""> <h1 id="loops" class="md-heading"><a href="#loops"> <span class="fancy-wrap">Loops<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h1>
<h2 id="introduction" class="md-heading"><a href="#introduction"> <span class="fancy-wrap">Introduction<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p>Loops are structures that repeatedly execute a block of statements based on specified criteria. They allow scripts to perform repetitive tasks without requiring duplicated lines of code. Pine Script® features three distinct loop types: <a href="/pine-script-docs/language/loops/#for-loops">for</a>, <a href="/pine-script-docs/language/loops/#while-loops">while</a>, and <a href="/pine-script-docs/language/loops/#forin-loops">for…in</a>.</p>
<p>Every loop structure in Pine Script consists of two main parts: a <em>loop header</em> and a <em>loop body</em>. The loop header determines the criteria under which the loop executes. The loop body is the indented block of code (<a href="/pine-script-docs/language/loops/#scope">local block</a>) that the script executes on each loop cycle (<em>iteration</em>) as long as the header’s conditions remain valid. See the <a href="/pine-script-docs/language/loops/#common-characteristics">Common characteristics</a> section to learn more.</p>
<p>Understanding when and how to use loops is essential for making the most of the power of Pine Script. Inefficient or <a href="/pine-script-docs/language/loops/#when-loops-are-unnecessary">unnecessary</a> usage of loops can lead to suboptimal runtime performance. However, effectively using loops <a href="/pine-script-docs/language/loops/#when-loops-are-necessary">when necessary</a> enables scripts to perform a wide range of calculations that would otherwise be impractical or impossible without them.</p>
<h3 id="when-loops-are-unnecessary" class="md-heading"><a href="#when-loops-are-unnecessary">When loops are <span class="fancy-wrap">unnecessary<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Pine’s <a href="/pine-script-docs/language/execution-model/">execution model</a> and <a href="/pine-script-docs/language/execution-model/#time-series">time series</a> structure make loops <em>unnecessary</em> in many situations.</p>
<p>When a user adds a Pine script to a chart, it runs within the equivalent of a <em>large loop</em>, executing its code once on <em>every</em> historical bar and realtime tick in the available data. Scripts can access the values from the executions on previous bars with the <a href="/pine-script-docs/language/operators/#-history-referencing-operator">history-referencing operator</a>, and calculated values can <em>persist</em> across executions when assigned to variables declared with the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_var">var</a> or <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_varip">varip</a> keywords. These capabilities enable scripts to utilize bar-by-bar calculations to accomplish various tasks instead of relying on explicit loops.</p>
<p>In addition, several <a href="/pine-script-docs/language/built-ins/">built-ins</a>, such as those in the <code dir="auto">ta.*</code> namespace, are internally optimized to eliminate the need to use loops for various calculations.</p>
<p>Let’s consider a simple example demonstrating unnecessary loop usage in Pine Script. To calculate the average <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> over a specified number of bars, newcomers to Pine may write a code like the following, which uses a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop to calculate the sum of historical values over <code dir="auto">lengthInput</code> bars and divides the result by the <code dir="auto">lengthInput</code>:</p>
<p><img src="/pine-script-docs/_astro/Loops-When-loops-are-unnecessary-1.BXNHgEl8_1LIA2B.webp" alt="image" width="1316" height="508" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="3nm"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Unnecessary&nbsp;loops&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;calculation&nbsp;window.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk33">defval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;sum&nbsp;of&nbsp;`close`&nbsp;values&nbsp;over&nbsp;`lengthInput`&nbsp;bars</span><span class="mtk9">.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">closeSum</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Loop&nbsp;over&nbsp;the&nbsp;most&nbsp;recent&nbsp;`lengthInput`&nbsp;bars,&nbsp;a</span><span class="mtk9">dding&nbsp;each&nbsp;bar's&nbsp;`close`&nbsp;to&nbsp;the&nbsp;`closeSum`.</span></span><br><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">closeSum</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk33">i</span><span class="mtk13">]</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;average&nbsp;`close`&nbsp;value&nbsp;over&nbsp;`lengthInput`&nbsp;bars</span><span class="mtk9">.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">avgClose</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">closeSum</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`avgClose`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">avgClose</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Average&nbsp;close"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br></code></div>
<p>Using a <a href="/pine-script-docs/language/loops/#for-loops">for</a> loop is an <strong>unnecessary</strong>, inefficient way to accomplish tasks like this in Pine. There are several ways to utilize the <a href="/pine-script-docs/language/execution-model/">execution model</a> and the available built-ins to eliminate this loop. Below, we replaced these calculations with a simple call to the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.sma">ta.sma()</a> function. This code is shorter, and it achieves the same result much more efficiently:</p>
<p><img src="/pine-script-docs/_astro/Loops-When-loops-are-unnecessary-2.BqNbiiYY_ZoMQmT.webp" alt="image" width="1314" height="506" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="2ze"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Unnecessary&nbsp;loops&nbsp;corrected&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;calculation&nbsp;window.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk33">defval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;average&nbsp;`close`&nbsp;value&nbsp;over&nbsp;`lengthInput`&nbsp;bars</span><span class="mtk9">.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">avgClose</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`avgClose`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">avgClose</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Average&nbsp;close"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>Users can see the substantial difference in efficiency between these two example scripts by analyzing their performance with the <a href="/pine-script-docs/writing/profiling-and-optimization/#pine-profiler">Pine Profiler</a>.</li>
</ul>
<h3 id="when-loops-are-necessary" class="md-heading"><a href="#when-loops-are-necessary">When loops are <span class="fancy-wrap">necessary<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Although Pine’s <a href="/pine-script-docs/language/execution-model/">execution model</a>, <a href="/pine-script-docs/language/execution-model/#time-series">time series</a>, and available <a href="/pine-script-docs/language/built-ins/">built-ins</a> often eliminate the need for loops in many cases, not all iterative tasks have loop-free alternatives. Loops <em>are necessary</em> for several types of tasks, including:</p>
<ul>
<li>Iterating through or manipulating <a href="/pine-script-docs/language/type-system/#collections">collections</a> (<a href="/pine-script-docs/language/arrays/">arrays</a>, <a href="/pine-script-docs/language/matrices/">matrices</a>, and <a href="/pine-script-docs/language/maps/">maps</a>)</li>
<li>Performing calculations that one <strong>cannot</strong> accomplish with loop-free expressions or the available built-ins</li>
<li>Looking back through history to analyze past bars with a reference value only available on the <em>current bar</em></li>
</ul>
<p>For example, a loop is <em>necessary</em> to identify which past bars’ <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a> values are above the current bar’s <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a> because the current value is <strong>not</strong> obtainable during a script’s executions on previous bars. The script can only access the current bar’s value while it executes on that bar, and it must <em>look back</em> through the historical series during that execution to compare the previous values.</p>
<p>The script below uses a <a href="/pine-script-docs/language/loops/#for-loops">for</a> loop to compare the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a> values of <code dir="auto">lengthInput</code> previous bars with the last historical bar’s <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a>. Within the loop, it calls <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_label.new">label.new()</a> to draw a circular <a href="https://www.tradingview.com/pine-script-reference/v6/#type_label">label</a> above each past bar that has a <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a> value exceeding that of the last historical bar:</p>
<p><img src="/pine-script-docs/_astro/Loops-When-loops-are-necessary.Bpzukabm_Z288WAS.webp" alt="image" width="1336" height="528" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="45w"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Necessary&nbsp;loop&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_labels_count</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;previous&nbsp;`high`&nbsp;values&nbsp;to&nbsp;compare&nbsp;t</span><span class="mtk9">o&nbsp;the&nbsp;last&nbsp;historical&nbsp;bar's&nbsp;`high`.&nbsp;</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islastconfirmedhistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;horizontal&nbsp;line&nbsp;segment&nbsp;at&nbsp;the&nbsp;last&nbsp;hist</span><span class="mtk9">orical&nbsp;bar's&nbsp;`high`&nbsp;to&nbsp;visualize&nbsp;the&nbsp;level.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.gray</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">line.style_dashed</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Create&nbsp;a&nbsp;`for`&nbsp;loop&nbsp;that&nbsp;counts&nbsp;from&nbsp;1&nbsp;to&nbsp;`leng</span><span class="mtk9">thInput`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;circular&nbsp;`label`&nbsp;above&nbsp;the&nbsp;bar&nbsp;from&nbsp;`i`&nbsp;</span><span class="mtk9">bars&nbsp;ago&nbsp;if&nbsp;that&nbsp;bar's&nbsp;`high`&nbsp;is&nbsp;above&nbsp;the&nbsp;current</span><span class="mtk9">&nbsp;`high`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk13">[</span><span class="mtk33">i</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">yloc</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">yloc.abovebar</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_circle</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.tiny</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;last&nbsp;historical&nbsp;bar.</span></span><br><span><span class="mtk16">barcolor</span><span class="mtk13">(</span><span class="mtk11">barstate.islastconfirmedhistory</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Last&nbsp;historical&nbsp;bar&nbsp;highlight"</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>Each <em>iteration</em> of the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop retrieves a previous bar’s <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a> with the history-referencing operator <a href="https://www.tradingview.com/pine-script-reference/v6/#op_%5B%5D">[]</a>, using the loop’s <em>counter</em> (<code dir="auto">i</code>) as the historical offset. The <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_label.new">label.new()</a> call also uses the counter to determine each label’s x-coordinate.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_indicator">indicator</a> declaration statement includes <code dir="auto">max_labels_count = 500</code>, meaning the script can show up to 500 <a href="/pine-script-docs/visuals/text-and-shapes/#labels">labels</a> on the chart.</li>
<li>The script calls <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_barcolor">barcolor()</a> to highlight the last historical chart bar, and it draws a horizontal <a href="https://www.tradingview.com/pine-script-reference/v6/#type_line">line</a> at that bar’s <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a> for visual reference.</li>
</ul>
<h2 id="common-characteristics" class="md-heading"><a href="#common-characteristics">Common <span class="fancy-wrap">characteristics<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p>The <a href="/pine-script-docs/language/loops/#for-loops">for</a>, <a href="/pine-script-docs/language/loops/#while-loops">while</a>, and <a href="/pine-script-docs/language/loops/#forin-loops">for…in</a> loop statements all have similarities in their structure, syntax, and general behavior. Before we explore each specific loop type, let’s familiarize ourselves with these characteristics.</p>
<h3 id="structure-and-syntax" class="md-heading"><a href="#structure-and-syntax">Structure and <span class="fancy-wrap">syntax<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>In any loop statement, programmers define the criteria under which a script remains in a loop and performs <em>iterations</em>, where an iteration refers to <em>one execution</em> of the code within the loop’s <a href="/pine-script-docs/language/loops/#scope">local block</a> (<em>body</em>). These criteria are part of the <em>loop header</em>. A script evaluates the header’s criteria <em>before</em> each iteration, only allowing new iterations to occur while they remain valid. When the header’s criteria are no longer valid, the script <em>exits</em> the loop and skips over its body.</p>
<p>The specific header syntax varies with each loop statement (<a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_while">while</a>, or <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a>) because each uses <em>distinct</em> criteria to control its iterations. Effective use of loops entails choosing the structure with control criteria best suited for a script’s required tasks. See the <a href="/pine-script-docs/language/loops/#for-loops">`for` loops</a>, <a href="/pine-script-docs/language/loops/#while-loops">`while` loops</a>, and <a href="/pine-script-docs/language/loops/#forin-loops">`for…in` loops</a> sections below for more information on each loop statement and its control criteria.</p>
<p>All loop statements in Pine Script follow the same general syntax:</p>
<div class="expressive-code not-content"><link rel="stylesheet" href="/pine-script-docs/_astro/ec.dtidy.css"><script type="module" src="/pine-script-docs/_astro/ec.qopfj.js" data-astro-exec=""></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[variables = | :=] loop_header</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">statements | continue | break</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">return_expression</span></div></div></code></pre></figure></div>
<p>Where:</p>
<ul>
<li><code dir="auto">loop_header</code> represents the loop structure’s header statement, which defines the criteria that control the loop’s iterations.</li>
<li><code dir="auto">statements</code> represents the code statements and expressions within the loop’s body, i.e., the <em>indented</em> block of code beneath the loop header. All code within the body belongs to the loop’s <a href="/pine-script-docs/language/loops/#scope">local scope</a>.</li>
<li><code dir="auto">continue</code> and <code dir="auto">break</code> are loop-specific <em>keywords</em> that control the flow of a loop’s iterations. The <code dir="auto">continue</code> keyword instructs the script to <em>skip</em> the remainder of the current loop iteration and <em>continue</em> to the next iteration. The <code dir="auto">break</code> keyword prompts the script to <em>stop</em> the current iteration and <em>exit</em> the loop entirely. See <a href="/pine-script-docs/language/loops/#keywords-and-return-expressions">this section</a> below for more information.</li>
<li><code dir="auto">return_expression</code> refers to the <em>last</em> code line or block within the loop’s body. The loop returns the results from this code after the final iteration. If the loop skips parts of some iterations or stops prematurely due to a <code dir="auto">continue</code> or <code dir="auto">break</code> statement, the returned values or references are those of the latest iteration that evaluated this code. To use the loop’s returned results, assign them to a variable or <a href="/pine-script-docs/language/type-system/#tuples">tuple</a>.</li>
<li><code dir="auto">variables</code> represents an optional variable or tuple to hold the values or references from the last evaluation of the <code dir="auto">return_expression</code>. The script can assign the loop’s returned results to variables only if the results are not <a href="/pine-script-docs/language/type-system/#void">void</a>. If the loop’s conditions prevent iteration, or if no iterations evaluate the <code dir="auto">return_expression</code>, the variables’ assigned values and references are <a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a>.</li>
</ul>
<aside aria-label="Note" class="tv-informer not-content" style="--informer-header-color:#6A6D78;--informer-back-color-light:#F0F3FA;--informer-back-color-dark:#2A2E39"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM8 6a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm1 2c.49 0 1 .59 1 1v3.01c0 .42-.51.99-1 .99s-1-.57-1-.99V9c0-.41.51-1 1-1Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Note</span></p><p>If a script initializes a variable with a loop’s result using the above syntax, and that <a href="/pine-script-docs/language/variable-declarations/">variable declaration</a> includes the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_var">var</a> or <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_varip">varip</a> keyword, the loop ends <em>immediately</em> after its <strong>first</strong> iteration, even if the header’s criteria allow more iterations.</p><br><p>To assign a loop’s result to a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_var">var</a> or <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_varip">varip</a> variable while enabling the loop to perform all required iterations, programmers can do either of the following:</p><ul>
<li>Declare the variable before the loop, then use the <a href="/pine-script-docs/language/operators/#-reassignment-operator">reassignment operator</a> (<code dir="auto">:=</code>) in the above syntax to <em>update</em> the variable.</li>
<li>Move the loop into a <a href="/pine-script-docs/language/user-defined-functions/">user-defined function</a>, then initialize the variable with the result of a call to that function.</li>
</ul><p></p></div></aside>
<h3 id="scope" class="md-heading"><a href="#scope"> <span class="fancy-wrap">Scope<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>All code lines that a script executes within a loop must have an indentation of <em>four spaces</em> or a <em>tab</em> relative to the loop’s header. The indented lines following the header define the loop’s <em>body</em>. This code represents a <em>local block</em>, meaning that all the definitions within the body are accessible only during the loop’s execution. In other words, the code within the loop’s body is part of its <em>local scope</em>.</p>
<p>Scripts can modify and <a href="/pine-script-docs/language/variable-declarations/#variable-reassignment">reassign</a> most variables from <em>outer</em> scopes inside a loop. However, any variables declared within the loop’s body strictly belong to that loop’s local scope. A script <strong>cannot</strong> access a loop’s declared variables <em>outside</em> its local block.</p>
<p>Note that:</p>
<ul>
<li>Variables declared within a loop’s <em>header</em> are also part of the local scope. For instance, a script cannot use the <em>counter variable</em> in a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop anywhere but within the loop’s local block.</li>
</ul>
<p>The body of any Pine loop statement can include <a href="/pine-script-docs/language/conditional-structures/">conditional structures</a> and <em>nested</em> loop statements. When a loop includes nested structures, each structure within the body maintains a <em>distinct</em> local scope. For example, variables declared within an <em>outer</em> loop’s scope are accessible to an <em>inner</em> loop. However, any variables declared within the inner loop’s scope are <strong>not</strong> accessible to the outer loop.</p>
<p>The simple example below demonstrates how a loop’s local scope works. This script calls <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_label.new">label.new()</a> within a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop on the last historical bar to draw <a href="/pine-script-docs/visuals/text-and-shapes/#labels">labels</a> above <code dir="auto">lengthInput</code> past bars. The color of each label depends on the <code dir="auto">labelColor</code> variable declared <em>within</em> the loop’s local block, and each label’s location depends on the loop counter (<code dir="auto">i</code>):</p>
<p><img src="/pine-script-docs/_astro/Loops-Common-characteristics-Scope.C3aeQeOf_uwxmQ.webp" alt="image" width="996" height="448" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5io"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Loop&nbsp;scope&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;calculation.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Lookback&nbsp;length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islastconfirmedhistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Has&nbsp;a&nbsp;value&nbsp;of&nbsp;`color.blue`&nbsp;if&nbsp;`close[i]`&nbsp;is&nbsp;abov</span><span class="mtk9">e&nbsp;the&nbsp;current&nbsp;`close`,&nbsp;`color.orange`&nbsp;otherwise.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;variable&nbsp;is&nbsp;LOCAL&nbsp;to&nbsp;the&nbsp;`for`&nbsp;lo</span><span class="mtk9">op's&nbsp;scope.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk33">i</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Display&nbsp;a&nbsp;colored&nbsp;`label`&nbsp;on&nbsp;the&nbsp;historical&nbsp;`hi</span><span class="mtk9">gh`&nbsp;from&nbsp;`i`&nbsp;bars&nbsp;back,&nbsp;using&nbsp;`labelColor`&nbsp;to&nbsp;set&nbsp;</span><span class="mtk9">the&nbsp;color.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk13">[</span><span class="mtk33">i</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.normal</span><span class="mtk13">)</span></span><br></code></div>
<p>In the above code, the <code dir="auto">i</code> and <code dir="auto">labelColor</code> variables are only accessible to the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop’s local scope. They are <strong>not</strong> usable within any outer scopes. Here, we added a <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_label.new">label.new()</a> call <em>after</em> the loop with <code dir="auto">bar_index - i</code> as the <code dir="auto">x</code> argument and <code dir="auto">labelColor</code> as the <code dir="auto">color</code> argument. This code causes a <em>compilation error</em> because neither <code dir="auto">i</code> nor <code dir="auto">labelColor</code> are valid variables in the outer scope:</p>
<div class="pine-colorizer not-content colorized" data-id="2le"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Loop&nbsp;scope&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;calculation.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Lookback&nbsp;length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islastconfirmedhistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Has&nbsp;a&nbsp;value&nbsp;of&nbsp;`color.blue`&nbsp;if&nbsp;`close[i]`&nbsp;is&nbsp;abov</span><span class="mtk9">e&nbsp;the&nbsp;current&nbsp;`close`,&nbsp;`color.orange`&nbsp;otherwise.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;variable&nbsp;is&nbsp;LOCAL&nbsp;to&nbsp;the&nbsp;`for`&nbsp;lo</span><span class="mtk9">op's&nbsp;scope.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk33">i</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Display&nbsp;a&nbsp;colored&nbsp;`label`&nbsp;on&nbsp;the&nbsp;historical&nbsp;`hi</span><span class="mtk9">gh`&nbsp;from&nbsp;`i`&nbsp;bars&nbsp;back,&nbsp;using&nbsp;`labelColor`&nbsp;to&nbsp;set&nbsp;</span><span class="mtk9">the&nbsp;color.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk13">[</span><span class="mtk33">i</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.normal</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Call&nbsp;`label.new()`&nbsp;to&nbsp;using&nbsp;the&nbsp;`i`&nbsp;and&nbsp;`labelC</span><span class="mtk9">olor`&nbsp;variables&nbsp;outside&nbsp;the&nbsp;loop's&nbsp;local&nbsp;scope.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;This&nbsp;code&nbsp;causes&nbsp;a&nbsp;compilation&nbsp;error&nbsp;because&nbsp;th</span><span class="mtk9">ese&nbsp;variables&nbsp;are&nbsp;not&nbsp;accessible&nbsp;in&nbsp;this&nbsp;location.</span><span class="mtk9">&nbsp;&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Scope&nbsp;test"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_up</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br></code></div>
<h3 id="keywords-and-return-expressions" class="md-heading"><a href="#keywords-and-return-expressions">Keywords and return <span class="fancy-wrap">expressions<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Every loop in Pine Script implicitly <em>returns</em> values, references, or <a href="/pine-script-docs/language/type-system/#void">void</a>. A loop’s returned results come from the <em>latest</em> execution of the <em>last</em> expression or nested structure within its body as of the final iteration. The results are usable only if they are not of the <a href="/pine-script-docs/language/type-system/#void">void</a> type. Loops return <a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a> results for values or references when no iterations occur. Scripts can add a variable or tuple assignment to a loop statement to hold the returned results for use in additional calculations outside the loop’s <a href="/pine-script-docs/language/loops/#scope">local scope</a>.</p>
<p>The values or references that a loop returns usually come from evaluating the last written expression or nested code block on the <em>final</em> iteration. However, a loop’s body can include <code dir="auto">continue</code> and <code dir="auto">break</code> keywords to control the flow of iterations beyond the criteria the loop header specifies, which can also affect the returned results. Programmers often include these keywords within <a href="/pine-script-docs/language/conditional-structures/">conditional structures</a> to control how iterations behave when certain conditions occur.</p>
<p>The <code dir="auto">continue</code> keyword instructs a script to <em>skip</em> the remaining statements and expressions in the current loop iteration, re-evaluate the loop header’s criteria, and proceed to the <em>next</em> iteration. The script <em>exits</em> the loop if the header’s criteria do not allow another iteration.</p>
<p>The <code dir="auto">break</code> keyword instructs a script to <em>stop</em> the loop entirely and immediately <em>exit</em> at that point without allowing any subsequent iterations. After breaking the loop, the script skips any remaining code within the loop’s body and <em>does not</em> re-evaluate the header’s criteria.</p>
<p>If a loop skips parts of iterations or stops prematurely due to a <code dir="auto">continue</code> or <code dir="auto">break</code> statement, it returns the values and references from the <em>last iteration</em> where the script <em>evaluated</em> the return expression. If the script did not evaluate the return expression across <em>any</em> of the loop’s iterations, the loop returns <a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a> results for all non-void types.</p>
<p>The example below selectively displays numbers from an <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a> within a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_label">label</a> on the last historical bar. It uses a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop to iterate through the array’s elements and build a “string” to use as the displayed text. The loop’s body contains an <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_if">if</a> statement that controls the flow of specific iterations. If the <code dir="auto">number</code> in the current iteration is 8, the script immediately <em>exits</em> the loop using the <code dir="auto">break</code> keyword. Otherwise, if the <code dir="auto">number</code> is even, it <em>skips</em> the rest of the current iteration and moves to the next one using the <code dir="auto">continue</code> keyword.</p>
<p>If neither of the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_if">if</a> statement’s conditions occur, the script evaluates the <em>last expression</em> within the loop’s body (i.e., the return expression), which converts the current <code dir="auto">number</code> to a “string” and concatenates the result with the <code dir="auto">tempString</code> value. The loop returns the <em>last evaluated result</em> from this expression after termination. The script assigns the returned value to the <code dir="auto">finalLabelText</code> variable and uses that variable as the <code dir="auto">text</code> argument in the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_label.new">label.new()</a> call:</p>
<p><img src="/pine-script-docs/_astro/Loops-Common-characteristics-Keywords-and-return-expressions.DPxrsv1p_Zh1F86.webp" alt="image" width="750" height="282" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="4cv"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Loop&nbsp;keywords&nbsp;and&nbsp;variable&nbsp;assignment&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;`array`&nbsp;of&nbsp;arbitrary&nbsp;"int"&nbsp;values&nbsp;to&nbsp;selective</span><span class="mtk9">ly&nbsp;convert&nbsp;to&nbsp;"string"&nbsp;and&nbsp;display&nbsp;in&nbsp;a&nbsp;`label`.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">int</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">randomArray</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">-3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">14</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">7</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">9</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">8</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">15</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">12</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Label&nbsp;creation&nbsp;logic.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islastconfirmedhistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;"string"&nbsp;containing&nbsp;representations&nbsp;of&nbsp;selected</span><span class="mtk9">&nbsp;values&nbsp;from&nbsp;the&nbsp;`randomArray`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">tempString</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;final&nbsp;text&nbsp;to&nbsp;display&nbsp;in&nbsp;the&nbsp;`label`.&nbsp;The&nbsp;`fo</span><span class="mtk9">r..in`&nbsp;loop&nbsp;returns&nbsp;the&nbsp;result&nbsp;after&nbsp;it&nbsp;terminates</span><span class="mtk9">.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">finalLabelText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">number</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">randomArray</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Stop&nbsp;the&nbsp;current&nbsp;iteration&nbsp;and&nbsp;exit&nbsp;the&nbsp;loop&nbsp;if</span><span class="mtk9">&nbsp;the&nbsp;`number`&nbsp;from&nbsp;the&nbsp;`randomArray`&nbsp;is&nbsp;8.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">number</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">8</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">break</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Skip&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;current&nbsp;iteration&nbsp;and&nbsp;proc</span><span class="mtk9">eed&nbsp;to&nbsp;the&nbsp;next&nbsp;iteration&nbsp;if&nbsp;the&nbsp;`number`&nbsp;is&nbsp;even.</span><span class="mtk9">&nbsp;&nbsp;&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">else</span><span class="mtk1">&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">number</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">continue</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Convert&nbsp;the&nbsp;`number`&nbsp;to&nbsp;a&nbsp;"string",&nbsp;append&nbsp;",&nbsp;"</span><span class="mtk9">,&nbsp;and&nbsp;concatenate&nbsp;the&nbsp;result&nbsp;with&nbsp;the&nbsp;current&nbsp;`tem</span><span class="mtk9">pString`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;This&nbsp;code&nbsp;represents&nbsp;the&nbsp;loop's&nbsp;return&nbsp;expressi</span><span class="mtk9">on.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">tempString</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">number</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">",&nbsp;"</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;`finalLabelText`&nbsp;withi</span><span class="mtk9">n&nbsp;a&nbsp;`label`&nbsp;on&nbsp;the&nbsp;current&nbsp;bar.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">finalLabelText</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v6/#type_label">label</a> displays only <em>odd</em> numbers from the <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a> because the script does not reassign the <code dir="auto">tempString</code> when the loop iteration’s <code dir="auto">number</code> is even. However, it does not include the <em>last</em> odd number from the array (15) because the loop stops when <code dir="auto">number == 8</code>, preventing iteration over the remaining <code dir="auto">randomArray</code> elements.</li>
<li>When the script exits the loop due to the <code dir="auto">break</code> keyword, the loop’s return value becomes the last evaluated result from the <code dir="auto">tempString</code> reassignment expression. In this case, the last time that code executes is on the iteration where <code dir="auto">number == 9</code>.</li>
</ul>
<h2 id="for-loops" class="md-heading"><a href="#for-loops"><span>​<code dir="auto">for</code>​ loops</span><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></a></h2>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop statement creates a <em>count-controlled</em> loop, which uses a <em>counter</em> variable to manage the iterative executions of its local code block. The counter starts at a predefined initial value, and the loop increments or decrements the counter by a fixed amount after each iteration. The loop stops its iterations after the counter reaches a specified final value.</p>
<p>Pine Script uses the following syntax to define a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[variables = | :=] for counter = from_num to to_num [by step_num]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">statements | continue | break</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">return_expression</span></div></div></code></pre></figure></div>
<p>Where the following parts define the <em>loop header</em>:</p>
<ul>
<li><code dir="auto">counter</code> represents the counter variable, which can be any valid identifier. The loop increments or decrements this variable’s value from the initial value (<code dir="auto">from_num</code>) to the final value (<code dir="auto">to_num</code>) by a fixed amount (<code dir="auto">step_num</code>) after each iteration. The last possible iteration occurs when the variable’s value reaches the <code dir="auto">to_num</code> value.</li>
<li><code dir="auto">from_num</code> is the <code dir="auto">counter</code> variable’s initial value on the first iteration.</li>
<li><code dir="auto">to_num</code> is the <em>final</em> <code dir="auto">counter</code> value for which the loop’s header allows a new iteration. The loop adjusts the <code dir="auto">counter</code> value by the <code dir="auto">step_num</code> amount until it reaches or passes this value. If the script modifies the <code dir="auto">to_num</code> during a loop iteration, the loop header uses the new value to control the allowed subsequent iterations.</li>
<li><code dir="auto">step_num</code> is a positive value representing the amount by which the <code dir="auto">counter</code> value increases or decreases until it reaches or passes the <code dir="auto">to_num</code> value. If the <code dir="auto">from_num</code> value is greater than the <em>initial</em> <code dir="auto">to_num</code> value, the loop <em>subtracts</em> this amount from the <code dir="auto">counter</code> value after each iteration. Otherwise, the loop <em>adds</em> this amount after each iteration. The default is 1.</li>
</ul>
<p>Refer to the <a href="/pine-script-docs/language/loops/#common-characteristics">Common characteristics</a> section above for detailed information about the <code dir="auto">variables</code>, <code dir="auto">statements</code>, <code dir="auto">continue</code>, <code dir="auto">break</code>, and <code dir="auto">return_expression</code> parts of the loop’s syntax.</p>
<p>This simple script demonstrates a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop that draws several <a href="/pine-script-docs/visuals/text-and-shapes/#labels">labels</a> at future bar indices during its execution on the last historical chart bar. The loop’s counter starts at 0, then increases by 1 until it reaches a value of 10, at which point the final iteration occurs:</p>
<p><img src="/pine-script-docs/_astro/Loops-For-loops-1.JEmTwodf_Zk2Mts.webp" alt="image" width="868" height="322" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="302"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Simple&nbsp;`for`&nbsp;loop&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islastconfirmedhistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Define&nbsp;a&nbsp;`for`&nbsp;loop&nbsp;that&nbsp;iterates&nbsp;from&nbsp;`i&nbsp;==&nbsp;0`</span><span class="mtk9">&nbsp;to&nbsp;`i&nbsp;==&nbsp;10`&nbsp;by&nbsp;1&nbsp;(11&nbsp;total&nbsp;iterations).</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;new&nbsp;label&nbsp;`i`&nbsp;bars&nbsp;ahead&nbsp;of&nbsp;the&nbsp;current&nbsp;</span><span class="mtk9">bar.&nbsp;&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">i</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.large</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">i</code> variable represents the loop’s <em>counter</em>. This variable is local to the loop’s <a href="/pine-script-docs/language/loops/#scope">scope</a>, meaning no <em>outer scopes</em> can access it. The code uses the variable within the loop’s body to determine the location and text of each <a href="https://www.tradingview.com/pine-script-reference/v6/#type_label">label</a> drawing.</li>
<li>Programmers often use <code dir="auto">i</code>, <code dir="auto">j</code>, and <code dir="auto">k</code> as loop counter identifiers. However, <em>any</em> valid variable name is allowed. For example, this code behaves the same if we name the counter <code dir="auto">offset</code> instead of <code dir="auto">i</code>.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop structure <em>automatically</em> manages the counter variable. We do not need to define code in the loop’s body to increment its value.</li>
</ul>
<p>The direction in which a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop adjusts its counter depends on the <em>initial</em> <code dir="auto">from_num</code> and <code dir="auto">to_num</code> values in the loop’s header, and the direction does not change across iterations. The loop counts <em>upward</em> after each iteration when the <code dir="auto">to_num</code> value is <em>above</em> the <code dir="auto">from_num</code> value, as shown in the previous example. If the <code dir="auto">to_num</code> value is <em>below</em> the <code dir="auto">from_num</code> value, the loop counts <em>downward</em> instead.</p>
<p>The script below calculates and plots the <a href="https://www.tradingview.com/support/solutions/43000592293-volume-weighted-moving-average-vwma/">volume-weighted moving average (VWMA)</a> of <a href="https://www.tradingview.com/pine-script-reference/v6/#var_open">open</a> prices across a specified number of bars. Then, it uses a downward-counting <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop to compare the last historical bar’s value to the values from previous bars, starting with the oldest bar in the specified lookback window. On each loop iteration, the script retrieves a previous bar’s <code dir="auto">vwmaOpen</code> value, calculates the difference from the current bar’s value, and displays the result in a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_label">label</a> at the past bar’s opening price:</p>
<p><img src="/pine-script-docs/_astro/Loops-For-loops-2.WC3Reqlz_Z1587F3.webp" alt="image" width="1336" height="558" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="2xh"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"`for`&nbsp;loop&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"VWMA&nbsp;differences"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_labels_count</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Display&nbsp;color&nbsp;for&nbsp;indicator&nbsp;visuals.</span></span><br><span><span class="mtk18 mtkb">const</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">DISPLAY_COLOR</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.rgb</span><span class="mtk13">(</span><span class="mtk12">17</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">127</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">218</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;`vwmaOpen`&nbsp;calculation.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">maLengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"VWMA&nbsp;length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;past&nbsp;bars&nbsp;to&nbsp;look&nbsp;back&nbsp;through&nbsp;and&nbsp;</span><span class="mtk9">compare&nbsp;to&nbsp;the&nbsp;current&nbsp;bar.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lookbackInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">15</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Lookback&nbsp;length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;volume-weighted&nbsp;moving&nbsp;average&nbsp;of&nbsp;`open`&nbsp;valu</span><span class="mtk9">es&nbsp;over&nbsp;`maLengthInput`&nbsp;bars.&nbsp;</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">vwmaOpen</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.vwma</span><span class="mtk13">(</span><span class="mtk11">open</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">maLengthInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islastconfirmedhistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Define&nbsp;a&nbsp;`for`&nbsp;loop&nbsp;that&nbsp;counts&nbsp;*downward*&nbsp;from</span><span class="mtk9">&nbsp;`i&nbsp;==&nbsp;lookbackInput`&nbsp;to&nbsp;`i&nbsp;==&nbsp;1`.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">lookbackInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;difference&nbsp;between&nbsp;the&nbsp;`vwmaOpen`&nbsp;from&nbsp;`i`&nbsp;ba</span><span class="mtk9">rs&nbsp;ago&nbsp;and&nbsp;the&nbsp;current&nbsp;`vwmaOpen`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">vwmaDifference</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">vwmaOpen</span><span class="mtk13">[</span><span class="mtk33">i</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">vwmaOpen</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;"string"&nbsp;representation&nbsp;of&nbsp;`vwmaDifference`,&nbsp;ro</span><span class="mtk9">unded&nbsp;to&nbsp;two&nbsp;fractional&nbsp;digits.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">displayText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">vwmaDifference</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk29">"+"</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk29">""</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">vwmaDifference</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"0.00"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;label&nbsp;showing&nbsp;the&nbsp;`displayText`&nbsp;at&nbsp;the&nbsp;`</span><span class="mtk9">open`&nbsp;of&nbsp;the&nbsp;bar&nbsp;from&nbsp;`i`&nbsp;bars&nbsp;back.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk13">[</span><span class="mtk33">i</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">displayText</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">DISPLAY_COLOR</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_lower_right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.normal</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`vwmaOpen`&nbsp;value.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">vwmaOpen</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"VWMA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">DISPLAY_COLOR</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>The script uses the loop’s counter (<code dir="auto">i</code>) to within the <a href="/pine-script-docs/language/operators/#-history-referencing-operator">history-referencing operator</a> to retrieve past values of the <code dir="auto">vwmaOpen</code> series. It also uses the counter to determine the location of each <a href="https://www.tradingview.com/pine-script-reference/v6/#type_label">label</a> drawing.</li>
<li>The loop in this example <em>decreases</em> the counter by one on each iteration because the final counter value in the loop’s header (<code dir="auto">1</code>) is less than the starting value (<code dir="auto">lookbackInput</code>).</li>
</ul>
<p>Programmers can use <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loops to iterate through <a href="/pine-script-docs/language/type-system/#collections">collections</a>, such as <a href="/pine-script-docs/language/arrays">arrays</a> and <a href="/pine-script-docs/language/matrices">matrices</a>. The loop’s counter can serve as an <em>index</em> for retrieving or modifying a collection’s contents. For example, this code block uses <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_array.get">array.get()</a> inside a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop to successively retrieve elements from an <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a>:</p>
<div class="pine-colorizer not-content colorized" data-id="ud"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lastIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.size</span><span class="mtk13">(</span><span class="mtk33">myArray</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">lastIndex</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">element</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.get</span><span class="mtk13">(</span><span class="mtk33">i</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>Array <em>indexing</em> starts from 0, but the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_array.size">array.size()</a> function <em>counts</em> array elements starting from 1. Therefore, we must subtract 1 from the array’s size to get the maximum index value. This way, the loop counter avoids representing an <a href="/pine-script-docs/language/arrays/#index-xx-is-out-of-bounds-array-size-is-yy">out-of-bounds</a> index on the last loop iteration.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop statement is often the <em>preferred</em> way to loop through <a href="/pine-script-docs/language/type-system/#collections">collections</a>. However, programmers may prefer a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop for some tasks, such as looping through stepped index values, iterating over a collection’s contents in reverse or a nonlinear order, and more. See the <a href="/pine-script-docs/language/loops/#looping-through-arrays">Looping through arrays</a> and <a href="/pine-script-docs/language/loops/#looping-through-matrices">Looping through matrices</a> sections to learn more about the best practices for looping through these collection types.</li>
</ul>
<p>The script below executes <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.rsi">ta.rsi()</a> and <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.mom">ta.mom()</a> calls to calculate the RSI and momentum of <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> prices over three different lengths (10, 20, and 50), then displays the results using a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_table">table</a> on the last chart bar. It stores “string” values for the header title within <a href="/pine-script-docs/language/arrays/">arrays</a> and the “float” values of the calculated indicators within a 2x3 <a href="https://www.tradingview.com/pine-script-reference/v6/#type_matrix">matrix</a>. The script uses a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop to access the elements in the arrays and initialize the <code dir="auto">displayTable</code> header cells. It then uses <em>nested</em> <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loops to iterate over the <em>row</em> and <em>column</em> indices in the <code dir="auto">taMatrix</code>, access elements, convert their values to strings, and populate the remaining table cells:</p>
<p><img src="/pine-script-docs/_astro/Loops-For-loops-3.LT8BH3HO_Z2ihhrX.webp" alt="image" width="932" height="390" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="6u2"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"`for`&nbsp;loop&nbsp;with&nbsp;collections&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Table&nbsp;of&nbsp;TA&nbsp;Indexes"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;RSI&nbsp;and&nbsp;momentum&nbsp;of&nbsp;`close`&nbsp;value</span><span class="mtk9">s&nbsp;with&nbsp;constant&nbsp;lengths&nbsp;of&nbsp;10,&nbsp;20,&nbsp;and&nbsp;50.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi10</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.rsi</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi20</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.rsi</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi50</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.rsi</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">mom10</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.mom</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">mom20</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.mom</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk13">)</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">mom50</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.mom</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islast</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;`table`&nbsp;that&nbsp;displays&nbsp;indicator&nbsp;values&nbsp;in&nbsp;the&nbsp;t</span><span class="mtk9">op-right&nbsp;corner&nbsp;of&nbsp;the&nbsp;chart.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">table</span><span class="mtk1">&nbsp;</span><span class="mtk33">displayTable</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">table.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">position.top_right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">columns</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rows</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">border_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.black</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">border_width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;array&nbsp;containing&nbsp;the&nbsp;"string"&nbsp;titles&nbsp;to&nbsp;displa</span><span class="mtk9">y&nbsp;within&nbsp;the&nbsp;side&nbsp;header&nbsp;of&nbsp;each&nbsp;table&nbsp;row.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">string</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">sideHeaderTitles</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk29">"TA&nbsp;Index"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"RSI"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Momentum"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;array&nbsp;containing&nbsp;the&nbsp;"string"&nbsp;titles&nbsp;to&nbsp;repres</span><span class="mtk9">enting&nbsp;the&nbsp;length&nbsp;of&nbsp;each&nbsp;displayed&nbsp;indicator.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">string</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">topHeaderTitles</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk29">"10"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"20"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"50"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;matrix&nbsp;containing&nbsp;the&nbsp;values&nbsp;to&nbsp;display&nbsp;within&nbsp;</span><span class="mtk9">the&nbsp;table.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">taMatrix</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Populate&nbsp;the&nbsp;`taMatrix`&nbsp;with&nbsp;indicator&nbsp;values.&nbsp;</span><span class="mtk9">The&nbsp;first&nbsp;row&nbsp;contains&nbsp;RSI&nbsp;data&nbsp;and&nbsp;the&nbsp;second&nbsp;con</span><span class="mtk9">tains&nbsp;momentum.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">taMatrix</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk33">rsi10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi50</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">mom10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">mom20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">mom50</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">taMatrix</span><span class="mtk1">.</span><span class="mtk15">reshape</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Initialize&nbsp;top&nbsp;header&nbsp;cells.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">displayTable</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Bars&nbsp;Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">displayTable</span><span class="mtk1">.</span><span class="mtk15">merge_cells</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Initialize&nbsp;additional&nbsp;header&nbsp;cells&nbsp;within&nbsp;a&nbsp;`fo</span><span class="mtk9">r`&nbsp;loop.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">displayTable</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">sideHeaderTitles</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk33">i</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">displayTable</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">topHeaderTitles</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk33">i</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Use&nbsp;nested&nbsp;`for`&nbsp;loops&nbsp;to&nbsp;iterate&nbsp;through&nbsp;the&nbsp;r</span><span class="mtk9">ow&nbsp;and&nbsp;column&nbsp;indices&nbsp;of&nbsp;the&nbsp;`taMatrix`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">taMatrix</span><span class="mtk1">.</span><span class="mtk15">rows</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">j</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">taMatrix</span><span class="mtk1">.</span><span class="mtk15">columns</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;value&nbsp;stored&nbsp;in&nbsp;the&nbsp;`taMatrix`&nbsp;at&nbsp;the&nbsp;`i`&nbsp;row</span><span class="mtk9">&nbsp;and&nbsp;`j`&nbsp;column.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">elementValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">taMatrix</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk33">i</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">j</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Initialize&nbsp;a&nbsp;cell&nbsp;in&nbsp;the&nbsp;`displayTable`&nbsp;at&nbsp;the&nbsp;</span><span class="mtk9">`i&nbsp;+&nbsp;2`&nbsp;row&nbsp;and&nbsp;`j&nbsp;+&nbsp;1`&nbsp;column&nbsp;showing&nbsp;a&nbsp;"string"&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;representation&nbsp;of&nbsp;the&nbsp;`elementValue`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">displayTable</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">column</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">j</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">row</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">elementValue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"#.##"</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>Both <a href="/pine-script-docs/language/arrays/">arrays</a> of header names (<code dir="auto">sideHeaderTitles</code> and <code dir="auto">topHeaderTitles</code>) contain the same number of elements, enabling the script to iterate through their contents simultaneously using a single <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop.</li>
<li>The nested <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loops iterate over <em>all</em> the index values in the <code dir="auto">taMatrix</code>. The <em>outer</em> loop iterates over each <em>row</em> index, and the <em>inner</em> loop iterates over every <em>column</em> index on each outer loop iteration.</li>
<li>The script creates and displays the <a href="https://www.tradingview.com/pine-script-reference/v6/#type_table">table</a> only on the last historical bar and all realtime bars because the historical states of <a href="/pine-script-docs/visuals/tables/">tables</a> are <em>never</em> visible. See the <a href="/pine-script-docs/writing/profiling-and-optimization/#reducing-drawing-updates">Reducing drawing updates</a> of the <a href="/pine-script-docs/writing/profiling-and-optimization/">Profiling and optimization</a> page for more information.</li>
</ul>
<p>It’s important to note that a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop’s header <em>dynamically</em> evaluates the <code dir="auto">to_num</code> value at the start of <em>every iteration</em>. If the <code dir="auto">to_num</code> argument is a variable and the script changes its value during an iteration, the loop uses the <em>new value</em> to update its stopping condition. Likewise, the stopping condition can change across iterations when the <code dir="auto">to_num</code> argument is an expression or function call that depends on data modified in the loop’s scope, such as a call to <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_array.size">array.size()</a> on a locally resized <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a> or <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_str.length">str.length()</a> on an adjusted string. Therefore, scripts can use <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loops to perform iterative tasks where the exact number of required iterations is <em>not predictable</em> in advance, similar to <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_while">while</a> loops.</p>
<p>For example, the following script uses a dynamic <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop to determine the historical offset of the most recent bar whose <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> differs from the current bar’s <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> by at least one standard deviation. The script declares a <code dir="auto">barOffset</code> variable with an initial value of zero and uses that variable to define the loop counter’s <code dir="auto">to_num</code> boundary. Within the loop’s scope, the script increments the <code dir="auto">barOffset</code> by one if the referenced bar’s <code dir="auto">close</code> is not far enough from the current bar’s value. Each time the <code dir="auto">barOffset</code> value increases, the loop increases its final counter value, allowing an <em>extra iteration</em>. The script plots the <code dir="auto">barOffset</code> and the corresponding bar’s <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> for visual reference:</p>
<p><img src="/pine-script-docs/_astro/Loops-For-loops-4.28vao8At_zHcik.webp" alt="image" width="2458" height="1130" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="60s"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6&nbsp;</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"`for`&nbsp;loop&nbsp;with&nbsp;dynamic&nbsp;`to_num`&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;length&nbsp;of&nbsp;the&nbsp;standard&nbsp;deviation.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4999</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;standard&nbsp;deviation&nbsp;of&nbsp;`close`&nbsp;prices&nbsp;over&nbsp;`le</span><span class="mtk9">ngthInput`&nbsp;bars.&nbsp;</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stdev</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.stdev</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;minimum&nbsp;bars&nbsp;back&nbsp;where&nbsp;the&nbsp;past&nbsp;bar's&nbsp;`close</span><span class="mtk9">`&nbsp;differs&nbsp;from&nbsp;the&nbsp;current&nbsp;`close`&nbsp;by&nbsp;at&nbsp;least&nbsp;`st</span><span class="mtk9">dev`.</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Used&nbsp;as&nbsp;the&nbsp;weight&nbsp;value&nbsp;in&nbsp;the&nbsp;weight</span><span class="mtk9">ed&nbsp;average.&nbsp;&nbsp;</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">barOffset</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Define&nbsp;a&nbsp;`for`&nbsp;loop&nbsp;that&nbsp;iterates&nbsp;from&nbsp;0&nbsp;to&nbsp;`ba</span><span class="mtk9">rsBack`.</span></span><br><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">barOffset</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;1&nbsp;for&nbsp;each&nbsp;bar&nbsp;where&nbsp;the&nbsp;distance&nbsp;from&nbsp;that</span><span class="mtk9">&nbsp;bar's&nbsp;`close`&nbsp;to&nbsp;the&nbsp;current&nbsp;bar's&nbsp;`close`&nbsp;is&nbsp;les</span><span class="mtk9">s&nbsp;than&nbsp;`stdev`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Each&nbsp;time&nbsp;`barsBack`&nbsp;increases,&nbsp;it&nbsp;changes&nbsp;the&nbsp;</span><span class="mtk9">loop's&nbsp;`to_num`&nbsp;boundary,&nbsp;allowing&nbsp;another&nbsp;iterati</span><span class="mtk9">on.&nbsp;&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">barOffset</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.abs</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk33">i</span><span class="mtk13">])</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">stdev</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;gradient&nbsp;color&nbsp;for&nbsp;the&nbsp;`barOffset`&nbsp;plot.&nbsp;</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">offsetColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.from_gradient</span><span class="mtk13">(</span><span class="mtk33">barOffset</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`barOffset`&nbsp;in&nbsp;a&nbsp;separate&nbsp;pane.&nbsp;</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">barOffset</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Bar&nbsp;offset"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">offsetColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_columns</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;historical&nbsp;`close`&nbsp;price&nbsp;from&nbsp;`barOffs</span><span class="mtk9">et`&nbsp;bars&nbsp;back&nbsp;in&nbsp;the&nbsp;main&nbsp;chart&nbsp;pane.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk33">barOffset</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Historical&nbsp;bar's&nbsp;price"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">force_overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>Changing the <code dir="auto">to_num</code> value on an iteration does not affect the established <em>direction</em> in which the loop adjusts its counter variable. For instance, if the loop in this example changed <code dir="auto">barOffset</code> to -1 on any iteration, it would stop immediately after that iteration ends without reducing the <code dir="auto">i</code> value.</li>
<li>The script uses <code dir="auto">force_overlay = true</code> in the second <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plot">plot()</a> call to display the historical closing price on the main chart pane.</li>
</ul>
<h2 id="while-loops" class="md-heading"><a href="#while-loops"><span>​<code dir="auto">while</code>​ loops</span><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></a></h2>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_while">while</a> loop statement creates a <em>condition-controlled</em> loop, which uses a <em>conditional expression</em> to control the executions of its local block. The loop continues its iterations as long as the specified condition remains <code dir="auto">true</code>.</p>
<p>Pine Script uses the following syntax to define a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_while">while</a> loop:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[variables = | :=] while condition</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">statements | continue | break</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">return_expression</span></div></div></code></pre></figure></div>
<p>Where the <code dir="auto">condition</code> in the loop’s <em>header</em> can be a literal, variable, expression, or function call that returns a “bool” value.</p>
<p>Refer to the <a href="/pine-script-docs/language/loops/#common-characteristics">Common characteristics</a> section above for detailed information about the <code dir="auto">variables</code>, <code dir="auto">statements</code>, <code dir="auto">continue</code>, <code dir="auto">break</code>, and <code dir="auto">return_expression</code> parts of the loop’s syntax.</p>
<p>A <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_while">while</a> loop’s header evaluates its <code dir="auto">condition</code> before each iteration. Consequently, when the script modifies the condition within an iteration, the loop’s header reflects those changes on the <em>next</em> iteration.</p>
<p>Depending on the specified condition in the loop header, a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_while">while</a> loop can behave similarly to a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop, continuing iteration until a <em>counter</em> variable reaches a specified limit. For example, the following script uses a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop and <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_while">while</a> loop to perform the same task. Both loops draw a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_label">label</a> displaying their respective counter value on each iteration:</p>
<p><img src="/pine-script-docs/_astro/Loops-While-loops-1.D6NOmppL_ZjTEtl.webp" alt="image" width="868" height="316" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="4r4"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"`while`&nbsp;loop&nbsp;with&nbsp;a&nbsp;counter&nbsp;condition&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islastconfirmedhistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;A&nbsp;`for`&nbsp;loop&nbsp;that&nbsp;creates&nbsp;blue&nbsp;labels&nbsp;displayin</span><span class="mtk9">g&nbsp;each&nbsp;`i`&nbsp;value.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">i</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.large</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_down</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;"int"&nbsp;to&nbsp;use&nbsp;as&nbsp;a&nbsp;counter&nbsp;within&nbsp;a&nbsp;`while`&nbsp;loo</span><span class="mtk9">p.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">j</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;A&nbsp;`while`&nbsp;loop&nbsp;that&nbsp;creates&nbsp;orange&nbsp;labels&nbsp;displ</span><span class="mtk9">aying&nbsp;each&nbsp;`j`&nbsp;value.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">while</span><span class="mtk1">&nbsp;</span><span class="mtk33">j</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">j</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">j</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.large</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_up</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Update&nbsp;the&nbsp;`j`&nbsp;counter&nbsp;within&nbsp;the&nbsp;local&nbsp;block.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">j</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>When a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_while">while</a> loop uses count-based logic, it must explicitly manage the user-specified counter within the local block. In contrast, a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop increments its counter automatically.</li>
<li>The script declares the variable the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_while">while</a> loop uses as a counter <em>outside</em> the loop’s <a href="/pine-script-docs/language/loops/#scope">scope</a>, meaning its value is usable in additional calculations after the loop terminates.</li>
<li>If this code did not increment the <code dir="auto">j</code> variable within the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_while">while</a> loop’s body, the value would <em>never</em> reach 10, meaning the loop would run <em>indefinitely</em> until causing a <a href="/pine-script-docs/error-messages/#loop-is-too-long--500-ms">runtime error</a>.</li>
</ul>
<p>Because a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_while">while</a> loop’s execution depends on its condition remaining <code dir="auto">true</code>, and the condition might not change on a specific iteration, the <em>precise</em> number of expected iterations might not be knowable <em>before</em> the loop begins. Therefore, <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_while">while</a> loops are often helpful in scenarios where the exact loop boundaries are <em>unknown</em>.</p>
<p>The script below tracks when the chart’s <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> crosses outside Keltner Channels with a user-specified length and channel width. When the price crosses outside the current bar’s channel, the script draws a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_box">box</a> highlighting all the previous <em>consecutive</em> bars with <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> values within that price window. The script uses a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_while">while</a> loop to analyze past bars’ prices and incrementally adjust the left side of each new <a href="https://www.tradingview.com/pine-script-reference/v6/#type_box">box</a> until the drawing covers all the latest consecutive bars in the current range:</p>
<p><img src="/pine-script-docs/_astro/Loops-While-loops-2.CDUKt8KX_JSuga.webp" alt="image" width="1336" height="560" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="299"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"`while`&nbsp;loop&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Price&nbsp;window&nbsp;boxes"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;length&nbsp;of&nbsp;the&nbsp;channel.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Channel&nbsp;length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4999</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;width&nbsp;multiplier&nbsp;of&nbsp;the&nbsp;channel.&nbsp;</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">widthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.float</span><span class="mtk13">(</span><span class="mtk12">2.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Width&nbsp;multiplier"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`lengthInput`-bar&nbsp;EMA&nbsp;of&nbsp;`close`&nbsp;prices.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.ema</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`lengthInput`-bar&nbsp;ATR,&nbsp;multiplied&nbsp;by&nbsp;the&nbsp;`wid</span><span class="mtk9">thInput`.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">atr</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.atr</span><span class="mtk13">(</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">widthInput</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;lower&nbsp;bound&nbsp;of&nbsp;the&nbsp;channel.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">channelLow</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">atr</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;upper&nbsp;bound&nbsp;of&nbsp;the&nbsp;channel.&nbsp;</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">channelHigh</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">ma</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">atr</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;the&nbsp;`close`&nbsp;price&nbsp;is&nbsp;outside&nbsp;the&nbsp;c</span><span class="mtk9">urrent&nbsp;channel&nbsp;range,&nbsp;`false`&nbsp;otherwise.&nbsp;</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceOutsideChannel</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">channelLow</span><span class="mtk1">&nbsp;</span><span class="mtk18">or</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">channelHigh</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Check&nbsp;if&nbsp;the&nbsp;`close`&nbsp;crossed&nbsp;outside&nbsp;the&nbsp;channe</span><span class="mtk9">l&nbsp;range,&nbsp;then&nbsp;analyze&nbsp;the&nbsp;past&nbsp;bars&nbsp;within&nbsp;the&nbsp;cur</span><span class="mtk9">rent&nbsp;range.&nbsp;</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceOutsideChannel</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk18">not</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceOutsideChannel</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;box&nbsp;that&nbsp;highlights&nbsp;consecutive&nbsp;past&nbsp;bars&nbsp;withi</span><span class="mtk9">n&nbsp;the&nbsp;current&nbsp;channel's&nbsp;price&nbsp;window.&nbsp;&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">box</span><span class="mtk1">&nbsp;</span><span class="mtk33">windowBox</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">box.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">channelHigh</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">channelLow</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">border_width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.gray</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">85</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;lookback&nbsp;index&nbsp;for&nbsp;box&nbsp;adjustment.&nbsp;The&nbsp;`while</span><span class="mtk9">`&nbsp;loop&nbsp;increments&nbsp;this&nbsp;value&nbsp;on&nbsp;each&nbsp;iteration.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Use&nbsp;a&nbsp;`while`&nbsp;loop&nbsp;to&nbsp;look&nbsp;backward&nbsp;through&nbsp;clo</span><span class="mtk9">se`&nbsp;prices.&nbsp;The&nbsp;loop&nbsp;iterates&nbsp;as&nbsp;long&nbsp;as&nbsp;the&nbsp;past&nbsp;</span><span class="mtk9">`close`&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;from&nbsp;`i`&nbsp;bars&nbsp;ago&nbsp;is&nbsp;between&nbsp;the&nbsp;current&nbsp;bar's&nbsp;</span><span class="mtk9">`channelLow`&nbsp;and&nbsp;`channelHigh`.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">while</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk33">i</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">channelLow</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk33">i</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">channelHigh</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Adjust&nbsp;the&nbsp;left&nbsp;side&nbsp;of&nbsp;the&nbsp;box.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">windowBox</span><span class="mtk1">.</span><span class="mtk15">set_left</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;1&nbsp;to&nbsp;the&nbsp;`i`&nbsp;value&nbsp;to&nbsp;check&nbsp;the&nbsp;`close`&nbsp;fro</span><span class="mtk9">m&nbsp;the&nbsp;next&nbsp;bar&nbsp;back&nbsp;on&nbsp;the&nbsp;next&nbsp;iteration.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`channelLow`&nbsp;and&nbsp;`channelHigh`&nbsp;for&nbsp;vis</span><span class="mtk9">ual&nbsp;reference.&nbsp;</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">channelLow</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Channel&nbsp;low"</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">channelHigh</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Channel&nbsp;high"</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>The left and right edges of <a href="/pine-script-docs/visuals/lines-and-boxes/#boxes">boxes</a> sit within the horizontal <em>center</em> of their respective bars, meaning that each drawing spans from the middle of the first consecutive bar to the middle of the last bar within each window.</li>
<li>This script uses the <code dir="auto">i</code> variable as a <a href="/pine-script-docs/language/operators/#-history-referencing-operator">history-referencing</a> index within the <em>conditional expression</em> the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_while">while</a> loop checks on each iteration. The variable <strong>does not</strong> behave as a loop counter, as the iteration boundaries are <strong>unknown</strong>. The loop executes its local block repeatedly until the condition becomes <code dir="auto">false</code>.</li>
</ul>
<h2 id="forin-loops" class="md-heading"><a href="#forin-loops"><span>​<code dir="auto">for...in</code>​ loops</span><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></a></h2>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop statement creates a <em>collection-controlled</em> loop, which uses the <em>contents</em> of a <a href="/pine-script-docs/language/type-system/#collections">collection</a> to control its iterations. This loop structure is often the preferred approach for looping through <a href="/pine-script-docs/language/arrays/">arrays</a>, <a href="/pine-script-docs/language/matrices/">matrices</a>, and <a href="/pine-script-docs/language/maps/">maps</a>.</p>
<p>A <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop traverses a collection <em>in order</em>, retrieving one of its stored items on each iteration. Therefore, the loop’s boundaries depend directly on the number of <em>items</em> (<a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a> <em>elements</em>, <a href="https://www.tradingview.com/pine-script-reference/v6/#type_matrix">matrix</a> <em>rows</em>, or <a href="https://www.tradingview.com/pine-script-reference/v6/#type_map">map</a> <em>key-value pairs</em>).</p>
<p>Pine Script features <em>two</em> general forms of the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop statement. The <em>first form</em> uses the following syntax:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[variables = | :=] for item in collection_id</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">statements | continue | break</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">return_expression</span></div></div></code></pre></figure></div>
<p>Where <code dir="auto">item</code> is a <em>variable</em> that holds sequential values or references from the specified <code dir="auto">collection_id</code>. The variable starts with the collection’s <em>first item</em> and takes on successive items in order after each iteration. This form is convenient when a script must access values from an <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a> or <a href="https://www.tradingview.com/pine-script-reference/v6/#type_matrix">matrix</a> iteratively but does not require the item’s <em>index</em> in its calculations.</p>
<p>The <em>second form</em> has a slightly different syntax that includes a <a href="/pine-script-docs/language/type-system/#tuples">tuple</a> in its <em>header</em>:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[variables = | :=] for [index, item] in collection_id</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">statements | continue | break</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">return_expression</span></div></div></code></pre></figure></div>
<p>Where <code dir="auto">index</code> is a variable that contains the <em>index</em> or <em>key</em> of the retrieved <code dir="auto">item</code>. This form is convenient when a task requires using a collection’s items <em>and</em> their indices in iterative calculations. This form of the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop is <em>required</em> when directly iterating through the contents of a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_map">map</a>. See <a href="/pine-script-docs/language/loops/#looping-through-maps">this section</a> below for more information.</p>
<p>Refer to the <a href="/pine-script-docs/language/loops/#common-characteristics">Common characteristics</a> section above for detailed information about the <code dir="auto">variables</code>, <code dir="auto">statements</code>, <code dir="auto">continue</code>, <code dir="auto">break</code>, and <code dir="auto">return_expression</code> parts of the loop’s syntax.</p>
<p>The iterative behavior of a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop depends on the <em>type</em> of collection the header specifies as the <code dir="auto">collection_id</code>:</p>
<ul>
<li>When using an <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a> in the header, the loop performs <a href="/pine-script-docs/language/loops/#looping-through-arrays"><em>element-wise</em> iteration</a>, meaning the retrieved <code dir="auto">item</code> on each iteration is one of the array’s <em>elements</em>.</li>
<li>When using a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_matrix">matrix</a> in the header, the loop performs <a href="/pine-script-docs/language/loops/#looping-through-matrices"><em>row-wise</em> iteration</a>, which means that each <code dir="auto">item</code> represents a <em>row array</em>.</li>
<li>When using a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_map">map</a> in the header, the loop performs <a href="/pine-script-docs/language/loops/#looping-through-maps"><em>pair-wise</em> iteration</a>, which retrieves a <em>key</em> and corresponding <em>value</em> on each iteration.</li>
</ul>
<aside aria-label="Note" class="tv-informer not-content" style="--informer-header-color:#6A6D78;--informer-back-color-light:#F0F3FA;--informer-back-color-dark:#2A2E39"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM8 6a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm1 2c.49 0 1 .59 1 1v3.01c0 .42-.51.99-1 .99s-1-.57-1-.99V9c0-.41.51-1 1-1Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Note</span>Scripts can modify the sizes of arrays and matrices directly within a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop’s local scope. When a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop changes the size of a collection during an iteration, the loop’s header uses the <em>updated size</em> to control subsequent iterations, just like an equivalent <a href="/pine-script-docs/language/loops/#for-loops">for</a> loop that uses <code dir="auto">array.size(id) - 1</code> or <code dir="auto">matrix.rows(id) - 1</code> as the <code dir="auto">to_num</code> argument.</p></div></aside>
<h3 id="looping-through-arrays" class="md-heading"><a href="#looping-through-arrays">Looping through <span class="fancy-wrap">arrays<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Pine scripts can iterate over the elements of <a href="/pine-script-docs/language/arrays/">arrays</a> using any loop structure. However, the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop is typically the most convenient because it automatically verifies the size of an <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a> when controlling iterations. With other loop structures, programmers must carefully set the header’s boundaries or conditions to <em>prevent</em> the loop from attempting to access an element at a <em>nonexistent</em> index.</p>
<p>For example, a <a href="/pine-script-docs/language/loops/#for-loops">for</a> loop can access an array’s elements using the counter variable as the lookup index in functions such as <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_array.get">array.get()</a>. However, programmers must ensure the counter always represents a <em>valid index</em> to prevent <a href="/pine-script-docs/language/arrays/#index-xx-is-out-of-bounds-array-size-is-yy">out-of-bounds</a> errors. Additionally, if an array might be <em>empty</em>, programmers must set conditions to prevent the loop’s execution entirely.</p>
<p>The code below shows a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop whose counter boundaries depend on the number of elements in an <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a>. If the array is empty, containing zero elements, the header’s final counter value is <a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a>, which <em>prevents</em> iteration. Otherwise, the final value is <em>one less</em> than the array’s <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_array.size">size</a> (i.e., the index of the last element):</p>
<div class="pine-colorizer not-content colorized" data-id="30q"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">index</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk16">array.size</span><span class="mtk13">(</span><span class="mtk33">myArray</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.size</span><span class="mtk13">(</span><span class="mtk33">myArray</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">element</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.get</span><span class="mtk13">(</span><span class="mtk33">myArray</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">index</span><span class="mtk13">)</span></span><br></code></div>
<p>In contrast, a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop automatically validates an array’s size and <em>directly</em> accesses its elements, providing a more convenient solution than a traditional <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop. The line below achieves the <em>same effect</em> as the code above without requiring the programmer to define boundaries explicitly or use the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_array.get">array.get()</a> function to access each element:</p>
<div class="pine-colorizer not-content colorized" data-id="np"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">element</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">myArray</span></span><br></code></div>
<p>The following example examines bars on a lower timeframe to gauge the strength of <em>intrabar</em> trends within each chart bar. The script uses a <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_request.security_lower_tf">request.security_lower_tf()</a> call to retrieve an <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a> of intrabar <a href="https://www.tradingview.com/pine-script-reference/v6/#var_hl2">hl2</a> prices from a calculated <code dir="auto">lowerTimeframe</code>. Then, it uses a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop to access each <code dir="auto">price</code> within the <code dir="auto">intrabarPrices</code> array and compare the value to the current <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> to calculate the bar’s <code dir="auto">strength</code>. The script plots the <code dir="auto">strength</code> as columns in a separate pane:</p>
<p><img src="/pine-script-docs/_astro/Loops-For-in-loops-Looping-through-arrays-1.D-rbYJQk_ZdCBAV.webp" alt="image" width="1336" height="554" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="65y"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"`for&nbsp;element&nbsp;in&nbsp;array`&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Intrabar&nbsp;strength"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;valid&nbsp;timeframe&nbsp;closest&nbsp;to&nbsp;one-tenth&nbsp;of&nbsp;the&nbsp;cur</span><span class="mtk9">rent&nbsp;chart's&nbsp;timeframe,&nbsp;"1"&nbsp;if&nbsp;the&nbsp;timeframe&nbsp;is&nbsp;to</span><span class="mtk9">o&nbsp;small.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">lowerTimeframe</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">timeframe.from_seconds</span><span class="mtk13">(</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk16">int</span><span class="mtk13">(</span><span class="mtk16">timeframe.in_seconds</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">60</span><span class="mtk13">))</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;array&nbsp;of&nbsp;intrabar&nbsp;`hl2`&nbsp;prices&nbsp;calculated&nbsp;from</span><span class="mtk9">&nbsp;the&nbsp;`lowerTimeframe`.</span></span><br><span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">intrabarPrices</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">request.security_lower_tf</span><span class="mtk13">(</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lowerTimeframe</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">hl2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;excess&nbsp;trend&nbsp;strength&nbsp;of&nbsp;`intrabarPrices`.&nbsp;</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">strength</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Loop&nbsp;directly&nbsp;through&nbsp;the&nbsp;`intrabarPrices`&nbsp;arra</span><span class="mtk9">y.&nbsp;Each&nbsp;iteration's&nbsp;`price`&nbsp;represents&nbsp;an&nbsp;array&nbsp;el</span><span class="mtk9">ement.</span></span><br><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">price</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">intrabarPrices</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Subtract&nbsp;1&nbsp;from&nbsp;the&nbsp;`strength`&nbsp;if&nbsp;the&nbsp;retrieved</span><span class="mtk9">&nbsp;`price`&nbsp;is&nbsp;above&nbsp;the&nbsp;current&nbsp;bar's&nbsp;`close`&nbsp;price.</span><span class="mtk9">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">price</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">strength</span><span class="mtk1">&nbsp;</span><span class="mtk18">-=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;1&nbsp;to&nbsp;the&nbsp;`strength`&nbsp;if&nbsp;the&nbsp;retrieved&nbsp;`price</span><span class="mtk9">`&nbsp;is&nbsp;below&nbsp;the&nbsp;current&nbsp;bar's&nbsp;`close`&nbsp;price.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">else</span><span class="mtk1">&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">price</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">strength</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`color.teal`&nbsp;when&nbsp;the&nbsp;`strength`&nbsp;is&nbsp;positive,&nbsp;</span><span class="mtk9">`color.maroon`&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">strengthColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">strength</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.maroon</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`strength`&nbsp;as&nbsp;columns&nbsp;colored&nbsp;by&nbsp;the&nbsp;`</span><span class="mtk9">strengthColor`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">strength</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Intrabar&nbsp;strength"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">strengthColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_columns</span><span class="mtk13">)</span></span><br></code></div>
<p>The <a href="/pine-script-docs/language/loops/#forin-loops">second form</a> of the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop is a convenient solution when a script’s calculations require accessing each element <em>and</em> corresponding index within an <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a>:</p>
<div class="pine-colorizer not-content colorized" data-id="5ke"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk13">[</span><span class="mtk33">index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">element</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">myArray</span></span><br></code></div>
<p>For example, suppose we want to display a <em>numerated</em> list of <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a> elements within a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_label">label</a> while excluding values at specific indices. We can use the second form of the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop structure to accomplish this task. The simple script below declares a <code dir="auto">stringArray</code> variable that references an <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a> of predefined “string” values. On the last historical bar, the script uses a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop to access each <code dir="auto">index</code> and <code dir="auto">element</code> in the <code dir="auto">stringArray</code> to construct the <code dir="auto">labelText</code>, which it uses in a <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_label.new">label.new()</a> call after the loop ends:</p>
<p><img src="/pine-script-docs/_astro/Loops-For-in-loops-Looping-through-arrays-2.CVOFB_ZV_Z20I1Ef.webp" alt="image" width="840" height="400" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="7d4"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"`for&nbsp;[index,&nbsp;item]&nbsp;in&nbsp;array`&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Array&nbsp;numerated&nbsp;output"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;array&nbsp;of&nbsp;"string"&nbsp;values&nbsp;to&nbsp;display&nbsp;as&nbsp;a&nbsp;numer</span><span class="mtk9">ated&nbsp;list.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">string</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">stringArray</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk29">"First"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Second"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Third"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Before&nbsp;Last"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Last"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islastconfirmedhistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;"string"&nbsp;modified&nbsp;within&nbsp;a&nbsp;loop&nbsp;to&nbsp;display&nbsp;with</span><span class="mtk9">in&nbsp;the&nbsp;`label`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Array&nbsp;values:&nbsp;\n"</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Loop&nbsp;through&nbsp;the&nbsp;`stringArray`,&nbsp;accessing&nbsp;each&nbsp;</span><span class="mtk9">`index`&nbsp;and&nbsp;corresponding&nbsp;`element`.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk13">[</span><span class="mtk33">index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">element</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">stringArray</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Skip&nbsp;the&nbsp;third&nbsp;`element`&nbsp;(at&nbsp;`index&nbsp;==&nbsp;2`)&nbsp;in&nbsp;t</span><span class="mtk9">he&nbsp;`labelText`.&nbsp;Include&nbsp;an&nbsp;"ELEMENT&nbsp;SKIPPED"&nbsp;messa</span><span class="mtk9">ge&nbsp;instead.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">labelText</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"--&nbsp;ELEMENT&nbsp;SKIPPED&nbsp;--&nbsp;\n"</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">continue</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">labelText</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">":&nbsp;"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">element</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"\n"</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;`labelText`&nbsp;within&nbsp;a&nbsp;`label`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelText</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_center</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textalign</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">text.align_left</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>This example adds 1 to the <code dir="auto">index</code> in the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_str.tostring">str.tostring()</a> call to start the numerated list with a value of <code dir="auto">"1"</code>, because <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a> indices always begins at 0.</li>
<li>On the <em>third</em> loop iteration, when <code dir="auto">index == 2</code>, the script adds an <code dir="auto">"-- ELEMENT SKIPPED --"</code> message to the <code dir="auto">labelText</code> instead of the retrieved <code dir="auto">element</code> and uses the <code dir="auto">continue</code> keyword to skip the remainder of the iteration. See <a href="/pine-script-docs/language/loops/#keywords-and-return-expressions">this section</a> above to learn more about loop keywords.</li>
</ul>
<p>Let’s explore an advanced example demonstrating the utility of <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loops. The following indicator draws a fixed number of horizontal <a href="/pine-script-docs/visuals/lines-and-boxes/#lines">lines</a> at pivot high values calculated from a <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.pivothigh">ta.pivothigh()</a> call, and it analyzes the lines within a loop to determine which ones represent active (<em>uncrossed</em>) pivots.</p>
<p>Each time the script detects a new pivot high point, it creates a new <a href="https://www.tradingview.com/pine-script-reference/v6/#type_line">line</a>, <em>inserts</em> that line at the beginning of the <code dir="auto">pivotLines</code> array, then removes the oldest element and deletes its ID using <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_line.delete">line.delete()</a>. The script accesses each <a href="https://www.tradingview.com/pine-script-reference/v6/#type_line">line</a> within the <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a> using a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop, analyzing and <a href="/pine-script-docs/visuals/lines-and-boxes/#modifying-lines">modifying</a> the properties of the line referenced on each iteration. When the current <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a> crosses above the <code dir="auto">pivotLine</code>, the script changes its style to signify that it is no longer an active level. Otherwise, it extends the line’s <code dir="auto">x2</code> coordinate and uses its price to calculate the average <em>active</em> pivot value. The script also plots each pivot high value and the average active pivot value on the chart:</p>
<p><img src="/pine-script-docs/_astro/Loops-For-in-loops-Looping-through-arrays-3.92QH6mmE_Z1GaAhA.webp" alt="image" width="1336" height="556" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5fc"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"`for...in`&nbsp;loop&nbsp;with&nbsp;arrays&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Active&nbsp;high&nbsp;pivots"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">max_lines_count</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;required&nbsp;on&nbsp;the&nbsp;left&nbsp;and&nbsp;right</span><span class="mtk9">&nbsp;to&nbsp;confirm&nbsp;a&nbsp;pivot&nbsp;point.&nbsp;</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">pivotBarsInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Pivot&nbsp;leg&nbsp;length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;recent&nbsp;pivot&nbsp;lines&nbsp;to&nbsp;analyze.&nbsp;Cont</span><span class="mtk9">rols&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;`pivotLines`&nbsp;array.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">maxRecentLines</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Maximum&nbsp;recent&nbsp;lines"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">500</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;array&nbsp;that&nbsp;acts&nbsp;as&nbsp;a&nbsp;queue&nbsp;holding&nbsp;the&nbsp;most&nbsp;re</span><span class="mtk9">cent&nbsp;pivot&nbsp;high&nbsp;lines.&nbsp;</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">line</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">pivotLines</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">line</span><span class="mtk13">&gt;(</span><span class="mtk33">maxRecentLines</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;pivot&nbsp;high&nbsp;price,&nbsp;or&nbsp;`na`&nbsp;if&nbsp;no&nbsp;pivot&nbsp;is&nbsp;foun</span><span class="mtk9">d.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">highPivotPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.pivothigh</span><span class="mtk13">(</span><span class="mtk33">pivotBarsInput</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">pivotBarsInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk18">not</span><span class="mtk1">&nbsp;</span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk33">highPivotPrice</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`chart.point`&nbsp;for&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;line.&nbsp;Does</span><span class="mtk9">&nbsp;not&nbsp;contain&nbsp;`time`&nbsp;information.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">firstPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.from_index</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk33">pivotBarsInput</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">highPivotPrice</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`chart.point`&nbsp;for&nbsp;the&nbsp;end&nbsp;of&nbsp;each&nbsp;line.&nbsp;Does&nbsp;</span><span class="mtk9">not&nbsp;contain&nbsp;`time`&nbsp;information.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">secondPoint</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">chart.point.from_index</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">highPivotPrice</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;horizontal&nbsp;line&nbsp;at&nbsp;the&nbsp;new&nbsp;pivot&nbsp;level.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">line</span><span class="mtk1">&nbsp;</span><span class="mtk33">hiPivotLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">line.new</span><span class="mtk13">(</span><span class="mtk33">firstPoint</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">secondPoint</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Insert&nbsp;the&nbsp;`hiPivotLine`&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;th</span><span class="mtk9">e&nbsp;`pivotLines`&nbsp;array.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">pivotLines</span><span class="mtk1">.</span><span class="mtk15">unshift</span><span class="mtk13">(</span><span class="mtk33">hiPivotLine</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Remove&nbsp;the&nbsp;oldest&nbsp;line&nbsp;from&nbsp;the&nbsp;array&nbsp;and&nbsp;delet</span><span class="mtk9">e&nbsp;its&nbsp;ID.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">line.delete</span><span class="mtk13">(</span><span class="mtk33">pivotLines</span><span class="mtk1">.</span><span class="mtk15">pop</span><span class="mtk13">())</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;sum&nbsp;of&nbsp;active&nbsp;pivot&nbsp;prices.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">activePivotSum</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.0</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;active&nbsp;pivot&nbsp;high&nbsp;levels.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">numActivePivots</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Loop&nbsp;through&nbsp;the&nbsp;`pivotLines`&nbsp;array,&nbsp;directly&nbsp;a</span><span class="mtk9">ccessing&nbsp;each&nbsp;`pivotLine`&nbsp;element.&nbsp;</span></span><br><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">pivotLine</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">pivotLines</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`x2`&nbsp;coordinate&nbsp;of&nbsp;the&nbsp;`pivotline`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lineEnd</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">pivotLine</span><span class="mtk1">.</span><span class="mtk15">get_x2</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Move&nbsp;to&nbsp;the&nbsp;next&nbsp;`pivotline`&nbsp;in&nbsp;the&nbsp;array&nbsp;if&nbsp;th</span><span class="mtk9">e&nbsp;current&nbsp;line&nbsp;is&nbsp;inactive.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">pivotLine</span><span class="mtk1">.</span><span class="mtk15">get_x2</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">continue</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;price&nbsp;value&nbsp;of&nbsp;the&nbsp;`pivotLine`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">pivotPrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">pivotLine</span><span class="mtk1">.</span><span class="mtk15">get_price</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Change&nbsp;the&nbsp;style&nbsp;of&nbsp;the&nbsp;`pivotLine`&nbsp;and&nbsp;stop&nbsp;ex</span><span class="mtk9">tending&nbsp;its&nbsp;display&nbsp;if&nbsp;the&nbsp;`high`&nbsp;is&nbsp;above&nbsp;the&nbsp;`pi</span><span class="mtk9">votPrice`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">pivotPrice</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">pivotLine</span><span class="mtk1">.</span><span class="mtk15">set_color</span><span class="mtk13">(</span><span class="mtk11">color.maroon</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">pivotLine</span><span class="mtk1">.</span><span class="mtk15">set_style</span><span class="mtk13">(</span><span class="mtk11">line.style_dotted</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">pivotLine</span><span class="mtk1">.</span><span class="mtk15">set_width</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">continue</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Extend&nbsp;the&nbsp;`pivotLine`&nbsp;and&nbsp;add&nbsp;the&nbsp;`pivotPrice`</span><span class="mtk9">&nbsp;to&nbsp;the&nbsp;`activePivotSum`&nbsp;when&nbsp;the&nbsp;loop&nbsp;allows&nbsp;a&nbsp;fu</span><span class="mtk9">ll&nbsp;iteration.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">pivotLine</span><span class="mtk1">.</span><span class="mtk15">set_x2</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">activePivotSum</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk33">pivotPrice</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">numActivePivots</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;average&nbsp;active&nbsp;pivot&nbsp;high&nbsp;value.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">avgActivePivot</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">activePivotSum</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">numActivePivots</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;crosses&nbsp;at&nbsp;the&nbsp;`highPivotPrice`,&nbsp;offset&nbsp;ba</span><span class="mtk9">ckward&nbsp;by&nbsp;the&nbsp;`pivotBarsInput`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">highPivotPrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"High&nbsp;pivot&nbsp;marker"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_cross</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">offset</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk33">pivotBarsInput</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`avgActivePivot`&nbsp;as&nbsp;a&nbsp;line&nbsp;with&nbsp;breaks</span><span class="mtk9">.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">avgActivePivot</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Avg.&nbsp;active&nbsp;pivot"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_linebr</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>The loop in this example executes on <em>every bar</em> because it has to compare active pivot line prices with the current <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a> value, then use the remaining active prices to calculate the bar’s <code dir="auto">avgActivePivot</code> value.</li>
<li>Pine Script features several ways to calculate averages, many of which <em>do not</em> require a loop. However, a loop is <a href="/pine-script-docs/language/loops/#when-loops-are-necessary">necessary</a> in this example because the script uses information only available on the <strong>current bar</strong> to determine which prices contribute toward the average.</li>
<li>The <em>first</em> form of the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop is the most convenient option in this example because we need direct access to the <a href="/pine-script-docs/visuals/lines-and-boxes/#lines">lines</a> referenced within the <code dir="auto">pivotLines</code> array, but we do not need the corresponding <em>index</em> values.</li>
</ul>
<h3 id="looping-through-matrices" class="md-heading"><a href="#looping-through-matrices">Looping through <span class="fancy-wrap">matrices<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Pine scripts can iterate over the contents of a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_matrix">matrix</a> in several different ways. Unlike <a href="/pine-script-docs/language/arrays">arrays</a>, <a href="/pine-script-docs/language/matrices/">matrices</a> use <em>two</em> indices to reference their elements because they store data in a <em>rectangular</em> format. The first index refers to <em>rows</em>, and the second refers to <em>columns</em>. If a programmer opts to use <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> or <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_while">while</a> loops to iterate through <a href="/pine-script-docs/language/matrices/">matrices</a> instead of using <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a>, they must carefully define the loop boundaries or conditions to avoid <a href="/pine-script-docs/language/matrices/#the-rowcolumn-index-xx-is-out-of-bounds-rowcolumn-size-is-yy">out-of-bounds</a> errors.</p>
<p>This code block shows a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop that performs <em>row-wise</em> iteration, looping through each <em>row index</em> in a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_matrix">matrix</a> and using the value in a <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_matrix.row">matrix.row()</a> call to retrieve a row <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a>. If the <a href="https://www.tradingview.com/pine-script-reference/v6/#type_matrix">matrix</a> is empty, the loop statement uses a final loop counter value of <a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a> to <em>prevent</em> iteration. Otherwise, the final counter is the last row index, which is <em>one less</em> than the value returned by <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_matrix.rows">matrix.rows()</a>:</p>
<div class="pine-colorizer not-content colorized" data-id="4vl"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">rowIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">myMatrix</span><span class="mtk1">.</span><span class="mtk15">rows</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk33">myMatrix</span><span class="mtk1">.</span><span class="mtk15">rows</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">rowArray</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">myMatrix</span><span class="mtk1">.</span><span class="mtk15">row</span><span class="mtk13">(</span><span class="mtk33">rowIndex</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>If we replace the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_matrix.rows">matrix.rows()</a> and <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_matrix.row">matrix.row()</a> calls with <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_matrix.columns">matrix.columns()</a> and <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_matrix.col">matrix.col()</a>, the loop performs <em>column-wise</em> iteration instead.</li>
</ul>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop statement is the more convenient approach to loop over and access the rows of a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_matrix">matrix</a> in order, as it automatically validates the number of rows and retrieves an <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a> of the current row’s elements on each iteration:</p>
<div class="pine-colorizer not-content colorized" data-id="15a"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">rowArray</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">myMatrix</span></span><br></code></div>
<p>When a script’s calculations require access to each row from a matrix and its corresponding <em>index</em>, programmers can use the <a href="/pine-script-docs/language/loops/#forin-loops">second form</a> of the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop:</p>
<div class="pine-colorizer not-content colorized" data-id="cv"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk13">[</span><span class="mtk33">rowIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rowArray</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">myMatrix</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop only performs <strong>row-wise</strong> iteration on <a href="/pine-script-docs/language/matrices/">matrices</a>. To <em>emulate</em> column-wise iteration, programmers can use a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop on a <a href="/pine-script-docs/language/matrices/#transposing">transposed copy</a>.</li>
</ul>
<p>The following example creates a custom string representing the rows of a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_matrix">matrix</a> with extra information. When the script executes on the last historical bar, it creates a 3x3 matrix populated with values from <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_math.random">math.random()</a> calls. Using the <a href="/pine-script-docs/language/loops/#forin-loops">first form</a> of the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop, the script iterates through each row in the matrix to create a “string” value representing the row’s contents, its average, and whether the average is above 0.5. Before the end of each iteration, the script concatenates the constructed string with the <code dir="auto">labelText</code> value. After the loop ends, the script creates a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_label">label</a> to display the <code dir="auto">labelText</code> variable’s final value:</p>
<p><img src="/pine-script-docs/_astro/Loops-For-in-loops-Looping-through-matrices-1.MLIBFwlx_ZsMuB0.webp" alt="image" width="1036" height="404" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5b"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"`for&nbsp;row&nbsp;in&nbsp;matrix`&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Custom&nbsp;matrix&nbsp;label"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Generates&nbsp;a&nbsp;pseudorandom&nbsp;value&nbsp;between&nbsp;0&nbsp;and&nbsp;1,&nbsp;r</span><span class="mtk9">ounded&nbsp;to&nbsp;4&nbsp;decimal&nbsp;places.&nbsp;</span></span><br><span><span class="mtk15">rand</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">math.round</span><span class="mtk13">(</span><span class="mtk16">math.random</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islastconfirmedhistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;matrix&nbsp;of&nbsp;randomized&nbsp;values&nbsp;to&nbsp;format&nbsp;and&nbsp;displ</span><span class="mtk9">ay&nbsp;in&nbsp;a&nbsp;`label`.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">randomMatrix</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;a&nbsp;row&nbsp;of&nbsp;9&nbsp;randomized&nbsp;values&nbsp;and&nbsp;reshape&nbsp;th</span><span class="mtk9">e&nbsp;matrix&nbsp;to&nbsp;3x3.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">randomMatrix</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk33">rand</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rand</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rand</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rand</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rand</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rand</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rand</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rand</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rand</span><span class="mtk13">())</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">randomMatrix</span><span class="mtk1">.</span><span class="mtk15">reshape</span><span class="mtk13">(</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;custom&nbsp;"string"&nbsp;representation&nbsp;of&nbsp;`randomMatrix</span><span class="mtk9">`&nbsp;information.&nbsp;Modified&nbsp;within&nbsp;a&nbsp;loop.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Matrix&nbsp;rows:&nbsp;\n"</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Loop&nbsp;through&nbsp;the&nbsp;rows&nbsp;in&nbsp;the&nbsp;`randomMatrix`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">row</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">randomMatrix</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;average&nbsp;element&nbsp;value&nbsp;within&nbsp;the&nbsp;`row`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">rowAvg</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">row</span><span class="mtk1">.</span><span class="mtk15">avg</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;upward&nbsp;arrow&nbsp;when&nbsp;the&nbsp;`rowAvg`&nbsp;is&nbsp;above&nbsp;0.5,&nbsp;a</span><span class="mtk9">&nbsp;downward&nbsp;arrow&nbsp;otherwise.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">directionChar</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">rowAvg</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0.5</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk29">"⬆"</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk29">"⬇"</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;a&nbsp;"string"&nbsp;representing&nbsp;the&nbsp;`row`&nbsp;array,&nbsp;it</span><span class="mtk9">s&nbsp;average,&nbsp;and&nbsp;the&nbsp;`directionChar`&nbsp;to&nbsp;the&nbsp;`labelTe</span><span class="mtk9">xt`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">labelText</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.format</span><span class="mtk13">(</span><span class="mtk29">"Row:&nbsp;{0}&nbsp;Avg:&nbsp;{1}&nbsp;{2}\n"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">row</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rowAvg</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">directionChar</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;`label`&nbsp;displaying&nbsp;the&nbsp;`labelText`&nbsp;on&nbsp;th</span><span class="mtk9">e&nbsp;current&nbsp;bar.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelText</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_center</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textalign</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">text.align_left</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br></code></div>
<p>Working with <a href="/pine-script-docs/language/matrices/">matrices</a> often entails iteratively accessing their <em>elements</em>, not just their rows and columns, typically using <em>nested loops</em>. For example, this code block uses an outer <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop to iterate over row indices. The inner <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop iterates over column indices on <em>each</em> outer loop iteration and calls <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_matrix.get">matrix.get()</a> to access an element:</p>
<div class="pine-colorizer not-content colorized" data-id="7mz"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">rowIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">myMatrix</span><span class="mtk1">.</span><span class="mtk15">rows</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk33">myMatrix</span><span class="mtk1">.</span><span class="mtk15">rows</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">columnIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">myMatrix</span><span class="mtk1">.</span><span class="mtk15">columns</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">element</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">myMatrix</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk33">rowIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">columnIndex</span><span class="mtk13">)</span></span><br></code></div>
<p>Alternatively, a more convenient approach for this type of task is to use nested <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loops. The outer <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop in this code block retrieves each row <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a> in a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_matrix">matrix</a>, and the inner <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> statement <a href="/pine-script-docs/language/loops/#looping-through-arrays">loops through that array</a>:</p>
<div class="pine-colorizer not-content colorized" data-id="5fl"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">rowArray</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">myMatrix</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">element</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">rowArray</span></span><br></code></div>
<p>The script below creates a 3x2 <a href="https://www.tradingview.com/pine-script-reference/v6/#type_matrix">matrix</a>, then accesses and modifies its elements within nested <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loops. Both loops use the <a href="/pine-script-docs/language/loops/#forin-loops">second form</a> of the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> statement to retrieve index values and corresponding items. The outer loop accesses a row index and row <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a> from the <a href="https://www.tradingview.com/pine-script-reference/v6/#type_matrix">matrix</a>. The inner loop accesses each index and respective element from that <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a>.</p>
<p>Within the nested loop’s iterations, the script converts each <code dir="auto">element</code> to a “string” and initializes a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_table">table</a> cell at the <code dir="auto">rowIndex</code> row and <code dir="auto">colIndex</code> column. Then, it uses the loop header variables within <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_matrix.set">matrix.set()</a> to update the <a href="https://www.tradingview.com/pine-script-reference/v6/#type_matrix">matrix</a> element. After the outer loop terminates, the script displays a “string” representation of the <em>updated</em> <a href="https://www.tradingview.com/pine-script-reference/v6/#type_matrix">matrix</a> within a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_label">label</a>:</p>
<p><img src="/pine-script-docs/_astro/Loops-For-in-loops-Looping-through-matrices-2.CZ4aQPdE_2aLlhM.webp" alt="image" width="848" height="370" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="16r"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Nested&nbsp;`for...in`&nbsp;loops&nbsp;on&nbsp;matrices&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islastconfirmedhistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;&nbsp;A&nbsp;matrix&nbsp;containing&nbsp;numbers&nbsp;to&nbsp;display.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">matrix</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">displayNumbers</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">matrix.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Populate&nbsp;the&nbsp;`displayNumbers`&nbsp;matrix&nbsp;and&nbsp;reshap</span><span class="mtk9">e&nbsp;to&nbsp;3x2.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">displayNumbers</span><span class="mtk1">.</span><span class="mtk15">add_row</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">6</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">displayNumbers</span><span class="mtk1">.</span><span class="mtk15">reshape</span><span class="mtk13">(</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;table&nbsp;that&nbsp;displays&nbsp;the&nbsp;elements&nbsp;of&nbsp;the&nbsp;`displa</span><span class="mtk9">yNumbers`&nbsp;before&nbsp;modification.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">table</span><span class="mtk1">&nbsp;</span><span class="mtk33">displayTable</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">table.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">position</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">position.middle_center</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">columns</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">displayNumbers</span><span class="mtk1">.</span><span class="mtk15">columns</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rows</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">displayNumbers</span><span class="mtk1">.</span><span class="mtk15">rows</span><span class="mtk13">()</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">border_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">border_width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Loop&nbsp;through&nbsp;the&nbsp;`displayNumbers`,&nbsp;retrieving&nbsp;t</span><span class="mtk9">he&nbsp;`rowIndex`&nbsp;and&nbsp;the&nbsp;current&nbsp;`row`.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk13">[</span><span class="mtk33">rowIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">row</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">displayNumbers</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Loop&nbsp;through&nbsp;the&nbsp;current&nbsp;`row`&nbsp;on&nbsp;each&nbsp;outer&nbsp;lo</span><span class="mtk9">op&nbsp;iteration&nbsp;to&nbsp;retrieve&nbsp;the&nbsp;`colIndex`&nbsp;and&nbsp;`eleme</span><span class="mtk9">nt`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk13">[</span><span class="mtk33">colIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">element</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">row</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Initialize&nbsp;a&nbsp;table&nbsp;cell&nbsp;at&nbsp;the&nbsp;`rowIndex`&nbsp;row&nbsp;a</span><span class="mtk9">nd&nbsp;`colIndex`&nbsp;column&nbsp;displaying&nbsp;the&nbsp;current&nbsp;`eleme</span><span class="mtk9">nt`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">displayTable</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk33">column</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">colIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">row</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">rowIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">element</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">text_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Update&nbsp;the&nbsp;`displayNumbers`&nbsp;value&nbsp;at&nbsp;the&nbsp;`rowIn</span><span class="mtk9">dex`&nbsp;and&nbsp;`colIndex`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">displayNumbers</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk33">rowIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">colIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.round</span><span class="mtk13">(</span><span class="mtk16">math.exp</span><span class="mtk13">(</span><span class="mtk33">element</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;`label`&nbsp;to&nbsp;display&nbsp;a&nbsp;"string"&nbsp;representa</span><span class="mtk9">tion&nbsp;of&nbsp;the&nbsp;updated&nbsp;`displayNumbers`&nbsp;matrix.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">x</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">y</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Matrix&nbsp;now&nbsp;modified:&nbsp;\n"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">displayNumbers</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_up</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br></code></div>
<h3 id="looping-through-maps" class="md-heading"><a href="#looping-through-maps">Looping through <span class="fancy-wrap">maps<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop statement is the primary, most convenient approach for iterating over the data within Pine Script <a href="/pine-script-docs/language/maps/">maps</a>.</p>
<p>Unlike <a href="/pine-script-docs/language/arrays/">arrays</a> and <a href="/pine-script-docs/language/matrices/">matrices</a>, maps are <em>unordered collections</em> that store data in <em>key-value pairs</em>. Rather than traversing an internal lookup index, a script references the <em>keys</em> from the pairs within a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_map">map</a> to access its <em>values</em>. Therefore, when looping through a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_map">map</a>, scripts must perform <em>pair-wise</em> iteration, which entails retrieving key-value pairs across iterations rather than indexed <a href="/pine-script-docs/language/loops/#looping-through-arrays">elements</a> or <a href="/pine-script-docs/language/loops/#looping-through-matrices">rows</a>.</p>
<p>Note that:</p>
<ul>
<li>Although <a href="/pine-script-docs/language/maps/">maps</a> are unordered collections, Pine Script internally tracks the <em>insertion order</em> of their key-value pairs.</li>
</ul>
<p>One way to access the data from a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_map">map</a> is to use the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_map.keys">map.keys()</a> function, which returns an <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a> containing all the <em>keys</em> from the map, sorted in their insertion order. A script can use the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> structure to <a href="/pine-script-docs/language/loops/#looping-through-arrays">loop through the array</a> of keys and call <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_map.get">map.get()</a> to retrieve corresponding values:</p>
<div class="pine-colorizer not-content colorized" data-id="4in"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">key</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">myMap</span><span class="mtk1">.</span><span class="mtk15">keys</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">value</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">myMap</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk33">key</span><span class="mtk13">)</span></span><br></code></div>
<p>However, the more convenient, <em>recommended</em> approach is to loop through a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_map">map</a> directly <em>without</em> creating new <a href="/pine-script-docs/language/arrays/">arrays</a>. To loop through a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_map">map</a> directly, use the <a href="/pine-script-docs/language/loops/#forin-loops">second form</a> of the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop statement. Using this loop with a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_map">map</a> creates a <a href="/pine-script-docs/language/type-system/#tuples">tuple</a> containing a <em>key</em> and respective <em>value</em> on each iteration. As when looping through a <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_map.keys">map.keys()</a> array, this <em>direct</em> <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop iterates through a map’s contents in their insertion order:</p>
<div class="pine-colorizer not-content colorized" data-id="30n"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk13">[</span><span class="mtk33">key</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">value</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">myMap</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>The second form of the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop is the <strong>only</strong> way to iterate <em>directly</em> through a map. A script cannot directly loop through this collection type without retrieving a key and value on each iteration.</li>
</ul>
<p>Let’s consider a simple example demonstrating how a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop works on a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_map">map</a>. When the script below executes on the last historical bar, it declares a <code dir="auto">simpleMap</code> variable to reference a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_map">map</a> of “string” keys and “float” values. The script uses <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_map.put">map.put()</a> to insert the keys from the <code dir="auto">newKeys</code> array into the collection with corresponding values from <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_math.random">math.random()</a> calls. Then, it uses a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop to iterate through the key-value pairs from the map and construct the <code dir="auto">displayText</code> string. After the loop ends, the script uses a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_label">label</a> to visualize the string:</p>
<p><img src="/pine-script-docs/_astro/Loops-For-in-loops-Looping-through-maps.CZTQ1Hx7_Z1jyX7b.webp" alt="image" width="860" height="404" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="2ov"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Looping&nbsp;through&nbsp;map&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islastconfirmedhistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;map&nbsp;of&nbsp;"string"&nbsp;keys&nbsp;and&nbsp;"float"&nbsp;values&nbsp;to&nbsp;rend</span><span class="mtk9">er&nbsp;within&nbsp;a&nbsp;`label`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">map</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">string</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">simpleMap</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">map.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">string</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;array&nbsp;of&nbsp;"string"&nbsp;values&nbsp;representing&nbsp;the&nbsp;keys</span><span class="mtk9">&nbsp;to&nbsp;put&nbsp;into&nbsp;the&nbsp;map.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">string</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">newKeys</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk29">"A"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"B"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"C"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"D"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"E"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Put&nbsp;key-value&nbsp;pairs&nbsp;into&nbsp;the&nbsp;`simpleMap`.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">key</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">newKeys</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">simpleMap</span><span class="mtk1">.</span><span class="mtk15">put</span><span class="mtk13">(</span><span class="mtk33">key</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.random</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;"string"&nbsp;representation&nbsp;of&nbsp;the&nbsp;`simpleMap`&nbsp;cont</span><span class="mtk9">ents.&nbsp;Modified&nbsp;within&nbsp;a&nbsp;loop.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">displayText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"simpleMap&nbsp;content:&nbsp;\n&nbsp;"</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Loop&nbsp;through&nbsp;each&nbsp;key-value&nbsp;pair&nbsp;within&nbsp;the&nbsp;`si</span><span class="mtk9">mpleMap`.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk13">[</span><span class="mtk33">key</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">value</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">simpleMap</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;a&nbsp;"string"&nbsp;representation&nbsp;of&nbsp;the&nbsp;pair&nbsp;to&nbsp;th</span><span class="mtk9">e&nbsp;`displayText`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">displayText</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk33">key</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">":&nbsp;"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">value</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"#.##"</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"\n&nbsp;"</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Draw&nbsp;a&nbsp;`label`&nbsp;showing&nbsp;the&nbsp;`displayText`&nbsp;on&nbsp;the</span><span class="mtk9">&nbsp;current&nbsp;bar.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">x</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">y</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">displayText</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.huge</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textalign</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">text.align_left</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_label_center</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>This script uses <a href="/pine-script-docs/language/loops/#forin-loops">both forms</a> of the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop statement. The first loop iterates through the “string” elements of the <code dir="auto">newKeys</code> array to put key-value pairs into the map referenced by <code dir="auto">simpleMap</code>, and the second iterates directly through the map’s key-value pairs to construct the custom string.</li>
</ul>
<aside aria-label="Notice" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice</span></p><p>In contrast to <a href="/pine-script-docs/language/arrays/">arrays</a> and <a href="/pine-script-docs/language/matrices/">matrices</a>, <a href="/pine-script-docs/language/maps/">maps</a> cannot change in size while a script iterates through them directly using a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop. Attempting to add or remove a map’s key-value pairs while looping through it with this structure typically causes a <em>runtime error</em>.</p><br><p>To correctly modify a map’s size within a loop, programmers can do any of the following:</p><ul>
<li>Make a <a href="/pine-script-docs/language/maps/#copying-a-map">copy</a> of the map and loop through that copied instance.</li>
<li>Use a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop to iterate through the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_map.keys">map.keys()</a> <em>array</em>.</li>
<li>Use a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> or <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_while">while</a> loop instead of a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for...in">for…in</a> loop.</li>
</ul><p></p></div></aside>      </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a href="/pine-script-docs/language/conditional-structures" class="pagination-card" data-pagefind-ignore="" data-astro-cid-assl6cvf=""> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-assl6cvf="" data-icon="theme/arrow-back">  <use xlink:href="#ai:local:theme/arrow-back"></use>  </svg> Conditional structures  </h4> </a>  <a href="/pine-script-docs/language/built-ins" class="pagination-card" data-pagefind-ignore="" data-astro-cid-assl6cvf=""> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Built-ins <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-assl6cvf="" data-icon="theme/arrow">  <symbol id="ai:local:theme/arrow"><path fill="none" stroke="var(--arrow-fill-color, #131722)" d="m11 8 6 6-6 6"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use>  </svg> </h4> </a>  </div>  </main>   <div id="toc" data-pagefind-ignore="all" data-astro-cid-oor6cujd=""><aside class="document-toc-container ml-4 w-48" data-astro-cid-oor6cujd=""><section id="toc-scroll-section" class="slick-scroll" data-astro-cid-oor6cujd=""><header data-astro-cid-oor6cujd=""><h2 class="toc-header" data-astro-cid-oor6cujd="">On this page</h2></header><ul class="" id="toc-entries" data-astro-cid-oor6cujd=""><a href="#introduction" aria-current="true" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-current="" data-astro-cid-oor6cujd="">Introduction</li></a><a href="#when-loops-are-unnecessary" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">When loops are unnecessary</li></a><a href="#when-loops-are-necessary" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">When loops are necessary</li></a><a href="#common-characteristics" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">Common characteristics</li></a><a href="#structure-and-syntax" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Structure and syntax</li></a><a href="#scope" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Scope</li></a><a href="#keywords-and-return-expressions" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Keywords and return expressions</li></a><a href="#for-loops" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd=""><code>for</code> loops</li></a><a href="#while-loops" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd=""><code>while</code> loops</li></a><a href="#forin-loops" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd=""><code>for...in</code> loops</li></a><a href="#looping-through-arrays" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Looping through arrays</li></a><a href="#looping-through-matrices" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Looping through matrices</li></a><a href="#looping-through-maps" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Looping through maps</li></a></ul></section><div class="toc-bottom-fade" data-astro-cid-oor6cujd=""></div><div class="back-top-space" data-astro-cid-oor6cujd=""><div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <a id="back-top-button" title="Back to top" href="#top" data-astro-cid-pkzv2hgs="" class="floating-button not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-secondary stvb-icon stvb-icon-force-color stvb-force-no-border"> <svg width="18" height="18" viewBox="0 0 18 18" data-astro-cid-oor6cujd="" data-icon="theme/arrow-up">  <symbol id="ai:local:theme/arrow-up"><g fill="none"><g clip-path="url(#a)"><path fill="currentColor" fill-rule="evenodd" d="m9 3.5.5.44 4 3.5-1 1.12-2.75-2.4V14h-1.5V6.15L5.49 8.56l-.98-1.12 4-3.5z" clip-rule="evenodd"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h18v18H0z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/arrow-up"></use>  </svg> </a> </div> </div></aside></div> </main> </div>   <footer data-astro-cid-b6pf7ola=""> <div class="footer-content" data-astro-cid-b6pf7ola="">  <ul data-astro-cid-b6pf7ola=""> <li data-astro-cid-b6pf7ola=""> <a href="https://www.tradingview.com/chat/#BfmVowG1TZkKO235" data-astro-cid-b6pf7ola="">Pine Q&amp;A chat</a>  </li><li data-astro-cid-b6pf7ola=""> <a href="https://stackoverflow.com/questions/tagged/pine-script" data-astro-cid-b6pf7ola="">Stack Overflow</a>  ↗ </li><li data-astro-cid-b6pf7ola=""> <a href="https://t.me/PineCodersQA" data-astro-cid-b6pf7ola="">Telegram</a>  ↗ </li><li data-astro-cid-b6pf7ola=""> <a href="https://www.reddit.com/r/TradingView/" data-astro-cid-b6pf7ola="">Reddit</a>  ↗ </li> </ul> <div class="flex" data-astro-cid-b6pf7ola=""></div> <div class="copyright" data-astro-cid-b6pf7ola="">Copyright © 2025 TradingView, Inc.</div> </div> </footer>         </body></html>