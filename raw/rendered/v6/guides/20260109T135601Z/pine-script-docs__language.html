<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><script data-astro-exec="">
			const url = window.location.href;
			const expectedUrl = url.replace(
				/^https:\/\/(?!beta)(\w+\.)?tradingview\.com/,
				'https://www.tradingview.com',
			);
			if (url !== expectedUrl) {
				window.location.replace(expectedUrl);
			}
		</script><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="none"><link rel="icon" href="https://static.tradingview.com/static/images/favicon.ico"><link rel="icon" type="image/svg+xml" href="/pine-script-docs/favicon.svg"><title>Language / Execution model</title><meta name="og:title" content="Language / Execution model"><meta name="twitter:title" content="Language / Execution model"><meta name="description" content="Everything you need to know about Pine Script®."><meta name="og:description" content="Everything you need to know about Pine Script®."><meta name="twitter:description" content="Everything you need to know about Pine Script®."><meta name="keywords" content="tradingview, pine, script, indicators, strategies"><meta name="og:image" content="/pine-script-docs/meta-image.png?1"><meta name="twitter:image" content="/pine-script-docs/meta-image.png?1"><meta name="og:image:width" content="1200"><meta name="og:image:height" content="630"><meta name="og:url" content="https://www.tradingview.com/pine-script-docs/language/execution-model/"><meta name="twitter:url" content="https://www.tradingview.com/pine-script-docs/language/execution-model/"><meta name="og:type" content="website"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@TradingView"><link rel="canonical" href="https://www.tradingview.com/pine-script-docs/language/execution-model/"><link rel="sitemap" href="/pine-script-docs/sitemap-index.xml"><link rel="stylesheet" href="/pine-script-docs/_astro/index.DfaRTfPD.css">
<link rel="stylesheet" href="/pine-script-docs/_astro/index.B9ah8c5K.css">
<style>.tv-spinner{display:none;position:absolute;margin:0 auto;border:0 solid rgb(149 152 161 / 20%);border-radius:50%;border-top-color:var(--tv-spinner-color, #2962ff);border-left-color:var(--tv-spinner-color, #2962ff);animation:tv-spinner-container-rotate .9s linear infinite}.tv-spinner-shown{display:block}.tv-spinner-size-large{top:calc(50% - 32px);left:calc(50% - 32px);width:56px;height:56px;border-width:4px}@keyframes tv-spinner-container-rotate{to{transform:rotate(360deg)}}:root{--page-background-color: #fff;background-color:var(--page-background-color)}:root[data-theme=dark]{--page-background-color: #000}body{background-color:var(--page-background-color)}#redirect-link{display:flex;position:absolute;inset:0;align-items:center;justify-content:center}#spinner{display:block;position:absolute;opacity:1;transition:opacity .2s}
.twitter-tweet:not(.twitter-tweet-rendered){padding:var(--tc-padding, 1em);border:1px solid var(--tc-border-color, #cfd9de)}.twitter-tweet:not(.twitter-tweet-rendered)>:first-child{margin-top:0}.twitter-tweet:not(.twitter-tweet-rendered)>:last-child{margin-bottom:0}lite-youtube{background-color:#000;position:relative;display:block;contain:content;background-position:center center;background-size:cover;cursor:pointer;max-width:720px}lite-youtube:before{content:attr(data-title);display:block;position:absolute;top:0;background-image:linear-gradient(180deg,#000000ab,#0000008a 14%,#00000026 54%,#0000000d 72%,#0000 94%);height:99px;width:100%;font-family:YouTube Noto,Roboto,Arial,Helvetica,sans-serif;color:#eee;text-shadow:0 0 2px rgba(0,0,0,.5);font-size:18px;padding:25px 20px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;box-sizing:border-box}lite-youtube:hover:before{color:#fff}lite-youtube:after{content:"";display:block;padding-bottom:56.25%}lite-youtube>iframe{width:100%;height:100%;position:absolute;top:0;left:0;border:0}lite-youtube>.lty-playbtn{display:block;width:100%;height:100%;background:no-repeat center/68px 48px;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 68 48"><path d="M66.52 7.74c-.78-2.93-2.49-5.41-5.42-6.19C55.79.13 34 0 34 0S12.21.13 6.9 1.55c-2.93.78-4.63 3.26-5.42 6.19C.06 13.05 0 24 0 24s.06 10.95 1.48 16.26c.78 2.93 2.49 5.41 5.42 6.19C12.21 47.87 34 48 34 48s21.79-.13 27.1-1.55c2.93-.78 4.64-3.26 5.42-6.19C67.94 34.95 68 24 68 24s-.06-10.95-1.48-16.26z" fill="red"/><path d="M45 24 27 14v20" fill="white"/></svg>');position:absolute;cursor:pointer;z-index:1;filter:grayscale(100%);transition:filter .1s cubic-bezier(0,0,.2,1);border:0}lite-youtube:hover>.lty-playbtn,lite-youtube .lty-playbtn:focus{filter:none}lite-youtube.lyt-activated{cursor:unset}lite-youtube.lyt-activated:before,lite-youtube.lyt-activated>.lty-playbtn{opacity:0;pointer-events:none}.lyt-visually-hidden{clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px}lite-youtube>iframe{all:unset!important;width:100%!important;height:100%!important;position:absolute!important;inset:0!important;border:0!important}lite-vimeo{font-size:10px;background-color:#000;position:relative;display:block;contain:content;background-position:center center;background-size:cover}lite-vimeo:after{content:"";display:block;padding-bottom:56.25%}lite-vimeo>iframe{all:unset!important;width:100%!important;height:100%!important;position:absolute!important;inset:0!important;border:0!important}lite-vimeo>.ltv-playbtn{content:"";position:absolute;inset:0;width:100%;background:transparent;outline:0;border:0;cursor:pointer}lite-vimeo>.ltv-playbtn:before{width:6.5em;height:4em;background:#172322bf;opacity:.8;border-radius:.25rem;transition:all .2s cubic-bezier(0,0,.2,1)}lite-vimeo>.ltv-playbtn:focus:before{outline:auto}lite-vimeo:hover>.ltv-playbtn:before{background-color:#00adef;background-color:var(--ltv-color, #00adef);opacity:1}lite-vimeo>.ltv-playbtn:after{border-style:solid;border-width:1em 0 1em 1.7em;border-color:transparent transparent transparent #fff}lite-vimeo>.ltv-playbtn:before,lite-vimeo>.ltv-playbtn:after{content:"";position:absolute;top:50%;left:50%;transform:translate3d(-50%,-50%,0)}lite-vimeo.ltv-activated:before,lite-vimeo.ltv-activated>.ltv-playbtn{cursor:unset;opacity:0;pointer-events:none}
</style><script type="module" src="/pine-script-docs/_astro/hoisted.wfEHaJbk.js" data-astro-exec=""></script><style id="tv-pine-light" type="text/css" media="screen">.monaco-editor-tv-pine-light { 
.mtk1 { color: #131722; }
.mtk2 { color: #ffffff; }
.mtk3 { color: #808080; }
.mtk4 { color: #ff0000; }
.mtk5 { color: #0451a5; }
.mtk6 { color: #0000ff; }
.mtk7 { color: #098658; }
.mtk8 { color: #008000; }
.mtk9 { color: #9598a1; }
.mtk10 { color: #dd0000; }
.mtk11 { color: #cc2929; }
.mtk12 { color: #f57f17; }
.mtk13 { color: #000000; }
.mtk14 { color: #383838; }
.mtk15 { color: #0c3299; }
.mtk16 { color: #2962ff; }
.mtk17 { color: #8e24aa; }
.mtk18 { color: #22ab94; }
.mtk19 { color: #cd3131; }
.mtk20 { color: #863b00; }
.mtk21 { color: #af00db; }
.mtk22 { color: #800000; }
.mtk23 { color: #e00000; }
.mtk24 { color: #3030c0; }
.mtk25 { color: #666666; }
.mtk26 { color: #778899; }
.mtk27 { color: #c700c7; }
.mtk28 { color: #a31515; }
.mtk29 { color: #388e3c; }
.mtk30 { color: #4f76ac; }
.mtk31 { color: #008080; }
.mtk32 { color: #001188; }
.mtk33 { color: #2a2e39; }
.mtk34 { color: #4864aa; }
.mtki { font-style: italic; }
.mtkb { font-weight: bold; }
.mtku { text-decoration: underline; text-underline-position: under; }
.mtks { text-decoration: line-through; }
.mtks.mtku { text-decoration: underline line-through; text-underline-position: under; } }</style></head> <body> <div id="search-content-blur" hidden=""></div> <script data-astro-exec="">
	/* eslint-disable @typescript-eslint/typedef */
	window.ThemeProvider = (() => {
		function getCurrent() {
			return (
				// eslint-disable-next-line no-restricted-syntax
				typeof localStorage !== 'undefined' &&
				localStorage.getItem('tv-docs-theme')
			);
		}
		const storedTheme = getCurrent();
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ?
				'light'
			:	'dark');
		document.documentElement.dataset.theme =
			theme === 'light' ? 'light' : 'dark';
		document.documentElement.classList.toggle(
			'theme-dark',
			theme === 'dark',
		); // add support for ui-lib themes
		document.documentElement.classList.toggle(
			'sl-theme-dark',
			theme === 'dark',
		); // add support for shoelace themes

		return {
			updatePickers(themeArg = storedTheme || 'auto') {
				let currentTheme = themeArg;
				if (currentTheme === 'unknown') {
					currentTheme = getCurrent() || 'auto';
				}
				document
					.querySelectorAll('docs-theme-select')
					.forEach((picker) => {
						const select = picker.querySelector('select');
						if (select) select.value = currentTheme;
						/** @type {HTMLTemplateElement | null} */
						const tmpl = document.querySelector(`#theme-icons`);
						const newIcon =
							tmpl &&
							tmpl.content.querySelector('.' + currentTheme);
						if (newIcon) {
							const oldIcon =
								picker.querySelector('svg.label-icon');
							if (oldIcon) {
								oldIcon.replaceChildren(
									...newIcon.cloneNode(true).childNodes,
								);
							}
						}
					});
			},
		};
	})();
	/* eslint-enable @typescript-eslint/typedef */
</script><template id="theme-icons"><svg width="16" height="16" viewBox="0 0 28 28" class="light" data-icon="theme/sun-28">  <symbol id="ai:local:theme/sun-28"><g fill="currentColor"><path d="M14 3h1.5v5H14zm0 18h1.5v5H14zm12-5.5V14h-5v1.5zM8 14v1.5H3V14zm15.3-7-1-1-3.6 3.6 1.1 1 3.5-3.5ZM9.5 18.7l1.1 1.1-3.5 3.5-1-1zM22 23.3l1-1-3.6-3.6-1 1.1 3.5 3.5ZM10.3 9.6l-1.1 1-3.5-3.5 1-1z"></path><path fill-rule="evenodd" d="M19 14.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0m-1.5 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0" clip-rule="evenodd"></path></g></symbol><use xlink:href="#ai:local:theme/sun-28"></use>  </svg><svg width="16" height="16" viewBox="0 0 28 28" class="dark" data-icon="theme/moon-28">  <symbol id="ai:local:theme/moon-28"><path fill="currentColor" fill-rule="evenodd" d="M21 7.02A9.23 9.23 0 0 0 15.2 5 9.1 9.1 0 0 0 6 14c0 4.97 4.12 9 9.2 9a9.33 9.33 0 0 0 5.8-2.02A7 7 0 0 1 14.36 14 7 7 0 0 1 21 7.02m-3.95-.3a8 8 0 0 0-1.85-.22A7.6 7.6 0 0 0 7.5 14a7.6 7.6 0 0 0 7.7 7.5 8 8 0 0 0 1.85-.22A8.46 8.46 0 0 1 12.86 14c0-3.1 1.69-5.8 4.19-7.28" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/moon-28"></use>  </svg><svg width="16" height="16" viewBox="0 0 28 28" class="auto" data-icon="theme/system-28">  <symbol id="ai:local:theme/system-28"><path fill="currentColor" d="M8 4h1v2H8zm0 9v2h1v-2zm6-3V9h-2v1zM3 9v1h2V9zm5.5 3a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5m4.2-6-.7-.7-1.4 1.4.7.7zM5 13.7l-.7-.7 1.4-1.4.7.7zm7.7-.7-.7.7-1.4-1.4.7-.7zM4.3 6l.7-.7 1.4 1.4-.7.7zm3 17 14-14 .8.7L8 23.7zm17.2-.1a3.5 3.5 0 0 1-3.4-5.9H21a4 4 0 1 0 3.5 5.9"></path></symbol><use xlink:href="#ai:local:theme/system-28"></use>  </svg></template> <div class="backdrop" data-mobile-menu-backdrop="" data-astro-cid-h2irkosh=""></div> <div class="menu-container" data-astro-cid-h2irkosh=""> <div class="header" data-astro-cid-h2irkosh=""> <div class="header-group" data-astro-cid-h2irkosh=""> <div id="version-select" data-astro-cid-kx7qoxgq=""> <label style="--sl-select-width: undefined; --sl-label-icon-size: 16px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq="">Version</span>  <select value="v6" data-has-border="" no-icon="true" data-astro-cid-lmznfliq=""> <option value="v6" selected="true" data-astro-cid-lmznfliq="">Version 6</option><option value="v5" data-astro-cid-lmznfliq="">Version 5</option><option value="v4" data-astro-cid-lmznfliq="">Version 4</option><option value="v3" data-astro-cid-lmznfliq="">Version 3</option> </select> <svg width="16" height="16" viewBox="0 0 24 24" class="icon caret" data-astro-cid-lmznfliq="" data-icon="theme/down-caret">  <symbol id="ai:local:theme/down-caret"><path fill="currentColor" d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1 1 0 0 0 1.42 0L17 10.59a1 1 0 0 0 0-1.42"></path></symbol><use xlink:href="#ai:local:theme/down-caret"></use>  </svg> </label>  </div>   <docs-theme-select class="" data-astro-cid-3wpspbi7=""> <label style="--sl-select-width: 48px; --sl-label-icon-size: 28px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq="">Theme</span> <svg width="28" height="28" viewBox="0 0 28 28" class="icon label-icon" data-button="" data-round="" data-astro-cid-lmznfliq="" data-icon="theme/system-28">  <symbol id="ai:local:theme/system-28"><path fill="currentColor" d="M8 4h1v2H8zm0 9v2h1v-2zm6-3V9h-2v1zM3 9v1h2V9zm5.5 3a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5m4.2-6-.7-.7-1.4 1.4.7.7zM5 13.7l-.7-.7 1.4-1.4.7.7zm7.7-.7-.7.7-1.4-1.4.7-.7zM4.3 6l.7-.7 1.4 1.4-.7.7zm3 17 14-14 .8.7L8 23.7zm17.2-.1a3.5 3.5 0 0 1-3.4-5.9H21a4 4 0 1 0 3.5 5.9"></path></symbol><use xlink:href="#ai:local:theme/system-28"></use>  </svg> <select value="auto" data-button="" data-astro-cid-lmznfliq=""> <option value="dark" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Dark&nbsp;&nbsp;</option><option value="light" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Light&nbsp;&nbsp;</option><option value="auto" selected="true" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Auto&nbsp;&nbsp;</option> </select>  </label>  </docs-theme-select>   <script data-astro-exec="">
	ThemeProvider.updatePickers('unknown');
</script>  </div> <div class="header-group" data-astro-cid-h2irkosh="">  <div class="not-content" style="stroke-width:2px" data-astro-cid-pkzv2hgs=""> <button id="mobile-menu-back-button" title="Close menu" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-primary stvb-icon">  <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-h2irkosh="" data-icon="theme/arrow-back">  <symbol id="ai:local:theme/arrow-back"><g fill="none"><g clip-path="url(#a)"><path stroke="var(--arrow-fill-color, #131722)" d="m17 20-6-6 6-6"></path></g><defs><clipPath id="a"><path fill="#fff" d="M28 28H0V0h28z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/arrow-back"></use>  </svg>  </button> </div>  </div> </div> <aside id="nav" class="keep-visible" style="--navbar-right-border-width: 0px" data-astro-cid-sa57sq6l=""> <div class="sidebar-viewport slick-scroll" data-astro-cid-sa57sq6l=""> <div class="sidebar" data-mobile="" data-astro-cid-sa57sq6l=""> <ul class="toc" aria-label="Docs sidebar" data-astro-cid-sa57sq6l=""> <li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/welcome" data-astro-cid-omxx3dey="">Welcome to Pine Script® v6</a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Pine Script® primer</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-steps" data-astro-cid-omxx3dey="">First steps</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-indicator" data-astro-cid-omxx3dey="">First indicator</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/next-steps" data-astro-cid-omxx3dey="">Next steps</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details open="" data-is-parent="" data-is-on-path="" data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Language</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-current="" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/execution-model" data-astro-cid-omxx3dey="">Execution model</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/type-system" data-astro-cid-omxx3dey="">Type system</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/script-structure" data-astro-cid-omxx3dey="">Script structure</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/identifiers" data-astro-cid-omxx3dey="">Identifiers</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/variable-declarations" data-astro-cid-omxx3dey="">Variable declarations</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/operators" data-astro-cid-omxx3dey="">Operators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/conditional-structures" data-astro-cid-omxx3dey="">Conditional structures</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/loops" data-astro-cid-omxx3dey="">Loops</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/built-ins" data-astro-cid-omxx3dey="">Built-ins</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/user-defined-functions" data-astro-cid-omxx3dey="">User-defined functions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/objects" data-astro-cid-omxx3dey="">Objects</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/enums" data-astro-cid-omxx3dey="">Enums</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/methods" data-astro-cid-omxx3dey="">Methods</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/arrays" data-astro-cid-omxx3dey="">Arrays</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/matrices" data-astro-cid-omxx3dey="">Matrices</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/maps" data-astro-cid-omxx3dey="">Maps</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Visuals</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/overview" data-astro-cid-omxx3dey="">Overview</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/backgrounds" data-astro-cid-omxx3dey="">Backgrounds</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/bar-coloring" data-astro-cid-omxx3dey="">Bar coloring</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/bar-plotting" data-astro-cid-omxx3dey="">Bar plotting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/colors" data-astro-cid-omxx3dey="">Colors</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/fills" data-astro-cid-omxx3dey="">Fills</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/levels" data-astro-cid-omxx3dey="">Levels</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/lines-and-boxes" data-astro-cid-omxx3dey="">Lines and boxes</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/plots" data-astro-cid-omxx3dey="">Plots</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/tables" data-astro-cid-omxx3dey="">Tables</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/text-and-shapes" data-astro-cid-omxx3dey="">Text and shapes</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Concepts</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/alerts" data-astro-cid-omxx3dey="">Alerts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-states" data-astro-cid-omxx3dey="">Bar states</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/chart-information" data-astro-cid-omxx3dey="">Chart information</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/inputs" data-astro-cid-omxx3dey="">Inputs</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/libraries" data-astro-cid-omxx3dey="">Libraries</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/non-standard-charts-data" data-astro-cid-omxx3dey="">Non-standard charts data</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/other-timeframes-and-data" data-astro-cid-omxx3dey="">Other timeframes and data</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/repainting" data-astro-cid-omxx3dey="">Repainting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/sessions" data-astro-cid-omxx3dey="">Sessions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strategies" data-astro-cid-omxx3dey="">Strategies</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strings" data-astro-cid-omxx3dey="">Strings</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/time" data-astro-cid-omxx3dey="">Time</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/timeframes" data-astro-cid-omxx3dey="">Timeframes</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Writing scripts</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/style-guide" data-astro-cid-omxx3dey="">Style guide</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/debugging" data-astro-cid-omxx3dey="">Debugging</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/profiling-and-optimization" data-astro-cid-omxx3dey="">Profiling and optimization</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/publishing" data-astro-cid-omxx3dey="">Publishing scripts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/limitations" data-astro-cid-omxx3dey="">Limitations</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">FAQ</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/general" data-astro-cid-omxx3dey="">General</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/alerts" data-astro-cid-omxx3dey="">Alerts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/data-structures" data-astro-cid-omxx3dey="">Data structures</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/functions" data-astro-cid-omxx3dey="">Functions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/indicators" data-astro-cid-omxx3dey="">Indicators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/other-data-and-timeframes" data-astro-cid-omxx3dey="">Other data and timeframes</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/programming" data-astro-cid-omxx3dey="">Programming</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/strategies" data-astro-cid-omxx3dey="">Strategies</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/strings-and-formatting" data-astro-cid-omxx3dey="">Strings and formatting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/techniques" data-astro-cid-omxx3dey="">Techniques</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/times-dates-and-sessions" data-astro-cid-omxx3dey="">Times, dates, and sessions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/variables-and-operators" data-astro-cid-omxx3dey="">Variables and operators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/visuals" data-astro-cid-omxx3dey="">Visuals</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/error-messages" data-astro-cid-omxx3dey="">Error messages</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/release-notes" data-astro-cid-omxx3dey="">Release notes</a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Migration guides</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/overview" data-astro-cid-omxx3dey="">Overview</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-6" data-astro-cid-omxx3dey="">To Pine Script® version 6</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-5" data-astro-cid-omxx3dey="">To Pine Script® version 5</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-4" data-astro-cid-omxx3dey="">To Pine Script® version 4</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-3" data-astro-cid-omxx3dey="">To Pine Script® version 3</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-2" data-astro-cid-omxx3dey="">To Pine Script® version 2</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/where-can-i-get-more-information" data-astro-cid-omxx3dey="">Where can I get more information?</a></li> </ul> <div class="toc-bottom" data-astro-cid-sa57sq6l=""></div> </div> </div> </aside>  </div>   <header class="header" data-astro-cid-d74r2unp=""> <nav role="navigation" aria-label="Main Navigation" data-astro-cid-d74r2unp=""> <mobile-menu-button id="mobile-menu-button-wc" data-astro-cid-oojooh3d=""> <!-- Annoyingly I need to wrap this. TODO: improve this --> <div id="mobile-menu-button-header" data-astro-cid-oojooh3d=""> <div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <button title="Open navigation menu" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-secondary stvb-icon stvb-icon-force-color stvb-force-no-border">  <svg width="28" height="28" viewBox="0 0 24 24" data-astro-cid-oojooh3d="" data-icon="theme/bars">  <symbol id="ai:local:theme/bars"><path fill="currentColor" d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2m18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2m0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2"></path></symbol><use xlink:href="#ai:local:theme/bars"></use>  </svg>  </button> </div>  </div> </mobile-menu-button>   <div data-hide-when-search="" data-astro-cid-d74r2unp=""> <div class="header-logo" data-astro-cid-tycb33lk=""> <a href="/pine-script-docs/" aria-label="Home button" data-astro-cid-tycb33lk=""> <div class="documentation-logo logo" data-astro-cid-tycb33lk=""><!-- Old Christmas icon -->
<!-- 
<svg width="184" height="44" viewBox="0 0 184 44" fill="none" xmlns="http://www.w3.org/2000/svg">
	<path fill-rule="evenodd" clip-rule="evenodd" d="M33.8209 5.1219C33.885 4.95937 34.115 4.95937 34.1791 5.1219L35.2253 7.77465L37.8781 8.82088C38.0406 8.88499 38.0406 9.11501 37.8781 9.17912L35.2253 10.2253L34.1791 12.8781C34.115 13.0406 33.885 13.0406 33.8209 12.8781L32.7747 10.2253L30.1219 9.17912C29.9594 9.11501 29.9594 8.88499 30.1219 8.82088L32.7747 7.77465L33.8209 5.1219Z" fill="#F9A825"/>
    <path d="M5.30092 15.1478C5.37479 14.9605 5.63986 14.9605 5.71373 15.1478L6.60557 17.4091L8.86685 18.3009C9.05415 18.3748 9.05415 18.6399 8.86685 18.7137L6.60557 19.6056L5.71373 21.8669C5.63986 22.0541 5.37479 22.0541 5.30092 21.8669L4.40908 19.6056L2.1478 18.7137C1.9605 18.6399 1.9605 18.3748 2.1478 18.3009L4.40908 17.4091L5.30092 15.1478Z" fill="#F9A825"/>
    <path d="M11.8231 3.12041C11.8864 2.95986 12.1136 2.95986 12.1769 3.12041L12.9414 5.05865L14.8796 5.82308C15.0401 5.8864 15.0401 6.1136 14.8796 6.17692L12.9414 6.94135L12.1769 8.87959C12.1136 9.04014 11.8864 9.04014 11.8231 8.87959L11.0586 6.94135L9.12041 6.17692C8.95986 6.1136 8.95986 5.8864 9.12041 5.82308L11.0586 5.05865L11.8231 3.12041Z" fill="#F9A825"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M22.6478 7.35459L34.7627 21.6923C35.1531 22.1543 35.0472 22.8544 34.5376 23.1802L26.9989 28.0001L18.4281 20.7531L11.3382 23.2611C10.402 23.5923 9.60771 22.5041 10.2085 21.7134L21.0877 7.39502C21.4749 6.88536 22.2346 6.86567 22.6478 7.35459ZM33.432 28.0842L38.3592 34.7471C38.7427 35.2657 38.3724 36 37.7274 36H6.27248C5.62746 36 5.25722 35.2657 5.64074 34.7471L10.8523 27.6996C10.9484 27.5697 11.0822 27.4725 11.2356 27.4214L17.6878 25.2707C17.9285 25.1904 18.1932 25.2314 18.3984 25.3806L26.2854 31.1166C26.5445 31.3051 26.8922 31.3173 27.1639 31.1475L32.3838 27.885C32.7316 27.6677 33.1881 27.7544 33.432 28.0842Z" fill="#089981"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M17.6363 11.9375C20.7386 12.451 23.1213 11.505 24.9187 10.0422L25.8869 11.1881C23.6236 13.0379 20.553 14.1584 16.6261 13.267L17.6363 11.9375ZM34.0572 20.8573C30.0669 21.363 26.2864 20.8179 23.1264 19.7076C20.7393 18.8689 18.6873 17.7013 17.155 16.3997C16.5283 15.8674 15.9767 15.3021 15.5241 14.7174L16.4708 13.4713C16.8706 14.0544 17.4225 14.6588 18.1262 15.2565C19.5001 16.4237 21.3856 17.5061 23.6236 18.2924C26.3235 19.241 29.5087 19.7493 32.8863 19.4716L34.0572 20.8573ZM9.06812 30.1123C15.4775 33.3909 23.0493 33.8897 29.0345 32.0941C31.0827 31.4796 32.9275 30.6019 34.4713 29.4897L35.3633 30.6959C33.6586 31.9268 31.6497 32.8756 29.4655 33.5309C23.053 35.4546 14.9758 34.8964 8.16479 31.3339L9.06812 30.1123Z" fill="#45E5CB"/>
    <path d="M55.56 13.96C59.016 13.96 61.536 16.456 61.536 19.696C61.536 22.936 59.016 25.432 55.56 25.432H53.376V31H49.896V13.96H55.56ZM55.512 22.168C57.096 22.168 58.152 21.088 58.152 19.696C58.152 18.304 57.096 17.224 55.512 17.224H53.376V22.168H55.512ZM66.8636 14.944C66.8636 16.096 65.9276 17.032 64.7516 17.032C63.6236 17.032 62.6636 16.096 62.6636 14.944C62.6636 13.792 63.6236 12.856 64.7516 12.856C65.9276 12.856 66.8636 13.792 66.8636 14.944ZM63.1196 31V19H66.4076V31H63.1196ZM69.0849 31V19H72.3729V20.368C72.9969 19.408 74.2449 18.736 75.8049 18.736C78.7089 18.736 80.4369 20.848 80.4369 23.968V31H77.1489V24.52C77.1489 22.792 76.4049 21.736 75.0369 21.736C73.5249 21.736 72.3729 22.84 72.3729 25.144V31H69.0849ZM82.2041 25C82.2041 21.448 84.8681 18.736 88.5161 18.736C91.6601 18.736 94.4201 20.752 94.4201 24.64C94.4201 24.928 94.4201 25.264 94.3721 25.768H85.3961C85.5881 27.376 87.0041 28.264 88.5881 28.264C90.0761 28.264 91.1561 27.568 91.6841 26.752L94.1321 28.576C93.0281 30.184 91.0841 31.264 88.5641 31.264C84.9881 31.264 82.2041 28.792 82.2041 25ZM88.4201 21.448C87.1961 21.448 85.8281 22.072 85.5161 23.536H91.1321C90.8441 22.12 89.6441 21.448 88.4201 21.448ZM100.412 28.24L103.076 26.008C103.916 27.28 105.38 28.024 106.772 28.024C108.14 28.024 109.052 27.352 109.052 26.368C109.052 25.408 108.356 24.736 106.676 24.16L105.236 23.656C102.5 22.696 101.036 21.112 101.036 18.784C101.036 15.568 103.484 13.672 106.796 13.672C108.884 13.672 110.708 14.392 112.172 16.024L109.868 18.4C109.052 17.416 107.996 16.936 106.82 16.936C105.644 16.936 104.54 17.44 104.54 18.448C104.54 19.48 105.38 19.936 107.18 20.584L108.548 21.088C111.044 22 112.604 23.584 112.604 26.152C112.58 29.2 110.156 31.288 106.628 31.288C103.916 31.288 101.636 30.112 100.412 28.24ZM125.859 27.808C124.827 29.872 122.667 31.264 120.171 31.264C116.619 31.264 113.811 28.624 113.811 25C113.811 21.376 116.619 18.736 120.171 18.736C122.667 18.736 124.827 20.128 125.859 22.192L123.003 23.728C122.523 22.624 121.491 21.808 120.171 21.808C118.443 21.808 117.123 23.152 117.123 25C117.123 26.848 118.443 28.192 120.171 28.192C121.491 28.192 122.523 27.376 123.003 26.272L125.859 27.808ZM127.482 31V19H130.77V20.92C131.178 19.744 132.402 18.856 133.746 18.856C134.082 18.856 134.442 18.88 134.85 19V22.336C134.346 22.168 133.89 22.072 133.362 22.072C131.802 22.072 130.77 23.296 130.77 25.264V31H127.482ZM140.215 14.944C140.215 16.096 139.279 17.032 138.103 17.032C136.975 17.032 136.015 16.096 136.015 14.944C136.015 13.792 136.975 12.856 138.103 12.856C139.279 12.856 140.215 13.792 140.215 14.944ZM136.471 31V19H139.759V31H136.471ZM142.436 36.016V19H145.724V20.344C146.276 19.576 147.548 18.736 149.204 18.736C152.396 18.736 154.844 21.592 154.844 25C154.844 28.408 152.396 31.264 149.204 31.264C147.548 31.264 146.276 30.424 145.724 29.656V36.016H142.436ZM151.508 25C151.508 23.128 150.284 21.736 148.484 21.736C146.684 21.736 145.46 23.128 145.46 25C145.46 26.872 146.684 28.264 148.484 28.264C150.284 28.264 151.508 26.872 151.508 25ZM164.407 30.88C163.879 31.048 163.231 31.144 162.319 31.144C159.775 31.144 157.735 29.728 157.735 26.8V21.88H155.311V19H157.735V15.664H161.023V19H164.407V21.88H161.023V26.152C161.023 27.616 161.647 28.192 163.063 28.192C163.591 28.192 164.023 28.12 164.407 27.976V30.88ZM173.626 22.648V13.96H175.978L177.874 16.888L179.746 13.96H182.122V22.648H179.698V18.184L177.874 20.968L176.026 18.136V22.648H173.626ZM167.386 22.648V16.456H165.058V13.96H172.258V16.456H169.93V22.648H167.386Z" fill="currentColor"/>
</svg> -->



<!-- Regular icon -->

<svg width="177" height="44" viewBox="0 0 177 44" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M17.6876 25.2705C17.9283 25.1902 18.1933 25.2316 18.3985 25.3808L26.2852 31.1162C26.5444 31.3047 26.8924 31.3173 27.1641 31.1474L32.3839 27.8847C32.7316 27.6675 33.1878 27.7545 33.4317 28.084L38.3594 34.7471C38.7428 35.2656 38.3725 35.9999 37.7276 36H6.27253C5.62754 36 5.25723 35.2657 5.64069 34.7471L10.8526 27.6992C10.9486 27.5695 11.0824 27.4729 11.2354 27.4219L17.6876 25.2705ZM21.088 7.39451C21.4752 6.88532 22.2345 6.8659 22.6475 7.35448L34.7628 21.6924C35.1531 22.1544 35.0468 22.8548 34.5372 23.1806L26.9991 28L18.4278 20.7529L11.338 23.2607C10.4021 23.5917 9.60809 22.5044 10.2081 21.7139L21.088 7.39451ZM13.8243 20.2597L17.7608 18.8672C18.4309 18.6301 19.1771 18.7667 19.7198 19.2256L27.1641 25.5205L32.4981 22.1103L21.9259 9.59862L13.8243 20.2597Z" fill="currentColor"></path>
<path d="M147.308 16.959C150.499 16.959 152.948 19.8149 152.948 23.2227C152.948 26.6307 150.5 29.4873 147.308 29.4873C145.652 29.4872 144.38 28.6469 143.828 27.8789V34.2393H140.54V17.2227H143.828V18.5674C144.38 17.7994 145.652 16.9591 147.308 16.959ZM104.9 11.8955C106.988 11.8956 108.812 12.6152 110.276 14.2471L107.972 16.623C107.156 15.6392 106.1 15.1592 104.924 15.1592C103.748 15.1592 102.645 15.6631 102.645 16.6709C102.645 17.7029 103.484 18.1596 105.284 18.8076L106.652 19.3115C109.148 20.2235 110.708 21.8072 110.708 24.375C110.684 27.4229 108.26 29.5106 104.732 29.5107C102.02 29.5107 99.7396 28.3349 98.5156 26.4629L101.18 24.2314C102.02 25.5034 103.484 26.247 104.876 26.2471C106.244 26.2471 107.156 25.5748 107.156 24.5908C107.156 23.631 106.46 22.9587 104.78 22.3828L103.34 21.8789C100.604 20.9189 99.1396 19.3348 99.1396 17.0068C99.1398 13.791 101.588 11.8955 104.9 11.8955ZM86.6201 16.959C89.7641 16.959 92.5244 18.9753 92.5244 22.8633C92.5244 23.1513 92.5246 23.4873 92.4766 23.9912H83.5C83.692 25.5992 85.1084 26.4873 86.6924 26.4873C88.18 26.4872 89.26 25.7914 89.7881 24.9756L92.2363 26.7988C91.1323 28.4068 89.188 29.4873 86.668 29.4873C83.092 29.4872 80.3086 27.0146 80.3086 23.2227C80.3088 19.6709 82.9723 16.959 86.6201 16.959ZM118.275 16.959C120.771 16.9591 122.931 18.3512 123.963 20.415L121.107 21.9512C120.627 20.8473 119.595 20.0314 118.275 20.0312C116.548 20.0312 115.227 21.3749 115.227 23.2227C115.227 25.0707 116.547 26.415 118.275 26.415C119.595 26.4149 120.627 25.599 121.107 24.4951L123.963 26.0312C122.931 28.0951 120.771 29.4872 118.275 29.4873C114.723 29.4873 111.915 26.8467 111.915 23.2227C111.915 19.5989 114.724 16.959 118.275 16.959ZM159.127 17.2227H162.511V20.1035H159.127V24.375C159.127 25.839 159.751 26.415 161.167 26.415C161.695 26.415 162.127 26.3432 162.511 26.1992V29.1035C161.983 29.2715 161.335 29.3672 160.423 29.3672C157.879 29.3672 155.839 27.9512 155.839 25.0234V20.1035H153.415V17.2227H155.839V13.8867H159.127V17.2227ZM53.6641 12.1836C57.12 12.1836 59.6395 14.6791 59.6396 17.9189C59.6396 21.1589 57.12 23.6552 53.6641 23.6553H51.4805V29.2227H48V12.1836H53.6641ZM64.5117 29.2227H61.2236V17.2227H64.5117V29.2227ZM73.9092 16.959C76.813 16.9591 78.541 19.0715 78.541 22.1914V29.2227H75.2529V22.7432C75.2529 21.0152 74.5086 19.959 73.1406 19.959C71.6288 19.9591 70.4766 21.0633 70.4766 23.3672V29.2227H67.1885V17.2227H70.4766V18.5908C71.1006 17.6308 72.3492 16.959 73.9092 16.959ZM131.85 17.0791C132.186 17.0791 132.546 17.1027 132.954 17.2227V20.5596C132.45 20.3916 131.994 20.2949 131.466 20.2949C129.906 20.2949 128.874 21.5193 128.874 23.4873V29.2227H125.586V17.2227H128.874V19.1436C129.282 17.9676 130.506 17.0792 131.85 17.0791ZM137.862 29.2227H134.574V17.2227H137.862V29.2227ZM146.588 19.959C144.788 19.959 143.564 21.3509 143.563 23.2227C143.563 25.0947 144.788 26.4873 146.588 26.4873C148.388 26.4873 149.612 25.0947 149.612 23.2227C149.612 21.3509 148.388 19.959 146.588 19.959ZM169.993 9.76074C170.876 9.76079 171.697 9.9237 172.455 10.25C173.213 10.5764 173.881 11.0326 174.457 11.6182C175.043 12.1942 175.499 12.8617 175.825 13.6201C176.151 14.3783 176.314 15.1991 176.314 16.082C176.314 16.9556 176.152 17.7769 175.825 18.5449C175.499 19.3032 175.043 19.975 174.457 20.5605C173.881 21.1365 173.208 21.5877 172.44 21.9141C171.682 22.2404 170.867 22.4042 169.993 22.4043C169.12 22.4043 168.298 22.2405 167.53 21.9141C166.772 21.5877 166.1 21.1365 165.515 20.5605C164.939 19.975 164.488 19.3032 164.161 18.5449C163.835 17.7769 163.671 16.9556 163.671 16.082C163.671 15.2086 163.835 14.393 164.161 13.6348C164.488 12.8668 164.939 12.1942 165.515 11.6182C166.1 11.0327 166.772 10.5764 167.53 10.25C168.298 9.92362 169.12 9.76074 169.993 9.76074ZM86.5244 19.6709C85.3005 19.6709 83.9323 20.295 83.6201 21.7588H89.2363C88.9482 20.3431 87.7482 19.671 86.5244 19.6709ZM169.993 11.1865C169.312 11.1865 168.672 11.3109 168.077 11.5605C167.492 11.8101 166.974 12.1612 166.522 12.6123C166.071 13.0635 165.72 13.5865 165.471 14.1816C165.221 14.7671 165.097 15.4006 165.097 16.082C165.097 16.7634 165.221 17.402 165.471 17.9971C165.72 18.5827 166.071 19.1015 166.522 19.5527C166.974 20.0038 167.492 20.3539 168.077 20.6035C168.672 20.8531 169.312 20.9785 169.993 20.9785C170.675 20.9785 171.308 20.8531 171.894 20.6035C172.489 20.3539 173.012 20.0038 173.463 19.5527C173.914 19.1015 174.265 18.5827 174.515 17.9971C174.764 17.402 174.889 16.7634 174.889 16.082C174.889 15.4006 174.764 14.7671 174.515 14.1816C174.265 13.5865 173.914 13.0635 173.463 12.6123C173.012 12.1611 172.489 11.8101 171.894 11.5605C171.308 11.311 170.675 11.1866 169.993 11.1865ZM51.4805 20.3916H53.6162C55.2001 20.3915 56.2559 19.3109 56.2559 17.9189C56.2558 16.5271 55.2 15.4474 53.6162 15.4473H51.4805V20.3916ZM169.878 13.2314C170.406 13.2315 170.838 13.2932 171.174 13.418C171.519 13.5332 171.773 13.7163 171.937 13.9658C172.1 14.2154 172.182 14.5271 172.182 14.9014C172.182 15.2469 172.09 15.5494 171.908 15.8086C171.726 16.0581 171.481 16.2646 171.174 16.4277L172.815 18.9336H171.217L169.964 16.8027H169.445V18.9336H168.034V13.2314H169.878ZM169.445 15.751H169.849C170.127 15.751 170.348 15.6932 170.511 15.5781C170.674 15.4533 170.756 15.247 170.756 14.959C170.756 14.7383 170.684 14.5703 170.54 14.4551C170.396 14.3399 170.165 14.2822 169.849 14.2822H169.445V15.751ZM62.8555 11.0791C64.0314 11.0791 64.9677 12.0151 64.9678 13.167C64.9678 14.319 64.0315 15.2549 62.8555 15.2549C61.7275 15.2548 60.7676 14.3189 60.7676 13.167C60.7677 12.0151 61.7276 11.0792 62.8555 11.0791ZM136.207 11.0791C137.383 11.0793 138.318 12.0152 138.318 13.167C138.318 14.3188 137.383 15.2546 136.207 15.2549C135.079 15.2549 134.118 14.319 134.118 13.167C134.118 12.0151 135.079 11.0791 136.207 11.0791Z" fill="currentColor"></path>
</svg>
</div> </a> </div>  </div> <div class="flex" data-astro-cid-d74r2unp=""></div> <div class="flex" data-astro-cid-d74r2unp=""> <div class="search-container" data-astro-cid-fg37foga=""> <div class="search-wrapper" data-astro-cid-fg37foga=""> <input class="search-input" type="text" placeholder="Search docs" name="s" value="" data-astro-cid-fg37foga="" data-has-input-listener="true"> <svg width="28" height="28" viewBox="0 0 28 28" class="search-button" data-astro-cid-fg37foga="" data-icon="theme/search">  <symbol id="ai:local:theme/search"><path fill="currentColor" fill-rule="evenodd" d="M18.5 12.5a6 6 0 1 1-12 0 6 6 0 0 1 12 0m-1.25 5.8a7.5 7.5 0 1 1 1.06-1.06l4.22 4.23.53.53L22 23.06l-.53-.53-4.22-4.22Z" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/search"></use>  </svg> <button class="search-clear" type="button" title="Reset" data-search-clear="" data-astro-cid-fg37foga="">Clear</button> <span class="divider" data-astro-cid-fg37foga=""></span> <button class="search-close" type="button" title="Close" data-search-close="" data-astro-cid-fg37foga=""> <svg width="18" height="18" viewBox="0 0 18 18" data-astro-cid-fg37foga="" data-icon="theme/cross-18">  <use xlink:href="#ai:local:theme/cross-18"></use>  </svg> </button> </div> <div id="search-results-wrapper" data-astro-cid-fg37foga=""> <aside id="search-results" hidden="" data-astro-cid-fg37foga="" data-has-button-listener="true"> <!-- Don't use h1 because when built it will be used as the first heading on the page --> <div class="heading" data-astro-cid-fg37foga="">Search results</div> <div id="search-results-contents" data-astro-cid-fg37foga=""></div> </aside> </div> </div>   </div> <ul class="links" data-astro-cid-d74r2unp="">  </ul> <div class="flex" data-astro-cid-d74r2unp=""></div> <div data-hide-when-search="" data-astro-cid-d74r2unp=""> <div id="version-select" data-hideable="true" data-astro-cid-kx7qoxgq=""> <label style="--sl-select-width: undefined; --sl-label-icon-size: 16px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq="">Version</span>  <select value="v6" data-has-border="" no-icon="true" data-astro-cid-lmznfliq=""> <option value="v6" selected="true" data-astro-cid-lmznfliq="">Version 6</option><option value="v5" data-astro-cid-lmznfliq="">Version 5</option><option value="v4" data-astro-cid-lmznfliq="">Version 4</option><option value="v3" data-astro-cid-lmznfliq="">Version 3</option> </select> <svg width="16" height="16" viewBox="0 0 24 24" class="icon caret" data-astro-cid-lmznfliq="" data-icon="theme/down-caret">  <use xlink:href="#ai:local:theme/down-caret"></use>  </svg> </label>  </div>   </div> <button id="search-button" data-astro-cid-6zeqadij="" data-has-listener="true"> <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-6zeqadij="" data-icon="theme/search">  <use xlink:href="#ai:local:theme/search"></use>  </svg> </button>  <script data-base-url="/pine-script-docs" data-astro-exec="">
	async function loadPageFind() {
		const base = document.currentScript.getAttribute('data-base-url');
		const pageFindBundleUrl = `${base}/pagefind/`;
		const pagefind = await import(`${pageFindBundleUrl}pagefind.js`);
		await pagefind.options({
			bundlePath: pageFindBundleUrl,
		});
		window.pagefind = pagefind;
	}
	loadPageFind().catch();
</script>  <docs-theme-select class="hide-with-breakpoint-568" data-astro-cid-3wpspbi7=""> <label style="--sl-select-width: 48px; --sl-label-icon-size: 28px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq="">Theme</span> <svg width="28" height="28" viewBox="0 0 28 28" class="icon label-icon" data-button="" data-round="" data-astro-cid-lmznfliq="" data-icon="theme/system-28">  <symbol id="ai:local:theme/system-28"><path fill="currentColor" d="M8 4h1v2H8zm0 9v2h1v-2zm6-3V9h-2v1zM3 9v1h2V9zm5.5 3a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5m4.2-6-.7-.7-1.4 1.4.7.7zM5 13.7l-.7-.7 1.4-1.4.7.7zm7.7-.7-.7.7-1.4-1.4.7-.7zM4.3 6l.7-.7 1.4 1.4-.7.7zm3 17 14-14 .8.7L8 23.7zm17.2-.1a3.5 3.5 0 0 1-3.4-5.9H21a4 4 0 1 0 3.5 5.9"></path></symbol><use xlink:href="#ai:local:theme/system-28"></use>  </svg> <select value="auto" data-button="" data-astro-cid-lmznfliq=""> <option value="dark" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Dark&nbsp;&nbsp;</option><option value="light" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Light&nbsp;&nbsp;</option><option value="auto" selected="true" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Auto&nbsp;&nbsp;</option> </select>  </label>  </docs-theme-select>   <script data-astro-exec="">
	ThemeProvider.updatePickers('unknown');
</script>  </nav> </header>        <div id="image-lightbox" class="not-content" hidden="" data-astro-cid-kws7taxh=""> <div class="button-wrapper" data-astro-cid-kws7taxh=""> <div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <button id="lightbox-close-button" title="Close image preview" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-black stvb-medium stvb-secondary stvb-icon stvb-force-no-border">  <svg width="24" height="24" viewBox="0 0 18 18" data-astro-cid-kws7taxh="" data-icon="theme/cross-18">  <symbol id="ai:local:theme/cross-18"><g fill="none"><g clip-path="url(#a)"><path fill="currentColor" fill-rule="evenodd" d="M5.53 4.47 4.47 5.53 7.94 9l-3.47 3.47 1.06 1.06L9 10.06l3.47 3.47 1.06-1.06L10.06 9l3.47-3.47-1.06-1.06L9 7.94z" clip-rule="evenodd"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h18v18H0z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/cross-18"></use>  </svg>  </button> </div>  </div> <img id="lightbox-image" src="" data-astro-cid-kws7taxh=""> </div>   <div id="page-container" data-astro-cid-xgirumru=""> <aside id="nav" class="" style="" data-astro-cid-sa57sq6l=""> <div class="sidebar-viewport slick-scroll" data-astro-cid-sa57sq6l=""> <div class="sidebar" data-astro-cid-sa57sq6l=""> <ul class="toc" aria-label="Docs sidebar" data-astro-cid-sa57sq6l=""> <li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/welcome" data-astro-cid-omxx3dey="">Welcome to Pine Script® v6</a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Pine Script® primer</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <symbol id="ai:local:theme/right-caret"><path fill="currentColor" d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1 1 0 0 0 0-1.42"></path></symbol><use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-steps" data-astro-cid-omxx3dey="">First steps</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-indicator" data-astro-cid-omxx3dey="">First indicator</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/next-steps" data-astro-cid-omxx3dey="">Next steps</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details open="" data-is-parent="" data-is-on-path="" data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Language</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-current="" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/execution-model" data-astro-cid-omxx3dey="">Execution model</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/type-system" data-astro-cid-omxx3dey="">Type system</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/script-structure" data-astro-cid-omxx3dey="">Script structure</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/identifiers" data-astro-cid-omxx3dey="">Identifiers</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/variable-declarations" data-astro-cid-omxx3dey="">Variable declarations</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/operators" data-astro-cid-omxx3dey="">Operators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/conditional-structures" data-astro-cid-omxx3dey="">Conditional structures</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/loops" data-astro-cid-omxx3dey="">Loops</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/built-ins" data-astro-cid-omxx3dey="">Built-ins</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/user-defined-functions" data-astro-cid-omxx3dey="">User-defined functions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/objects" data-astro-cid-omxx3dey="">Objects</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/enums" data-astro-cid-omxx3dey="">Enums</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/methods" data-astro-cid-omxx3dey="">Methods</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/arrays" data-astro-cid-omxx3dey="">Arrays</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/matrices" data-astro-cid-omxx3dey="">Matrices</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/maps" data-astro-cid-omxx3dey="">Maps</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Visuals</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/overview" data-astro-cid-omxx3dey="">Overview</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/backgrounds" data-astro-cid-omxx3dey="">Backgrounds</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/bar-coloring" data-astro-cid-omxx3dey="">Bar coloring</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/bar-plotting" data-astro-cid-omxx3dey="">Bar plotting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/colors" data-astro-cid-omxx3dey="">Colors</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/fills" data-astro-cid-omxx3dey="">Fills</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/levels" data-astro-cid-omxx3dey="">Levels</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/lines-and-boxes" data-astro-cid-omxx3dey="">Lines and boxes</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/plots" data-astro-cid-omxx3dey="">Plots</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/tables" data-astro-cid-omxx3dey="">Tables</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/text-and-shapes" data-astro-cid-omxx3dey="">Text and shapes</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Concepts</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/alerts" data-astro-cid-omxx3dey="">Alerts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-states" data-astro-cid-omxx3dey="">Bar states</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/chart-information" data-astro-cid-omxx3dey="">Chart information</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/inputs" data-astro-cid-omxx3dey="">Inputs</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/libraries" data-astro-cid-omxx3dey="">Libraries</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/non-standard-charts-data" data-astro-cid-omxx3dey="">Non-standard charts data</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/other-timeframes-and-data" data-astro-cid-omxx3dey="">Other timeframes and data</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/repainting" data-astro-cid-omxx3dey="">Repainting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/sessions" data-astro-cid-omxx3dey="">Sessions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strategies" data-astro-cid-omxx3dey="">Strategies</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strings" data-astro-cid-omxx3dey="">Strings</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/time" data-astro-cid-omxx3dey="">Time</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/timeframes" data-astro-cid-omxx3dey="">Timeframes</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Writing scripts</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/style-guide" data-astro-cid-omxx3dey="">Style guide</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/debugging" data-astro-cid-omxx3dey="">Debugging</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/profiling-and-optimization" data-astro-cid-omxx3dey="">Profiling and optimization</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/publishing" data-astro-cid-omxx3dey="">Publishing scripts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/limitations" data-astro-cid-omxx3dey="">Limitations</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">FAQ</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/general" data-astro-cid-omxx3dey="">General</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/alerts" data-astro-cid-omxx3dey="">Alerts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/data-structures" data-astro-cid-omxx3dey="">Data structures</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/functions" data-astro-cid-omxx3dey="">Functions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/indicators" data-astro-cid-omxx3dey="">Indicators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/other-data-and-timeframes" data-astro-cid-omxx3dey="">Other data and timeframes</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/programming" data-astro-cid-omxx3dey="">Programming</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/strategies" data-astro-cid-omxx3dey="">Strategies</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/strings-and-formatting" data-astro-cid-omxx3dey="">Strings and formatting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/techniques" data-astro-cid-omxx3dey="">Techniques</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/times-dates-and-sessions" data-astro-cid-omxx3dey="">Times, dates, and sessions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/variables-and-operators" data-astro-cid-omxx3dey="">Variables and operators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/visuals" data-astro-cid-omxx3dey="">Visuals</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/error-messages" data-astro-cid-omxx3dey="">Error messages</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/release-notes" data-astro-cid-omxx3dey="">Release notes</a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Migration guides</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/overview" data-astro-cid-omxx3dey="">Overview</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-6" data-astro-cid-omxx3dey="">To Pine Script® version 6</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-5" data-astro-cid-omxx3dey="">To Pine Script® version 5</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-4" data-astro-cid-omxx3dey="">To Pine Script® version 4</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-3" data-astro-cid-omxx3dey="">To Pine Script® version 3</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-2" data-astro-cid-omxx3dey="">To Pine Script® version 2</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/where-can-i-get-more-information" data-astro-cid-omxx3dey="">Where can I get more information?</a></li> </ul> <div class="toc-bottom" data-astro-cid-sa57sq6l=""></div> </div> </div> </aside>  <main class="main-pane" data-page-type="md" data-astro-cid-xgirumru=""> <a id="top" data-astro-cid-xgirumru=""></a> <main class="content" data-toc-shown="" data-astro-cid-ju3wuhkz="">  <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-pagefind-ignore="" data-astro-cid-wlavna2o=""> <a href="/pine-script-docs" aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o=""> <span data-astro-cid-wlavna2o="">User Manual</span>  </a>  <span class="divider" data-astro-cid-wlavna2o="">/</span> <a href="/pine-script-docs/language/execution-model" data-astro-cid-wlavna2o="">Language</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Execution model</span> </div>     </div> <div id="slot-container" data-astro-cid-xgirumru=""> <h1 id="execution-model" class="md-heading"><a href="#execution-model">Execution <span class="fancy-wrap">model<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h1>
<h2 id="introduction" class="md-heading"><a href="#introduction"> <span class="fancy-wrap">Introduction<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p>Pine Script® relies on an event-driven, sequential execution model to control how a script’s compiled source code runs in charts, <a href="/pine-script-docs/concepts/alerts/">alerts</a>, <a href="https://www.tradingview.com/support/solutions/43000666199-what-is-deep-backtesting/">Deep Backtesting</a> mode, and the <a href="https://www.tradingview.com/support/solutions/43000742436-tradingview-pine-screener-key-features-and-requirements/">Pine Screener</a>.</p>
<p>In contrast to the traditional execution model of most programming languages, Pine’s runtime system executes a script <em>repeatedly</em> on the sequence of <em>historical bars</em> and <em>realtime ticks</em> in the dataset on which it runs, performing <em>separate</em> calculations for <em>each bar</em> as it progresses. After each execution on a closed bar, the necessary data from that execution becomes part of an internal <a href="/pine-script-docs/language/execution-model/#time-series">time series</a>, and the script can use that data in its calculations on subsequent bars.</p>
<p>This combination of sequential executions and storage enables programmers to use minimal code to write scripts with dynamic calculations that advance across a dataset bar by bar.</p>
<p>The execution model and time series structure closely connect to the <a href="/pine-script-docs/language/type-system/">type system</a> — together, they define how a script behaves as it runs on a dataset. Although it’s possible to write simple scripts without understanding these foundational topics, learning about them and their nuances is key to becoming proficient in Pine Script.</p>
<p>This page explains the execution model in two parts: <a href="/pine-script-docs/language/execution-model/#the-basics">The basics</a> and <a href="/pine-script-docs/language/execution-model/#the-details">The details</a>. The first part provides quick, actionable information about the model for beginners. The second part offers an <em>advanced</em>, in-depth breakdown of the model’s workings and unique behaviors. To make the most of the information on this page, we recommend that newcomers to Pine Script start with <a href="/pine-script-docs/language/execution-model/#the-basics">The basics</a>, learn about other topics in this manual, and then come back to this page for the advanced details.</p>
<h2 id="the-basics" class="md-heading"><a href="#the-basics">The <span class="fancy-wrap">basics<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p>The following sections outline core principles of the execution model for beginners. If you are new to Pine Script, start here.</p>
<h3 id="bar-by-bar-execution" class="md-heading"><a href="#bar-by-bar-execution">Bar-by-bar <span class="fancy-wrap">execution<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>The dataset for a symbol on a given timeframe, as shown on a chart, consists of a sequence of bars representing a <em>time series</em>. Each bar in the sequence represents the price and volume for a specific time period. The first (leftmost) bar on a chart corresponds to the <em>earliest</em> period, and the last (rightmost) bar corresponds to the <em>most recent</em> period.</p>
<p>Much of the power of Pine Script stems from its ability to process this time series data efficiently. When a user runs a script, its code does <em>not</em> execute just once; it executes from start to end on <em>each bar</em> in the symbol’s dataset individually, progressing from the first available bar to the most recent bar. Each separate script execution performs calculations or generates outputs (e.g., <a href="/pine-script-docs/concepts/plots/">plots</a>) for a <em>specific bar</em> using the data available on that bar.</p>
<p>A script can retrieve price, volume, and other essential data for each bar on which it executes by using the <a href="/pine-script-docs/language/built-ins/#built-in-variables">built-in variables</a> that hold bar information, such as <a href="https://www.tradingview.com/pine-script-reference/v6/#var_open">open</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_low">low</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a>, and <a href="https://www.tradingview.com/pine-script-reference/v6/#var_volume">volume</a>. These variables automatically <em>update</em> before each new execution to store the values for the <em>current bar</em>.</p>
<p>For example, the simple script below uses the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plot">plot()</a> function to display the series of <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> values (i.e., the closing price of each bar) on the chart:</p>
<div class="pine-colorizer not-content colorized" data-id="1uy"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Bar-by-bar&nbsp;execution&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">behind_chart</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">false</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`close`&nbsp;series&nbsp;on&nbsp;the&nbsp;chart.</span></span><br><span><span class="mtk9">//&nbsp;This&nbsp;call&nbsp;defines&nbsp;the&nbsp;plotted&nbsp;point&nbsp;for&nbsp;the&nbsp;cur</span><span class="mtk9">rent&nbsp;bar&nbsp;on&nbsp;each&nbsp;execution.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Close&nbsp;price"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br></code></div>
<p>When a user first adds this script to their chart, its code executes <em>once</em> for <em>every bar</em> in the available dataset. As the script runs on the data, two primary steps occur on each bar:</p>
<ol>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> variable automatically updates to hold the current bar’s latest price.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plot">plot()</a> function call plots the updated <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> value at the current bar’s position.</li>
</ol>
<p>When the script finishes its run from the first bar to the most recent bar, the result is a simple <em>line plot</em> showing the progression of closing prices across the chart’s history:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-The-basics-Bar-by-bar-execution-1.D5nkQfFJ_1oCMgX.webp" alt="image" width="2652" height="1126" loading="lazy" decoding="async"></p>
<p>Note that the above script evaluates the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plot">plot()</a> function call once for every bar on the chart, not just once in total. On each separate execution, the call defines the plotted point for the current bar: the chart’s first bar during the first execution, the second bar during the next, and so on.</p>
<p>This pattern illustrates a key principle of Pine’s execution model: on each successive execution, a script <em>re-evaluates</em> function calls and other expressions within its required <em>scopes</em> to perform separate calculations for the current bar.</p>
<aside aria-label="Note" class="tv-informer not-content" style="--informer-header-color:#6A6D78;--informer-back-color-light:#F0F3FA;--informer-back-color-dark:#2A2E39"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM8 6a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm1 2c.49 0 1 .59 1 1v3.01c0 .42-.51.99-1 .99s-1-.57-1-.99V9c0-.41.51-1 1-1Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Note</span>The <a href="/pine-script-docs/faq/programming/#what-does-scope-mean">scope</a> of an expression is the part of the code where the script can access it. A script evaluates its <em>global</em> scope <em>once</em> per execution, i.e., on <em>every bar</em>. In contrast, it evaluates <em>local</em> scopes — such as the code inside <a href="/pine-script-docs/language/conditional-structures/">conditional structures</a>, <a href="/pine-script-docs/language/user-defined-functions/">user-defined functions</a>, and <a href="/pine-script-docs/language/loops/">loops</a> — <em>zero</em>, <em>one</em>, or <em>several</em> times per execution, depending on the logic.</p></div></aside>
<p>Repeated code evaluation also applies to <a href="/pine-script-docs/language/variable-declarations/">variable declarations</a>. By default, a script does not declare a variable only once throughout its runtime; the script <em>re-declares</em> that variable and assigns an initial value based on the current bar’s data during <em>each</em> new evaluation of its scope.</p>
<p>Let’s look at a simple example. The following script declares an <code dir="auto">x</code> variable of the “int” <a href="/pine-script-docs/language/type-system/#types">type</a> with an initial value of 0. Then, it increases the variable’s value by 10 with the addition assignment operator (<a href="https://www.tradingview.com/pine-script-reference/v6/#op_+=">+=</a>). The script calls <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plot">plot()</a> to display the value of <code dir="auto">x</code> on each bar in a separate pane:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-The-basics-Bar-by-bar-execution-2.CYV_XhNc_fPGku.webp" alt="image" width="2654" height="1128" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="ge"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Repeated&nbsp;declarations&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;user-defined&nbsp;variable.&nbsp;The&nbsp;script&nbsp;declares&nbsp;this</span><span class="mtk9">&nbsp;variable&nbsp;and&nbsp;initializes&nbsp;it&nbsp;to&nbsp;0&nbsp;on&nbsp;*every*&nbsp;execu</span><span class="mtk9">tion.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">x</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Increase&nbsp;the&nbsp;value&nbsp;of&nbsp;`x`&nbsp;by&nbsp;10&nbsp;on&nbsp;every&nbsp;bar.</span></span><br><span><span class="mtk33">x</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;value&nbsp;of&nbsp;`x`.</span></span><br><span><span class="mtk9">//&nbsp;Because&nbsp;`x`&nbsp;begins&nbsp;at&nbsp;0&nbsp;on&nbsp;every&nbsp;execution,&nbsp;and</span><span class="mtk9">&nbsp;the&nbsp;script&nbsp;adds&nbsp;10&nbsp;to&nbsp;that&nbsp;value,&nbsp;the&nbsp;plotted&nbsp;val</span><span class="mtk9">ue&nbsp;is&nbsp;always&nbsp;10.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">x</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"`x`&nbsp;value"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br></code></div>
<p>As shown above, the script plots a value of 10 on every bar, because the <code dir="auto">x</code> variable <em>does not</em> carry over from bar to bar; the script declares the variable <em>repeatedly</em>. On each bar, the script re-declares <code dir="auto">x</code> with an initial value of 0, then adds 10 to that value, resulting in a final value of 10 for every plotted point.</p>
<p>Programmers can change the behavior of a variable, enabling it to <em>persist</em> and preserve updates to its value <em>across bars</em>, by including the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_var">var</a> keyword in its declaration, as described in the <a href="/pine-script-docs/language/variable-declarations/#declaration-modes">Declaration modes</a> section of the <a href="/pine-script-docs/language/variable-declarations/">Variable declarations</a> page.</p>
<p>Below, we modify the previous script by adding <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_var">var</a> to the <code dir="auto">x</code> declaration. Now, the script declares and initializes <code dir="auto">x</code> only <em>once</em> — on the <em>first bar</em> — and that variable persists across <em>all</em> bars that follow. The script now plots a line that <em>increases</em> by 10 on each bar, because <code dir="auto">x</code> preserves the result from each addition across the chart’s history. The value changes from 0 to 10 on the first bar, then to 20 on the second, and so on:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-The-basics-Bar-by-bar-execution-3.2eRg8rX8_ZUqlGK.webp" alt="image" width="2652" height="1124" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="w1"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Persistent&nbsp;declarations&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;*persistent*&nbsp;variable.&nbsp;The&nbsp;script&nbsp;initializes&nbsp;t</span><span class="mtk9">his&nbsp;variable&nbsp;only&nbsp;on&nbsp;the&nbsp;*first&nbsp;execution*.&nbsp;</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;variable&nbsp;preserves&nbsp;all&nbsp;changes&nbsp;to&nbsp;</span><span class="mtk9">its&nbsp;value&nbsp;on&nbsp;each&nbsp;closed&nbsp;bar.&nbsp;</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">x</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Increase&nbsp;the&nbsp;value&nbsp;of&nbsp;`x`&nbsp;by&nbsp;10&nbsp;on&nbsp;every&nbsp;bar.</span></span><br><span><span class="mtk33">x</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`x`&nbsp;series&nbsp;on&nbsp;the&nbsp;chart.&nbsp;</span></span><br><span><span class="mtk9">//&nbsp;Because&nbsp;the&nbsp;script&nbsp;declares&nbsp;`x`&nbsp;using&nbsp;`var`&nbsp;and</span><span class="mtk9">&nbsp;then&nbsp;increments&nbsp;its&nbsp;value,&nbsp;the&nbsp;value&nbsp;never&nbsp;resets</span><span class="mtk9">&nbsp;to&nbsp;0.</span></span><br><span><span class="mtk9">//&nbsp;The&nbsp;plotted&nbsp;value&nbsp;is&nbsp;10&nbsp;on&nbsp;the&nbsp;first&nbsp;bar,&nbsp;20&nbsp;on</span><span class="mtk9">&nbsp;the&nbsp;next,&nbsp;and&nbsp;so&nbsp;on.&nbsp;</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">x</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"`x`&nbsp;series"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br></code></div>
<h3 id="storing-and-using-data-from-previous-bars" class="md-heading"><a href="#storing-and-using-data-from-previous-bars">Storing and using data from previous <span class="fancy-wrap">bars<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>As a script runs on a dataset, the states of its variables, function calls, and other expressions are automatically <em>committed (saved)</em> to an internal <em>time series</em> on each bar, creating historical trails of previous bar values that the script can access during its calculations on the current bar. The script can use these previous values by doing either of the following:</p>
<ul>
<li>Using the <a href="/pine-script-docs/language/operators/#-history-referencing-operator">[] history-referencing operator</a>. The number in the square brackets represents how many <em>bars back</em> from the current bar the script looks to retrieve a past value. For instance, <code dir="auto">close[1]</code> retrieves the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> value from <em>one bar before</em> the current bar, and <code dir="auto">close[100]</code> retrieves the value from <em>100 bars back</em>.</li>
<li>Calling the <a href="/pine-script-docs/language/built-ins/#built-in-functions">built-in functions</a> that calculate on past values internally, such as <code dir="auto">ta.*()</code> functions. For instance, <code dir="auto">ta.change(close, 10)</code> calculates the difference between the current value of <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> and its value from 10 bars back.</li>
</ul>
<p>The example below uses both of the above techniques to perform calculations based on data from previous bars. The script calculates a series of bar-by-bar price returns and plots the result as color-coded columns. It declares two global variables on each bar: <code dir="auto">priceReturn</code> for the calculated returns, and <code dir="auto">returnColor</code> for the plot’s color. The <code dir="auto">priceReturn</code> value is the result of dividing the current one-bar change in closing prices (<code dir="auto">ta.change(close, 1)</code>) by the previous bar’s closing price (<code dir="auto">close[1]</code>). The <code dir="auto">returnColor</code> value is <a href="https://www.tradingview.com/pine-script-reference/v6/#const_color.teal">color.teal</a> if the current value of <code dir="auto">priceReturn</code> is higher than the value from the previous bar (<code dir="auto">priceReturn[1]</code>), and <a href="https://www.tradingview.com/pine-script-reference/v6/#const_color.maroon">color.maroon</a> otherwise:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-The-basics-Storing-and-using-data-from-previous-bars-1.CZbtEkeL_Z28dT9i.webp" alt="image" width="2652" height="1212" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="6s6"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Storing&nbsp;and&nbsp;using&nbsp;data&nbsp;from&nbsp;previous&nbsp;bars&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;one-bar&nbsp;price&nbsp;return,&nbsp;based&nbsp;on&nbsp;the&nbsp;current&nbsp;an</span><span class="mtk9">d&nbsp;*previous*&nbsp;bars'&nbsp;`close`&nbsp;values.</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;variable's&nbsp;final&nbsp;value&nbsp;on&nbsp;each&nbsp;ba</span><span class="mtk9">r&nbsp;automatically&nbsp;becomes&nbsp;part&nbsp;of&nbsp;the&nbsp;internal&nbsp;time&nbsp;</span><span class="mtk9">series.&nbsp;</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceReturn</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.change</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`color.teal`&nbsp;if&nbsp;the&nbsp;`priceReturn`&nbsp;value&nbsp;is&nbsp;abo</span><span class="mtk9">ve&nbsp;the&nbsp;value&nbsp;on&nbsp;the&nbsp;previous&nbsp;bar;&nbsp;`color.maroon`&nbsp;o</span><span class="mtk9">therwise.&nbsp;</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">returnColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceReturn</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceReturn</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.maroon</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;current&nbsp;`priceReturn`&nbsp;value&nbsp;as&nbsp;a&nbsp;colum</span><span class="mtk9">n,&nbsp;colored&nbsp;using&nbsp;the&nbsp;value&nbsp;of&nbsp;`returnColor`.&nbsp;</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">priceReturn</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Price&nbsp;return"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">returnColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_columns</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>This script does <em>not</em> plot a column on bar 0 (the <em>first</em> bar). The <code dir="auto">priceReturn</code> value is <a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a> on that bar, because there is <em>no previous bar</em> available for the script to reference at that point.</li>
</ul>
<aside aria-label="Notice" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice</span>For consistency, use historical references only on variables or expressions that the script evaluates on <strong>every bar</strong>, in the <em>global</em> scope. A script that references the history of variables or expressions defined in <em>local</em> scopes — such as the code inside an <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_if">if</a> statement — can cause <em>unintended results</em>. The compiler warns users about this behavior directly inside the Pine Editor. For <em>advanced</em> details on this behavior, see the <a href="/pine-script-docs/language/execution-model/#time-series-in-scopes">Time series in scopes</a> section.</p></div></aside>
<h3 id="realtime-bars" class="md-heading"><a href="#realtime-bars">Realtime <span class="fancy-wrap">bars<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>When a script first runs on a chart, all <em>closed</em> bars in the accessed dataset are <em>historical bars</em>. These bars represent data for elapsed time periods where the final price and volume are <em>confirmed</em>. All indicators execute <strong>once</strong> per historical bar.</p>
<p>When the rightmost bar on the chart is <em>open</em>, it is a <em>realtime bar</em>. Unlike a historical bar, whose values are final, a realtime bar <em>updates</em> its values as new price or volume data becomes available. After the bar closes, it becomes an <em>elapsed realtime bar</em>, which is then no longer subject to change as the script runs.</p>
<p>Because the final values for a realtime bar are <em>unknown</em> until the bar closes, an indicator executes differently on that bar than it does on historical bars. The script executes not once, but <strong>repeatedly</strong> on the realtime bar — once for each new <em>update (tick)</em> — to <em>recalculate</em> its results using the latest data.</p>
<aside aria-label="Note" class="tv-informer not-content" style="--informer-header-color:#6A6D78;--informer-back-color-light:#F0F3FA;--informer-back-color-dark:#2A2E39"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM8 6a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm1 2c.49 0 1 .59 1 1v3.01c0 .42-.51.99-1 .99s-1-.57-1-.99V9c0-.41.51-1 1-1Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Note</span></p><p>On the open realtime bar, variables such as <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_low">low</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a>, and <a href="https://www.tradingview.com/pine-script-reference/v6/#var_volume">volume</a> hold the <em>latest</em> available values for the bar. These values <strong>do not</strong> represent <em>confirmed</em> data for the bar until the script executes on that bar’s <em>closing tick</em>.</p><br><p>Scripts can identify historical and realtime bars, and whether a realtime bar’s data is confirmed, by using the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_barstate.ishistory">barstate.ishistory</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_barstate.isrealtime">barstate.isrealtime</a>, and <a href="https://www.tradingview.com/pine-script-reference/v6/#var_barstate.isconfirmed">barstate.isconfirmed</a> variables. See the <a href="/pine-script-docs/concepts/bar-states/">Bar states</a> page to learn more.</p><p></p></div></aside>
<p>Before each recalculation on the realtime bar, the data for a script’s variables, expressions, and outputs on that bar is <em>cleared</em>, or <em>reset</em>. We refer to this process as <em>rollback</em>. The purpose of rollback is to revert the script to the same confirmed state it had when the realtime bar opened. This process ensures that the script’s calculations for the bar operate only on the latest available data, without relying on <em>temporary data</em> from the bar’s <em>previous ticks</em>.</p>
<aside aria-label="Notice" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice</span>A variable can <em>escape</em> rollback and persist across <em>all ticks</em> within a bar if its declaration includes the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_varip">varip</a> keyword. This behavior is helpful for calculations that require data from before a bar’s closing tick. However, it can also cause <a href="/pine-script-docs/concepts/repainting/">repainting</a>, because the ticks that occur before a realtime bar’s close become <strong>unavailable</strong> after the script reloads. Refer to the <a href="/pine-script-docs/language/variable-declarations/#declaration-modes">Declaration modes</a> section of the <a href="/pine-script-docs/language/variable-declarations/">Variable declarations</a> page to learn more about this keyword.</p></div></aside>
<p>Let’s look at rollback and recalculation in action. The following script uses <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.stoch">ta.stoch()</a> to calculate the <a href="https://www.tradingview.com/support/solutions/43000502332-stochastic-stoch/">Stochastic oscillator</a> based on the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a>, and <a href="https://www.tradingview.com/pine-script-reference/v6/#var_low">low</a> values over a specified number of bars, then plots the result in a separate pane. It also calls <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_bgcolor">bgcolor()</a> to highlight the background on each realtime bar — where <a href="https://www.tradingview.com/pine-script-reference/v6/#var_barstate.isrealtime">barstate.isrealtime</a> is <code dir="auto">true</code> — for visual reference:</p>
<div class="pine-colorizer not-content colorized" data-id="21h"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Recalculation&nbsp;on&nbsp;realtime&nbsp;bars&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;in&nbsp;the&nbsp;Stochastic&nbsp;calculation.</span><span class="mtk9">&nbsp;Users&nbsp;can&nbsp;change&nbsp;this&nbsp;value&nbsp;in&nbsp;the&nbsp;"Settings/Inpu</span><span class="mtk9">ts"&nbsp;tab.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;Stochastic&nbsp;oscillator,&nbsp;based&nbsp;on&nbsp;the&nbsp;`close`,&nbsp;</span><span class="mtk9">`high`,&nbsp;and&nbsp;`low`&nbsp;values&nbsp;over&nbsp;`lengthInput`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">stochastic</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.stoch</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">low</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`stochastic`&nbsp;value&nbsp;for&nbsp;each&nbsp;bar.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">stochastic</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Stochastic&nbsp;%K"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;background&nbsp;of&nbsp;each&nbsp;realtime&nbsp;bar.&nbsp;</span><span class="mtk9">&nbsp;</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk11">barstate.isrealtime</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Realtime&nbsp;background&nbsp;highlight"</span><span class="mtk13">)</span></span><br></code></div>
<p>When we add the script to our chart, it executes once per bar in the chart’s history, from the leftmost bar to the rightmost bar. However, the rightmost bar on our chart is still <em>open</em>. Therefore, it is a <em>realtime bar</em>, not a historical bar. After the script reaches that bar, it begins executing once for <em>every new update</em> to the bar’s data. Each new script execution calculates on the latest available prices and <em>replaces</em> the bar’s previous result.</p>
<p>For instance, in the initial image below, the oscillator’s value 10 seconds into the open realtime bar (the one with the purple background) is 32.08:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-The-basics-Realtime-bars-1.AOvj4-Z1_1svjXm.webp" alt="image" width="2650" height="1220" loading="lazy" decoding="async"></p>
<p>Every time the bar updates, rollback <em>resets</em> the script’s data for that bar, and the script <em>recalculates</em> its result using the latest <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_low">low</a>, and <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> values. Here, halfway through the realtime bar’s period, the oscillator’s plot now shows a value of 16.71:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-The-basics-Realtime-bars-2.C780uf5g_1ywlee.webp" alt="image" width="2650" height="1220" loading="lazy" decoding="async"></p>
<p>Recalculation continues for each successive update to the bar. Then, the script reaches the bar’s closing tick, where the prices become <em>confirmed</em>. On that tick, the script calculates the oscillator’s final value of 19.35. Afterward, another realtime bar opens, and the pattern of rollback and recalculation continues on that bar:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-The-basics-Realtime-bars-3.rq8kAEPJ_Z2sy82e.webp" alt="image" width="2650" height="1220" loading="lazy" decoding="async"></p>
<p>Note that:</p>
<ul>
<li>Only the values for a realtime bar’s <em>final tick</em> become part of the internal time series. The values from ticks <em>before</em> the bar’s close are <strong>not</strong> saved.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_input.int">input.int()</a> function returns a value of the “input int” <em>qualified type</em>. Values qualified as “input” are established <em>before</em> the first script execution, and they remain consistent throughout the script’s runtime. If the user changes the “Length” input to a new value, the script <em>restarts</em> to perform new calculations across the dataset using that value. See the <a href="/pine-script-docs/concepts/inputs/">Inputs</a> page and the <a href="/pine-script-docs/language/type-system/#qualifiers">Qualifiers</a> section of the <a href="/pine-script-docs/language/type-system/">Type system</a> page to learn more about script inputs and the “input” qualifier.</li>
<li>If the script restarts, all the realtime bars from the previous script run become <em>historical bars</em> in the new run. Therefore, after restarting, the script executes only <strong>once</strong> on each of those bars and does <em>not</em> highlight their background.</li>
</ul>
<aside aria-label="Note" class="tv-informer not-content" style="--informer-header-color:#6A6D78;--informer-back-color-light:#F0F3FA;--informer-back-color-dark:#2A2E39"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM8 6a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm1 2c.49 0 1 .59 1 1v3.01c0 .42-.51.99-1 .99s-1-.57-1-.99V9c0-.41.51-1 1-1Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Note</span><em>Strategy</em> scripts do not execute in the same way as indicators by default; they execute only <em>once</em> on <em>every bar</em>, including all <em>realtime bars</em>. Calculations occur on each realtime bar only after the bar <strong>closes</strong>. Users can change this behavior with the <code dir="auto">calc_on_every_tick</code> and <code dir="auto">calc_on_order_fills</code> parameters of the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy">strategy()</a> function. See the <a href="/pine-script-docs/concepts/strategies/">Strategies</a> page to learn more about strategy scripts and how they differ from indicators.</p></div></aside>
<h2 id="the-details" class="md-heading"><a href="#the-details">The <span class="fancy-wrap">details<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p>The following sections provide in-depth details about Pine’s execution model, including the mechanics of executions on <a href="/pine-script-docs/language/execution-model/#executions-on-historical-bars">historical bars</a> and <a href="/pine-script-docs/language/execution-model/#executions-on-realtime-bars">realtime bars</a>, which <a href="/pine-script-docs/language/execution-model/#events-that-trigger-script-executions">events</a> trigger script executions, and how the runtime system maintains data across executions in a <a href="/pine-script-docs/language/execution-model/#time-series">time series</a> format.</p>
<aside aria-label="Tip" class="tv-informer not-content" style="--informer-header-color:#089981;--informer-back-color-light:#DAF2EE;--informer-back-color-dark:#082621"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16Zm3.87-12.15c.36.2.49.66.28 1.02l-4 7a.75.75 0 0 1-1.18.16l-3-3a.75.75 0 1 1 1.06-1.06l2.3 2.3 3.52-6.14a.75.75 0 0 1 1.02-.28Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Tip</span>New to Pine Script? To make the most of the <em>advanced</em> information below, start by learning <a href="/pine-script-docs/language/execution-model/#the-basics">The basics</a> and understanding other core concepts — such as the <a href="/pine-script-docs/language/type-system/">type system</a>, <a href="/pine-script-docs/language/variable-declarations/">variable declarations</a>, <a href="/pine-script-docs/language/operators/">operators</a>, <a href="/pine-script-docs/language/conditional-structures/">conditional structures</a>, and <a href="/pine-script-docs/language/user-defined-functions/">user-defined functions</a> — before venturing further.</p></div></aside>
<h3 id="executions-on-historical-bars" class="md-heading"><a href="#executions-on-historical-bars">Executions on historical <span class="fancy-wrap">bars<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>When a script loads on the chart or in another location after an <a href="/pine-script-docs/language/execution-model/#events-that-trigger-script-executions">execution-triggering event</a>, its compiled source code executes on <em>every</em> accessible bar in the current dataset in order, starting with the first bar.</p>
<aside aria-label="Note" class="tv-informer not-content" style="--informer-header-color:#6A6D78;--informer-back-color-light:#F0F3FA;--informer-back-color-dark:#2A2E39"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM8 6a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm1 2c.49 0 1 .59 1 1v3.01c0 .42-.51.99-1 .99s-1-.57-1-.99V9c0-.41.51-1 1-1Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Note</span>The first bar that a script accesses depends on the <code dir="auto">calc_bars_count</code> parameter of its <a href="/pine-script-docs/language/script-structure/#declaration-statement">declaration statement</a> and the limits of the user’s <em>plan</em>. If the <code dir="auto">calc_bars_count</code> argument is a non-zero value that is less than or equal to the plan’s <a href="/pine-script-docs/writing/limitations/#chart-bars">bar limit</a>, script executions begin at the specified number of bars <em>before</em> the latest bar. Otherwise, executions start at the <em>earliest</em> available bar.</p></div></aside>
<p>While the script loads, the runtime system performs the following steps for <em>each bar</em> that it accesses:</p>
<ol>
<li>It updates the built-in variables that hold bar information. For instance, the system sets the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_open">open</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_low">low</a>, and <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> variables to hold the OHLC price values of the bar <em>before</em> each execution.</li>
<li>It executes the script’s compiled code from start to end using the data available as of the current bar.</li>
<li>After the execution ends, the system commits (saves) all necessary data for the current bar to the <a href="/pine-script-docs/language/execution-model/#time-series">time series</a>. The script can then access that data from <a href="/pine-script-docs/language/execution-model/#historical-buffers">historical buffers</a> during its executions on subsequent bars by using the <a href="/pine-script-docs/language/operators/#-history-referencing-operator">history-referencing operator</a> or the built-in functions that reference past bars internally.</li>
</ol>
<p>These steps repeat for every successive bar up to the most recent bar. After the runtime system completes this process across the dataset, the script’s committed <em>outputs</em> — such as <a href="/pine-script-docs/concepts/plots/">plots</a>, <a href="/pine-script-docs/language/type-system/#drawing-types">drawings</a>, <a href="/pine-script-docs/writing/debugging/#pine-logs">Pine Logs</a>, and <a href="/pine-script-docs/concepts/strategies/#strategy-tester">Strategy Tester</a> results — become available to the user.</p>
<p>All the closed bars on which the script executes while loading are <em>historical</em>, because they represent data points that were confirmed before the <a href="/pine-script-docs/language/execution-model/#events-that-trigger-script-executions">event</a> that triggered the loading process. By default, all scripts execute <strong>once</strong> for each historical bar.</p>
<aside aria-label="Tip" class="tv-informer not-content" style="--informer-header-color:#089981;--informer-back-color-light:#DAF2EE;--informer-back-color-dark:#082621"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16Zm3.87-12.15c.36.2.49.66.28 1.02l-4 7a.75.75 0 0 1-1.18.16l-3-3a.75.75 0 1 1 1.06-1.06l2.3 2.3 3.52-6.14a.75.75 0 0 1 1.02-.28Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Tip</span>Scripts can identify which bars have a historical state with the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_barstate.ishistory">barstate.ishistory</a> variable. Its value is <code dir="auto">true</code> for every closed bar accessed during the script’s loading time and <code dir="auto">false</code> for all bars that close afterward. See the <a href="/pine-script-docs/concepts/bar-states/">Bar states</a> page to learn more about <code dir="auto">barstate.*</code> variables.</p></div></aside>
<p>Let’s examine a simple indicator to understand how script executions work on historical bars.</p>
<p>The script below calculates the 20-bar moving average of <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> values and plots the result on the chart. The color of the plot depends on whether the average is above or below the value on the previous bar. The script also increments an <code dir="auto">executionNum</code> variable to count code executions, then plots the result alongside <a href="https://www.tradingview.com/pine-script-reference/v6/#var_bar_index">bar_index</a> for comparison. Additionally, it highlights the background of historical bars in orange for visual reference:</p>
<div class="pine-colorizer not-content colorized" data-id="4me"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Executions&nbsp;on&nbsp;historical&nbsp;bars&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;average&nbsp;of&nbsp;the&nbsp;latest&nbsp;20&nbsp;`close`&nbsp;values.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">sma</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`color.green`&nbsp;if&nbsp;the&nbsp;`sma`&nbsp;value&nbsp;is&nbsp;above&nbsp;the&nbsp;</span><span class="mtk9">value&nbsp;on&nbsp;the&nbsp;previous&nbsp;bar;&nbsp;`color.red`&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">plotColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">sma</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">sma</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Tracks&nbsp;the&nbsp;current&nbsp;execution&nbsp;number,&nbsp;where&nbsp;0&nbsp;repr</span><span class="mtk9">esents&nbsp;the&nbsp;first&nbsp;execution.</span></span><br><span><span class="mtk18">varip</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">executionNum</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">-1</span></span><br><span><span class="mtk9">//&nbsp;Add&nbsp;1&nbsp;to&nbsp;the&nbsp;`executionNum`&nbsp;value.</span></span><br><span><span class="mtk33">executionNum</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;`sma`&nbsp;as&nbsp;a&nbsp;line&nbsp;plot&nbsp;on&nbsp;the&nbsp;main&nbsp;ch</span><span class="mtk9">art&nbsp;pane,&nbsp;colored&nbsp;by&nbsp;the&nbsp;`plotColor`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">sma</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"SMA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">plotColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">force_overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;`executionNum`&nbsp;and&nbsp;`bar_index`&nbsp;seri</span><span class="mtk9">es&nbsp;in&nbsp;a&nbsp;separate&nbsp;pane.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">executionNum</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Execution&nbsp;number"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Bar&nbsp;index"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">color.aqua</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;chart's&nbsp;background&nbsp;in&nbsp;translucent</span><span class="mtk9">&nbsp;orange&nbsp;when&nbsp;`barstate.ishistory`&nbsp;is&nbsp;`true`.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk11">barstate.ishistory</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Historical&nbsp;highlight"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">force_overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br></code></div>
<p>The statements and expressions in this source code might appear static at first glance. However, they have <em>dynamic</em> behavior across bars because the system executes the script <em>repeatedly</em> — once for each successive data point. Below, we inspect the code step by step to explain how the script works during its historical executions.</p>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_indicator">indicator()</a> call at the top of the code is a <a href="/pine-script-docs/language/script-structure/#declaration-statement">declaration statement</a> that defines the script’s type and properties once, at <em>compile time</em>. This statement does not execute as the script runs on the dataset:</p>
<div class="pine-colorizer not-content colorized" data-id="1oq"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Executions&nbsp;on&nbsp;historical&nbsp;bars&nbsp;demo"</span><span class="mtk13">)</span></span><br></code></div>
<p><em>Before</em> each script execution on a bar, the runtime system updates the built-in <a href="https://www.tradingview.com/pine-script-reference/v6/#var_bar_index">bar_index</a> and <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> variables required in the calculations. The <a href="https://www.tradingview.com/pine-script-reference/v6/#var_bar_index">bar_index</a> value is the bar’s global <em>time series index</em>, where 0 represents the first bar, 1 represents the second, and so on. The <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> variable holds the bar’s <em>latest price</em>. For historical bars, its value is the <em>final price</em> at the bar’s closing time.</p>
<p>Each time that the script executes, it declares and initializes a global <code dir="auto">sma</code> variable of the “float” <a href="/pine-script-docs/language/type-system/#types">type</a>. This <a href="/pine-script-docs/language/variable-declarations/">variable declaration</a> happens on <em>every</em> execution because the code line does not specify a <a href="/pine-script-docs/language/variable-declarations/#declaration-modes">declaration mode</a>. The variable’s assigned value is the result of a <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.sma">ta.sma()</a> function call. The call returns the average of the latest 20 <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> values as of the current bar, or <a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a> if fewer than 20 bars are available. After the execution ends, the system commits the new value of <code dir="auto">sma</code> to the <a href="/pine-script-docs/language/execution-model/#time-series">time series</a>:</p>
<div class="pine-colorizer not-content colorized" data-id="1t9"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;average&nbsp;of&nbsp;the&nbsp;latest&nbsp;20&nbsp;`close`&nbsp;values.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">sma</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">//@variable</code> comment above the <code dir="auto">sma</code> declaration is an <a href="/pine-script-docs/language/script-structure/#compiler-annotations">annotation</a> that <em>documents</em> the variable in the code. The Pine Editor displays the comment in a pop-up window when the user hovers the mouse pointer over the variable.</li>
</ul>
<p>During each execution, the script also initializes a <code dir="auto">plotColor</code> variable of the “color” type. The script uses a <a href="/pine-script-docs/language/operators/#-ternary-operator">ternary operation</a> that compares the current <code dir="auto">sma</code> value to <code dir="auto">sma[1]</code> — the <em>last committed value</em> for <code dir="auto">sma</code> as of the <em>previous bar</em> — to determine the <code dir="auto">plotColor</code> variable’s assigned value. If the current <code dir="auto">sma</code> value is higher than the last committed value, the <code dir="auto">plotColor</code> value is <a href="https://www.tradingview.com/pine-script-reference/v6/#const_color.green">color.green</a>. Otherwise, it is <a href="https://www.tradingview.com/pine-script-reference/v6/#const_color.red">color.red</a>:</p>
<div class="pine-colorizer not-content colorized" data-id="5v6"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`color.green`&nbsp;if&nbsp;the&nbsp;`sma`&nbsp;value&nbsp;is&nbsp;above&nbsp;the&nbsp;</span><span class="mtk9">value&nbsp;on&nbsp;the&nbsp;previous&nbsp;bar;&nbsp;`color.red`&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">plotColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">sma</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">sma</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span></span><br></code></div>
<p>In contrast to the variables above, the script <em>does not</em> initialize the <code dir="auto">executionNum</code> variable on every execution. Instead, initialization happens only <em>once</em> — on the <em>first</em> bar — because the variable declaration is in the <em>global scope</em> and uses the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_varip">varip</a> keyword. Once initialized, the variable <em>persists</em> across all subsequent bars and the ticks within those bars. Only the reassignment or compound assignment <a href="/pine-script-docs/language/operators/">operators</a> can change its value:</p>
<div class="pine-colorizer not-content colorized" data-id="38p"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Tracks&nbsp;the&nbsp;current&nbsp;execution&nbsp;number,&nbsp;where&nbsp;0&nbsp;repr</span><span class="mtk9">esents&nbsp;the&nbsp;first&nbsp;execution.</span></span><br><span><span class="mtk18">varip</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">executionNum</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">-1</span></span><br></code></div>
<p>The code following the <code dir="auto">executionNum</code> declaration uses the addition assignment operator (<a href="https://www.tradingview.com/pine-script-reference/v6/#op_+=">+=</a>) to increase the variable’s value by one on each new execution. Starting from -1, the value increases to 0 on the first execution after initialization, then 1 on the second, and so on:</p>
<div class="pine-colorizer not-content colorized" data-id="5xa"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//&nbsp;Add&nbsp;1&nbsp;to&nbsp;the&nbsp;`executionNum`&nbsp;value.</span></span><br><span><span class="mtk33">executionNum</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br></code></div>
<p>The script evaluates the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plot">plot()</a> and <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_bgcolor">bgcolor()</a> calls on every execution. Each <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plot">plot()</a> call creates a new point on a line plot at the bar’s location on the time axis. The <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_bgcolor">bgcolor()</a> call creates a background color for the bar based on a ternary expression. The background is translucent orange if <a href="https://www.tradingview.com/pine-script-reference/v6/#var_barstate.ishistory">barstate.ishistory</a> is <code dir="auto">true</code>. Otherwise, it is <a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a> (no color):</p>
<div class="pine-colorizer not-content colorized" data-id="1jt"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;`sma`&nbsp;as&nbsp;a&nbsp;line&nbsp;plot&nbsp;on&nbsp;the&nbsp;main&nbsp;ch</span><span class="mtk9">art&nbsp;pane,&nbsp;colored&nbsp;by&nbsp;the&nbsp;`plotColor`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">sma</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"SMA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">plotColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">force_overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;`executionNum`&nbsp;and&nbsp;`bar_index`&nbsp;seri</span><span class="mtk9">es&nbsp;in&nbsp;a&nbsp;separate&nbsp;pane.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">executionNum</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Execution&nbsp;number"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Bar&nbsp;index"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">color.aqua</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;chart's&nbsp;background&nbsp;in&nbsp;translucent</span><span class="mtk9">&nbsp;orange&nbsp;when&nbsp;`barstate.ishistory`&nbsp;is&nbsp;`true`.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk11">barstate.ishistory</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Historical&nbsp;highlight"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">force_overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plot">plot()</a> and <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_bgcolor">bgcolor()</a> calls that include <code dir="auto">force_overlay = true</code> display their visuals on the main chart pane. The other <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plot">plot()</a> calls
output visuals in a separate pane, because the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_indicator">indicator()</a> call does not include <code dir="auto">overlay = true</code>.</li>
</ul>
<p>After the system executes the script on all available data points and finishes loading, the script’s outputs then become visible on the chart:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-Executions-on-historical-bars-1.CbmTx9jr_Z1leWpo.webp" alt="image" width="2644" height="1246" loading="lazy" decoding="async"></p>
<p>Note that:</p>
<ul>
<li>When the script first loads, <em>all</em> bars, including the latest one, have an orange background because they initially represent <em>historical</em> data. However, the latest bar on our chart is still open, meaning it is a <em>realtime bar</em>. After a new tick arrives from the realtime data feed, the bar’s values update, and the script executes <em>again</em> on that bar. The orange background for the bar then <em>disappears</em> because the system sets the value of <a href="https://www.tradingview.com/pine-script-reference/v6/#var_barstate.ishistory">barstate.ishistory</a> to <code dir="auto">false</code>.</li>
<li>The <code dir="auto">executionNum</code> and <a href="https://www.tradingview.com/pine-script-reference/v6/#var_bar_index">bar_index</a> values are identical on historical bars because the script executes <em>once per bar</em> on that part of the dataset. However, they begin to differ on the realtime bar. On that bar, the script executes after <em>every new update</em> to recalculate its results, and the <code dir="auto">executionNum</code> value increases each time. See the <a href="/pine-script-docs/language/execution-model/#executions-on-realtime-bars">Executions on realtime bars</a> section to learn more.</li>
<li>An alternative, more robust method to track code executions is to use the <a href="/pine-script-docs/writing/profiling-and-optimization/#pine-profiler">Pine Profiler</a>. The profiler analyzes the total runtime and execution count of every significant part of the source code. To learn more about this feature, see the <a href="/pine-script-docs/writing/profiling-and-optimization/">Profiling and optimization</a> page.</li>
</ul>
<p>It’s important to note that, unlike indicators, <a href="/pine-script-docs/concepts/strategies/">strategies</a> can execute <em>more than once</em> per historical bar, depending on the specified <a href="/pine-script-docs/concepts/strategies/#altering-calculation-behavior">calculation behavior</a>. If the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy">strategy()</a> declaration statement includes <code dir="auto">calc_on_order_fills = true</code>, or if the user selects the “After order is filled” checkbox in the “Settings/Properties” tab, the runtime system executes the script on <em>each available tick</em> where the <a href="/pine-script-docs/concepts/strategies/#broker-emulator">broker emulator</a> fills an order, or once per bar when there is no order to fill.</p>
<p>Let’s look at a simple example. The following strategy changes the direction of its simulated position on each execution. If there is an open short position or no position, the strategy places a <a href="/pine-script-docs/concepts/strategies/#market-orders">market order</a> to close all short trades and enter a long trade. If a long position is open, the strategy places a market order to close it and open a short trade.</p>
<p>As with the previous example, this script increments an <code dir="auto">executionNum</code> variable declared with <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_varip">varip</a> to count new executions, plots the result alongside <a href="https://www.tradingview.com/pine-script-reference/v6/#var_bar_index">bar_index</a> for comparison, and highlights the background of historical bars in orange with <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_bgcolor">bgcolor()</a>:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-Executions-on-historical-bars-2.DpP1JZmD_2lzKqv.webp" alt="image" width="2646" height="1196" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="2uz"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Default&nbsp;strategy&nbsp;behavior&nbsp;on&nbsp;historical&nbsp;bars&nbsp;demo</span><span class="mtk29">"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;a&nbsp;market&nbsp;order&nbsp;to&nbsp;close&nbsp;short&nbsp;trades&nbsp;and&nbsp;</span><span class="mtk9">enter&nbsp;a&nbsp;long&nbsp;trade&nbsp;when&nbsp;there&nbsp;is&nbsp;a&nbsp;short&nbsp;position&nbsp;</span><span class="mtk9">or&nbsp;no&nbsp;position.</span></span><br><span><span class="mtk9">//&nbsp;Otherwise,&nbsp;if&nbsp;a&nbsp;long&nbsp;position&nbsp;is&nbsp;open,&nbsp;place&nbsp;a&nbsp;</span><span class="mtk9">market&nbsp;order&nbsp;to&nbsp;close&nbsp;the&nbsp;long&nbsp;trades&nbsp;and&nbsp;enter&nbsp;a&nbsp;</span><span class="mtk9">short&nbsp;trade.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk18">else</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Short"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Tracks&nbsp;the&nbsp;current&nbsp;execution&nbsp;number,&nbsp;where&nbsp;0&nbsp;repr</span><span class="mtk9">esents&nbsp;the&nbsp;first&nbsp;execution.</span></span><br><span><span class="mtk18">varip</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">executionNum</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">-1</span></span><br><span><span class="mtk9">//&nbsp;Add&nbsp;1&nbsp;to&nbsp;the&nbsp;`executionNum`&nbsp;value.</span></span><br><span><span class="mtk33">executionNum</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;`executionNum`&nbsp;and&nbsp;`bar_index`&nbsp;seri</span><span class="mtk9">es&nbsp;in&nbsp;a&nbsp;separate&nbsp;pane.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">executionNum</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Execution&nbsp;number"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Bar&nbsp;index"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">color.aqua</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;chart's&nbsp;background&nbsp;in&nbsp;translucent</span><span class="mtk9">&nbsp;orange&nbsp;when&nbsp;`barstate.ishistory`&nbsp;is&nbsp;`true`.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk11">barstate.ishistory</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Historical&nbsp;highlight"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">force_overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.entry">strategy.entry()</a> command creates entry orders. By default, a long entry using this command reverses an open short position, and a short entry reverses an open long position. See the <a href="/pine-script-docs/concepts/strategies/#reversing-positions">Reversing positions</a> section of the <a href="/pine-script-docs/concepts/strategies/">Strategies</a> page to learn more.</li>
</ul>
<p>The script above uses the default calculation behavior: it places a new order only at the close of each bar. The broker emulator fills the order at the next bar’s opening price, as the trade markers on the chart above indicate. The <code dir="auto">executionNum</code> and <a href="https://www.tradingview.com/pine-script-reference/v6/#var_bar_index">bar_index</a> plots show the same values because the script executes only once per bar.</p>
<p>If we include <code dir="auto">calc_on_order_fills = true</code> in the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy">strategy()</a> declaration statement, the runtime system <em>re-executes</em> the script on a bar after each new order fill to update the calculations. Our script’s logic generates a new order on <em>every</em> execution, and the broker emulator considers historical bars to have <em>four ticks</em> for filling orders by default (the open, high, low, and close). Therefore, with this change, the script executes <strong>four times</strong> per historical bar instead of only once. As shown below, the strategy now shows four trade markers on each historical bar, and the <code dir="auto">executionNum</code> value is four times that of the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_bar_index">bar_index</a> variable:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-Executions-on-historical-bars-3.C3-PPUqF_Z9LtnE.webp" alt="image" width="2650" height="1190" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="19t"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Calculation&nbsp;after&nbsp;order&nbsp;fill&nbsp;on&nbsp;historical&nbsp;bars&nbsp;d</span><span class="mtk29">emo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">calc_on_order_fills</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;a&nbsp;market&nbsp;order&nbsp;to&nbsp;close&nbsp;short&nbsp;trades&nbsp;and&nbsp;</span><span class="mtk9">enter&nbsp;a&nbsp;long&nbsp;trade&nbsp;when&nbsp;there&nbsp;is&nbsp;a&nbsp;short&nbsp;position&nbsp;</span><span class="mtk9">or&nbsp;no&nbsp;position.</span></span><br><span><span class="mtk9">//&nbsp;Otherwise,&nbsp;if&nbsp;a&nbsp;long&nbsp;position&nbsp;is&nbsp;open,&nbsp;place&nbsp;a&nbsp;</span><span class="mtk9">market&nbsp;order&nbsp;to&nbsp;close&nbsp;the&nbsp;long&nbsp;trades&nbsp;and&nbsp;enter&nbsp;a&nbsp;</span><span class="mtk9">short&nbsp;trade.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Long"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk18">else</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Short"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Tracks&nbsp;the&nbsp;current&nbsp;execution&nbsp;number,&nbsp;where&nbsp;0&nbsp;repr</span><span class="mtk9">esents&nbsp;the&nbsp;first&nbsp;execution.</span></span><br><span><span class="mtk18">varip</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">executionNum</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">-1</span></span><br><span><span class="mtk9">//&nbsp;Add&nbsp;1&nbsp;to&nbsp;the&nbsp;`executionNum`&nbsp;value.</span></span><br><span><span class="mtk33">executionNum</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;`executionNum`&nbsp;and&nbsp;`bar_index`&nbsp;seri</span><span class="mtk9">es&nbsp;in&nbsp;a&nbsp;separate&nbsp;pane.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">executionNum</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Execution&nbsp;number"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Bar&nbsp;index"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">color.aqua</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;chart's&nbsp;background&nbsp;in&nbsp;translucent</span><span class="mtk9">&nbsp;orange&nbsp;when&nbsp;`barstate.ishistory`&nbsp;is&nbsp;`true`.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk11">barstate.ishistory</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Historical&nbsp;highlight"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">force_overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>This script can execute <em>more than four</em> times per bar if it uses <a href="/pine-script-docs/concepts/strategies/#bar-magnifier">Bar Magnifier</a> mode, because this mode enables the broker emulator to fill orders on historical bars using intrabar prices from a <em>lower timeframe</em>.</li>
<li>The script can execute numerous times on a <em>realtime</em> bar, depending on the updates from the data feed, because <em>each new update</em> to the bar is a valid tick for filling the strategy’s orders.</li>
<li>An alternative way to confirm the script’s increased execution count is to select and clear the “After order is filled” checkbox in the “Settings/Properties” tab while <a href="/pine-script-docs/writing/profiling-and-optimization/#profiling-a-script">profiling</a> the code.</li>
</ul>
<h3 id="executions-on-realtime-bars" class="md-heading"><a href="#executions-on-realtime-bars">Executions on realtime <span class="fancy-wrap">bars<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>After a script running on the chart or in an alert executes across all historical bars in a dataset, the runtime system continues to execute the script on the current bar, if it is open, and on any new bars that form later. We refer to these bars as <em>realtime bars</em>, because they represent incoming data from a separate data feed that the script can access only <em>after</em> it finishes loading.</p>
<p>As explained in the previous section, historical bars represent confirmed data points. By contrast, a realtime bar represents an initially <em>unconfirmed</em> data point that evolves as new updates (ticks) arrive from the realtime data feed. With each new tick, the bar’s <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_low">low</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_volume">volume</a>, and other values update to represent the latest data while the bar remains open. After the bar closes, it becomes an <em>elapsed realtime bar</em>, whose values no longer change. Then, a new realtime bar opens after another tick arrives, and that bar updates as new data becomes available.</p>
<aside aria-label="Tip" class="tv-informer not-content" style="--informer-header-color:#089981;--informer-back-color-light:#DAF2EE;--informer-back-color-dark:#082621"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16Zm3.87-12.15c.36.2.49.66.28 1.02l-4 7a.75.75 0 0 1-1.18.16l-3-3a.75.75 0 1 1 1.06-1.06l2.3 2.3 3.52-6.14a.75.75 0 0 1 1.02-.28Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Tip</span>Scripts can identify which bars have a realtime state with the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_barstate.isrealtime">barstate.isrealtime</a> variable. Its value is <code dir="auto">true</code> for every bar that closes <em>after</em> the script’s loading time and <code dir="auto">false</code> for all previous bars. Additionally, scripts can detect <em>closed bars</em> with the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_barstate.isconfirmed">barstate.isconfirmed</a> variable. To learn more about these and other <code dir="auto">barstate.*</code> variables, refer to the <a href="/pine-script-docs/concepts/bar-states/">Bar states</a> page.</p></div></aside>
<p>As an <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_indicator">indicator</a> or <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_library">library</a> script runs on an open realtime bar, its compiled code executes once after <strong>every new update</strong> from the data feed. With each new execution, the script recalculates its results for that bar using the latest data. Consequently, the states of the script’s variables, expressions, and objects can <em>change</em> with each new execution while the bar remains open. The system <em>commits</em> the script’s data for the realtime bar only after the bar closes.</p>
<p>After each script execution that occurs <em>before</em> a bar’s closing tick, the runtime engine executes a <em>rollback</em> process. Rollback <em>resets</em> applicable script data to the latest committed states in the <a href="/pine-script-docs/language/execution-model/#time-series">time series</a>. This process enables the script to recalculate the bar’s results using only the latest available data — without the influence of <em>temporary</em> data from executions on the bar’s previous ticks.</p>
<p>Below, we explain how recalculation and rollback affect a script’s data and outputs, along with some notable exceptions to this process:</p>
<p><strong>Reinitialize variables</strong></p>
<p class="spacer-wrapper"><spacer></spacer>The runtime system erases the states of any variables that the script initializes during its executions before a bar’s close, excluding those declared using the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_varip">varip</a> keyword. When the script executes again after rollback, it <em>reinitializes</em> the variables with new values or references based on the latest available data.</p>
<p class="spacer-wrapper"><spacer></spacer>Likewise, the system does not preserve the <em>temporary</em> states of built-in variables that hold values for the current bar. Before the new script execution, it sets the variables to use the bar’s most recent data. For instance, the system updates <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a>, and <a href="https://www.tradingview.com/pine-script-reference/v6/#var_low">low</a> with the latest, highest, and lowest prices reported since the bar’s opening time.</p>
<p><strong>Reset changes to <code dir="auto">var</code> variables</strong></p>
<p class="spacer-wrapper"><spacer></spacer>Variables that use the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_var">var</a> keyword in their declaration are initialized only <em>once</em> — during the <em>first</em> execution of their scopes on a <em>closed bar</em>. Variables that use the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_var">var</a> keyword in their declaration remain initialized after the <em>first</em> time that their scopes execute on a bar’s <em>closing tick</em>. Their assigned values or references <em>persist</em> across subsequent bars, changing only after <a href="/pine-script-docs/language/variable-declarations/#variable-reassignment">reassignment</a> or compound assignment operations.</p>
<p class="spacer-wrapper"><spacer></spacer>Although these variables preserve data across successive bars, they <strong>do not</strong> preserve data across executions on the <em>ticks</em> of an open bar. Rollback reverts all variables declared with <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_var">var</a> before the current bar to the last committed states in the time series as of the previous bar.</p>
<p class="spacer-wrapper"><spacer></spacer>For instance, if a variable declared with <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_var">var</a> has a value of 20 on the open bar and 19 on the previous bar, the variable’s value reverts to 19 before the script executes on the next tick of the same bar. The temporary value of 20 does not persist.</p>
<p><strong>Replace plotted outputs</strong></p>
<p class="spacer-wrapper"><spacer></spacer>The <code dir="auto">plot*()</code>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_bgcolor">bgcolor()</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_barcolor">barcolor()</a>, and <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_fill">fill()</a> functions create visual outputs on <em>every bar</em>. These outputs are <em>temporary</em> on the open realtime bar. When the script executes again after rollback, the new outputs for the bar from calls to these functions <em>replace</em> the ones from the previous tick.</p>
<p class="spacer-wrapper"><spacer></spacer>For example, when the expression <code dir="auto">plot(close)</code> executes on the open bar, it displays the bar’s latest <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> value as of the current execution. However, the plotted result is <strong>temporary</strong> until the bar closes. After rollback, the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> variable updates, then the script calls <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plot">plot()</a> again on the next execution to replace the output from the previous tick and display the new value.</p>
<p><strong>Remove and revert objects</strong></p>
<p class="spacer-wrapper"><spacer></spacer><a href="/pine-script-docs/language/type-system/#user-defined-types">User-defined types (UDTs)</a> and special types such as <a href="/pine-script-docs/language/type-system/#collections">collections</a> and <a href="/pine-script-docs/language/type-system/#drawing-types">drawing types</a> are <em>reference types</em>. They define structures from which scripts create <em>objects</em> — independent entities that store data elsewhere in memory. Variables of these types hold <em>references</em> that provide access to specific objects and their data; the variables do <strong>not</strong> store objects directly.</p>
<p class="spacer-wrapper"><spacer></spacer>If a script creates objects on an open bar and does not assign their references to variables declared with the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_varip">varip</a> keyword, the rollback process <em>removes</em> those objects. During the next execution on the open bar, the script creates <em>new objects</em> if the updated logic allows it.</p>
<p class="spacer-wrapper"><spacer></spacer>For example, if a script calls <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_label.new">label.new()</a> to create a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_label">label</a> object on the open bar, the system <em>deletes</em> that object during rollback. On the next execution, the script evaluates <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_label.new">label.new()</a> again, creating a <em>new</em> label that replaces the output. The label created on the previous tick no longer exists.</p>
<p class="spacer-wrapper"><spacer></spacer>Similarly, for objects of built-in or user-defined types with references assigned to <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_var">var</a> variables, the rollback process reverts any changes to those objects that occur on the open bar. The only exception is for <a href="/pine-script-docs/language/type-system/#user-defined-types">UDTs</a> with <em>fields</em> that include the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_varip">varip</a> keyword. See the <a href="/pine-script-docs/language/objects/">Objects</a> page for more information.</p>
<p><strong>Exceptions</strong></p>
<p class="spacer-wrapper"><spacer></spacer>The runtime system does not revert <em>all</em> the data from script executions on an open bar. The following are notable exceptions to the rollback process:</p>
<ul>
<li>Variables or fields declared with the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_varip">varip</a> keyword <strong>do not</strong> revert to a previously committed state. They persist across <em>all</em> script executions after initialization, even those on the ticks of an open realtime bar.</li>
<li>Logged messages in the <a href="/pine-script-docs/writing/debugging/#pine-logs">Pine Logs</a> pane do not disappear after rollback. The messages from any <code dir="auto">log.*()</code> calls during executions on the ticks of realtime bars remain in the pane until the script reloads.</li>
<li>The data from <a href="/pine-script-docs/concepts/strategies/#orders-and-trades">strategy orders</a> placed or filled on the ticks within a bar is not subject to rollback. If a strategy script creates orders or the <a href="/pine-script-docs/concepts/strategies/#broker-emulator">broker emulator</a> fills orders on an open bar, the data from those events persists.</li>
<li>Rollback does not erase logs for <a href="/pine-script-docs/concepts/alerts/">alerts</a> from the “Alerts” menu. All messages from a script alert remain visible until the user restarts the alert.</li>
<li>Runtime errors from the system or the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_runtime.error">runtime.error()</a> function completely <em>stop</em> script executions. If an error occurs at any point while a script executes on an open bar, the system halts the script and does not revert the error after new updates from the data feed.</li>
</ul>
<p>Let’s inspect the behavior of a simple indicator on realtime bars. The following script calculates an <a href="https://www.tradingview.com/support/solutions/43000502338-relative-strength-index-rsi/">RSI</a> of <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> values using <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.rsi">ta.rsi()</a> and displays the result with a <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plot">plot()</a> call. To track the number of executions that occur <em>per bar</em>, the script increments an <code dir="auto">executions</code> variable declared with <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_varip">varip</a> and calculates its one-bar change using <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.change">ta.change()</a>. The script converts each bar’s execution count to a string with <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_str.tostring">str.tostring()</a>, then displays the result in a color-coded <a href="https://www.tradingview.com/pine-script-reference/v6/#type_label">label</a> at the bar’s <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a>. The label is purple if the bar is open. Otherwise, it is gray. The script also highlights the background of realtime bars in orange using <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_bgcolor">bgcolor()</a>:</p>
<div class="pine-colorizer not-content colorized" data-id="hl"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Executions&nbsp;on&nbsp;realtime&nbsp;bars&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;14-bar&nbsp;RSI&nbsp;of&nbsp;`close`&nbsp;prices.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.rsi</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Tracks&nbsp;the&nbsp;number&nbsp;of&nbsp;script&nbsp;executions,&nbsp;where&nbsp;1&nbsp;r</span><span class="mtk9">epresents&nbsp;the&nbsp;first&nbsp;execution.</span></span><br><span><span class="mtk18">varip</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">executions</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk9">//&nbsp;Add&nbsp;1&nbsp;to&nbsp;the&nbsp;`executions`&nbsp;value.</span></span><br><span><span class="mtk33">executions</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`color.gray`&nbsp;if&nbsp;the&nbsp;bar&nbsp;is&nbsp;confirmed&nbsp;(closed);</span><span class="mtk9">&nbsp;`color.purple`&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isconfirmed</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.gray</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Calculate&nbsp;the&nbsp;one-bar&nbsp;change&nbsp;in&nbsp;`executions`,&nbsp;t</span><span class="mtk9">hen&nbsp;convert&nbsp;the&nbsp;value&nbsp;to&nbsp;a&nbsp;string&nbsp;and&nbsp;display&nbsp;the&nbsp;</span><span class="mtk9">result&nbsp;in&nbsp;a&nbsp;label.</span></span><br><span><span class="mtk9">//&nbsp;Each&nbsp;call&nbsp;to&nbsp;`label.new()`&nbsp;creates&nbsp;a&nbsp;*new*&nbsp;`lab</span><span class="mtk9">el`&nbsp;object.</span></span><br><span><span class="mtk16">label.new</span><span class="mtk13">(</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk16">ta.change</span><span class="mtk13">(</span><span class="mtk33">executions</span><span class="mtk13">))</span><span class="mtk18">,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">force_overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span></span><br><span><span class="mtk1">&nbsp;</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`rsi`&nbsp;value&nbsp;with&nbsp;colors&nbsp;based&nbsp;on&nbsp;wheth</span><span class="mtk9">er&nbsp;the&nbsp;value&nbsp;is&nbsp;above&nbsp;50&nbsp;or&nbsp;not.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">rsi</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"RSI"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">rsi</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.maroon</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;chart's&nbsp;background&nbsp;in&nbsp;translucent</span><span class="mtk9">&nbsp;orange&nbsp;when&nbsp;`barstate.isrealtime`&nbsp;is&nbsp;`true`.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk11">barstate.isrealtime</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Realtime&nbsp;highlight"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">force_overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br></code></div>
<p>When we first add the script to the chart, it does <em>not</em> add an orange background to any bar because it calculates only on data that exists at the script’s loading time. This data is <em>historical</em>. Each bar’s label shows a value of 1 because indicators always execute <em>once</em> per historical bar:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-Executions-on-realtime-bars-1.C6ZIpkKC_Z1DmFI2.webp" alt="image" width="2656" height="1240" loading="lazy" decoding="async"></p>
<p>Notice the countdown timer and the <em>purple</em> label for the latest bar in the chart above. These both indicate that the bar is <em>open</em> and subject to changes. A new update from the data feed affects the bar’s values, triggering rollback and a new script execution to recalculate the results.</p>
<p>When rollback occurs, the runtime system reverts the internal data of the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.rsi">ta.rsi()</a> call to its last committed state, erases the state of the <code dir="auto">rsi</code> variable, and deletes the latest <a href="https://www.tradingview.com/pine-script-reference/v6/#type_label">label</a> object. However, the system does not revert the <code dir="auto">executions</code> variable because it uses the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_varip">varip</a> keyword.</p>
<p>After rollback, the system updates the built-in <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a>, and <code dir="auto">barstate.*</code> variables using the current bar’s latest data, and the new execution begins. The script evaluates the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.rsi">ta.rsi()</a> call using the new <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> price and reinitializes the <code dir="auto">rsi</code> variable with the returned value. Then, it increases the <code dir="auto">executions</code> value by one, evaluates <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.change">ta.change()</a> again, and creates a new label at the bar’s current high price to show the updated result. Lastly, it evaluates the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plot">plot()</a> and <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_bgcolor">bgcolor()</a> calls to replace the bar’s plotted visuals. The last bar’s label remains purple because the bar is still open, but the background color is now <em>orange</em> because <a href="https://www.tradingview.com/pine-script-reference/v6/#var_barstate.isrealtime">barstate.isrealtime</a> is <code dir="auto">true</code>:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-Executions-on-realtime-bars-2.DkBtTFWJ_wi3cQ.webp" alt="image" width="2656" height="1242" loading="lazy" decoding="async"></p>
<p>As subsequent updates become available from the data feed, the pattern of rollback and re-execution continues, and the script’s outputs for the bar update with each new execution:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-Executions-on-realtime-bars-3.5O5RsfWP_2oucrw.webp" alt="image" width="2656" height="1248" loading="lazy" decoding="async"></p>
<p>The last time that rollback and another execution occur on this bar is after the <em>closing tick</em>, when the bar becomes an <em>elapsed</em> realtime bar. After the final execution, the bar’s label is <em>gray</em> because <a href="https://www.tradingview.com/pine-script-reference/v6/#var_barstate.isconfirmed">barstate.isconfirmed</a> is <code dir="auto">true</code>. The runtime system then <em>commits</em> necessary data from this execution to the <a href="/pine-script-docs/language/execution-model/#time-series">time series</a> for calculations on future bars.</p>
<p>Then, a new realtime bar opens after another update from the data feed, and the execution pattern continues:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-Executions-on-realtime-bars-4.C8UTIyzZ_1eXV6W.webp" alt="image" width="2656" height="1240" loading="lazy" decoding="async"></p>
<p>Note that:</p>
<ul>
<li>Although the previous bar is now confirmed, it still has an orange background corresponding to a <em>realtime</em> state because it closed <strong>after</strong> the script’s loading time. When the script later reloads after an <a href="/pine-script-docs/language/execution-model/#events-that-trigger-script-executions">execution-triggering event</a>, that bar becomes <em>historical</em>.</li>
</ul>
<p>It’s important to note that <a href="/pine-script-docs/concepts/strategies/">strategies</a> often execute differently than indicators on realtime bars. By default, they execute only <strong>once</strong> per bar at each <em>closing tick</em> without undergoing rollback. However, users can modify a strategy’s <a href="/pine-script-docs/concepts/strategies/#altering-calculation-behavior">calculation behavior</a> to allow rollback and re-execution on a bar before its closing tick.</p>
<p>If the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy">strategy()</a> statement includes <code dir="auto">calc_on_every_tick = true</code>, or if the user selects the “On every tick” checkbox in the “Settings/Properties” tab, the script executes on a realtime bar after <em>each new update</em> from the data feed, similar to an indicator.</p>
<p>Additionally, if the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy">strategy()</a> statement includes <code dir="auto">calc_on_order_fills = true</code> or the user selects “After order is filled” in the “Settings/Properties” tab, the script executes on <em>each tick</em> where the <a href="/pine-script-docs/concepts/strategies/#broker-emulator">broker emulator</a> fills an order. With this behavior, the system can execute the script multiple times on the open bar, but only on the ticks where an <em>order fill</em> occurs.</p>
<aside aria-label="Note" class="tv-informer not-content" style="--informer-header-color:#6A6D78;--informer-back-color-light:#F0F3FA;--informer-back-color-dark:#2A2E39"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM8 6a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm1 2c.49 0 1 .59 1 1v3.01c0 .42-.51.99-1 .99s-1-.57-1-.99V9c0-.41.51-1 1-1Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Note</span>Rollback typically occurs only after script executions on realtime bars. However, it can also happen on <em>historical bars</em> for strategies that recalculate after an order fills, because such scripts can execute <em>more than once</em> on <em>any</em> bar.</p></div></aside>
<p>To summarize the general process for script executions on realtime bars:</p>
<ul>
<li>An <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_indicator">indicator</a> or <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_library">library</a> script executes on the <em>first available tick</em> in an open realtime bar, then <em>once per update</em> to recalculate the results for the bar using the latest data. A <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy">strategy</a> script executes only on the bar’s <em>closing tick</em> by default, but users can modify its calculation behavior to allow executions while the bar is open.</li>
<li>Before each new script execution on an open bar, the runtime system executes a <em>rollback</em> process, which <em>reverts</em> all applicable variables, expressions, and objects to their <em>last committed states</em> as of the previous bar’s close.</li>
<li>After the script executes on an <em>elapsed</em> realtime bar’s closing tick, the system <em>commits</em> necessary data from that execution to the <a href="/pine-script-docs/language/execution-model/#time-series">time series</a> for access on later bars. It does <strong>not</strong> commit the data from executions on the bar’s <em>unconfirmed</em> values from previous ticks.</li>
</ul>
<h3 id="events-that-trigger-script-executions" class="md-heading"><a href="#events-that-trigger-script-executions">Events that trigger script <span class="fancy-wrap">executions<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Several events cause a script to load and execute across all the available bars in a dataset. The specific events that trigger the loading process depend on where the script runs.</p>
<p>For a script on the <a href="https://www.tradingview.com/chart/">chart</a>, the following events always cause the script to load and perform <em>new executions</em> on every bar:</p>
<ul>
<li>The user adds the script to the chart for the first time from the Pine Editor or the “Indicators, metrics, and strategies” menu.</li>
<li>The user saves an update to the script while it is active on the chart.</li>
<li>The chart is refreshed while the script is active.</li>
</ul>
<p>Other events also trigger the loading process for a script on the chart. However, these events do not <em>always</em> cause new script executions on past bars. The results from running a script with a unique combination of settings are often temporarily <em>cached</em>. If cached data exists for a selected combination of settings, the system loads the script using that data. See the <a href="/pine-script-docs/language/execution-model/#caching">Caching</a> section for more information.</p>
<p>Below are the additional events that cause a script to load on the chart, either by performing new executions across the dataset or by using available cached data:</p>
<ul>
<li>The user selects new values for the <a href="/pine-script-docs/concepts/inputs/">inputs</a> or <a href="https://www.tradingview.com/support/solutions/43000628599-strategy-properties/">strategy properties</a> in the script’s “Settings” menu.</li>
<li>The script uses the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_chart.left_visible_bar_time">chart.left_visible_bar_time</a> or <a href="https://www.tradingview.com/pine-script-reference/v6/#var_chart.right_visible_bar_time">chart.right_visible_bar_time</a> variable, and the visible chart range changes.</li>
<li>The script uses the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_chart.fg_color">chart.fg_color</a> or <a href="https://www.tradingview.com/pine-script-reference/v6/#var_chart.bg_color">chart.bg_color</a> variable, and the user changes the chart’s background color.</li>
<li>The chart loads a new dataset with a different <em>timeframe</em> or <em>ticker identifier</em>. Several user actions affect a chart’s ticker ID, such as selecting a symbol from the “Symbol Search” menu, changing the chart type, toggling data modifications in the chart’s settings, and activating <a href="https://www.tradingview.com/support/solutions/43000712747-bar-replay-how-and-why-to-test-a-strategy-in-the-past/">Bar Replay</a> mode.</li>
<li>The user opens or closes the <a href="/pine-script-docs/writing/debugging/#pine-logs">Pine Logs</a> pane.</li>
<li>The user activates or deactivates the <a href="/pine-script-docs/writing/profiling-and-optimization/#pine-profiler">Pine Profiler</a>.</li>
</ul>
<p>For scripts used in other locations, the following events trigger the loading process:</p>
<ul>
<li>The user creates a new script <a href="/pine-script-docs/concepts/alerts/">alert</a> from the “Create Alert” dialog box.</li>
<li>The user pauses and restarts an alert instance from the “Alerts” menu.</li>
<li>The user clicks the “Generate report” button in the <a href="/pine-script-docs/concepts/strategies/#strategy-tester">Strategy Tester</a> while <a href="https://www.tradingview.com/support/solutions/43000666199-what-is-deep-backtesting/">Deep Backtesting</a> mode is enabled.</li>
<li>The user clicks the “Scan” button in the <a href="https://www.tradingview.com/support/solutions/43000742436-tradingview-pine-screener-key-features-and-requirements/">Pine Screener</a> to run the script on the datasets from a chosen watchlist.</li>
</ul>
<p><em>After</em> a script loads, either of the following causes new script executions on an <em>open bar</em>:</p>
<ul>
<li>One of the events above causes the script to load again and execute across the <em>entire dataset</em> up to the bar.</li>
<li>The script runs on the chart or in an alert, and the bar updates after new data becomes available. The system performs <em>rollback</em> and re-executes the script on that bar using the latest data. The only exception is if the script is a strategy that does not allow recalculation on the new tick.</li>
</ul>
<p>When a script completely reloads on the chart or in an alert after an applicable event, all the <a href="/pine-script-docs/language/execution-model/#executions-on-realtime-bars">elapsed realtime bars</a> from the script’s previous run become <a href="/pine-script-docs/language/execution-model/#executions-on-historical-bars">historical bars</a> in the new run, because they represent <em>confirmed</em> data points that the script accesses from <em>a different data feed</em> as it loads.</p>
<p>The bars in a symbol’s dataset come from two distinct data feeds: the <em>historical</em> feed and the <em>realtime</em> feed. The historical feed reports only the <em>final</em> values for each bar, whereas the realtime feed includes the <em>temporary</em> values from all available ticks. When a realtime bar becomes historical after a script restarts, the values from the bar’s previous ticks are no longer accessible; only the <strong>final</strong> price, volume, and other values remain. Therefore, if a script relies on temporary data from realtime bars in its calculations, it might behave differently after reloading.</p>
<p>For example, the following script calculates the one-bar arithmetic return of the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> series and displays the result as a line plot. On each realtime bar, the script updates three variables declared with <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_varip">varip</a> to track the first, highest, and lowest return values calculated during executions across the bar’s ticks, then calls <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plotcandle">plotcandle()</a> to plot a candle showing the values. Additionally, it uses <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_bgcolor">bgcolor()</a> to highlight the background of realtime bars in orange:</p>
<div class="pine-colorizer not-content colorized" data-id="w0"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Reloading&nbsp;a&nbsp;script&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">precision</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;one-bar&nbsp;arithmetic&nbsp;return&nbsp;of&nbsp;the&nbsp;`close`&nbsp;seri</span><span class="mtk9">es.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceReturn</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.change</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Declare&nbsp;persistent&nbsp;variables&nbsp;to&nbsp;track&nbsp;the&nbsp;first</span><span class="mtk9">,&nbsp;highest,&nbsp;and&nbsp;lowest&nbsp;`priceReturn`&nbsp;values&nbsp;across&nbsp;</span><span class="mtk9">ticks&nbsp;in</span></span><br><span><span class="mtk9">//&nbsp;each&nbsp;realtime&nbsp;bar.</span></span><br><span><span class="mtk18">varip</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">o</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk18">varip</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">h</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk18">varip</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">l</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isrealtime</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;On&nbsp;the&nbsp;first&nbsp;tick&nbsp;in&nbsp;the&nbsp;realtime&nbsp;bar,&nbsp;reassign</span><span class="mtk9">&nbsp;`o`,&nbsp;`h`,&nbsp;and&nbsp;`l`&nbsp;to&nbsp;hold&nbsp;the&nbsp;value&nbsp;of&nbsp;`priceRetu</span><span class="mtk9">rn`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isnew</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">o</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceReturn</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">h</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceReturn</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">l</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceReturn</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Otherwise,&nbsp;reassign&nbsp;`h`&nbsp;and&nbsp;`l`&nbsp;to&nbsp;the&nbsp;bar's&nbsp;hi</span><span class="mtk9">ghest&nbsp;and&nbsp;lowest&nbsp;`priceReturn`&nbsp;value&nbsp;as&nbsp;of&nbsp;the&nbsp;cur</span><span class="mtk9">rent&nbsp;tick.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">else</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">h</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk33">h</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceReturn</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">l</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.min</span><span class="mtk13">(</span><span class="mtk33">l</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceReturn</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;candles&nbsp;to&nbsp;display&nbsp;the&nbsp;`o`,&nbsp;`h`,&nbsp;`l`,&nbsp;and&nbsp;</span><span class="mtk9">`priceReturn`&nbsp;values&nbsp;for&nbsp;each&nbsp;realtime&nbsp;bar.</span></span><br><span><span class="mtk9">//&nbsp;The&nbsp;candles&nbsp;do&nbsp;not&nbsp;appear&nbsp;on&nbsp;historical&nbsp;bars,&nbsp;b</span><span class="mtk9">ecause&nbsp;`o`,&nbsp;`h`,&nbsp;and&nbsp;`l`&nbsp;are&nbsp;`na`&nbsp;on&nbsp;those&nbsp;bars.</span></span><br><span><span class="mtk16">plotcandle</span><span class="mtk13">(</span><span class="mtk33">o</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">h</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">l</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceReturn</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Return&nbsp;candles"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bordercolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Dispaly&nbsp;the&nbsp;`priceReturn`&nbsp;series&nbsp;as&nbsp;a&nbsp;purple&nbsp;li</span><span class="mtk9">ne&nbsp;plot.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">priceReturn</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Return&nbsp;plot"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;background&nbsp;of&nbsp;all&nbsp;realtime&nbsp;bars&nbsp;i</span><span class="mtk9">n&nbsp;orange.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk11">barstate.isrealtime</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Realtime&nbsp;highlight"</span><span class="mtk13">)</span></span><br></code></div>
<p>After the script loads on the chart and executes on several realtime bars, all the elapsed realtime bars, as well as the open realtime bar, include plotted return candles and an orange background color:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-Events-that-trigger-script-executions-1.Bu_ElpOQ_Z25zgpA.webp" alt="image" width="2656" height="1240" loading="lazy" decoding="async"></p>
<p>After an applicable event, such as a chart refresh, the script <em>reloads</em> and executes across the dataset again. All the closed bars with a realtime state in the previous run become <em>historical</em> bars in the new run. The results thus change because our script relies on realtime data. As shown below, the script does not display candles or background colors for previous bars after we refresh the chart. Those outputs appear only for the latest bar, after new ticks become available, because that bar is now the <strong>only</strong> one with a realtime state:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-Events-that-trigger-script-executions-2.CbIdk5sI_W8NUw.webp" alt="image" width="2656" height="1240" loading="lazy" decoding="async"></p>
<p>Note that:</p>
<ul>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v6/#var_barstate.isnew">barstate.isnew</a> variable has a value of <code dir="auto">true</code> when a realtime bar opens, and <code dir="auto">false</code> on all subsequent updates to the bar. If the script reloads midway through a realtime bar’s progression, only the background color appears on that bar. The script does not show a candle on the first realtime bar in that case, because its <code dir="auto">o</code>, <code dir="auto">h</code>, and <code dir="auto">l</code> variables hold <a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a> until the first time that <a href="https://www.tradingview.com/pine-script-reference/v6/#var_barstate.isnew">barstate.isnew</a> is <code dir="auto">true</code>.</li>
</ul>
<aside aria-label="Note" class="tv-informer not-content" style="--informer-header-color:#6A6D78;--informer-back-color-light:#F0F3FA;--informer-back-color-dark:#2A2E39"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM8 6a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm1 2c.49 0 1 .59 1 1v3.01c0 .42-.51.99-1 .99s-1-.57-1-.99V9c0-.41.51-1 1-1Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Note</span></p><p>A script might also behave differently after reloading due to differences between bars constructed from realtime data and those retrieved from historical data feeds. Occasionally, a data provider must adjust the values of a closed bar originally built from realtime updates. In such cases, the script accesses the adjusted values only after <em>restarting</em> and retrieving the bar from the <em>historical</em> feed. Although such adjustments are typically minor and infrequent, they can cause slight variations in a script’s calculations on former realtime bars.</p><br><p>Refer to the <a href="/pine-script-docs/concepts/repainting/">Repainting</a> page to learn more about potential differences between historical and realtime script behaviors and their causes.</p><p></p></div></aside>
<h4 id="caching" class="md-heading"><a href="#caching"> <span class="fancy-wrap">Caching<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p>When a script runs on a chart for the <em>first time</em> using a <em>unique configuration</em>, the data from that run is often temporarily cached for reuse. The cached data is erased after the chart is refreshed or the user updates the script’s source code.</p>
<p>In this context, the configuration refers to the combined state of all script, chart, and developer tool settings that can affect the script’s executions. This combination includes:</p>
<ul>
<li>The values of <a href="/pine-script-docs/concepts/inputs/">inputs</a> in the script’s “Settings/Inputs” tab.</li>
<li>The values of the <a href="https://www.tradingview.com/support/solutions/43000628599-strategy-properties/">strategy properties</a> in the “Settings/Properties” tab.</li>
<li>The values of the <code dir="auto">chart.*</code> variables whose <a href="/pine-script-docs/language/type-system/#qualifiers">qualifiers</a> are “input” (<a href="https://www.tradingview.com/pine-script-reference/v6/#var_chart.left_visible_bar_time">chart.left_visible_bar_time</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_chart.right_visible_bar_time">chart.right_visible_bar_time</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_chart.fg_color">chart.fg_color</a>, and <a href="https://www.tradingview.com/pine-script-reference/v6/#var_chart.bg_color">chart.bg_color</a>).</li>
<li>The chart’s timeframe.</li>
<li>The chart’s ticker identifier.</li>
<li>Whether the <a href="/pine-script-docs/writing/debugging/#pine-logs">Pine Logs</a> pane is open or closed.</li>
<li>Whether the <a href="/pine-script-docs/writing/profiling-and-optimization/#pine-profiler">Pine Profiler</a> is active or not.</li>
</ul>
<p>Each time that a script runs using a unique combination of settings, it executes from start to end on each bar in the dataset to perform new calculations. If possible, the script’s data from the run is then cached. If cached data is available on past bars for a selected combination of settings, the runtime system loads the script using that data.</p>
<p>This behavior enables users to change a script’s inputs, alter the chart, and toggle developer tools without losing information — including <a href="/pine-script-docs/concepts/bar-states/">bar states</a> — from previous script runs using different settings. Additionally, caching helps reduce loading times and resource requirements when switching between settings or adding multiple instances of the same script to the chart.</p>
<p>To understand this behavior, let’s revisit the script from the <a href="/pine-script-docs/language/execution-model/#events-that-trigger-script-executions">previous section</a>. The script has different behaviors on historical and realtime bars. In the version below, we’ve added a <code dir="auto">lengthInput</code> variable that holds the value from an <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_input.int">input.int()</a> call. The script uses this variable to define the length of the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.change">ta.change()</a> calculation and the offset of the <a href="/pine-script-docs/language/operators/#-history-referencing-operator">history-referencing operator</a>:</p>
<div class="pine-colorizer not-content colorized" data-id="15h"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Caching&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">precision</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;bar&nbsp;span&nbsp;of&nbsp;the&nbsp;`priceReturn`&nbsp;calculation.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Length"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;arithmetic&nbsp;return&nbsp;of&nbsp;the&nbsp;`close`&nbsp;series&nbsp;acros</span><span class="mtk9">s&nbsp;`lengthInput`&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceReturn</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.change</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">lengthInput</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk33">lengthInput</span><span class="mtk13">]</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Declare&nbsp;persistent&nbsp;variables&nbsp;to&nbsp;track&nbsp;the&nbsp;first</span><span class="mtk9">,&nbsp;highest,&nbsp;and&nbsp;lowest&nbsp;`priceReturn`&nbsp;values&nbsp;across&nbsp;</span><span class="mtk9">ticks&nbsp;in</span></span><br><span><span class="mtk9">//&nbsp;each&nbsp;realtime&nbsp;bar.</span></span><br><span><span class="mtk18">varip</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">o</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk18">varip</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">h</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk18">varip</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">l</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isrealtime</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;On&nbsp;the&nbsp;first&nbsp;tick&nbsp;in&nbsp;the&nbsp;realtime&nbsp;bar,&nbsp;reassign</span><span class="mtk9">&nbsp;`o`,&nbsp;`h`,&nbsp;and&nbsp;`l`&nbsp;to&nbsp;hold&nbsp;the&nbsp;value&nbsp;of&nbsp;`priceRetu</span><span class="mtk9">rn`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isnew</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">o</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceReturn</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">h</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceReturn</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">l</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceReturn</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Otherwise,&nbsp;reassign&nbsp;`h`&nbsp;and&nbsp;`l`&nbsp;to&nbsp;the&nbsp;bar's&nbsp;hi</span><span class="mtk9">ghest&nbsp;and&nbsp;lowest&nbsp;`priceReturn`&nbsp;value&nbsp;as&nbsp;of&nbsp;the&nbsp;cur</span><span class="mtk9">rent&nbsp;tick.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">else</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">h</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk33">h</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceReturn</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">l</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">math.min</span><span class="mtk13">(</span><span class="mtk33">l</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceReturn</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;candles&nbsp;to&nbsp;display&nbsp;the&nbsp;`o`,&nbsp;`h`,&nbsp;`l`,&nbsp;and&nbsp;</span><span class="mtk9">`priceReturn`&nbsp;values&nbsp;for&nbsp;each&nbsp;realtime&nbsp;bar.</span></span><br><span><span class="mtk9">//&nbsp;The&nbsp;candles&nbsp;do&nbsp;not&nbsp;appear&nbsp;on&nbsp;historical&nbsp;bars,&nbsp;b</span><span class="mtk9">ecause&nbsp;`o`,&nbsp;`h`,&nbsp;and&nbsp;`l`&nbsp;are&nbsp;`na`&nbsp;on&nbsp;those&nbsp;bars.</span></span><br><span><span class="mtk16">plotcandle</span><span class="mtk13">(</span><span class="mtk33">o</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">h</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">l</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">priceReturn</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Return&nbsp;candles"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bordercolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Dispaly&nbsp;the&nbsp;`priceReturn`&nbsp;series&nbsp;as&nbsp;a&nbsp;purple&nbsp;li</span><span class="mtk9">ne&nbsp;plot.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">priceReturn</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Return&nbsp;plot"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;background&nbsp;of&nbsp;all&nbsp;realtime&nbsp;bars&nbsp;i</span><span class="mtk9">n&nbsp;orange.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk11">barstate.isrealtime</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Realtime&nbsp;highlight"</span><span class="mtk13">)</span></span><br></code></div>
<p>After we add the script to our 1m chart and let it run for a few minutes with a “Length” input value of 5, the script plots candles and highlights the background for the latest few bars, because <a href="https://www.tradingview.com/pine-script-reference/v6/#var_barstate.isrealtime">barstate.isrealtime</a> is <code dir="auto">true</code> on those bars:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-Events-that-trigger-script-executions-Caching-1.BY9-bg_Z_Z1h9UoE.webp" alt="image" width="2654" height="1244" loading="lazy" decoding="async"></p>
<p>Let’s change the “Length” input to a new value, causing the script to reload and execute across the dataset again. Here, we changed the value from 5 to 10 and let the script execute on some new ticks. The script no longer displays candles and background colors for the same bars after restarting, because it now accesses the data for those formerly realtime bars from the <em>historical</em> data feed:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-Events-that-trigger-script-executions-Caching-2.DyVd2t5m_Z1wVpJs.webp" alt="image" width="2654" height="1242" loading="lazy" decoding="async"></p>
<p>As shown above, the realtime bar information from the first run is <em>not available</em> when we change the script’s input to a new value. However, the data from that previous run still exists in memory. If we revert the “Length” input’s value to 5, the candle plot and background colors start on the same bar as the first run:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-Events-that-trigger-script-executions-Caching-3.ByASZdF6_Z1Va6dx.webp" alt="image" width="2654" height="1250" loading="lazy" decoding="async"></p>
<p>If we add a second instance of the script to the chart, using the same settings, the runtime system loads the new instance using the cached data instead of executing it entirely from scratch. As such, its outputs are <em>identical</em> to those from the first script instance, even though we added it to the chart a few bars later:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-Events-that-trigger-script-executions-Caching-4.CGwk5hPj_ZgkqEL.webp" alt="image" width="2656" height="1250" loading="lazy" decoding="async"></p>
<p>Similarly, cached data usually remains available even if we remove the script from our chart and add it again.</p>
<aside aria-label="Tip" class="tv-informer not-content" style="--informer-header-color:#089981;--informer-back-color-light:#DAF2EE;--informer-back-color-dark:#082621"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16Zm3.87-12.15c.36.2.49.66.28 1.02l-4 7a.75.75 0 0 1-1.18.16l-3-3a.75.75 0 1 1 1.06-1.06l2.3 2.3 3.52-6.14a.75.75 0 0 1 1.02-.28Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Tip</span>You can clear cached data for a script on the chart at any time by simply reloading the chart.</p></div></aside>
<h3 id="time-series" class="md-heading"><a href="#time-series">Time <span class="fancy-wrap">series<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>A symbol’s dataset is a form of <em>time series</em> — a sequence of collected values indexed by time. Each bar represents a distinct data point, anchored to a specific time, that contains price and volume data for a particular period. This data format thus shows how a symbol’s values progress across time in successive periodic steps.</p>
<p>Pine Script’s internal time series structure follows a similar format. After executing a script on a closed bar’s confirmed values, the runtime system <em>commits (saves)</em> the results of the script’s statements and expressions to internal time series for later use. Each bar with committed data has an assigned <em>index</em> in the series, where 0 represents the first bar, 1 represents the second, and so on. Scripts can retrieve this index with the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_bar_index">bar_index</a> variable.</p>
<p>Scripts can access the data committed to the time series on past bars by using the <a href="/pine-script-docs/language/operators/#-history-referencing-operator">[] history-referencing operator</a>. The value between the operator’s square brackets specifies the position of the referenced bar in the time series as a <em>relative offset</em> behind the current bar. For variables and expressions in the global scope, an offset value of 1 refers to the previous bar at <code dir="auto">bar_index - 1</code> (one bar back), a value of 2 refers to the bar at <code dir="auto">bar_index - 2</code> (two bars back), and so on. An offset of 0 always refers to the <em>current bar</em>.</p>
<p>For example, consider the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_open">open</a> variable, which holds the opening price of the current bar on which the script executes. Before each script execution on a new bar, the runtime system commits the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_open">open</a> value from the last execution on the previous bar. Then, it updates the variable to hold the current bar’s opening price. To access the committed <a href="https://www.tradingview.com/pine-script-reference/v6/#var_open">open</a> value for the previous bar, we can use the expression <code dir="auto">open[1]</code>. To access the committed value from 10 bars back, we use <code dir="auto">open[10]</code>.</p>
<p>The script below performs three history-referencing operations to retrieve the current bar’s <a href="https://www.tradingview.com/pine-script-reference/v6/#var_open">open</a> value, the value from one bar back, and the value from a user-specified number of bars back. Then, it plots the retrieved values on the chart for comparison:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-Time-series-1.CzCPjlKh_1P3h3k.webp" alt="image" width="2646" height="1190" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="4o4"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"History&nbsp;referencing&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">behind_chart</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">false</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;bars&nbsp;back&nbsp;from&nbsp;which&nbsp;to&nbsp;retrieve&nbsp;th</span><span class="mtk9">e&nbsp;`open`&nbsp;price&nbsp;for&nbsp;`pastOpen`.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">offsetInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Bar&nbsp;offset"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;current&nbsp;bar's&nbsp;opening&nbsp;price.&nbsp;`open[0]`&nbsp;is&nbsp;equ</span><span class="mtk9">ivalent&nbsp;to&nbsp;using&nbsp;`open`&nbsp;without&nbsp;the&nbsp;`[]`&nbsp;operator.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">currOpen</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk13">[</span><span class="mtk12">0</span><span class="mtk13">]</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;last&nbsp;committed&nbsp;`open`&nbsp;value.&nbsp;Represents&nbsp;the&nbsp;p</span><span class="mtk9">revious&nbsp;bar's&nbsp;value,&nbsp;or&nbsp;`na`&nbsp;if&nbsp;no&nbsp;previous&nbsp;bar&nbsp;ex</span><span class="mtk9">ists.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">prevOpen</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`open`&nbsp;value&nbsp;committed&nbsp;`offsetInput`&nbsp;bars&nbsp;bac</span><span class="mtk9">k,&nbsp;or&nbsp;`na`&nbsp;if&nbsp;no&nbsp;bar&nbsp;exists&nbsp;at&nbsp;that&nbsp;offset.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">pastOpen</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk13">[</span><span class="mtk33">offsetInput</span><span class="mtk13">]</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;`currOpen`,&nbsp;`prevOpen`,&nbsp;and&nbsp;`pastOpen`&nbsp;for</span><span class="mtk9">&nbsp;comparison.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">currOpen</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Current&nbsp;`open`"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">prevOpen</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Previous&nbsp;bar&nbsp;`open`"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">pastOpen</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Past&nbsp;`open`&nbsp;from&nbsp;custom&nbsp;offset"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk12">4</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>The expression <code dir="auto">open[0]</code> is equivalent to using <a href="https://www.tradingview.com/pine-script-reference/v6/#var_open">open</a> without the history-referencing operator, because an offset of 0 refers to the current bar.</li>
<li>At the beginning of the chart’s dataset, the expressions <code dir="auto">open[1]</code> and <code dir="auto">open[offsetInput]</code> return <a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a> because they refer to previous bars that are unavailable.</li>
<li>Each history-referencing expression also leaves a trail of values in the time series. Therefore, it is possible to retrieve past states of the expression using another history-referencing operation, e.g., <code dir="auto">(open[offsetInput])[1]</code>.</li>
<li>Internally, the system maintains a <em>limited amount</em> of time series data for variables and expressions in fixed-length <em>historical buffers</em>. These buffers define the <em>maximum offsets</em> allowed for history-referencing operations. See the next section, <a href="/pine-script-docs/language/execution-model/#historical-buffers">Historical buffers</a>, to learn more.</li>
</ul>
<p>Another way that scripts use committed values from a time series is by calling the built-in functions that reference history internally, such as those in the <code dir="auto">ta.*</code> namespace. For example, the expression <code dir="auto">ta.highest(high, 20)</code> calculates the highest value from the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a> series over a 20-bar window. It compares the series’ current value to the committed values from the previous 19 bars to determine the result. The script below executes this call on each bar and plots the resulting series on the chart. Additionally, the script colors the background of the last 20 bars on the chart to highlight the bars used in the latest execution’s <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.highest">ta.highest()</a> call:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-Time-series-2.tycqzMI6_AVJD9.webp" alt="image" width="2652" height="1182" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="4da"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"History&nbsp;referencing&nbsp;in&nbsp;functions&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">behind_chart</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">false</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;highest&nbsp;value&nbsp;from&nbsp;the&nbsp;`high`&nbsp;series&nbsp;across&nbsp;t</span><span class="mtk9">he&nbsp;20&nbsp;most&nbsp;recent&nbsp;bars.</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;`ta.highest()`&nbsp;call&nbsp;compares&nbsp;the&nbsp;c</span><span class="mtk9">urrent&nbsp;`high`&nbsp;to&nbsp;the&nbsp;last&nbsp;19&nbsp;committed&nbsp;values.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">highest</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.highest</span><span class="mtk13">(</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`highest`&nbsp;series&nbsp;on&nbsp;the&nbsp;chart.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">highest</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"20-bar&nbsp;high"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Color&nbsp;the&nbsp;background&nbsp;of&nbsp;the&nbsp;last&nbsp;20&nbsp;bars,&nbsp;i.e.,</span><span class="mtk9">&nbsp;the&nbsp;bars&nbsp;used&nbsp;by&nbsp;the&nbsp;latest&nbsp;execution's&nbsp;`ta.highe</span><span class="mtk9">st()`&nbsp;call.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">show_last</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Last&nbsp;20&nbsp;bar&nbsp;highlight"</span><span class="mtk13">)</span></span><br></code></div>
<p>Note that:</p>
<ul>
<li>The first 19 bars of the chart have a plotted value of <a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a>, because the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.highest">ta.highest()</a> function call requires the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_high">high</a> values from the current bar and 19 previous bars to calculate the result.</li>
<li>All function calls and expressions that do not return “void” leave historical trails in the time series, just like variables. Therefore, scripts can use an expression such as <code dir="auto">ta.highest(high, 20)[10]</code> to retrieve the 20-bar high from 10 bars back.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.highest">ta.highest()</a> function and other functions that access past values from a time series must execute in the <strong>global scope</strong> for consistent calculations. Time series storage for variables and expressions in local scopes works <em>differently</em> than that for global values. See the <a href="/pine-script-docs/language/execution-model/#time-series-in-scopes">Time series in scopes</a> section for more information.</li>
</ul>
<aside aria-label="Note" class="tv-informer not-content" style="--informer-header-color:#6A6D78;--informer-back-color-light:#F0F3FA;--informer-back-color-dark:#2A2E39"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM8 6a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm1 2c.49 0 1 .59 1 1v3.01c0 .42-.51.99-1 .99s-1-.57-1-.99V9c0-.41.51-1 1-1Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Note</span></p><p>Programmers should not confuse time series with the “series” qualifier. The time series concept describes how Pine’s runtime system stores and retrieves data across successive script executions. In contrast, the “series” qualifier describes variables and expressions whose values can change from bar to bar, such as <a href="https://www.tradingview.com/pine-script-reference/v6/#var_open">open</a>.</p><br><p>To understand this distinction, consider the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_timeframe.period">timeframe.period</a> variable, which is of the “simple string” <em>qualified type</em>. The variable’s value cannot change because its <em>qualifier</em> is “simple”, but it still leaves a trail of successive values in the time series. It is possible, though not very useful, to retrieve the value from 10 bars back using an expression such as <code dir="auto">timeframe.period[10]</code>. The returned value equals the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_timeframe.period">timeframe.period</a> value for all bars with a <a href="https://www.tradingview.com/pine-script-reference/v6/#var_bar_index">bar_index</a> of 10 and above. However, the expression’s result is “series string”, because the expression returns a <em>different</em> value (<a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a>) on the first 10 bars.</p><br><p>See the <a href="/pine-script-docs/language/type-system/#qualifiers">Qualifiers</a> section of the <a href="/pine-script-docs/language/type-system/">Type system</a> page to learn more about “series” and other qualifiers.</p><p></p></div></aside>
<h4 id="historical-buffers" class="md-heading"><a href="#historical-buffers">Historical <span class="fancy-wrap">buffers<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p>To promote efficiency and help ensure computing resources remain available for all users, the Pine Script runtime system uses fixed-length <em>historical buffers</em> to maintain a <em>limited amount</em> of time series data for all variables and expressions. These historical buffers define the <em>maximum</em> number of committed data points that a script can access on any bar via the <a href="/pine-script-docs/language/operators/#-history-referencing-operator">history-referencing operator</a> or the built-in functions that reference past bars internally.</p>
<p>For most series, the underlying historical buffer can contain data from up to <strong>5000</strong> past bars. The only exception is for some built-in series such as <a href="https://www.tradingview.com/pine-script-reference/v6/#var_open">open</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a>, and <a href="https://www.tradingview.com/pine-script-reference/v6/#var_time">time</a>, whose buffers can store data for <em>more</em> than 5000 bars.</p>
<p>Although these buffers can contain thousands of data points at their maximum size, a script might not <em>require</em> that much past data for its calculations on any bar. Therefore, the runtime system automatically optimizes the size of each series’ historical buffer based on the historical references that the script performs as it loads on the dataset. Each resulting buffer contains <em>only</em> the amount of past data required by the script’s calculations and <em>not more</em>.</p>
<p>For instance, if the maximum number of bars back for which a script references the value of a variable on historical bars is 500, the system maintains a historical buffer that includes only the latest 500 committed values of that variable. The buffer does not store 5000 committed values, because the script <em>does not</em> require all that extra data. This behavior thus helps to minimize a script’s resource requirements while preserving the integrity of its calculations.</p>
<p>To determine the sufficient buffer size for each variable and expression in a script, the runtime system performs the following process during the script’s loading time:</p>
<ol>
<li>It analyzes all the historical references that occur while executing the script on the dataset’s first <strong>244 bars</strong>, then sets the initial size of each buffer to the minimum size that accommodates those references.</li>
<li>While executing the script on subsequent bars, it checks if the script attempts to access data from previous bars that are beyond the limits of the defined buffers. If the script’s historical references exceed the buffer limits on any bar, the system restarts the loading process and tries a larger buffer size.</li>
<li>In the rare case that a historical buffer’s size remains insufficient after several calculation attempts, the system stops the script and raises a runtime error.</li>
</ol>
<p>It’s crucial to emphasize that the runtime system defines the sizes of all historical buffers only while executing a script on <em>historical bars</em>. It does <strong>not</strong> adjust any historical buffers during executions on <em>new bars</em> from the realtime data feed. If a script references past data from beyond a historical buffer’s limits while executing on a realtime bar, it causes a <a href="/pine-script-docs/error-messages/#the-requested-historical-offset-x-is-beyond-the-historical-buffers-limit-y">runtime error</a>.</p>
<p>For example, the script below retrieves a past value from the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> series using the <a href="/pine-script-docs/language/operators/#-history-referencing-operator">history-referencing operator</a> with an offset of 100 bars back on historical bars and 150 bars back on realtime bars. Because the script references data from 100 bars back during all <a href="/pine-script-docs/language/execution-model/#executions-on-historical-bars">historical executions</a>, the system sets the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> buffer’s size to include only 100 past values. Consequently, an error occurs when the script executes on the open realtime bar, because a historical offset of 150 is <em>beyond</em> the buffer’s limit:</p>
<div class="pine-colorizer not-content colorized" data-id="3l5"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Max&nbsp;bars&nbsp;back&nbsp;error&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;historical&nbsp;offset&nbsp;for&nbsp;retrieving&nbsp;past&nbsp;values&nbsp;</span><span class="mtk9">from&nbsp;the&nbsp;`close`&nbsp;series.</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;the&nbsp;bar&nbsp;is&nbsp;historical,&nbsp;the&nbsp;offset&nbsp;</span><span class="mtk9">is&nbsp;100.&nbsp;Otherwise,&nbsp;the&nbsp;offset&nbsp;is&nbsp;150.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">offset</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.ishistory</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk12">150</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;value&nbsp;of&nbsp;`close`&nbsp;from&nbsp;`offset`&nbsp;bars&nbsp;back.</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;code&nbsp;causes&nbsp;a&nbsp;*runtime&nbsp;error*&nbsp;on</span><span class="mtk9">&nbsp;a&nbsp;realtime&nbsp;bar.&nbsp;During&nbsp;all&nbsp;code&nbsp;executions&nbsp;on&nbsp;his</span><span class="mtk9">torical&nbsp;bars,</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;script&nbsp;requires&nbsp;only&nbsp;the&nbsp;latest&nbsp;1</span><span class="mtk9">00&nbsp;past&nbsp;values&nbsp;of&nbsp;`close`,&nbsp;so&nbsp;the&nbsp;system&nbsp;sets&nbsp;the&nbsp;</span><span class="mtk9">buffer&nbsp;size&nbsp;to</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;only&nbsp;the&nbsp;past&nbsp;100&nbsp;values.&nbsp;The</span><span class="mtk9">&nbsp;offset&nbsp;of&nbsp;150&nbsp;is&nbsp;thus&nbsp;*out&nbsp;of&nbsp;bounds*.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">pastClose</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk33">offset</span><span class="mtk13">]</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`pastClose`&nbsp;series.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">pastClose</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Past&nbsp;`close`"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;background&nbsp;of&nbsp;all&nbsp;realtime&nbsp;bars&nbsp;i</span><span class="mtk9">n&nbsp;orange.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk11">barstate.isrealtime</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Realtime&nbsp;highlight"</span><span class="mtk13">)</span></span><br></code></div>
<p>For cases like these, programmers can <em>manually</em> set the size of a historical buffer to ensure it contains a sufficient amount of data by doing any of the following:</p>
<ul>
<li>Modify the script to reference the maximum required number of bars back with the <a href="https://www.tradingview.com/pine-script-reference/v6/#op_%5B%5D">[]</a> operator during its execution on the <em>first bar</em>.</li>
<li>Call the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_max_bars_back">max_bars_back()</a> function to explicitly set the historical buffer size for a <em>specific</em> series.</li>
<li>Include a <code dir="auto">max_bars_back</code> argument in the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_indicator">indicator()</a> or <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy">strategy()</a> declaration statement to set the initial size of <em>all</em> historical buffers.</li>
</ul>
<aside aria-label="Notice" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice</span>The larger the size of a historical buffer, the more memory resources it requires. A script with buffers that are too large can cause the <a href="/pine-script-docs/error-messages/#memory-limits-exceeded">“Memory limits exceeded” error</a>. Therefore, when manually setting the buffer size for a series, use the <strong>smallest</strong> possible size that accommodates <em>all</em> required historical references to that series.</p></div></aside>
<p>Below, we modified the script by including the expression <code dir="auto">max_bars_back(close, 150)</code>, which sets the size of the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> buffer to include 150 past values. With the appropriate buffer size manually defined, the script’s history-referencing operation no longer causes an error on realtime bars:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-Time-series-Historical-buffers-1.BRNlhWd3_p17Kq.webp" alt="image" width="2656" height="1180" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="7nb"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Manual&nbsp;buffer&nbsp;sizing&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;historical&nbsp;offset&nbsp;for&nbsp;retrieving&nbsp;past&nbsp;values&nbsp;</span><span class="mtk9">from&nbsp;the&nbsp;`close`&nbsp;series.</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;the&nbsp;bar&nbsp;is&nbsp;historical,&nbsp;the&nbsp;offset&nbsp;</span><span class="mtk9">is&nbsp;100.&nbsp;Otherwise,&nbsp;the&nbsp;offset&nbsp;is&nbsp;150.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">offset</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.ishistory</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk12">150</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;`close`&nbsp;historical&nbsp;buffer&nbsp;t</span><span class="mtk9">o&nbsp;include&nbsp;150&nbsp;past&nbsp;values,&nbsp;ensuring&nbsp;the&nbsp;script&nbsp;has</span><span class="mtk9">&nbsp;exactly</span></span><br><span><span class="mtk9">//&nbsp;the&nbsp;amount&nbsp;of&nbsp;history&nbsp;that&nbsp;it&nbsp;requires&nbsp;on&nbsp;realt</span><span class="mtk9">ime&nbsp;bars.</span></span><br><span><span class="mtk16">max_bars_back</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">150</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;value&nbsp;of&nbsp;`close`&nbsp;from&nbsp;`offset`&nbsp;bars&nbsp;back.</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;code&nbsp;no&nbsp;longer&nbsp;causes&nbsp;an&nbsp;error&nbsp;w</span><span class="mtk9">hen&nbsp;it&nbsp;executes&nbsp;on&nbsp;a&nbsp;realtime&nbsp;bar,&nbsp;because&nbsp;the&nbsp;his</span><span class="mtk9">torical</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buffer&nbsp;has&nbsp;an&nbsp;appropriate&nbsp;size&nbsp;define</span><span class="mtk9">d&nbsp;in&nbsp;advance.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">pastClose</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">[</span><span class="mtk33">offset</span><span class="mtk13">]</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`pastClose`&nbsp;series.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">pastClose</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Past&nbsp;`close`"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">chart.fg_color</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;background&nbsp;of&nbsp;all&nbsp;realtime&nbsp;bars&nbsp;i</span><span class="mtk9">n&nbsp;orange.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk11">barstate.isrealtime</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">70</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">title</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Realtime&nbsp;highlight"</span><span class="mtk13">)</span></span><br></code></div>
<aside aria-label="Tip" class="tv-informer not-content" style="--informer-header-color:#089981;--informer-back-color-light:#DAF2EE;--informer-back-color-dark:#082621"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16Zm3.87-12.15c.36.2.49.66.28 1.02l-4 7a.75.75 0 0 1-1.18.16l-3-3a.75.75 0 1 1 1.06-1.06l2.3 2.3 3.52-6.14a.75.75 0 0 1 1.02-.28Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Tip</span>Manually setting historical buffer sizes can also improve a script’s resource efficiency in some cases. As explained above, the runtime system <em>restarts</em> a script to recalculate its buffers if any historical reference exceeds a buffer’s limit after the first <strong>244 bars</strong>. This process increases the script’s loading time and memory use. Setting the appropriate buffer size in advance with <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_max_bars_back">max_bars_back()</a> prevents the script from restarting for buffer calculations. See the <a href="/pine-script-docs/writing/profiling-and-optimization/#minimizing-historical-buffer-calculations">Minimizing historical buffer calculations</a> section of the <a href="/pine-script-docs/writing/profiling-and-optimization/">Profiling and optimization</a> page for more information.</p></div></aside>
<h4 id="time-series-in-scopes" class="md-heading"><a href="#time-series-in-scopes">Time series in <span class="fancy-wrap">scopes<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h4>
<p>The <em>scope</em> of a variable or expression refers to the part of the script where it is defined and accessible in the code. Every script has one <em>global</em> scope and zero or more <em>local</em> scopes.</p>
<p>All variables and expressions in a script that are outside <a href="/pine-script-docs/language/user-defined-functions/">user-defined functions</a> or <a href="/pine-script-docs/language/methods/#user-defined-methods">methods</a>, <a href="/pine-script-docs/language/conditional-structures/">conditional structures</a>, <a href="/pine-script-docs/language/loops/">loops</a>, and <a href="/pine-script-docs/language/type-system/#user-defined-types">user-defined type</a> or <a href="/pine-script-docs/language/type-system/#enum-types">enum type</a> declarations belong to the <em>global scope</em>. The script evaluates variables and expressions from this scope <em>once</em> for <em>every execution</em> across bars and ticks in the dataset.</p>
<p>All functions, methods, conditional structures, and loops create their own <em>local scopes</em>. The variables and expressions defined within a local scope belong exclusively to that scope. In contrast to the global scope, a script does <em>not</em> always evaluate a local scope once per execution; the script might evaluate the scope <em>zero</em>, <em>one</em>, or <em>several</em> times per execution, depending on its logic.</p>
<p>For the runtime system to commit data from a variable or expression and queue that data into a <a href="/pine-script-docs/language/execution-model/#historical-buffers">historical buffer</a> on any bar, a script must evaluate the scope of that code <em>once</em> when it executes on the bar’s <em>closing tick</em>. If the script does not evaluate the scope, the runtime system <em>cannot</em> add new data to the historical buffer. Similarly, if the script evaluates the scope repeatedly within a loop, the historical buffer cannot store series data for <em>each</em> separate iteration, because each entry in the time series corresponds to a single bar.</p>
<p>Therefore, time series behave differently in global and local scopes: the historical buffers for global variables and expressions <em>always</em> contain committed data for <em>consecutive</em> past bars, whereas the buffers for local variables often contain an <strong>inconsistent</strong> history of committed data.</p>
<aside aria-label="Note" class="tv-informer not-content" style="--informer-header-color:#6A6D78;--informer-back-color-light:#F0F3FA;--informer-back-color-dark:#2A2E39"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM8 6a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm1 2c.49 0 1 .59 1 1v3.01c0 .42-.51.99-1 .99s-1-.57-1-.99V9c0-.41.51-1 1-1Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Note</span>Function and method <em>parameters</em> have the same historical buffer behaviors as <em>local variables</em>. Each parameter in a function call has a <em>unique buffer</em>, and the system can add new data to that buffer only on a bar’s closing tick. If the script does not evaluate the function call on every closing tick, the buffers for its parameters contain an inconsistent history. This behavior applies even if the argument supplied to a parameter is a <em>global variable</em>.</p></div></aside>
<p>If a script references the history of a global variable using an expression such as <code dir="auto">myVariable[1]</code>, the historical offset of 1 always refers to the confirmed <code dir="auto">myVariable</code> value from the <em>previous bar</em>. Likewise, an expression such as <code dir="auto">myVariable[9]</code> retrieves the variable’s value from <em>nine bars back</em>. Either expression consistently accesses the value corresponding to a <em>specific</em> number of bars back, because the runtime system commits a new value for that global variable on <em>every bar</em>.</p>
<p>In contrast, the result of using the <a href="https://www.tradingview.com/pine-script-reference/v6/#op_%5B%5D">[]</a> operator on a <em>local</em> variable <strong>does not</strong> represent the value from a specific number of bars back. Instead, it represents the variable’s <em>last committed value</em> as of the bar at the specified offset. For instance, suppose <code dir="auto">myVariable</code> is a local variable, and the script last evaluated the variable’s scope 10 bars before the current bar. A history-referencing operation with any offset from <em>1 to 9</em> on that variable — such as <code dir="auto">myVariable[1]</code>, <code dir="auto">myVariable[5]</code>, or <code dir="auto">myVariable[9]</code> — returns the variable’s value from <strong>10 bars back</strong>, because there is not a recent committed value after that point for the operator to access. This behavior often leads to <em>unintended results</em>. Therefore, to ensure consistency, we recommend using historical references only on variables or expressions that the script evaluates on <em>every bar</em>.</p>
<p>The following example demonstrates how a simple history-referencing operation behaves inside a user-defined function’s scope when a script does <em>not</em> call the function on every bar. The script below defines a custom <code dir="auto">upDownColor()</code> function, which compares the current value of its <code dir="auto">source</code> parameter to the last committed value (<code dir="auto">source[1]</code>) on each call. The function returns <a href="https://www.tradingview.com/pine-script-reference/v6/#const_color.blue">color.blue</a> if the current <code dir="auto">source</code> value is higher than the previous value. Otherwise, it returns <a href="https://www.tradingview.com/pine-script-reference/v6/#const_color.orange">color.orange</a>.</p>
<p>The script uses this function <em>conditionally</em>, inside a <a href="/pine-script-docs/language/operators/#-ternary-operator">ternary operation</a>, to determine the color of a plot that shows the remainder from dividing <a href="https://www.tradingview.com/pine-script-reference/v6/#var_bar_index">bar_index</a> by a specified value. If the <code dir="auto">remainder</code> variable’s value is nonzero, the operation calls <code dir="auto">upDownColor(remainder)</code> to calculate the color (blue or orange). If the value is 0, the operation does <em>not</em> use the call and instead returns <a href="https://www.tradingview.com/pine-script-reference/v6/#const_color.gray">color.gray</a>. The <code dir="auto">remainder</code> value <em>increases</em> on each bar, except for when it returns to 0 — causing the gray color. Therefore, a user might expect the plot’s color to be only blue or gray on every bar. However, the color changes to <em>orange</em> on each bar after the one where the color is gray, even though the <code dir="auto">remainder</code> value on that bar is <em>higher</em> than the value on the previous bar:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-Time-series-Time-series-in-scopes-1.D_JOArZO_2tWKEC.webp" alt="image" width="2652" height="1176" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="6sv"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Local&nbsp;historical&nbsp;references&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;&nbsp;Returns&nbsp;`color.blue`&nbsp;if&nbsp;`source`&nbsp;is&nbsp;above&nbsp;its&nbsp;la</span><span class="mtk9">st&nbsp;committed&nbsp;value;&nbsp;`color.orange`&nbsp;otherwise.</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;consistent&nbsp;results,&nbsp;this&nbsp;function</span><span class="mtk9">&nbsp;should&nbsp;execute&nbsp;on&nbsp;*every&nbsp;bar*,&nbsp;because&nbsp;it&nbsp;uses&nbsp;th</span><span class="mtk9">e</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;history-referencing&nbsp;operator&nbsp;on&nbsp;the&nbsp;`</span><span class="mtk9">source`&nbsp;series.</span></span><br><span><span class="mtk9">//</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Even&nbsp;if&nbsp;the&nbsp;argument&nbsp;supplied&nbsp;to&nbsp;`sou</span><span class="mtk9">rce`&nbsp;comes&nbsp;from&nbsp;a&nbsp;global&nbsp;variable,&nbsp;the&nbsp;`source`&nbsp;pa</span><span class="mtk9">rameter&nbsp;remains</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;part&nbsp;of&nbsp;the&nbsp;function's&nbsp;*local&nbsp;scope*.</span><span class="mtk9">&nbsp;The&nbsp;system&nbsp;maintains&nbsp;a&nbsp;*separate&nbsp;historical&nbsp;buffe</span><span class="mtk9">r*&nbsp;for&nbsp;the&nbsp;`source`</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;series&nbsp;in&nbsp;each&nbsp;function&nbsp;call&nbsp;instance</span><span class="mtk9">.&nbsp;The&nbsp;buffer&nbsp;contains&nbsp;only&nbsp;the&nbsp;committed&nbsp;`source`&nbsp;</span><span class="mtk9">values&nbsp;from&nbsp;the&nbsp;bars</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;the&nbsp;function&nbsp;call&nbsp;occurs.&nbsp;If&nbsp;th</span><span class="mtk9">e&nbsp;call&nbsp;does&nbsp;not&nbsp;occur&nbsp;on&nbsp;a&nbsp;bar,&nbsp;the&nbsp;buffer&nbsp;for&nbsp;`so</span><span class="mtk9">urce`&nbsp;contains</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**no&nbsp;new&nbsp;data**&nbsp;for&nbsp;that&nbsp;bar.</span></span><br><span><span class="mtk15">upDownColor</span><span class="mtk13">(</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">source</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">source</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">source</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;value&nbsp;by&nbsp;which&nbsp;to&nbsp;divide&nbsp;the&nbsp;`bar_index`&nbsp;valu</span><span class="mtk9">e.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">divisorInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Divisor"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;remainder&nbsp;of&nbsp;dividing&nbsp;`bar_index`&nbsp;by&nbsp;`divisor</span><span class="mtk9">Input`.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">remainder</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk33">divisorInput</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`color.gray`&nbsp;if&nbsp;`remainder`&nbsp;equals&nbsp;0,&nbsp;and&nbsp;the&nbsp;</span><span class="mtk9">result&nbsp;of&nbsp;`upDownColor(remainder)`&nbsp;otherwise.</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;`upDownColor()`&nbsp;call&nbsp;does&nbsp;not&nbsp;exec</span><span class="mtk9">ute&nbsp;on&nbsp;every&nbsp;bar.&nbsp;Therefore,&nbsp;it&nbsp;does&nbsp;*not*&nbsp;always&nbsp;</span><span class="mtk9">compare&nbsp;the</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`remainder`&nbsp;value&nbsp;from&nbsp;one&nbsp;bar&nbsp;back&nbsp;to</span><span class="mtk9">&nbsp;calculate&nbsp;the&nbsp;color.&nbsp;Instead,&nbsp;the&nbsp;function&nbsp;compar</span><span class="mtk9">es&nbsp;the&nbsp;current</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`remainder`&nbsp;to&nbsp;the&nbsp;value&nbsp;from&nbsp;the&nbsp;last</span><span class="mtk9">&nbsp;bar&nbsp;where&nbsp;`remainder`&nbsp;is&nbsp;nonzero.</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">plotColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">remainder</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.gray</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk33">upDownColor</span><span class="mtk13">(</span><span class="mtk33">remainder</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`remainder`&nbsp;series&nbsp;and&nbsp;color&nbsp;it&nbsp;using&nbsp;</span><span class="mtk9">`plotColor`.&nbsp;The&nbsp;plot&nbsp;is&nbsp;orange&nbsp;after&nbsp;each&nbsp;bar&nbsp;whe</span><span class="mtk9">re&nbsp;`remainder&nbsp;==&nbsp;0`,</span></span><br><span><span class="mtk9">//&nbsp;because&nbsp;the&nbsp;`upDownColor()`&nbsp;function&nbsp;call&nbsp;does&nbsp;</span><span class="mtk9">not&nbsp;have&nbsp;data&nbsp;for&nbsp;that&nbsp;bar&nbsp;to&nbsp;use&nbsp;in&nbsp;its&nbsp;logic.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">remainder</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Remainder"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">plotColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br></code></div>
<p>The script behaves this way because <code dir="auto">upDownColor()</code> uses the <a href="/pine-script-docs/language/operators/#-history-referencing-operator">history-referencing operator</a> on the <code dir="auto">source</code> series, which is <em>local</em> to the function’s scope, and the script does not call the function on <em>every</em> execution. When the value of <code dir="auto">remainder</code> is zero, the <em>first</em> expression in the ternary condition evaluates to <code dir="auto">true</code>, and therefore the second branch of the ternary expression, which contains the function call, does <em>not</em> execute.</p>
<p>The compiler issues the following warning about the function directly in the Pine Editor:</p>
<div class="expressive-code not-content"><link rel="stylesheet" href="/pine-script-docs/_astro/ec.dtidy.css"><script type="module" src="/pine-script-docs/_astro/ec.qopfj.js" data-astro-exec=""></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plaintext" tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">The function `upDownColor()` should be called on each calculation for consistency. It is recommended to extract the call from the ternary operator or from the scope.</span></div></div></code></pre></figure></div>
<p>The runtime system maintains a separate <a href="/pine-script-docs/language/execution-model/#historical-buffers">historical buffer</a> for the local <code dir="auto">source</code> series, but it cannot update that buffer unless the script <em>calls</em> the function. On each bar where <code dir="auto">remainder</code> is 0, the call does not occur, and the system has no new value to commit to the time series. Therefore, the <code dir="auto">source</code> buffer does <em>not</em> contain a value for that bar. On the bar that follows, the local expression <code dir="auto">source[1]</code> refers to the <code dir="auto">source</code> value from the <em>last bar</em> where the <code dir="auto">upDownColor()</code> call occured — <em>two bars back</em> — and <strong>not</strong> the value of <code dir="auto">remainder</code> from the previous bar. Because the value from two bars back is <em>higher</em> than the current value, the returned color is <a href="https://www.tradingview.com/pine-script-reference/v6/#const_color.orange">color.orange</a> instead of <a href="https://www.tradingview.com/pine-script-reference/v6/#const_color.blue">color.blue</a>.</p>
<p>We can fix this script’s behavior by following the instructions in the compiler warning. Below, we modified the script by moving the <code dir="auto">upDownColor()</code> call <em>outside</em> the ternary expression, enabling the script to execute it on <em>every bar</em>. The historical buffer for the function’s <code dir="auto">source</code> series now contains <code dir="auto">remainder</code> values from <em>consecutive</em> bars. With this change, an orange color does not appear because the function consistently compares values from <em>one</em> bar back:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-Time-series-Time-series-in-scopes-2.DnGQwjrs_Z2gROjb.webp" alt="image" width="2652" height="1184" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="vp"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Consistent&nbsp;historical&nbsp;references&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;&nbsp;Returns&nbsp;`color.blue`&nbsp;if&nbsp;`source`&nbsp;is&nbsp;above&nbsp;its&nbsp;la</span><span class="mtk9">st&nbsp;committed&nbsp;value;&nbsp;`color.orange`&nbsp;otherwise.</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;consistent&nbsp;results,&nbsp;this&nbsp;function</span><span class="mtk9">&nbsp;should&nbsp;execute&nbsp;on&nbsp;*every&nbsp;bar*,&nbsp;because&nbsp;it&nbsp;uses&nbsp;th</span><span class="mtk9">e</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;history-referencing&nbsp;operator&nbsp;on&nbsp;the&nbsp;`</span><span class="mtk9">source`&nbsp;series.</span></span><br><span><span class="mtk15">upDownColor</span><span class="mtk13">(</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">source</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">source</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">source</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;value&nbsp;by&nbsp;which&nbsp;to&nbsp;divide&nbsp;the&nbsp;`bar_index`&nbsp;valu</span><span class="mtk9">e.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">divisorInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Divisor"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;remainder&nbsp;of&nbsp;dividing&nbsp;`bar_index`&nbsp;by&nbsp;`divisor</span><span class="mtk9">Input`.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">remainder</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk33">divisorInput</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`color.blue`&nbsp;if&nbsp;`remainder`&nbsp;is&nbsp;above&nbsp;its&nbsp;previ</span><span class="mtk9">ous&nbsp;value,&nbsp;and&nbsp;`color.orange`&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">secondColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">upDownColor</span><span class="mtk13">(</span><span class="mtk33">remainder</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`color.gray`&nbsp;if&nbsp;`remainder`&nbsp;equals&nbsp;0,&nbsp;and&nbsp;`sec</span><span class="mtk9">ondColor`&nbsp;otherwise.</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;ternary&nbsp;operation&nbsp;no&nbsp;longer&nbsp;cause</span><span class="mtk9">s&nbsp;a&nbsp;warning.&nbsp;The&nbsp;scope&nbsp;of&nbsp;the&nbsp;`upDownColor()`&nbsp;call</span><span class="mtk9">&nbsp;executes&nbsp;on</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;every&nbsp;bar,&nbsp;meaning&nbsp;its&nbsp;historical&nbsp;buff</span><span class="mtk9">er&nbsp;consistently&nbsp;includes&nbsp;data&nbsp;for&nbsp;consecutive&nbsp;past</span><span class="mtk9">&nbsp;bars.</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">plotColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">remainder</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.gray</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk33">secondColor</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`remainder`&nbsp;series&nbsp;and&nbsp;color&nbsp;it&nbsp;using&nbsp;</span><span class="mtk9">`plotColor`.&nbsp;The&nbsp;plot&nbsp;is&nbsp;now&nbsp;blue&nbsp;or&nbsp;gray,&nbsp;but&nbsp;nev</span><span class="mtk9">er&nbsp;orange.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">remainder</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Remainder"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">plotColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br></code></div>
<p>A similar behavior applies to all built-in functions that reference past values internally, such as those in the <code dir="auto">ta</code> namespace. For example, the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.sma">ta.sma()</a> function uses the current value of a <code dir="auto">source</code> series and <code dir="auto">length - 1</code> past values from that series to calculate a <a href="https://www.tradingview.com/support/solutions/43000696841-simple-moving-average/">moving average</a>. If a script calls this function only on <em>some</em> bars instead of on <em>every</em> bar, the historical buffer for <code dir="auto">source</code> does not contain values for consecutive past bars. Therefore, such a call can cause unintended results, because the call calculates the returned average using an inconsistent history of previous values.</p>
<p>The script below demonstrates how the results of the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.sma">ta.sma()</a> function can vary with the scope in which the function call occurs. The script declares three global variables to hold calculated SMA values: <code dir="auto">controlSMA</code>, <code dir="auto">localSMA</code>, and <code dir="auto">globalSMA</code>. The script initializes <code dir="auto">controlSMA</code> using the result of a <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.sma">ta.sma()</a> function call, and it initializes the other two variables with <a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a>. Within the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_if">if</a> structure, the script updates the value of <code dir="auto">globalSMA</code> using <code dir="auto">controlSMA</code>, and it updates <code dir="auto">localSMA</code> using the result of another <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.sma">ta.sma()</a> call with the same arguments as the first call.</p>
<p>As shown below, the <code dir="auto">controlSMA</code> and <code dir="auto">globalSMA</code> variables have the same value. Both hold the result of the <em>global</em> <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.sma">ta.sma()</a> call, which executes on <em>every bar</em>. The internal historical buffer for <code dir="auto">source</code> in that call thus includes committed values for consecutive past bars. In contrast, the <code dir="auto">localSMA</code> value differs, because the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.sma">ta.sma()</a> call for that variable does <em>not</em> execute on every bar. The buffer for that call’s local <code dir="auto">source</code> series contains only the values from bars with an <em>even</em> <a href="https://www.tradingview.com/pine-script-reference/v6/#var_bar_index">bar_index</a> value:</p>
<p><img src="/pine-script-docs/_astro/Execution-model-Time-series-Time-series-in-scopes-3.H3TNziJy_1gEv1o.webp" alt="image" width="2654" height="1188" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="6nn"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"`ta.*()`&nbsp;functions&nbsp;in&nbsp;scopes&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">behind_chart</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">false</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Is&nbsp;`true`&nbsp;if&nbsp;the&nbsp;`bar_index`&nbsp;is&nbsp;divisible&nbsp;by&nbsp;2,&nbsp;a</span><span class="mtk9">nd&nbsp;`false`&nbsp;otherwise.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">condition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;20-bar&nbsp;moving&nbsp;average&nbsp;of&nbsp;`close`&nbsp;values.</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;`ta.sma()`&nbsp;call&nbsp;executes&nbsp;in&nbsp;the&nbsp;g</span><span class="mtk9">lobal&nbsp;scope,&nbsp;so&nbsp;the&nbsp;script&nbsp;evaluates&nbsp;it&nbsp;on&nbsp;every&nbsp;b</span><span class="mtk9">ar.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">controlSMA</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Declare&nbsp;two&nbsp;additional&nbsp;variables&nbsp;to&nbsp;modify&nbsp;late</span><span class="mtk9">r&nbsp;within&nbsp;the&nbsp;`if`&nbsp;structure's&nbsp;scope.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">globalSMA</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">localSMA</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">condition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Assign&nbsp;the&nbsp;`controlSMA`&nbsp;value&nbsp;to&nbsp;`globalSMA`.&nbsp;T</span><span class="mtk9">his&nbsp;code&nbsp;does&nbsp;not&nbsp;cause&nbsp;a&nbsp;warning.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">globalSMA</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk33">controlSMA</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Call&nbsp;`ta.sma()`&nbsp;with&nbsp;the&nbsp;same&nbsp;arguments&nbsp;as&nbsp;befo</span><span class="mtk9">re&nbsp;within&nbsp;this&nbsp;block&nbsp;and&nbsp;assign&nbsp;the&nbsp;result&nbsp;to&nbsp;`loc</span><span class="mtk9">alSMA`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;The&nbsp;function&nbsp;call&nbsp;causes&nbsp;a&nbsp;warning,&nbsp;because&nbsp;it&nbsp;</span><span class="mtk9">does&nbsp;not&nbsp;execute&nbsp;in&nbsp;the&nbsp;global&nbsp;scope.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;The&nbsp;historical&nbsp;buffers&nbsp;for&nbsp;this&nbsp;`ta.sma()`&nbsp;call</span><span class="mtk9">&nbsp;contain&nbsp;data&nbsp;only&nbsp;for&nbsp;the&nbsp;bars&nbsp;where&nbsp;`condition`&nbsp;</span><span class="mtk9">is&nbsp;`true`,</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;thus&nbsp;leading&nbsp;to&nbsp;a&nbsp;*different*&nbsp;result.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">localSMA</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;`controlSMA`,&nbsp;`globalSMA`,&nbsp;and&nbsp;`localSMA`&nbsp;</span><span class="mtk9">for&nbsp;comparison.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">controlSMA</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Control&nbsp;SMA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">globalSMA</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk29">"Global&nbsp;SMA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_circles</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">localSMA</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Local&nbsp;SMA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk11">color.gray</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_circles</span><span class="mtk13">)</span></span><br></code></div>
<p>To summarize the behavior of time series in a script’s scopes:</p>
<ul>
<li>A script evaluates its global scope once on <em>every execution</em>. After each script execution on a bar’s closing tick, the system commits the data for variables and expressions in the global scope and updates their <a href="/pine-script-docs/language/execution-model/#historical-buffers">historical buffers</a>. The resulting buffers thus include data for consecutive past bars, ensuring consistent results for operations and functions that rely on past data.</li>
<li>A script evaluates local scopes <em>zero</em>, <em>one</em>, or <em>several</em> times per execution. The runtime system <strong>cannot</strong> maintain consistent bar-by-bar historical buffers for scopes that a script does <em>not</em> evaluate on every bar, or for scopes that the script evaluates <em>more than once</em> on a bar’s closing tick. Therefore, using the <a href="https://www.tradingview.com/pine-script-reference/v6/#op_%5B%5D">[]</a> operator on local variables and expressions, or not calling functions that access past data once on each closing tick, can cause <strong>unintended results</strong>.</li>
</ul>
<aside aria-label="Note" class="tv-informer not-content" style="--informer-header-color:#6A6D78;--informer-back-color-light:#F0F3FA;--informer-back-color-dark:#2A2E39"><div class="tv-informer-icon"><svg viewBox="0 0 18 18" width="18" height="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM8 6a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm1 2c.49 0 1 .59 1 1v3.01c0 .42-.51.99-1 .99s-1-.57-1-.99V9c0-.41.51-1 1-1Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Note</span></p><p>Not all built-in functions use past data from historical buffers in their calculations. For example, most functions in the <code dir="auto">math</code> namespace, excluding <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_math.sum">math.sum()</a>, operate only on the <em>current</em> arguments of the function call. Functions that do not interact with their history in any way do not require special treatment to ensure intended results.</p><br><p>If the use of a function call within a local block does <em>not</em> cause a compiler warning, it is typically safe to use in that block without affecting the result. However, if the warning occurs, it is usually best to move the call to the <em>global scope</em> — outside the operands of the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_or">or</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_and">and</a>, or <a href="https://www.tradingview.com/pine-script-reference/v6/#op_?:">?:</a> operators — to ensure consistent calculations.</p><p></p></div></aside>      </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <span data-astro-cid-xgirumru=""></span> <a href="/pine-script-docs/language/type-system" class="pagination-card" data-pagefind-ignore="" data-astro-cid-assl6cvf=""> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Type system <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-assl6cvf="" data-icon="theme/arrow">  <symbol id="ai:local:theme/arrow"><path fill="none" stroke="var(--arrow-fill-color, #131722)" d="m11 8 6 6-6 6"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use>  </svg> </h4> </a>  </div>  </main>   <div id="toc" data-pagefind-ignore="all" data-astro-cid-oor6cujd=""><aside class="document-toc-container ml-4 w-48" data-astro-cid-oor6cujd=""><section id="toc-scroll-section" class="slick-scroll" data-astro-cid-oor6cujd=""><header data-astro-cid-oor6cujd=""><h2 class="toc-header" data-astro-cid-oor6cujd="">On this page</h2></header><ul class="" id="toc-entries" data-astro-cid-oor6cujd=""><a href="#introduction" aria-current="true" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-current="" data-astro-cid-oor6cujd="">Introduction</li></a><a href="#the-basics" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">The basics</li></a><a href="#bar-by-bar-execution" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Bar-by-bar execution</li></a><a href="#storing-and-using-data-from-previous-bars" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Storing and using data from previous bars</li></a><a href="#realtime-bars" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Realtime bars</li></a><a href="#the-details" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">The details</li></a><a href="#executions-on-historical-bars" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Executions on historical bars</li></a><a href="#executions-on-realtime-bars" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Executions on realtime bars</li></a><a href="#events-that-trigger-script-executions" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Events that trigger script executions</li></a><a href="#caching" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd="">Caching</li></a><a href="#time-series" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Time series</li></a><a href="#historical-buffers" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd="">Historical buffers</li></a><a href="#time-series-in-scopes" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-4" data-astro-cid-oor6cujd="">Time series in scopes</li></a></ul></section><div class="toc-bottom-fade" data-astro-cid-oor6cujd=""></div><div class="back-top-space" data-astro-cid-oor6cujd=""><div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <a id="back-top-button" title="Back to top" href="#top" data-astro-cid-pkzv2hgs="" class="floating-button not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-secondary stvb-icon stvb-icon-force-color stvb-force-no-border"> <svg width="18" height="18" viewBox="0 0 18 18" data-astro-cid-oor6cujd="" data-icon="theme/arrow-up">  <symbol id="ai:local:theme/arrow-up"><g fill="none"><g clip-path="url(#a)"><path fill="currentColor" fill-rule="evenodd" d="m9 3.5.5.44 4 3.5-1 1.12-2.75-2.4V14h-1.5V6.15L5.49 8.56l-.98-1.12 4-3.5z" clip-rule="evenodd"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h18v18H0z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/arrow-up"></use>  </svg> </a> </div> </div></aside></div> </main> </div>   <footer data-astro-cid-b6pf7ola=""> <div class="footer-content" data-astro-cid-b6pf7ola="">  <ul data-astro-cid-b6pf7ola=""> <li data-astro-cid-b6pf7ola=""> <a href="https://www.tradingview.com/chat/#BfmVowG1TZkKO235" data-astro-cid-b6pf7ola="">Pine Q&amp;A chat</a>  </li><li data-astro-cid-b6pf7ola=""> <a href="https://stackoverflow.com/questions/tagged/pine-script" data-astro-cid-b6pf7ola="">Stack Overflow</a>  ↗ </li><li data-astro-cid-b6pf7ola=""> <a href="https://t.me/PineCodersQA" data-astro-cid-b6pf7ola="">Telegram</a>  ↗ </li><li data-astro-cid-b6pf7ola=""> <a href="https://www.reddit.com/r/TradingView/" data-astro-cid-b6pf7ola="">Reddit</a>  ↗ </li> </ul> <div class="flex" data-astro-cid-b6pf7ola=""></div> <div class="copyright" data-astro-cid-b6pf7ola="">Copyright © 2025 TradingView, Inc.</div> </div> </footer>         </body></html>