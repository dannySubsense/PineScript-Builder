<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><script data-astro-exec="">
			const url = window.location.href;
			const expectedUrl = url.replace(
				/^https:\/\/(?!beta)(\w+\.)?tradingview\.com/,
				'https://www.tradingview.com',
			);
			if (url !== expectedUrl) {
				window.location.replace(expectedUrl);
			}
		</script><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="none"><link rel="icon" href="https://static.tradingview.com/static/images/favicon.ico"><link rel="icon" type="image/svg+xml" href="/pine-script-docs/favicon.svg"><title>Migration guides / To Pine Script® version 6</title><meta name="og:title" content="Migration guides / To Pine Script® version 6"><meta name="twitter:title" content="Migration guides / To Pine Script® version 6"><meta name="description" content="Everything you need to know about Pine Script®."><meta name="og:description" content="Everything you need to know about Pine Script®."><meta name="twitter:description" content="Everything you need to know about Pine Script®."><meta name="keywords" content="tradingview, pine, script, indicators, strategies"><meta name="og:image" content="/pine-script-docs/meta-image.png?1"><meta name="twitter:image" content="/pine-script-docs/meta-image.png?1"><meta name="og:image:width" content="1200"><meta name="og:image:height" content="630"><meta name="og:url" content="https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6/"><meta name="twitter:url" content="https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6/"><meta name="og:type" content="website"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@TradingView"><link rel="canonical" href="https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6/"><link rel="sitemap" href="/pine-script-docs/sitemap-index.xml"><link rel="stylesheet" href="/pine-script-docs/_astro/index.DfaRTfPD.css">
<link rel="stylesheet" href="/pine-script-docs/_astro/index.B9ah8c5K.css">
<style>.tv-spinner{display:none;position:absolute;margin:0 auto;border:0 solid rgb(149 152 161 / 20%);border-radius:50%;border-top-color:var(--tv-spinner-color, #2962ff);border-left-color:var(--tv-spinner-color, #2962ff);animation:tv-spinner-container-rotate .9s linear infinite}.tv-spinner-shown{display:block}.tv-spinner-size-large{top:calc(50% - 32px);left:calc(50% - 32px);width:56px;height:56px;border-width:4px}@keyframes tv-spinner-container-rotate{to{transform:rotate(360deg)}}:root{--page-background-color: #fff;background-color:var(--page-background-color)}:root[data-theme=dark]{--page-background-color: #000}body{background-color:var(--page-background-color)}#redirect-link{display:flex;position:absolute;inset:0;align-items:center;justify-content:center}#spinner{display:block;position:absolute;opacity:1;transition:opacity .2s}
.twitter-tweet:not(.twitter-tweet-rendered){padding:var(--tc-padding, 1em);border:1px solid var(--tc-border-color, #cfd9de)}.twitter-tweet:not(.twitter-tweet-rendered)>:first-child{margin-top:0}.twitter-tweet:not(.twitter-tweet-rendered)>:last-child{margin-bottom:0}lite-youtube{background-color:#000;position:relative;display:block;contain:content;background-position:center center;background-size:cover;cursor:pointer;max-width:720px}lite-youtube:before{content:attr(data-title);display:block;position:absolute;top:0;background-image:linear-gradient(180deg,#000000ab,#0000008a 14%,#00000026 54%,#0000000d 72%,#0000 94%);height:99px;width:100%;font-family:YouTube Noto,Roboto,Arial,Helvetica,sans-serif;color:#eee;text-shadow:0 0 2px rgba(0,0,0,.5);font-size:18px;padding:25px 20px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;box-sizing:border-box}lite-youtube:hover:before{color:#fff}lite-youtube:after{content:"";display:block;padding-bottom:56.25%}lite-youtube>iframe{width:100%;height:100%;position:absolute;top:0;left:0;border:0}lite-youtube>.lty-playbtn{display:block;width:100%;height:100%;background:no-repeat center/68px 48px;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 68 48"><path d="M66.52 7.74c-.78-2.93-2.49-5.41-5.42-6.19C55.79.13 34 0 34 0S12.21.13 6.9 1.55c-2.93.78-4.63 3.26-5.42 6.19C.06 13.05 0 24 0 24s.06 10.95 1.48 16.26c.78 2.93 2.49 5.41 5.42 6.19C12.21 47.87 34 48 34 48s21.79-.13 27.1-1.55c2.93-.78 4.64-3.26 5.42-6.19C67.94 34.95 68 24 68 24s-.06-10.95-1.48-16.26z" fill="red"/><path d="M45 24 27 14v20" fill="white"/></svg>');position:absolute;cursor:pointer;z-index:1;filter:grayscale(100%);transition:filter .1s cubic-bezier(0,0,.2,1);border:0}lite-youtube:hover>.lty-playbtn,lite-youtube .lty-playbtn:focus{filter:none}lite-youtube.lyt-activated{cursor:unset}lite-youtube.lyt-activated:before,lite-youtube.lyt-activated>.lty-playbtn{opacity:0;pointer-events:none}.lyt-visually-hidden{clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px}lite-youtube>iframe{all:unset!important;width:100%!important;height:100%!important;position:absolute!important;inset:0!important;border:0!important}lite-vimeo{font-size:10px;background-color:#000;position:relative;display:block;contain:content;background-position:center center;background-size:cover}lite-vimeo:after{content:"";display:block;padding-bottom:56.25%}lite-vimeo>iframe{all:unset!important;width:100%!important;height:100%!important;position:absolute!important;inset:0!important;border:0!important}lite-vimeo>.ltv-playbtn{content:"";position:absolute;inset:0;width:100%;background:transparent;outline:0;border:0;cursor:pointer}lite-vimeo>.ltv-playbtn:before{width:6.5em;height:4em;background:#172322bf;opacity:.8;border-radius:.25rem;transition:all .2s cubic-bezier(0,0,.2,1)}lite-vimeo>.ltv-playbtn:focus:before{outline:auto}lite-vimeo:hover>.ltv-playbtn:before{background-color:#00adef;background-color:var(--ltv-color, #00adef);opacity:1}lite-vimeo>.ltv-playbtn:after{border-style:solid;border-width:1em 0 1em 1.7em;border-color:transparent transparent transparent #fff}lite-vimeo>.ltv-playbtn:before,lite-vimeo>.ltv-playbtn:after{content:"";position:absolute;top:50%;left:50%;transform:translate3d(-50%,-50%,0)}lite-vimeo.ltv-activated:before,lite-vimeo.ltv-activated>.ltv-playbtn{cursor:unset;opacity:0;pointer-events:none}
</style><script type="module" src="/pine-script-docs/_astro/hoisted.wfEHaJbk.js" data-astro-exec=""></script><style id="tv-pine-light" type="text/css" media="screen">.monaco-editor-tv-pine-light { 
.mtk1 { color: #131722; }
.mtk2 { color: #ffffff; }
.mtk3 { color: #808080; }
.mtk4 { color: #ff0000; }
.mtk5 { color: #0451a5; }
.mtk6 { color: #0000ff; }
.mtk7 { color: #098658; }
.mtk8 { color: #008000; }
.mtk9 { color: #9598a1; }
.mtk10 { color: #dd0000; }
.mtk11 { color: #cc2929; }
.mtk12 { color: #f57f17; }
.mtk13 { color: #000000; }
.mtk14 { color: #383838; }
.mtk15 { color: #0c3299; }
.mtk16 { color: #2962ff; }
.mtk17 { color: #8e24aa; }
.mtk18 { color: #22ab94; }
.mtk19 { color: #cd3131; }
.mtk20 { color: #863b00; }
.mtk21 { color: #af00db; }
.mtk22 { color: #800000; }
.mtk23 { color: #e00000; }
.mtk24 { color: #3030c0; }
.mtk25 { color: #666666; }
.mtk26 { color: #778899; }
.mtk27 { color: #c700c7; }
.mtk28 { color: #a31515; }
.mtk29 { color: #388e3c; }
.mtk30 { color: #4f76ac; }
.mtk31 { color: #008080; }
.mtk32 { color: #001188; }
.mtk33 { color: #2a2e39; }
.mtk34 { color: #4864aa; }
.mtki { font-style: italic; }
.mtkb { font-weight: bold; }
.mtku { text-decoration: underline; text-underline-position: under; }
.mtks { text-decoration: line-through; }
.mtks.mtku { text-decoration: underline line-through; text-underline-position: under; } }</style></head> <body> <div id="search-content-blur" hidden=""></div> <script data-astro-exec="">
	/* eslint-disable @typescript-eslint/typedef */
	window.ThemeProvider = (() => {
		function getCurrent() {
			return (
				// eslint-disable-next-line no-restricted-syntax
				typeof localStorage !== 'undefined' &&
				localStorage.getItem('tv-docs-theme')
			);
		}
		const storedTheme = getCurrent();
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ?
				'light'
			:	'dark');
		document.documentElement.dataset.theme =
			theme === 'light' ? 'light' : 'dark';
		document.documentElement.classList.toggle(
			'theme-dark',
			theme === 'dark',
		); // add support for ui-lib themes
		document.documentElement.classList.toggle(
			'sl-theme-dark',
			theme === 'dark',
		); // add support for shoelace themes

		return {
			updatePickers(themeArg = storedTheme || 'auto') {
				let currentTheme = themeArg;
				if (currentTheme === 'unknown') {
					currentTheme = getCurrent() || 'auto';
				}
				document
					.querySelectorAll('docs-theme-select')
					.forEach((picker) => {
						const select = picker.querySelector('select');
						if (select) select.value = currentTheme;
						/** @type {HTMLTemplateElement | null} */
						const tmpl = document.querySelector(`#theme-icons`);
						const newIcon =
							tmpl &&
							tmpl.content.querySelector('.' + currentTheme);
						if (newIcon) {
							const oldIcon =
								picker.querySelector('svg.label-icon');
							if (oldIcon) {
								oldIcon.replaceChildren(
									...newIcon.cloneNode(true).childNodes,
								);
							}
						}
					});
			},
		};
	})();
	/* eslint-enable @typescript-eslint/typedef */
</script><template id="theme-icons"><svg width="16" height="16" viewBox="0 0 28 28" class="light" data-icon="theme/sun-28">  <symbol id="ai:local:theme/sun-28"><g fill="currentColor"><path d="M14 3h1.5v5H14zm0 18h1.5v5H14zm12-5.5V14h-5v1.5zM8 14v1.5H3V14zm15.3-7-1-1-3.6 3.6 1.1 1 3.5-3.5ZM9.5 18.7l1.1 1.1-3.5 3.5-1-1zM22 23.3l1-1-3.6-3.6-1 1.1 3.5 3.5ZM10.3 9.6l-1.1 1-3.5-3.5 1-1z"></path><path fill-rule="evenodd" d="M19 14.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0m-1.5 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0" clip-rule="evenodd"></path></g></symbol><use xlink:href="#ai:local:theme/sun-28"></use>  </svg><svg width="16" height="16" viewBox="0 0 28 28" class="dark" data-icon="theme/moon-28">  <symbol id="ai:local:theme/moon-28"><path fill="currentColor" fill-rule="evenodd" d="M21 7.02A9.23 9.23 0 0 0 15.2 5 9.1 9.1 0 0 0 6 14c0 4.97 4.12 9 9.2 9a9.33 9.33 0 0 0 5.8-2.02A7 7 0 0 1 14.36 14 7 7 0 0 1 21 7.02m-3.95-.3a8 8 0 0 0-1.85-.22A7.6 7.6 0 0 0 7.5 14a7.6 7.6 0 0 0 7.7 7.5 8 8 0 0 0 1.85-.22A8.46 8.46 0 0 1 12.86 14c0-3.1 1.69-5.8 4.19-7.28" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/moon-28"></use>  </svg><svg width="16" height="16" viewBox="0 0 28 28" class="auto" data-icon="theme/system-28">  <symbol id="ai:local:theme/system-28"><path fill="currentColor" d="M8 4h1v2H8zm0 9v2h1v-2zm6-3V9h-2v1zM3 9v1h2V9zm5.5 3a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5m4.2-6-.7-.7-1.4 1.4.7.7zM5 13.7l-.7-.7 1.4-1.4.7.7zm7.7-.7-.7.7-1.4-1.4.7-.7zM4.3 6l.7-.7 1.4 1.4-.7.7zm3 17 14-14 .8.7L8 23.7zm17.2-.1a3.5 3.5 0 0 1-3.4-5.9H21a4 4 0 1 0 3.5 5.9"></path></symbol><use xlink:href="#ai:local:theme/system-28"></use>  </svg></template> <div class="backdrop" data-mobile-menu-backdrop="" data-astro-cid-h2irkosh=""></div> <div class="menu-container" data-astro-cid-h2irkosh=""> <div class="header" data-astro-cid-h2irkosh=""> <div class="header-group" data-astro-cid-h2irkosh=""> <div id="version-select" data-astro-cid-kx7qoxgq=""> <label style="--sl-select-width: undefined; --sl-label-icon-size: 16px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq="">Version</span>  <select value="v6" data-has-border="" no-icon="true" data-astro-cid-lmznfliq=""> <option value="v6" selected="true" data-astro-cid-lmznfliq="">Version 6</option><option value="v5" data-astro-cid-lmznfliq="">Version 5</option><option value="v4" data-astro-cid-lmznfliq="">Version 4</option><option value="v3" data-astro-cid-lmznfliq="">Version 3</option> </select> <svg width="16" height="16" viewBox="0 0 24 24" class="icon caret" data-astro-cid-lmznfliq="" data-icon="theme/down-caret">  <symbol id="ai:local:theme/down-caret"><path fill="currentColor" d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1 1 0 0 0 1.42 0L17 10.59a1 1 0 0 0 0-1.42"></path></symbol><use xlink:href="#ai:local:theme/down-caret"></use>  </svg> </label>  </div>   <docs-theme-select class="" data-astro-cid-3wpspbi7=""> <label style="--sl-select-width: 48px; --sl-label-icon-size: 28px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq="">Theme</span> <svg width="28" height="28" viewBox="0 0 28 28" class="icon label-icon" data-button="" data-round="" data-astro-cid-lmznfliq="" data-icon="theme/system-28">  <symbol id="ai:local:theme/system-28"><path fill="currentColor" d="M8 4h1v2H8zm0 9v2h1v-2zm6-3V9h-2v1zM3 9v1h2V9zm5.5 3a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5m4.2-6-.7-.7-1.4 1.4.7.7zM5 13.7l-.7-.7 1.4-1.4.7.7zm7.7-.7-.7.7-1.4-1.4.7-.7zM4.3 6l.7-.7 1.4 1.4-.7.7zm3 17 14-14 .8.7L8 23.7zm17.2-.1a3.5 3.5 0 0 1-3.4-5.9H21a4 4 0 1 0 3.5 5.9"></path></symbol><use xlink:href="#ai:local:theme/system-28"></use>  </svg> <select value="auto" data-button="" data-astro-cid-lmznfliq=""> <option value="dark" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Dark&nbsp;&nbsp;</option><option value="light" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Light&nbsp;&nbsp;</option><option value="auto" selected="true" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Auto&nbsp;&nbsp;</option> </select>  </label>  </docs-theme-select>   <script data-astro-exec="">
	ThemeProvider.updatePickers('unknown');
</script>  </div> <div class="header-group" data-astro-cid-h2irkosh="">  <div class="not-content" style="stroke-width:2px" data-astro-cid-pkzv2hgs=""> <button id="mobile-menu-back-button" title="Close menu" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-primary stvb-icon">  <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-h2irkosh="" data-icon="theme/arrow-back">  <symbol id="ai:local:theme/arrow-back"><g fill="none"><g clip-path="url(#a)"><path stroke="var(--arrow-fill-color, #131722)" d="m17 20-6-6 6-6"></path></g><defs><clipPath id="a"><path fill="#fff" d="M28 28H0V0h28z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/arrow-back"></use>  </svg>  </button> </div>  </div> </div> <aside id="nav" class="keep-visible" style="--navbar-right-border-width: 0px" data-astro-cid-sa57sq6l=""> <div class="sidebar-viewport slick-scroll" data-astro-cid-sa57sq6l=""> <div class="sidebar" data-mobile="" data-astro-cid-sa57sq6l=""> <ul class="toc" aria-label="Docs sidebar" data-astro-cid-sa57sq6l=""> <li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/welcome" data-astro-cid-omxx3dey="">Welcome to Pine Script® v6</a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Pine Script® primer</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-steps" data-astro-cid-omxx3dey="">First steps</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-indicator" data-astro-cid-omxx3dey="">First indicator</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/next-steps" data-astro-cid-omxx3dey="">Next steps</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Language</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/execution-model" data-astro-cid-omxx3dey="">Execution model</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/type-system" data-astro-cid-omxx3dey="">Type system</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/script-structure" data-astro-cid-omxx3dey="">Script structure</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/identifiers" data-astro-cid-omxx3dey="">Identifiers</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/variable-declarations" data-astro-cid-omxx3dey="">Variable declarations</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/operators" data-astro-cid-omxx3dey="">Operators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/conditional-structures" data-astro-cid-omxx3dey="">Conditional structures</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/loops" data-astro-cid-omxx3dey="">Loops</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/built-ins" data-astro-cid-omxx3dey="">Built-ins</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/user-defined-functions" data-astro-cid-omxx3dey="">User-defined functions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/objects" data-astro-cid-omxx3dey="">Objects</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/enums" data-astro-cid-omxx3dey="">Enums</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/methods" data-astro-cid-omxx3dey="">Methods</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/arrays" data-astro-cid-omxx3dey="">Arrays</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/matrices" data-astro-cid-omxx3dey="">Matrices</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/maps" data-astro-cid-omxx3dey="">Maps</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Visuals</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/overview" data-astro-cid-omxx3dey="">Overview</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/backgrounds" data-astro-cid-omxx3dey="">Backgrounds</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/bar-coloring" data-astro-cid-omxx3dey="">Bar coloring</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/bar-plotting" data-astro-cid-omxx3dey="">Bar plotting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/colors" data-astro-cid-omxx3dey="">Colors</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/fills" data-astro-cid-omxx3dey="">Fills</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/levels" data-astro-cid-omxx3dey="">Levels</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/lines-and-boxes" data-astro-cid-omxx3dey="">Lines and boxes</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/plots" data-astro-cid-omxx3dey="">Plots</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/tables" data-astro-cid-omxx3dey="">Tables</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/text-and-shapes" data-astro-cid-omxx3dey="">Text and shapes</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Concepts</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/alerts" data-astro-cid-omxx3dey="">Alerts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-states" data-astro-cid-omxx3dey="">Bar states</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/chart-information" data-astro-cid-omxx3dey="">Chart information</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/inputs" data-astro-cid-omxx3dey="">Inputs</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/libraries" data-astro-cid-omxx3dey="">Libraries</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/non-standard-charts-data" data-astro-cid-omxx3dey="">Non-standard charts data</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/other-timeframes-and-data" data-astro-cid-omxx3dey="">Other timeframes and data</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/repainting" data-astro-cid-omxx3dey="">Repainting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/sessions" data-astro-cid-omxx3dey="">Sessions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strategies" data-astro-cid-omxx3dey="">Strategies</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strings" data-astro-cid-omxx3dey="">Strings</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/time" data-astro-cid-omxx3dey="">Time</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/timeframes" data-astro-cid-omxx3dey="">Timeframes</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Writing scripts</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/style-guide" data-astro-cid-omxx3dey="">Style guide</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/debugging" data-astro-cid-omxx3dey="">Debugging</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/profiling-and-optimization" data-astro-cid-omxx3dey="">Profiling and optimization</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/publishing" data-astro-cid-omxx3dey="">Publishing scripts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/limitations" data-astro-cid-omxx3dey="">Limitations</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">FAQ</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/general" data-astro-cid-omxx3dey="">General</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/alerts" data-astro-cid-omxx3dey="">Alerts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/data-structures" data-astro-cid-omxx3dey="">Data structures</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/functions" data-astro-cid-omxx3dey="">Functions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/indicators" data-astro-cid-omxx3dey="">Indicators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/other-data-and-timeframes" data-astro-cid-omxx3dey="">Other data and timeframes</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/programming" data-astro-cid-omxx3dey="">Programming</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/strategies" data-astro-cid-omxx3dey="">Strategies</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/strings-and-formatting" data-astro-cid-omxx3dey="">Strings and formatting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/techniques" data-astro-cid-omxx3dey="">Techniques</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/times-dates-and-sessions" data-astro-cid-omxx3dey="">Times, dates, and sessions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/variables-and-operators" data-astro-cid-omxx3dey="">Variables and operators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/visuals" data-astro-cid-omxx3dey="">Visuals</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/error-messages" data-astro-cid-omxx3dey="">Error messages</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/release-notes" data-astro-cid-omxx3dey="">Release notes</a></li><li class="item" data-astro-cid-omxx3dey=""><details open="" data-is-parent="" data-is-on-path="" data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Migration guides</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/overview" data-astro-cid-omxx3dey="">Overview</a></li><li class="item" data-current="" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-6" data-astro-cid-omxx3dey="">To Pine Script® version 6</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-5" data-astro-cid-omxx3dey="">To Pine Script® version 5</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-4" data-astro-cid-omxx3dey="">To Pine Script® version 4</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-3" data-astro-cid-omxx3dey="">To Pine Script® version 3</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-2" data-astro-cid-omxx3dey="">To Pine Script® version 2</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/where-can-i-get-more-information" data-astro-cid-omxx3dey="">Where can I get more information?</a></li> </ul> <div class="toc-bottom" data-astro-cid-sa57sq6l=""></div> </div> </div> </aside>  </div>   <header class="header" data-astro-cid-d74r2unp=""> <nav role="navigation" aria-label="Main Navigation" data-astro-cid-d74r2unp=""> <mobile-menu-button id="mobile-menu-button-wc" data-astro-cid-oojooh3d=""> <!-- Annoyingly I need to wrap this. TODO: improve this --> <div id="mobile-menu-button-header" data-astro-cid-oojooh3d=""> <div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <button title="Open navigation menu" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-secondary stvb-icon stvb-icon-force-color stvb-force-no-border">  <svg width="28" height="28" viewBox="0 0 24 24" data-astro-cid-oojooh3d="" data-icon="theme/bars">  <symbol id="ai:local:theme/bars"><path fill="currentColor" d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2m18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2m0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2"></path></symbol><use xlink:href="#ai:local:theme/bars"></use>  </svg>  </button> </div>  </div> </mobile-menu-button>   <div data-hide-when-search="" data-astro-cid-d74r2unp=""> <div class="header-logo" data-astro-cid-tycb33lk=""> <a href="/pine-script-docs/" aria-label="Home button" data-astro-cid-tycb33lk=""> <div class="documentation-logo logo" data-astro-cid-tycb33lk=""><!-- Old Christmas icon -->
<!-- 
<svg width="184" height="44" viewBox="0 0 184 44" fill="none" xmlns="http://www.w3.org/2000/svg">
	<path fill-rule="evenodd" clip-rule="evenodd" d="M33.8209 5.1219C33.885 4.95937 34.115 4.95937 34.1791 5.1219L35.2253 7.77465L37.8781 8.82088C38.0406 8.88499 38.0406 9.11501 37.8781 9.17912L35.2253 10.2253L34.1791 12.8781C34.115 13.0406 33.885 13.0406 33.8209 12.8781L32.7747 10.2253L30.1219 9.17912C29.9594 9.11501 29.9594 8.88499 30.1219 8.82088L32.7747 7.77465L33.8209 5.1219Z" fill="#F9A825"/>
    <path d="M5.30092 15.1478C5.37479 14.9605 5.63986 14.9605 5.71373 15.1478L6.60557 17.4091L8.86685 18.3009C9.05415 18.3748 9.05415 18.6399 8.86685 18.7137L6.60557 19.6056L5.71373 21.8669C5.63986 22.0541 5.37479 22.0541 5.30092 21.8669L4.40908 19.6056L2.1478 18.7137C1.9605 18.6399 1.9605 18.3748 2.1478 18.3009L4.40908 17.4091L5.30092 15.1478Z" fill="#F9A825"/>
    <path d="M11.8231 3.12041C11.8864 2.95986 12.1136 2.95986 12.1769 3.12041L12.9414 5.05865L14.8796 5.82308C15.0401 5.8864 15.0401 6.1136 14.8796 6.17692L12.9414 6.94135L12.1769 8.87959C12.1136 9.04014 11.8864 9.04014 11.8231 8.87959L11.0586 6.94135L9.12041 6.17692C8.95986 6.1136 8.95986 5.8864 9.12041 5.82308L11.0586 5.05865L11.8231 3.12041Z" fill="#F9A825"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M22.6478 7.35459L34.7627 21.6923C35.1531 22.1543 35.0472 22.8544 34.5376 23.1802L26.9989 28.0001L18.4281 20.7531L11.3382 23.2611C10.402 23.5923 9.60771 22.5041 10.2085 21.7134L21.0877 7.39502C21.4749 6.88536 22.2346 6.86567 22.6478 7.35459ZM33.432 28.0842L38.3592 34.7471C38.7427 35.2657 38.3724 36 37.7274 36H6.27248C5.62746 36 5.25722 35.2657 5.64074 34.7471L10.8523 27.6996C10.9484 27.5697 11.0822 27.4725 11.2356 27.4214L17.6878 25.2707C17.9285 25.1904 18.1932 25.2314 18.3984 25.3806L26.2854 31.1166C26.5445 31.3051 26.8922 31.3173 27.1639 31.1475L32.3838 27.885C32.7316 27.6677 33.1881 27.7544 33.432 28.0842Z" fill="#089981"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M17.6363 11.9375C20.7386 12.451 23.1213 11.505 24.9187 10.0422L25.8869 11.1881C23.6236 13.0379 20.553 14.1584 16.6261 13.267L17.6363 11.9375ZM34.0572 20.8573C30.0669 21.363 26.2864 20.8179 23.1264 19.7076C20.7393 18.8689 18.6873 17.7013 17.155 16.3997C16.5283 15.8674 15.9767 15.3021 15.5241 14.7174L16.4708 13.4713C16.8706 14.0544 17.4225 14.6588 18.1262 15.2565C19.5001 16.4237 21.3856 17.5061 23.6236 18.2924C26.3235 19.241 29.5087 19.7493 32.8863 19.4716L34.0572 20.8573ZM9.06812 30.1123C15.4775 33.3909 23.0493 33.8897 29.0345 32.0941C31.0827 31.4796 32.9275 30.6019 34.4713 29.4897L35.3633 30.6959C33.6586 31.9268 31.6497 32.8756 29.4655 33.5309C23.053 35.4546 14.9758 34.8964 8.16479 31.3339L9.06812 30.1123Z" fill="#45E5CB"/>
    <path d="M55.56 13.96C59.016 13.96 61.536 16.456 61.536 19.696C61.536 22.936 59.016 25.432 55.56 25.432H53.376V31H49.896V13.96H55.56ZM55.512 22.168C57.096 22.168 58.152 21.088 58.152 19.696C58.152 18.304 57.096 17.224 55.512 17.224H53.376V22.168H55.512ZM66.8636 14.944C66.8636 16.096 65.9276 17.032 64.7516 17.032C63.6236 17.032 62.6636 16.096 62.6636 14.944C62.6636 13.792 63.6236 12.856 64.7516 12.856C65.9276 12.856 66.8636 13.792 66.8636 14.944ZM63.1196 31V19H66.4076V31H63.1196ZM69.0849 31V19H72.3729V20.368C72.9969 19.408 74.2449 18.736 75.8049 18.736C78.7089 18.736 80.4369 20.848 80.4369 23.968V31H77.1489V24.52C77.1489 22.792 76.4049 21.736 75.0369 21.736C73.5249 21.736 72.3729 22.84 72.3729 25.144V31H69.0849ZM82.2041 25C82.2041 21.448 84.8681 18.736 88.5161 18.736C91.6601 18.736 94.4201 20.752 94.4201 24.64C94.4201 24.928 94.4201 25.264 94.3721 25.768H85.3961C85.5881 27.376 87.0041 28.264 88.5881 28.264C90.0761 28.264 91.1561 27.568 91.6841 26.752L94.1321 28.576C93.0281 30.184 91.0841 31.264 88.5641 31.264C84.9881 31.264 82.2041 28.792 82.2041 25ZM88.4201 21.448C87.1961 21.448 85.8281 22.072 85.5161 23.536H91.1321C90.8441 22.12 89.6441 21.448 88.4201 21.448ZM100.412 28.24L103.076 26.008C103.916 27.28 105.38 28.024 106.772 28.024C108.14 28.024 109.052 27.352 109.052 26.368C109.052 25.408 108.356 24.736 106.676 24.16L105.236 23.656C102.5 22.696 101.036 21.112 101.036 18.784C101.036 15.568 103.484 13.672 106.796 13.672C108.884 13.672 110.708 14.392 112.172 16.024L109.868 18.4C109.052 17.416 107.996 16.936 106.82 16.936C105.644 16.936 104.54 17.44 104.54 18.448C104.54 19.48 105.38 19.936 107.18 20.584L108.548 21.088C111.044 22 112.604 23.584 112.604 26.152C112.58 29.2 110.156 31.288 106.628 31.288C103.916 31.288 101.636 30.112 100.412 28.24ZM125.859 27.808C124.827 29.872 122.667 31.264 120.171 31.264C116.619 31.264 113.811 28.624 113.811 25C113.811 21.376 116.619 18.736 120.171 18.736C122.667 18.736 124.827 20.128 125.859 22.192L123.003 23.728C122.523 22.624 121.491 21.808 120.171 21.808C118.443 21.808 117.123 23.152 117.123 25C117.123 26.848 118.443 28.192 120.171 28.192C121.491 28.192 122.523 27.376 123.003 26.272L125.859 27.808ZM127.482 31V19H130.77V20.92C131.178 19.744 132.402 18.856 133.746 18.856C134.082 18.856 134.442 18.88 134.85 19V22.336C134.346 22.168 133.89 22.072 133.362 22.072C131.802 22.072 130.77 23.296 130.77 25.264V31H127.482ZM140.215 14.944C140.215 16.096 139.279 17.032 138.103 17.032C136.975 17.032 136.015 16.096 136.015 14.944C136.015 13.792 136.975 12.856 138.103 12.856C139.279 12.856 140.215 13.792 140.215 14.944ZM136.471 31V19H139.759V31H136.471ZM142.436 36.016V19H145.724V20.344C146.276 19.576 147.548 18.736 149.204 18.736C152.396 18.736 154.844 21.592 154.844 25C154.844 28.408 152.396 31.264 149.204 31.264C147.548 31.264 146.276 30.424 145.724 29.656V36.016H142.436ZM151.508 25C151.508 23.128 150.284 21.736 148.484 21.736C146.684 21.736 145.46 23.128 145.46 25C145.46 26.872 146.684 28.264 148.484 28.264C150.284 28.264 151.508 26.872 151.508 25ZM164.407 30.88C163.879 31.048 163.231 31.144 162.319 31.144C159.775 31.144 157.735 29.728 157.735 26.8V21.88H155.311V19H157.735V15.664H161.023V19H164.407V21.88H161.023V26.152C161.023 27.616 161.647 28.192 163.063 28.192C163.591 28.192 164.023 28.12 164.407 27.976V30.88ZM173.626 22.648V13.96H175.978L177.874 16.888L179.746 13.96H182.122V22.648H179.698V18.184L177.874 20.968L176.026 18.136V22.648H173.626ZM167.386 22.648V16.456H165.058V13.96H172.258V16.456H169.93V22.648H167.386Z" fill="currentColor"/>
</svg> -->



<!-- Regular icon -->

<svg width="177" height="44" viewBox="0 0 177 44" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M17.6876 25.2705C17.9283 25.1902 18.1933 25.2316 18.3985 25.3808L26.2852 31.1162C26.5444 31.3047 26.8924 31.3173 27.1641 31.1474L32.3839 27.8847C32.7316 27.6675 33.1878 27.7545 33.4317 28.084L38.3594 34.7471C38.7428 35.2656 38.3725 35.9999 37.7276 36H6.27253C5.62754 36 5.25723 35.2657 5.64069 34.7471L10.8526 27.6992C10.9486 27.5695 11.0824 27.4729 11.2354 27.4219L17.6876 25.2705ZM21.088 7.39451C21.4752 6.88532 22.2345 6.8659 22.6475 7.35448L34.7628 21.6924C35.1531 22.1544 35.0468 22.8548 34.5372 23.1806L26.9991 28L18.4278 20.7529L11.338 23.2607C10.4021 23.5917 9.60809 22.5044 10.2081 21.7139L21.088 7.39451ZM13.8243 20.2597L17.7608 18.8672C18.4309 18.6301 19.1771 18.7667 19.7198 19.2256L27.1641 25.5205L32.4981 22.1103L21.9259 9.59862L13.8243 20.2597Z" fill="currentColor"></path>
<path d="M147.308 16.959C150.499 16.959 152.948 19.8149 152.948 23.2227C152.948 26.6307 150.5 29.4873 147.308 29.4873C145.652 29.4872 144.38 28.6469 143.828 27.8789V34.2393H140.54V17.2227H143.828V18.5674C144.38 17.7994 145.652 16.9591 147.308 16.959ZM104.9 11.8955C106.988 11.8956 108.812 12.6152 110.276 14.2471L107.972 16.623C107.156 15.6392 106.1 15.1592 104.924 15.1592C103.748 15.1592 102.645 15.6631 102.645 16.6709C102.645 17.7029 103.484 18.1596 105.284 18.8076L106.652 19.3115C109.148 20.2235 110.708 21.8072 110.708 24.375C110.684 27.4229 108.26 29.5106 104.732 29.5107C102.02 29.5107 99.7396 28.3349 98.5156 26.4629L101.18 24.2314C102.02 25.5034 103.484 26.247 104.876 26.2471C106.244 26.2471 107.156 25.5748 107.156 24.5908C107.156 23.631 106.46 22.9587 104.78 22.3828L103.34 21.8789C100.604 20.9189 99.1396 19.3348 99.1396 17.0068C99.1398 13.791 101.588 11.8955 104.9 11.8955ZM86.6201 16.959C89.7641 16.959 92.5244 18.9753 92.5244 22.8633C92.5244 23.1513 92.5246 23.4873 92.4766 23.9912H83.5C83.692 25.5992 85.1084 26.4873 86.6924 26.4873C88.18 26.4872 89.26 25.7914 89.7881 24.9756L92.2363 26.7988C91.1323 28.4068 89.188 29.4873 86.668 29.4873C83.092 29.4872 80.3086 27.0146 80.3086 23.2227C80.3088 19.6709 82.9723 16.959 86.6201 16.959ZM118.275 16.959C120.771 16.9591 122.931 18.3512 123.963 20.415L121.107 21.9512C120.627 20.8473 119.595 20.0314 118.275 20.0312C116.548 20.0312 115.227 21.3749 115.227 23.2227C115.227 25.0707 116.547 26.415 118.275 26.415C119.595 26.4149 120.627 25.599 121.107 24.4951L123.963 26.0312C122.931 28.0951 120.771 29.4872 118.275 29.4873C114.723 29.4873 111.915 26.8467 111.915 23.2227C111.915 19.5989 114.724 16.959 118.275 16.959ZM159.127 17.2227H162.511V20.1035H159.127V24.375C159.127 25.839 159.751 26.415 161.167 26.415C161.695 26.415 162.127 26.3432 162.511 26.1992V29.1035C161.983 29.2715 161.335 29.3672 160.423 29.3672C157.879 29.3672 155.839 27.9512 155.839 25.0234V20.1035H153.415V17.2227H155.839V13.8867H159.127V17.2227ZM53.6641 12.1836C57.12 12.1836 59.6395 14.6791 59.6396 17.9189C59.6396 21.1589 57.12 23.6552 53.6641 23.6553H51.4805V29.2227H48V12.1836H53.6641ZM64.5117 29.2227H61.2236V17.2227H64.5117V29.2227ZM73.9092 16.959C76.813 16.9591 78.541 19.0715 78.541 22.1914V29.2227H75.2529V22.7432C75.2529 21.0152 74.5086 19.959 73.1406 19.959C71.6288 19.9591 70.4766 21.0633 70.4766 23.3672V29.2227H67.1885V17.2227H70.4766V18.5908C71.1006 17.6308 72.3492 16.959 73.9092 16.959ZM131.85 17.0791C132.186 17.0791 132.546 17.1027 132.954 17.2227V20.5596C132.45 20.3916 131.994 20.2949 131.466 20.2949C129.906 20.2949 128.874 21.5193 128.874 23.4873V29.2227H125.586V17.2227H128.874V19.1436C129.282 17.9676 130.506 17.0792 131.85 17.0791ZM137.862 29.2227H134.574V17.2227H137.862V29.2227ZM146.588 19.959C144.788 19.959 143.564 21.3509 143.563 23.2227C143.563 25.0947 144.788 26.4873 146.588 26.4873C148.388 26.4873 149.612 25.0947 149.612 23.2227C149.612 21.3509 148.388 19.959 146.588 19.959ZM169.993 9.76074C170.876 9.76079 171.697 9.9237 172.455 10.25C173.213 10.5764 173.881 11.0326 174.457 11.6182C175.043 12.1942 175.499 12.8617 175.825 13.6201C176.151 14.3783 176.314 15.1991 176.314 16.082C176.314 16.9556 176.152 17.7769 175.825 18.5449C175.499 19.3032 175.043 19.975 174.457 20.5605C173.881 21.1365 173.208 21.5877 172.44 21.9141C171.682 22.2404 170.867 22.4042 169.993 22.4043C169.12 22.4043 168.298 22.2405 167.53 21.9141C166.772 21.5877 166.1 21.1365 165.515 20.5605C164.939 19.975 164.488 19.3032 164.161 18.5449C163.835 17.7769 163.671 16.9556 163.671 16.082C163.671 15.2086 163.835 14.393 164.161 13.6348C164.488 12.8668 164.939 12.1942 165.515 11.6182C166.1 11.0327 166.772 10.5764 167.53 10.25C168.298 9.92362 169.12 9.76074 169.993 9.76074ZM86.5244 19.6709C85.3005 19.6709 83.9323 20.295 83.6201 21.7588H89.2363C88.9482 20.3431 87.7482 19.671 86.5244 19.6709ZM169.993 11.1865C169.312 11.1865 168.672 11.3109 168.077 11.5605C167.492 11.8101 166.974 12.1612 166.522 12.6123C166.071 13.0635 165.72 13.5865 165.471 14.1816C165.221 14.7671 165.097 15.4006 165.097 16.082C165.097 16.7634 165.221 17.402 165.471 17.9971C165.72 18.5827 166.071 19.1015 166.522 19.5527C166.974 20.0038 167.492 20.3539 168.077 20.6035C168.672 20.8531 169.312 20.9785 169.993 20.9785C170.675 20.9785 171.308 20.8531 171.894 20.6035C172.489 20.3539 173.012 20.0038 173.463 19.5527C173.914 19.1015 174.265 18.5827 174.515 17.9971C174.764 17.402 174.889 16.7634 174.889 16.082C174.889 15.4006 174.764 14.7671 174.515 14.1816C174.265 13.5865 173.914 13.0635 173.463 12.6123C173.012 12.1611 172.489 11.8101 171.894 11.5605C171.308 11.311 170.675 11.1866 169.993 11.1865ZM51.4805 20.3916H53.6162C55.2001 20.3915 56.2559 19.3109 56.2559 17.9189C56.2558 16.5271 55.2 15.4474 53.6162 15.4473H51.4805V20.3916ZM169.878 13.2314C170.406 13.2315 170.838 13.2932 171.174 13.418C171.519 13.5332 171.773 13.7163 171.937 13.9658C172.1 14.2154 172.182 14.5271 172.182 14.9014C172.182 15.2469 172.09 15.5494 171.908 15.8086C171.726 16.0581 171.481 16.2646 171.174 16.4277L172.815 18.9336H171.217L169.964 16.8027H169.445V18.9336H168.034V13.2314H169.878ZM169.445 15.751H169.849C170.127 15.751 170.348 15.6932 170.511 15.5781C170.674 15.4533 170.756 15.247 170.756 14.959C170.756 14.7383 170.684 14.5703 170.54 14.4551C170.396 14.3399 170.165 14.2822 169.849 14.2822H169.445V15.751ZM62.8555 11.0791C64.0314 11.0791 64.9677 12.0151 64.9678 13.167C64.9678 14.319 64.0315 15.2549 62.8555 15.2549C61.7275 15.2548 60.7676 14.3189 60.7676 13.167C60.7677 12.0151 61.7276 11.0792 62.8555 11.0791ZM136.207 11.0791C137.383 11.0793 138.318 12.0152 138.318 13.167C138.318 14.3188 137.383 15.2546 136.207 15.2549C135.079 15.2549 134.118 14.319 134.118 13.167C134.118 12.0151 135.079 11.0791 136.207 11.0791Z" fill="currentColor"></path>
</svg>
</div> </a> </div>  </div> <div class="flex" data-astro-cid-d74r2unp=""></div> <div class="flex" data-astro-cid-d74r2unp=""> <div class="search-container" data-astro-cid-fg37foga=""> <div class="search-wrapper" data-astro-cid-fg37foga=""> <input class="search-input" type="text" placeholder="Search docs" name="s" value="" data-astro-cid-fg37foga="" data-has-input-listener="true"> <svg width="28" height="28" viewBox="0 0 28 28" class="search-button" data-astro-cid-fg37foga="" data-icon="theme/search">  <symbol id="ai:local:theme/search"><path fill="currentColor" fill-rule="evenodd" d="M18.5 12.5a6 6 0 1 1-12 0 6 6 0 0 1 12 0m-1.25 5.8a7.5 7.5 0 1 1 1.06-1.06l4.22 4.23.53.53L22 23.06l-.53-.53-4.22-4.22Z" clip-rule="evenodd"></path></symbol><use xlink:href="#ai:local:theme/search"></use>  </svg> <button class="search-clear" type="button" title="Reset" data-search-clear="" data-astro-cid-fg37foga="">Clear</button> <span class="divider" data-astro-cid-fg37foga=""></span> <button class="search-close" type="button" title="Close" data-search-close="" data-astro-cid-fg37foga=""> <svg width="18" height="18" viewBox="0 0 18 18" data-astro-cid-fg37foga="" data-icon="theme/cross-18">  <use xlink:href="#ai:local:theme/cross-18"></use>  </svg> </button> </div> <div id="search-results-wrapper" data-astro-cid-fg37foga=""> <aside id="search-results" hidden="" data-astro-cid-fg37foga="" data-has-button-listener="true"> <!-- Don't use h1 because when built it will be used as the first heading on the page --> <div class="heading" data-astro-cid-fg37foga="">Search results</div> <div id="search-results-contents" data-astro-cid-fg37foga=""></div> </aside> </div> </div>   </div> <ul class="links" data-astro-cid-d74r2unp="">  </ul> <div class="flex" data-astro-cid-d74r2unp=""></div> <div data-hide-when-search="" data-astro-cid-d74r2unp=""> <div id="version-select" data-hideable="true" data-astro-cid-kx7qoxgq=""> <label style="--sl-select-width: undefined; --sl-label-icon-size: 16px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq="">Version</span>  <select value="v6" data-has-border="" no-icon="true" data-astro-cid-lmznfliq=""> <option value="v6" selected="true" data-astro-cid-lmznfliq="">Version 6</option><option value="v5" data-astro-cid-lmznfliq="">Version 5</option><option value="v4" data-astro-cid-lmznfliq="">Version 4</option><option value="v3" data-astro-cid-lmznfliq="">Version 3</option> </select> <svg width="16" height="16" viewBox="0 0 24 24" class="icon caret" data-astro-cid-lmznfliq="" data-icon="theme/down-caret">  <use xlink:href="#ai:local:theme/down-caret"></use>  </svg> </label>  </div>   </div> <button id="search-button" data-astro-cid-6zeqadij="" data-has-listener="true"> <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-6zeqadij="" data-icon="theme/search">  <use xlink:href="#ai:local:theme/search"></use>  </svg> </button>  <script data-base-url="/pine-script-docs" data-astro-exec="">
	async function loadPageFind() {
		const base = document.currentScript.getAttribute('data-base-url');
		const pageFindBundleUrl = `${base}/pagefind/`;
		const pagefind = await import(`${pageFindBundleUrl}pagefind.js`);
		await pagefind.options({
			bundlePath: pageFindBundleUrl,
		});
		window.pagefind = pagefind;
	}
	loadPageFind().catch();
</script>  <docs-theme-select class="hide-with-breakpoint-568" data-astro-cid-3wpspbi7=""> <label style="--sl-select-width: 48px; --sl-label-icon-size: 28px;" data-astro-cid-lmznfliq=""> <span class="sr-only" data-astro-cid-lmznfliq="">Theme</span> <svg width="28" height="28" viewBox="0 0 28 28" class="icon label-icon" data-button="" data-round="" data-astro-cid-lmznfliq="" data-icon="theme/system-28">  <symbol id="ai:local:theme/system-28"><path fill="currentColor" d="M8 4h1v2H8zm0 9v2h1v-2zm6-3V9h-2v1zM3 9v1h2V9zm5.5 3a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5m4.2-6-.7-.7-1.4 1.4.7.7zM5 13.7l-.7-.7 1.4-1.4.7.7zm7.7-.7-.7.7-1.4-1.4.7-.7zM4.3 6l.7-.7 1.4 1.4-.7.7zm3 17 14-14 .8.7L8 23.7zm17.2-.1a3.5 3.5 0 0 1-3.4-5.9H21a4 4 0 1 0 3.5 5.9"></path></symbol><use xlink:href="#ai:local:theme/system-28"></use>  </svg> <select value="auto" data-button="" data-astro-cid-lmznfliq=""> <option value="dark" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Dark&nbsp;&nbsp;</option><option value="light" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Light&nbsp;&nbsp;</option><option value="auto" selected="true" data-astro-cid-lmznfliq="">&nbsp;&nbsp;Auto&nbsp;&nbsp;</option> </select>  </label>  </docs-theme-select>   <script data-astro-exec="">
	ThemeProvider.updatePickers('unknown');
</script>  </nav> </header>        <div id="image-lightbox" class="not-content" hidden="" data-astro-cid-kws7taxh=""> <div class="button-wrapper" data-astro-cid-kws7taxh=""> <div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <button id="lightbox-close-button" title="Close image preview" data-astro-cid-pkzv2hgs="" class="not-content stvb-base stvb-pointer stvb-black stvb-medium stvb-secondary stvb-icon stvb-force-no-border">  <svg width="24" height="24" viewBox="0 0 18 18" data-astro-cid-kws7taxh="" data-icon="theme/cross-18">  <symbol id="ai:local:theme/cross-18"><g fill="none"><g clip-path="url(#a)"><path fill="currentColor" fill-rule="evenodd" d="M5.53 4.47 4.47 5.53 7.94 9l-3.47 3.47 1.06 1.06L9 10.06l3.47 3.47 1.06-1.06L10.06 9l3.47-3.47-1.06-1.06L9 7.94z" clip-rule="evenodd"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h18v18H0z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/cross-18"></use>  </svg>  </button> </div>  </div> <img id="lightbox-image" src="" data-astro-cid-kws7taxh=""> </div>   <div id="page-container" data-astro-cid-xgirumru=""> <aside id="nav" class="" style="" data-astro-cid-sa57sq6l=""> <div class="sidebar-viewport slick-scroll" data-astro-cid-sa57sq6l=""> <div class="sidebar" data-astro-cid-sa57sq6l=""> <ul class="toc" aria-label="Docs sidebar" data-astro-cid-sa57sq6l=""> <li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/welcome" data-astro-cid-omxx3dey="">Welcome to Pine Script® v6</a></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Pine Script® primer</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <symbol id="ai:local:theme/right-caret"><path fill="currentColor" d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1 1 0 0 0 0-1.42"></path></symbol><use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-steps" data-astro-cid-omxx3dey="">First steps</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/first-indicator" data-astro-cid-omxx3dey="">First indicator</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/primer/next-steps" data-astro-cid-omxx3dey="">Next steps</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Language</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/execution-model" data-astro-cid-omxx3dey="">Execution model</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/type-system" data-astro-cid-omxx3dey="">Type system</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/script-structure" data-astro-cid-omxx3dey="">Script structure</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/identifiers" data-astro-cid-omxx3dey="">Identifiers</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/variable-declarations" data-astro-cid-omxx3dey="">Variable declarations</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/operators" data-astro-cid-omxx3dey="">Operators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/conditional-structures" data-astro-cid-omxx3dey="">Conditional structures</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/loops" data-astro-cid-omxx3dey="">Loops</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/built-ins" data-astro-cid-omxx3dey="">Built-ins</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/user-defined-functions" data-astro-cid-omxx3dey="">User-defined functions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/objects" data-astro-cid-omxx3dey="">Objects</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/enums" data-astro-cid-omxx3dey="">Enums</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/methods" data-astro-cid-omxx3dey="">Methods</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/arrays" data-astro-cid-omxx3dey="">Arrays</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/matrices" data-astro-cid-omxx3dey="">Matrices</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/language/maps" data-astro-cid-omxx3dey="">Maps</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Visuals</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/overview" data-astro-cid-omxx3dey="">Overview</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/backgrounds" data-astro-cid-omxx3dey="">Backgrounds</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/bar-coloring" data-astro-cid-omxx3dey="">Bar coloring</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/bar-plotting" data-astro-cid-omxx3dey="">Bar plotting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/colors" data-astro-cid-omxx3dey="">Colors</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/fills" data-astro-cid-omxx3dey="">Fills</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/levels" data-astro-cid-omxx3dey="">Levels</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/lines-and-boxes" data-astro-cid-omxx3dey="">Lines and boxes</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/plots" data-astro-cid-omxx3dey="">Plots</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/tables" data-astro-cid-omxx3dey="">Tables</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/visuals/text-and-shapes" data-astro-cid-omxx3dey="">Text and shapes</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Concepts</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/alerts" data-astro-cid-omxx3dey="">Alerts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/bar-states" data-astro-cid-omxx3dey="">Bar states</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/chart-information" data-astro-cid-omxx3dey="">Chart information</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/inputs" data-astro-cid-omxx3dey="">Inputs</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/libraries" data-astro-cid-omxx3dey="">Libraries</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/non-standard-charts-data" data-astro-cid-omxx3dey="">Non-standard charts data</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/other-timeframes-and-data" data-astro-cid-omxx3dey="">Other timeframes and data</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/repainting" data-astro-cid-omxx3dey="">Repainting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/sessions" data-astro-cid-omxx3dey="">Sessions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strategies" data-astro-cid-omxx3dey="">Strategies</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/strings" data-astro-cid-omxx3dey="">Strings</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/time" data-astro-cid-omxx3dey="">Time</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/concepts/timeframes" data-astro-cid-omxx3dey="">Timeframes</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Writing scripts</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/style-guide" data-astro-cid-omxx3dey="">Style guide</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/debugging" data-astro-cid-omxx3dey="">Debugging</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/profiling-and-optimization" data-astro-cid-omxx3dey="">Profiling and optimization</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/publishing" data-astro-cid-omxx3dey="">Publishing scripts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/writing/limitations" data-astro-cid-omxx3dey="">Limitations</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><details data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">FAQ</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/general" data-astro-cid-omxx3dey="">General</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/alerts" data-astro-cid-omxx3dey="">Alerts</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/data-structures" data-astro-cid-omxx3dey="">Data structures</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/functions" data-astro-cid-omxx3dey="">Functions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/indicators" data-astro-cid-omxx3dey="">Indicators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/other-data-and-timeframes" data-astro-cid-omxx3dey="">Other data and timeframes</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/programming" data-astro-cid-omxx3dey="">Programming</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/strategies" data-astro-cid-omxx3dey="">Strategies</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/strings-and-formatting" data-astro-cid-omxx3dey="">Strings and formatting</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/techniques" data-astro-cid-omxx3dey="">Techniques</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/times-dates-and-sessions" data-astro-cid-omxx3dey="">Times, dates, and sessions</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/variables-and-operators" data-astro-cid-omxx3dey="">Variables and operators</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/faq/visuals" data-astro-cid-omxx3dey="">Visuals</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/error-messages" data-astro-cid-omxx3dey="">Error messages</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/release-notes" data-astro-cid-omxx3dey="">Release notes</a></li><li class="item" data-astro-cid-omxx3dey=""><details open="" data-is-parent="" data-is-on-path="" data-astro-cid-omxx3dey=""><summary data-astro-cid-omxx3dey=""><div class="summary-link" data-astro-cid-omxx3dey="">Migration guides</div><div class="caret" data-astro-cid-omxx3dey=""><svg width="18" height="18" viewBox="0 0 24 24" class="icon" data-astro-cid-omxx3dey="" data-icon="theme/right-caret">  <use xlink:href="#ai:local:theme/right-caret"></use>  </svg></div></summary><ul class="children" data-astro-cid-omxx3dey=""><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/overview" data-astro-cid-omxx3dey="">Overview</a></li><li class="item" data-current="" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-6" data-astro-cid-omxx3dey="">To Pine Script® version 6</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-5" data-astro-cid-omxx3dey="">To Pine Script® version 5</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-4" data-astro-cid-omxx3dey="">To Pine Script® version 4</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-3" data-astro-cid-omxx3dey="">To Pine Script® version 3</a></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/migration-guides/to-pine-version-2" data-astro-cid-omxx3dey="">To Pine Script® version 2</a></li></ul></details></li><li class="item" data-astro-cid-omxx3dey=""><a class="page-link" href="/pine-script-docs/where-can-i-get-more-information" data-astro-cid-omxx3dey="">Where can I get more information?</a></li> </ul> <div class="toc-bottom" data-astro-cid-sa57sq6l=""></div> </div> </div> </aside>  <main class="main-pane" data-page-type="md" data-astro-cid-xgirumru=""> <a id="top" data-astro-cid-xgirumru=""></a> <main class="content" data-toc-shown="" data-astro-cid-ju3wuhkz="">  <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-pagefind-ignore="" data-astro-cid-wlavna2o=""> <a href="/pine-script-docs" aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o=""> <span data-astro-cid-wlavna2o="">User Manual</span>  </a>  <span class="divider" data-astro-cid-wlavna2o="">/</span> <a href="/pine-script-docs/migration-guides/overview" data-astro-cid-wlavna2o="">Migration guides</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">To Pine Script® version 6</span> </div>     </div> <div id="slot-container" data-astro-cid-xgirumru=""> <h1 id="to-pine-script-version-6" class="md-heading"><a href="#to-pine-script-version-6">To Pine Script® version <span class="fancy-wrap">6<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h1>
<h2 id="introduction" class="md-heading"><a href="#introduction"> <span class="fancy-wrap">Introduction<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p>Pine Script v6 introduces a number of changes and new features. See the <a href="/pine-script-docs/release-notes/">Release Notes</a> for a list of all new features.</p>
<p>Some changes are not compatible with v5 scripts. This guide explains how to update your script from v5 to v6. If you want to convert a script from v4 or earlier to v6, refer to the migration guides for previous versions and update the script one version at a time.</p>
<p>The Pine Editor converter can handle many of these changes <em>automatically</em>, while other changes might require <em>manual</em> fixes.</p>
<p>Here are the changes that affect v5 scripts:</p>
<ul>
<li>Values of the “int” and “float” types are no longer implicitly cast to “bool”.</li>
<li>Boolean values can no longer be <a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a>, and the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_na">na()</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_nz">nz()</a>, and <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_fixnan">fixnan()</a> functions no longer accept “bool” arguments.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_and">and</a> and <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_or">or</a> operators now evaluate conditions lazily.</li>
<li>All <code dir="auto">request.*()</code> functions can now execute dynamically.</li>
<li>Division of two “const int” values can now return a fractional value.</li>
<li>The <code dir="auto">when</code> parameter is removed from all applicable <code dir="auto">strategy.*()</code> functions.</li>
<li>The default long and short margin percentage for strategies is now 100.</li>
<li>Strategies now trim the oldest orders in their results instead of raising an error when they exceed the 9000 trade limit.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> command no longer ignores relative parameters defining take-profit and stop-loss prices or trailing stop activation levels when the call also includes arguments for the related absolute parameters.</li>
<li>The history-referencing operator <a href="https://www.tradingview.com/pine-script-reference/v6/#op_%5B%5D">[]</a> can no longer reference the history of literal values or fields of user-defined types directly.</li>
<li>Function calls can no longer include more than one argument for the same parameter.</li>
<li>The <code dir="auto">offset</code> parameter of <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plot">plot()</a> and other functions no longer accepts “series” values.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a> values are no longer allowed in place of built-in constants of unique types.</li>
<li>The value of <a href="https://www.tradingview.com/pine-script-reference/v6/#var_timeframe.period">timeframe.period</a> now always includes a multiplier (e.g., <code dir="auto">"1D"</code> instead of <code dir="auto">"D"</code>).</li>
<li>Some <code dir="auto">array.*()</code> functions now accept negative index arguments.</li>
<li>Some mutable variables are no longer erroneously marked as “const”.</li>
<li>The <code dir="auto">transp</code> parameter is removed from all applicable functions.</li>
<li>Some default colors and color constants have updated values.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop statement now evaluates its end boundary dynamically before every iteration.</li>
</ul>
<h2 id="converting-v5-to-v6-using-the-pine-editor" class="md-heading"><a href="#converting-v5-to-v6-using-the-pine-editor">Converting v5 to v6 using the Pine <span class="fancy-wrap">Editor<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p>The Pine Editor can automatically convert a v5 script to v6. The Pine Editor highlights the <code dir="auto">//@version=5</code> <a href="/pine-script-docs/language/script-structure/#compiler-annotations">annotation</a> of a v5 script in yellow.</p>
<p>To convert the script, click the editor’s “Manage script” dropdown menu and select “Convert code to v6”:</p>
<p><img src="/pine-script-docs/_astro/MigrationGuideTov6-Convert-button.BbP6b2UG_ZIeE3O.webp" alt="image" width="985" height="631" loading="lazy" decoding="async"></p>
<p>A script can be converted only if its v5 code compiles successfully. In rare cases, converting the script automatically can result in a v6 script with compilation errors. In that case, the errors are highlighted in the Editor, and you need to resolve them by using the information in the following sections.</p>
<h2 id="dynamic-requests" class="md-heading"><a href="#dynamic-requests">Dynamic <span class="fancy-wrap">requests<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p>In Pine v6, scripts can call all <code dir="auto">request.*()</code> functions <em>dynamically by default</em>, allowing any single <code dir="auto">request.*()</code> call instance in the code to request data from different datasets and work within local scopes.</p>
<p>When a script does <em>not</em> use <a href="/pine-script-docs/concepts/other-timeframes-and-data/#dynamic-requests">dynamic requests</a>, the <em>context</em> of a data request (ticker ID and timeframe) must be known on the first script execution and remain <em>unchanged</em> across all subsequent executions. Therefore, <code dir="auto">symbol</code>, <code dir="auto">timeframe</code>, and other parameters specifying a non-dynamic <code dir="auto">request.*()</code> call’s context require arguments with the “simple” qualifier. Additionally, non-dynamic requests must execute globally, meaning they are not allowed inside the local scopes of <a href="/pine-script-docs/language/loops/">loops</a> and other structures.</p>
<p>In contrast, when a script allows dynamic requests, it can call <code dir="auto">request.*()</code> functions with <em>“series” arguments</em> for the parameters that define the context of the data requests. With this qualifier change, scripts can:</p>
<ul>
<li>Retrieve data from new datasets on <em>any</em> historical bar, even <em>after</em> the first available bar, with a single <code dir="auto">request.*()</code> call instance.</li>
<li>Store symbol and timeframe strings in <a href="/pine-script-docs/language/type-system/#collections">collections</a> or <a href="/pine-script-docs/language/objects/">objects</a>, then use the collected values to define a <code dir="auto">request.*()</code> call’s context.</li>
<li>Call <code dir="auto">request.*()</code> functions within the local scopes of <a href="/pine-script-docs/language/loops/">loops</a> and <a href="/pine-script-docs/language/conditional-structures/">conditional structures</a>.</li>
<li><a href="/pine-script-docs/concepts/libraries/#library-functions">Export library functions</a> containing <code dir="auto">request.*()</code> calls.</li>
</ul>
<p><em>Non-dynamic</em> requests are the default in Pine v5. Scripts coded in v5 can execute dynamic requests, but only if programmers specify <code dir="auto">dynamic_requests = true</code> in the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_indicator">indicator()</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy">strategy()</a>, or <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_library">library()</a> declaration statement. If not specified, the default argument is <code dir="auto">false</code>.</p>
<p>In Pine v6, dynamic requests are <em>always</em> available by default. When a script includes <code dir="auto">request.*()</code> calls, the compiler analyzes the script to determine whether dynamic requests are necessary. If unnecessary for the script, the compiler automatically turns the feature off to optimize performance.</p>
<p>The following v6 example uses a single <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_request.security">request.security()</a> instance in a <a href="/pine-script-docs/language/loops/">loop</a> to retrieve data for multiple symbols stored in an <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a>. On each iteration, the script dynamically retrieves the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> price for one of the stored symbols from the “1D” timeframe and pushes the retrieved value into an array with <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_array.push">array.push()</a>. After the loop terminates, the script calculates that array’s average using <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_array.avg">array.avg()</a> and plots the result. In Pine v5, this script would cause a <em>compilation error</em> unless we included <code dir="auto">dynamic_requests = true</code> in the declaration statement:</p>
<p><img src="/pine-script-docs/_astro/MigrationGuideTov6-Dynamic-requests.CU--JEtI_Z1wsCBX.webp" alt="image" width="1120" height="532" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="42a"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Dynamic&nbsp;`request`&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//For&nbsp;v5:&nbsp;must&nbsp;add&nbsp;`dynamic_requests&nbsp;=&nbsp;true`&nbsp;to&nbsp;`i</span><span class="mtk9">ndicator()`&nbsp;for&nbsp;this&nbsp;code&nbsp;to&nbsp;work.</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;User-input&nbsp;toggle&nbsp;to&nbsp;display&nbsp;each&nbsp;symbol's&nbsp;`close</span><span class="mtk9">`&nbsp;price&nbsp;on&nbsp;chart&nbsp;alongside&nbsp;average&nbsp;`close`.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">showSymbols</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.bool</span><span class="mtk13">(</span><span class="mtk11">false</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Plot&nbsp;symbol&nbsp;closes"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Persistent&nbsp;array&nbsp;of&nbsp;"string"&nbsp;symbol&nbsp;ticker&nbsp;IDs&nbsp;to</span><span class="mtk9">&nbsp;request&nbsp;for&nbsp;our&nbsp;custom&nbsp;index.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">string</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">symbols</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk29">"NASDAQ:MSFT"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"NASDAQ:AAPL"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"NASDAQ:GOOGL"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"NASDAQ:NVDA"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Array&nbsp;storing&nbsp;the&nbsp;`close`&nbsp;prices&nbsp;for&nbsp;the&nbsp;`symbols</span><span class="mtk9">`&nbsp;on&nbsp;each&nbsp;bar.</span></span><br><span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">symCloses</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Loop&nbsp;through&nbsp;`symbols`&nbsp;and&nbsp;request&nbsp;daily&nbsp;`close</span><span class="mtk9">`&nbsp;prices.&nbsp;</span></span><br><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk13">[</span><span class="mtk33">i</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">sym</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">in</span><span class="mtk1">&nbsp;</span><span class="mtk33">symbols</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">reqClose</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">request.security</span><span class="mtk13">(</span><span class="mtk33">sym</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"1D"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">symCloses</span><span class="mtk1">.</span><span class="mtk15">push</span><span class="mtk13">(</span><span class="mtk33">reqClose</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Calculate&nbsp;and&nbsp;plot&nbsp;the&nbsp;average&nbsp;`close`&nbsp;for&nbsp;the&nbsp;</span><span class="mtk9">`symbols`&nbsp;to&nbsp;create&nbsp;our&nbsp;custom&nbsp;index&nbsp;plot.</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">avgClose</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">symCloses</span><span class="mtk1">.</span><span class="mtk15">avg</span><span class="mtk13">()</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">avgClose</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Avg&nbsp;close"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">avgClose</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;=</span><span class="mtk1">&nbsp;</span><span class="mtk33">avgClose</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;each&nbsp;symbol's&nbsp;`close`&nbsp;for&nbsp;reference&nbsp;if&nbsp;`sh</span><span class="mtk9">owSymbols`&nbsp;is&nbsp;`true`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">showSymbols</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">symCloses</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"MSFT"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">showSymbols</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">symCloses</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"AAPL"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.navy</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">showSymbols</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">symCloses</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"GOOGL"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.aqua</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">showSymbols</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk33">symCloses</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">3</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"NVDA"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.teal</span><span class="mtk13">)</span></span><br></code></div>
<p>There are minor differences between dynamic and non-dynamic requests in some obscure cases, such as when using the result of one <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_request.security">request.security()</a> call in the <code dir="auto">expression</code> argument of another call. As a result, a valid v5 script without dynamic requests can behave differently after conversion to v6, even if nothing related to the requests was changed in the code.</p>
<p><strong>Fix:</strong> In Pine v6, the <code dir="auto">dynamic_requests</code> parameter of the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_indicator">indicator()</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy">strategy()</a>, and <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_library">library()</a> functions is <code dir="auto">true</code> by default. If you find differences in a <code dir="auto">request.*()</code> call’s behavior after converting a script to v6, you can include <code dir="auto">dynamic_requests = false</code> in the declaration statement to force dynamic requests off and replicate most of the previous v5 behavior.</p>
<p>It’s important to note that, in Pine v5, it is possible to call user-defined functions or methods containing <code dir="auto">request.*()</code> calls inside the local blocks of loops and conditional structures <em>without</em> enabling dynamic requests. However, such calls still require <em>“simple”</em> arguments for all parameters defining the requested context, which limits their utility.</p>
<p>In Pine v6, calling a <code dir="auto">request.*()</code> function from the scope of a loop or conditional structure is <strong>not allowed</strong> if <code dir="auto">dynamic_requests</code> is set to <code dir="auto">false</code> in the script’s declaration statement, even if the call is within a user-defined function. A v6 script that attempts to use wrapped <code dir="auto">request.*()</code> calls in local scopes without dynamic requests enabled causes a <em>compilation error</em>.</p>
<p><strong>Fix:</strong> If a v5 script specifies <code dir="auto">dynamic_requests</code> is <code dir="auto">false</code> in its declaration statement and uses functions containing <code dir="auto">request.*()</code> calls inside local blocks, remove the explicit <code dir="auto">dynamic_requests</code> argument when converting the script to v6. The converted script will use <a href="/pine-script-docs/concepts/other-timeframes-and-data/#dynamic-requests">dynamic requests</a> automatically, allowing the functions containing <code dir="auto">request.*()</code> calls to work correctly inside local scopes.</p>
<h2 id="types" class="md-heading"><a href="#types"> <span class="fancy-wrap">Types<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p>The following changes have been made to how Pine handles types.</p>
<h3 id="explicit-bool-casting" class="md-heading"><a href="#explicit-bool-casting">Explicit “bool” <span class="fancy-wrap">casting<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>In Pine v6, “int” and “float” values are no longer implicitly cast to “bool”.</p>
<p>In Pine v5, values of “int” and “float” types can be implicitly cast to “bool” when an expression or function requires a boolean value. In such cases, <code dir="auto">na</code>, <code dir="auto">0</code>, or <code dir="auto">0.0</code> are considered <code dir="auto">false</code>, and <em>any other value</em> is considered <code dir="auto">true</code>.</p>
<p>For example, take a look at this conditional expression:</p>
<div class="pine-colorizer not-content colorized" data-id="2p4"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">expr</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span></span><br></code></div>
<p>It assigns <code dir="auto">color.red</code> to <code dir="auto">expr</code> on the <em>first</em> bar of the chart, because that bar has a <code dir="auto">bar_index</code> of 0, and then assigns <code dir="auto">color.green</code> on <em>every</em> following bar, because any <em>non-zero</em> value is <code dir="auto">true</code>. The ternary operator <a href="https://www.tradingview.com/pine-script-reference/v6/#op_?:">?:</a> expects a “bool” expression for its condition, but in v5 it can also accept a numeric value as its conditional expression, which it automatically converts (implicitly casts) to a “bool”.</p>
<p>In v6, scripts must <em>explicitly</em> cast a numeric value to “bool” to use it where a “bool” type is required.</p>
<p><strong>Fix:</strong> Wrap the numeric value with the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_bool">bool()</a> function to cast it explicitly.</p>
<div class="pine-colorizer not-content colorized" data-id="6yz"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">expr</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">bool</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span></span><br></code></div>
<h3 id="boolean-values-cannot-be-na" class="md-heading"><a href="#boolean-values-cannot-be-na"><span>Boolean values cannot be ​<code dir="auto">na</code>​</span><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></a></h3>
<p>In v6, “bool” values can no longer be <code dir="auto">na</code>. Consequently, the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_na">na()</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_nz">nz()</a>, and <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_fixnan">fixnan()</a> functions no longer accept “bool” types.</p>
<p>In v5, “<a href="https://www.tradingview.com/pine-script-reference/v6/#type_bool">bool</a>” variables have <em>three</em> possible values: they can be <code dir="auto">true</code>, <code dir="auto">false</code>, or <code dir="auto">na</code>. The boolean <code dir="auto">na</code> value behaves differently from both <code dir="auto"> true</code> and <code dir="auto">false</code>:</p>
<ul>
<li>
<p>When implicitly cast to “bool”, <code dir="auto">na</code> is evaluated as <code dir="auto">false</code>.</p>
</li>
<li>
<p>The boolean <code dir="auto">na</code> value is <strong>not</strong> considered equal to <code dir="auto">false</code> when compared using the <code dir="auto">==</code> operator.</p>
</li>
<li>
<p>When the boolean <code dir="auto">na</code> value is passed to the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_na">na()</a> function, it returns <code dir="auto">true</code>, whereas <code dir="auto">na(true)</code> and <code dir="auto">na(false)</code> both return <code dir="auto">false</code>.</p>
</li>
</ul>
<p>To manage the boolean <code dir="auto">na</code> value, the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_na">na()</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_nz">nz()</a>, and <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_fixnan">fixnan()</a> functions in v5 have overloads that accept “bool” type arguments. This third boolean state leads to occasional confusion in v5 scripts.</p>
<p>In v6, this is no longer the case: a “bool” must be <em>either</em> <code dir="auto">true</code> or <code dir="auto">false</code>, with <strong>no</strong> third state. This means that in v6 scripts:</p>
<ul>
<li>
<p>A variable declared as “bool” can <strong>no longer</strong> be assigned <code dir="auto">na</code> as its default value.</p>
</li>
<li>
<p>In conditional expressions like <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a> and <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_switch">switch</a>, if the return type of the expression is “bool”, any <em>unspecified</em> condition returns <code dir="auto">false</code> instead of <code dir="auto">na</code>.</p>
</li>
<li>
<p>Expressions that returned a boolean <code dir="auto">na</code> value in v5 now return <code dir="auto">false</code>. For example, using the history-referencing operator <code dir="auto">[]</code> on the very first bar of the dataset to request a historical value of a “bool” variable returned <code dir="auto">na</code> in v5, because no past bars exist, but in Pine v6 it returns <code dir="auto">false</code>.</p>
</li>
<li>
<p>Functions that explicitly check whether a value is <code dir="auto">na</code> – specifically, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_na">na()</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_nz">nz()</a>, and <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_fixnan">fixnan()</a> – do <strong>not</strong> accept “bool” arguments in v6.</p>
</li>
</ul>
<p>This example v5 script creates a simple <a href="/pine-script-docs/concepts/strategies/">strategy</a> that switches between long and short positions when two moving averages cross. An <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_if">if</a>-statement assigns <code dir="auto">true</code> or <code dir="auto">false</code> to a “bool” variable <code dir="auto">isLong</code> to track the trade’s long or short direction, using the strategy’s positive (&gt; 0) or negative (&lt; 0) <a href="/pine-script-docs/concepts/strategies/#position-sizing">position size</a>. However, when the position size is zero, <em>neither</em> of these conditions are valid. In v5, the undefined condition (== 0) assigns <code dir="auto">na</code> to the variable <code dir="auto">isLong</code>.</p>
<p>Therefore, a boolean <code dir="auto">na</code> value occurs on the first few bars in the dataset before the strategy enters any positions. We can visualize the three “bool” states by setting the <a href="/pine-script-docs/visuals/backgrounds/">background color</a> based on the value of <code dir="auto">isLong</code>:</p>
<p><img src="/pine-script-docs/_astro/MigrationGuideTov6-No-bool-na-1.B7b5WX8__ZhfW1O.webp" alt="image" width="1235" height="445" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="7cn"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Bool&nbsp;`na`&nbsp;demo&nbsp;v5"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk18">=</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">margin_long</span><span class="mtk18">=</span><span class="mtk12">100</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">margin_short</span><span class="mtk18">=</span><span class="mtk12">100</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Strategy's&nbsp;long&nbsp;and&nbsp;short&nbsp;trades&nbsp;are&nbsp;based&nbsp;on&nbsp;m</span><span class="mtk9">oving&nbsp;average&nbsp;cross&nbsp;over/under.</span></span><br><span><span class="mtk33">longCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">28</span><span class="mtk13">))</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">longCondition</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"My&nbsp;Long&nbsp;Entry&nbsp;Id"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk33">shortCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">28</span><span class="mtk13">))</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">shortCondition</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"My&nbsp;Short&nbsp;Entry&nbsp;Id"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Boolean&nbsp;variable&nbsp;that&nbsp;tracks&nbsp;the&nbsp;current&nbsp;directio</span><span class="mtk9">n&nbsp;of&nbsp;the&nbsp;trade.</span></span><br><span><span class="mtk9">//&nbsp;Is&nbsp;`true`&nbsp;when&nbsp;`position_size`&nbsp;is&nbsp;greater&nbsp;than&nbsp;</span><span class="mtk9">0&nbsp;(long),&nbsp;and&nbsp;`false`&nbsp;when&nbsp;`position_size`&nbsp;is&nbsp;less</span><span class="mtk9">&nbsp;than&nbsp;0&nbsp;(short).</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">isLong</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">true</span></span><br><span><span class="mtk18">else</span><span class="mtk1">&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">false</span></span><br><span><span class="mtk9">//&nbsp;When&nbsp;`position_size`&nbsp;is&nbsp;equal&nbsp;to&nbsp;0,&nbsp;neither&nbsp;con</span><span class="mtk9">dition&nbsp;is&nbsp;met.&nbsp;In&nbsp;v5,&nbsp;an&nbsp;undefined&nbsp;condition&nbsp;sets&nbsp;</span><span class="mtk9">`isLong`&nbsp;to&nbsp;`na`.</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Background&nbsp;color,&nbsp;set&nbsp;depending&nbsp;on&nbsp;the&nbsp;state&nbsp;of&nbsp;`</span><span class="mtk9">isLong`&nbsp;(`true`/`false`/`na`).</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">stateColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk18">switch</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">isLong</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">90</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Blue&nbsp;color&nbsp;if&nbsp;long&nbsp;position.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">isLong</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">false</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">90</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Orange&nbsp;color&nbsp;if&nbsp;short&nbsp;position.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk33">isLong</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">40</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Red&nbsp;color&nbsp;if&nbsp;no&nbsp;position.&nbsp;Note&nbsp;this&nbsp;line&nbsp;is&nbsp;inv</span><span class="mtk9">alid&nbsp;in&nbsp;v6.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">stateColor</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;On&nbsp;the&nbsp;first&nbsp;bar,&nbsp;display&nbsp;the&nbsp;raw&nbsp;value&nbsp;of&nbsp;`isL</span><span class="mtk9">ong`&nbsp;in&nbsp;a&nbsp;table.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isfirst</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">table</span><span class="mtk1">&nbsp;</span><span class="mtk33">t</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">table.new</span><span class="mtk13">(</span><span class="mtk33">position</span><span class="mtk1">.&nbsp;</span><span class="mtk33">bottom_right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.yellow</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">frame_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.black</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">frame_width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">t</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"On&nbsp;first&nbsp;bar"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">t</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"`isLong`&nbsp;raw&nbsp;value:"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">40</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">t</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">isLong</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">40</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Compare&nbsp;`isLong`&nbsp;value&nbsp;to&nbsp;Boolean&nbsp;`true`&nbsp;and&nbsp;`f</span><span class="mtk9">alse`&nbsp;values.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">t</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"`isLong`&nbsp;==&nbsp;`true`?"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">t</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">isLong</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">t</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"`isLong`&nbsp;==&nbsp;`false`?"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">t</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">isLong</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">false</span><span class="mtk13">))</span></span><br></code></div>
<p><strong>Fix:</strong> Remove any <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_na">na()</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_nz">nz()</a>, and <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_fixnan">fixnan()</a> functions that run on “bool” values. Ensure that all “bool” values are correctly interpreted as <code dir="auto">true</code> or <code dir="auto">false</code> states <strong>only</strong>. If your code logic requires a third <a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a> state to execute as intended, rewrite the code using a different type or structure to achieve the previous three-state behavior.</p>
<p>To adapt our code to Pine v6, we must first remove the following line to resolve the initial compilation error:</p>
<div class="pine-colorizer not-content colorized" data-id="5iw"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk16">na</span><span class="mtk13">(</span><span class="mtk33">isLong</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.red</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">40</span><span class="mtk13">)</span></span><br></code></div>
<p>In v6, the undefined condition (<code dir="auto">strategy.position_size == 0</code>) now returns <code dir="auto">false</code> instead of <code dir="auto">na</code>. Consequently, the script <em>incorrectly</em> highlights the bars where there are <em>no</em> trade positions the same color as those where there are <em>short</em> positions, since <code dir="auto">isLong</code> has the same <code dir="auto">false</code> result for both conditions:</p>
<p><img src="/pine-script-docs/_astro/MigrationGuideTov6-No-bool-na-2.BCM2Ys_b_Z1lBgK8.webp" alt="image" width="1234" height="417" loading="lazy" decoding="async"></p>
<p>We want to distinguish between <em>three</em> unique states: long positions, short positions, and no entered positions. Therefore, using a two-state Boolean variable in v6 is no longer suitable. Instead, to maintain our desired behavior, we must <em>rewrite</em> the v6 code to replace the “bool” variable with a different type. For example, we can use an “int” variable to represent our three different <code dir="auto">position_size</code> states using -1, 0, and 1:</p>
<p><img src="/pine-script-docs/_astro/MigrationGuideTov6-No-bool-na-3.C2oMRPfl_ZJu6OY.webp" alt="image" width="1096" height="414" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="3o3"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Bool&nbsp;`na`&nbsp;demo&nbsp;v6"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk18">=</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">margin_long</span><span class="mtk18">=</span><span class="mtk12">100</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">margin_short</span><span class="mtk18">=</span><span class="mtk12">100</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Strategy's&nbsp;long&nbsp;and&nbsp;short&nbsp;trades&nbsp;are&nbsp;based&nbsp;on&nbsp;m</span><span class="mtk9">oving&nbsp;average&nbsp;cross&nbsp;over/under.&nbsp;</span></span><br><span><span class="mtk33">longCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">28</span><span class="mtk13">))</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">longCondition</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"My&nbsp;Long&nbsp;Entry&nbsp;Id"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk33">shortCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">28</span><span class="mtk13">))</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">shortCondition</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"My&nbsp;Short&nbsp;Entry&nbsp;Id"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Integer&nbsp;variable&nbsp;that&nbsp;tracks&nbsp;the&nbsp;current&nbsp;directio</span><span class="mtk9">n&nbsp;of&nbsp;the&nbsp;trade.&nbsp;</span></span><br><span><span class="mtk9">//&nbsp;Is&nbsp;`-1`&nbsp;when&nbsp;`position_size`&nbsp;is&nbsp;less&nbsp;than&nbsp;0&nbsp;(sh</span><span class="mtk9">ort),&nbsp;`+1`&nbsp;when&nbsp;`position_size`&nbsp;is&nbsp;greater&nbsp;than&nbsp;0&nbsp;</span><span class="mtk9">(long),&nbsp;</span></span><br><span><span class="mtk9">//&nbsp;&nbsp;and&nbsp;`0`&nbsp;when&nbsp;`position_size`&nbsp;is&nbsp;equal&nbsp;to&nbsp;0&nbsp;(no</span><span class="mtk9">&nbsp;trades).</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">tradeDirection</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk12">-1</span></span><br><span><span class="mtk18">else</span><span class="mtk1">&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.position_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk18">else</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//strategy.position_size&nbsp;==&nbsp;0&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Background&nbsp;color,&nbsp;set&nbsp;depending&nbsp;on&nbsp;the&nbsp;`tradeDire</span><span class="mtk9">ction`.</span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">directionColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk18">switch</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">tradeDirection</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">90</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Blue&nbsp;color&nbsp;if&nbsp;long&nbsp;position.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">tradeDirection</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">-1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">90</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Orange&nbsp;color&nbsp;if&nbsp;short&nbsp;position.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">tradeDirection</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk11">na</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;No&nbsp;color&nbsp;if&nbsp;no&nbsp;position.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">directionColor</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;On&nbsp;the&nbsp;first&nbsp;bar,&nbsp;display&nbsp;the&nbsp;value&nbsp;of&nbsp;`tradeDi</span><span class="mtk9">rection`&nbsp;in&nbsp;a&nbsp;table&nbsp;for&nbsp;reference.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">table</span><span class="mtk1">&nbsp;</span><span class="mtk33">t</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">table.new</span><span class="mtk13">(</span><span class="mtk11">position.bottom_right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.yellow</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">frame_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.black</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">frame_width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.isfirst</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">t</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"On&nbsp;first&nbsp;bar"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">t</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"`tradeDirection`&nbsp;value:"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">60</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">t</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">tradeDirection</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">60</span><span class="mtk13">))</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;"string"&nbsp;representation&nbsp;of&nbsp;`tradeDirection`&nbsp;val</span><span class="mtk9">ue&nbsp;on&nbsp;current&nbsp;bar.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">directionString</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">tradeDirection</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Long"</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk33">tradeDirection</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">-1</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Short"</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk29">"No&nbsp;entered&nbsp;positions"</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">t</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"State:&nbsp;"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">t</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">directionString</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islastconfirmedhistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;"string"&nbsp;representation&nbsp;of&nbsp;`tradeDirection`&nbsp;&nbsp;va</span><span class="mtk9">lue&nbsp;on&nbsp;current&nbsp;bar.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">directionString</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">tradeDirection</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Long"</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk33">tradeDirection</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">-1</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Short"</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk29">"No&nbsp;entered&nbsp;positions"</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"On&nbsp;last&nbsp;bar&nbsp;\n&nbsp;`tradeDirection`&nbsp;value:&nbsp;"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">tradeDirection</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"\n&nbsp;State:&nbsp;"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">directionString</span><span class="mtk13">)</span></span><br></code></div>
<h3 id="unique-parameters-cannot-be-na" class="md-heading"><a href="#unique-parameters-cannot-be-na"><span>Unique parameters cannot be ​<code dir="auto">na</code>​</span><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></a></h3>
<p>Some Pine Script function parameters expect values of <em>unique</em> types. For example, the <code dir="auto">style</code> parameter of the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plot">plot()</a> function expects a value of the “input plot_style” qualified type, which must be one of the constants in the <code dir="auto">plot.style_*</code> group.</p>
<p>In v5, passing <a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a> to the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plot">plot()</a> function’s <code dir="auto">style</code> parameter simply plots a line using the default style <code dir="auto">plot.style_line</code>, without raising an error.</p>
<p>In v6, parameters that expect unique types <strong>no longer</strong> accept <a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a> values. Additionally, <a href="/pine-script-docs/language/conditional-structures/">conditional expressions</a> that return these unique types must be used in a form that <strong>cannot</strong> result in an <a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a> value. For example, a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_switch">switch</a>-statement must have a <code dir="auto">default</code> block, and an <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_if">if</a>-statement must have an <code dir="auto">else</code>-block, because these conditional expressions can return <a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a> otherwise.</p>
<p>The following example script shows two code structures that work in v5 but raise errors in v6.</p>
<p><img src="/pine-script-docs/_astro/MigrationGuideTov6-No-enum-na.Rirf8rCY_ZFlyGA.webp" alt="image" width="1214" height="584" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="231"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"`na`&nbsp;and&nbsp;unique&nbsp;types&nbsp;demo&nbsp;v5"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;User-selected&nbsp;"string"&nbsp;to&nbsp;determine&nbsp;type&nbsp;of&nbsp;plot&nbsp;</span><span class="mtk9">used&nbsp;for&nbsp;`plot()`&nbsp;function's&nbsp;`style`&nbsp;argument.</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">inputStyle</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.string</span><span class="mtk13">(</span><span class="mtk29">"Area"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Plot&nbsp;style"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">options</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk13">[</span><span class="mtk29">"Area"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Columns"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Histogram"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Stepline-diamond"</span><span class="mtk13">])</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Initialize&nbsp;an&nbsp;`input&nbsp;plot_style`&nbsp;type&nbsp;variable&nbsp;</span><span class="mtk9">based&nbsp;on&nbsp;user's&nbsp;selected&nbsp;`inputStyle`.</span></span><br><span><span class="mtk33">selectedPlotStyle</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk18">switch</span><span class="mtk1">&nbsp;</span><span class="mtk33">inputStyle</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Area"</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_area</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Columns"</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_columns</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Histogram"</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_histogram</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Stepline-diamond"</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_stepline_diamond</span></span><br><span><span class="mtk9">//&nbsp;`switch`&nbsp;statement&nbsp;covers&nbsp;all&nbsp;`inputStyle`&nbsp;opti</span><span class="mtk9">ons,&nbsp;but&nbsp;does&nbsp;not&nbsp;include&nbsp;`default`&nbsp;block.</span></span><br><span><span class="mtk9">//&nbsp;Valid&nbsp;in&nbsp;v5.&nbsp;Invalid&nbsp;in&nbsp;v6&nbsp;-&nbsp;`switch`&nbsp;statement</span><span class="mtk9">&nbsp;must&nbsp;include&nbsp;a&nbsp;`default`&nbsp;block,&nbsp;otherwise&nbsp;raises&nbsp;</span><span class="mtk9">error.</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Source&nbsp;plot"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">selectedPlotStyle</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Toggle&nbsp;for&nbsp;the&nbsp;style&nbsp;of&nbsp;the&nbsp;line&nbsp;plotted&nbsp;at&nbsp;price</span><span class="mtk9">&nbsp;"100".</span></span><br><span><span class="mtk33">inputHundredStyle</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.bool</span><span class="mtk13">(</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"&nbsp;Use&nbsp;crosses&nbsp;style&nbsp;for&nbsp;'100-line'"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk33">hundredLineStyle</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">inputHundredStyle</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">plot.style_cross</span></span><br><span><span class="mtk9">//&nbsp;Since&nbsp;there&nbsp;is&nbsp;no&nbsp;`else`&nbsp;block,&nbsp;setting&nbsp;`inputH</span><span class="mtk9">undredStyle`&nbsp;to&nbsp;`false`&nbsp;makes&nbsp;this&nbsp;variable&nbsp;`na`.</span></span><br><span><span class="mtk9">//&nbsp;In&nbsp;v5,&nbsp;passing&nbsp;`na`&nbsp;to&nbsp;the&nbsp;`style`&nbsp;parameter&nbsp;ma</span><span class="mtk9">kes&nbsp;the&nbsp;`plot()`&nbsp;function&nbsp;use&nbsp;its&nbsp;default&nbsp;style&nbsp;`p</span><span class="mtk9">lot.style_line`.</span></span><br><span><span class="mtk9">//&nbsp;In&nbsp;v6,&nbsp;this&nbsp;raises&nbsp;a&nbsp;compilation&nbsp;error&nbsp;because&nbsp;</span><span class="mtk9">`style`&nbsp;cannot&nbsp;be&nbsp;`na`.</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;"100-line"&nbsp;using&nbsp;the&nbsp;`hundredLineStyle</span><span class="mtk9">`&nbsp;style&nbsp;constant.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk12">100</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"100-line"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">hundredLineStyle</span><span class="mtk13">)</span></span><br></code></div>
<p><strong>Fix:</strong> Ensure that no <a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a> value is passed to parameters that expect unique types, and that all conditional statements return a suitable non-<a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a> value.</p>
<div class="pine-colorizer not-content colorized" data-id="20q"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"`na`&nbsp;and&nbsp;unique&nbsp;types&nbsp;demo&nbsp;v6"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;User-selected&nbsp;"string"&nbsp;to&nbsp;determine&nbsp;type&nbsp;of&nbsp;plot&nbsp;</span><span class="mtk9">used&nbsp;for&nbsp;`plot()`&nbsp;function's&nbsp;`style`&nbsp;argument.</span></span><br><span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">inputStyle</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.string</span><span class="mtk13">(</span><span class="mtk29">"Area"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Plot&nbsp;style"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">options</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk13">[</span><span class="mtk29">"Area"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Columns"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Histogram"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Stepline-diamond"</span><span class="mtk13">])</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Initialize&nbsp;an&nbsp;`input&nbsp;plot_style`&nbsp;type&nbsp;variable&nbsp;</span><span class="mtk9">based&nbsp;on&nbsp;user's&nbsp;selected&nbsp;`inputStyle`.</span></span><br><span><span class="mtk33">selectedPlotStyle</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk18">switch</span><span class="mtk1">&nbsp;</span><span class="mtk33">inputStyle</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Area"</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_area</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Columns"</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_columns</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Histogram"</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_histogram</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"Stepline-diamond"</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_stepline_diamond</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;A&nbsp;default&nbsp;block&nbsp;must&nbsp;be&nbsp;included&nbsp;in&nbsp;v6.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk11">plot.style_line</span></span><br><span><span></span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Source&nbsp;plot"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">selectedPlotStyle</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Toggle&nbsp;for&nbsp;the&nbsp;style&nbsp;of&nbsp;the&nbsp;line&nbsp;plotted&nbsp;at&nbsp;price</span><span class="mtk9">&nbsp;"100".</span></span><br><span><span class="mtk33">inputHundredStyle</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.bool</span><span class="mtk13">(</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"&nbsp;Use&nbsp;crosses&nbsp;style&nbsp;for&nbsp;'100-line'"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk33">hundredLineStyle</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">inputHundredStyle</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">plot.style_cross</span></span><br><span><span class="mtk18">else</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//`else`&nbsp;block&nbsp;must&nbsp;be&nbsp;included&nbsp;in&nbsp;v6.&nbsp;Sets&nbsp;"line"</span><span class="mtk9">&nbsp;style&nbsp;if&nbsp;`inputHundredStyle`&nbsp;is&nbsp;`false`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">plot.style_line</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;"100-line"&nbsp;using&nbsp;the&nbsp;`hundredLineStyle</span><span class="mtk9">`&nbsp;style&nbsp;constant.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk12">100</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"100-line"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">hundredLineStyle</span><span class="mtk13">)</span></span><br></code></div>
<h2 id="constants" class="md-heading"><a href="#constants"> <span class="fancy-wrap">Constants<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p>The following changes have been made to how Pine handles constant values.</p>
<h3 id="fractional-division-of-constants" class="md-heading"><a href="#fractional-division-of-constants">Fractional division of <span class="fancy-wrap">constants<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Dividing two integer “const” values can return a fractional value.</p>
<p>In v5, the result of the division of two “int” values is inconsistent. If <em>both</em> values are qualified as “const”, the script performs what is known as <em>integer division</em>, and discards any fractional remainder in the result, e.g., <code dir="auto">5/2 = 2</code>. However, if <em>at least one</em> of the integers is qualified as “input”, “simple”, or “series”, the script <em>preserves</em> the fractional remainder in the division result: <code dir="auto">5/2 = 2.5</code>.</p>
<p><img src="/pine-script-docs/_astro/MigrationGuideTov6-No-int-division-1.vzmEC1NZ_ZLqSka.webp" alt="image" width="1087" height="344" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="2j0"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"`int`&nbsp;division&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;`float`&nbsp;division&nbsp;produces&nbsp;fractional&nbsp;remainder&nbsp;</span><span class="mtk9">in&nbsp;both&nbsp;v5&nbsp;and&nbsp;v6.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk1">&nbsp;</span><span class="mtk12">5.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk12">2.0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"`float`&nbsp;values"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;`const&nbsp;int`&nbsp;division&nbsp;produces&nbsp;rounded-down&nbsp;resu</span><span class="mtk9">lt&nbsp;in&nbsp;v5.&nbsp;In&nbsp;v6,&nbsp;it&nbsp;produces&nbsp;a&nbsp;fractional&nbsp;remainde</span><span class="mtk9">r.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"`const&nbsp;int`&nbsp;values"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk1">&nbsp;</span><span class="mtk16">int</span><span class="mtk13">(</span><span class="mtk12">5</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk16">int</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"values&nbsp;wrapped&nbsp;`int()`"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Wrapped&nbsp;`int()`&nbsp;division&nbsp;produces&nbsp;rounded&nbsp;down&nbsp;</span><span class="mtk9">result&nbsp;in&nbsp;both&nbsp;v5&nbsp;and&nbsp;v6.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk1">&nbsp;</span><span class="mtk16">int</span><span class="mtk13">(</span><span class="mtk12">5</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"result&nbsp;wrapped&nbsp;`int()`"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Using&nbsp;`input&nbsp;int`&nbsp;type&nbsp;in&nbsp;division&nbsp;preserves&nbsp;th</span><span class="mtk9">e&nbsp;fractional&nbsp;remainder&nbsp;in&nbsp;both&nbsp;v5&nbsp;and&nbsp;v6.</span></span><br><span><span class="mtk33">inputNum</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Division&nbsp;int"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">minval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk33">inputNum</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"`input&nbsp;int`&nbsp;value"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.purple</span><span class="mtk13">)</span></span><br></code></div>
<p>In v6, dividing two “int” values that are not evenly divisible <em>always</em> results in a number with a <em>fractional value</em>, regardless of the type and qualifier of the two arguments used. Therefore, the v6 division result is <code dir="auto">5/2 = 2.5</code>, even if both values involved are “const int”.</p>
<p><img src="/pine-script-docs/_astro/MigrationGuideTov6-No-int-division-2.DNd_hajv_1TwdjI.webp" alt="image" width="1087" height="342" loading="lazy" decoding="async"></p>
<p><strong>Fix:</strong> If you need an “int” division result <em>without</em> a fractional value, wrap the division with the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_int">int()</a> function to cast the <em>result</em> to “int”, which discards the fractional remainder. Alternatively, use <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_math.round">math.round()</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_math.floor">math.floor()</a>, or <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_math.ceil">math.ceil()</a> to <em>round</em> the division result in a specific direction.</p>
<h3 id="mutable-variables-are-always-series" class="md-heading"><a href="#mutable-variables-are-always-series">Mutable variables are always <span class="fancy-wrap">“series”<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>In Pine v5, some mutable variables are qualified as “series” values but are <em>erroneously</em> qualified as “const”. This behavior is incorrect and allows a programmer to pass them where “series” variables are usually not accepted.</p>
<p>For example, the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.ema">ta.ema()</a> function expects its <code dir="auto">length</code> argument to be an integer qualified as “simple” or weaker (see the <a href="/pine-script-docs/language/type-system/#qualifiers">Qualifiers hierarchy</a>). In the example script below the <code dir="auto">seriesLen</code> variable is effectively a “series” type because its value changes between bars. In v5, <code dir="auto">seriesLen</code> <em>can</em> be passed to <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.ema">ta.ema()</a>. Although this does not raise an error, it does not work as expected, because only its <em>first</em> recorded value <code dir="auto">1</code> is used as the <code dir="auto">length</code> in the script:</p>
<div class="pine-colorizer not-content colorized" data-id="327"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"`const`&nbsp;mutable&nbsp;variables&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Variable&nbsp;is&nbsp;effectively&nbsp;of&nbsp;`series&nbsp;int`&nbsp;type.&nbsp;</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk33">seriesLen</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk33">seriesLen</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;`ta.ema()`&nbsp;only&nbsp;uses&nbsp;`length&nbsp;=&nbsp;1`&nbsp;throughout&nbsp;ex</span><span class="mtk9">ecution,&nbsp;even&nbsp;as&nbsp;`seriesLen`&nbsp;changes.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk16">ta.ema</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">seriesLen</span><span class="mtk13">))</span></span><br></code></div>
<p>In v6, <code dir="auto">seriesLen</code> is correctly parsed as a “series int” type, and raises a compilation error if passed in place of the expected “simple int” argument for <code dir="auto">length</code>.</p>
<p><strong>Fix:</strong> Pass values of the expected qualified type to built-in functions. In our example, set the <code dir="auto">length</code> argument to a “const int” value.</p>
<div class="pine-colorizer not-content colorized" data-id="4p8"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"`const`&nbsp;mutable&nbsp;variables&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Variable&nbsp;is&nbsp;now&nbsp;of&nbsp;`const&nbsp;int`&nbsp;type.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk33">seriesLen</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;`ta.ema()`&nbsp;uses&nbsp;`length&nbsp;=&nbsp;1`&nbsp;throughout&nbsp;executi</span><span class="mtk9">on.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk16">ta.ema</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">seriesLen</span><span class="mtk13">))</span></span><br></code></div>
<h3 id="color-changes" class="md-heading"><a href="#color-changes">Color <span class="fancy-wrap">changes<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>The color values behind some of the <code dir="auto">color.*</code> constants have changed in Pine v6 to better reflect the TradingView palette:</p>

























<table><thead><tr><th style="text-align:left">Constant name</th><th style="text-align:left">Pine v5 color</th><th style="text-align:left">Pine v6 color</th></tr></thead><tbody><tr><td style="text-align:left">color.red</td><td style="text-align:left">#FF5252</td><td style="text-align:left">#F23645</td></tr><tr><td style="text-align:left">color.teal</td><td style="text-align:left">#00897B</td><td style="text-align:left">#089981</td></tr><tr><td style="text-align:left">color.yellow</td><td style="text-align:left">#FFEB3B</td><td style="text-align:left">#FDD835</td></tr></tbody></table>
<p>Additionally, the default text color for <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_label.new">label.new()</a> is now <code dir="auto">color.white</code> in v6 (previously <code dir="auto">color.black</code> in v5) to ensure that the text is more visible against the default <code dir="auto">color.blue</code> label.</p>
<p><img src="/pine-script-docs/_astro/MigrationGuideTov6-Color-changes.BNSaJyQ-_Zq4WdJ.webp" alt="image" width="1154" height="514" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="2nv"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Default&nbsp;colors&nbsp;v6"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">defaultColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk18">switch</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.yellow</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">=&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">defaultColor</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islastconfirmedhistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Default&nbsp;text&nbsp;color"</span><span class="mtk13">)</span></span><br></code></div>
<h2 id="strategies" class="md-heading"><a href="#strategies"> <span class="fancy-wrap">Strategies<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<h3 id="removal-of-when-parameter" class="md-heading"><a href="#removal-of-when-parameter"><span>Removal of ​<code dir="auto">when</code>​ parameter</span><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></a></h3>
<p>The <code dir="auto">when</code> parameter for order creation functions was deprecated in v5 and is removed in v6. An order is created only if the <code dir="auto">when</code> condition is <code dir="auto">true</code>, which is its default value. This parameter affects the following functions: <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.entry">strategy.entry()</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.order">strategy.order()</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.close">strategy.close()</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.close_all">strategy.close_all()</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.cancel">strategy.cancel()</a>, and <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.cancel_all">strategy.cancel_all()</a>.</p>
<p>The following example strategy shows the use of the <code dir="auto">when</code> parameter, and works in v5 but not v6.</p>
<div class="pine-colorizer not-content colorized" data-id="3ga"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Conditional&nbsp;strategy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk18">=</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk33">longCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">28</span><span class="mtk13">))</span></span><br><span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"My&nbsp;Long&nbsp;Entry&nbsp;Id"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">when</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">longCondition</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk33">shortCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">28</span><span class="mtk13">))</span></span><br><span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"My&nbsp;Short&nbsp;Entry&nbsp;Id"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">when</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortCondition</span><span class="mtk13">)</span></span><br></code></div>
<p><strong>Fix:</strong> To trigger the order creation conditionally, use <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_if">if</a> statements instead.</p>
<div class="pine-colorizer not-content colorized" data-id="6hu"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Conditional&nbsp;strategy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk18">=</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk33">longCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">28</span><span class="mtk13">))</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">longCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"My&nbsp;Long&nbsp;Entry&nbsp;Id"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk33">shortCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">28</span><span class="mtk13">))</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">shortCondition</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"My&nbsp;Short&nbsp;Entry&nbsp;Id"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk13">)</span></span><br></code></div>
<h3 id="default-margin-percentage" class="md-heading"><a href="#default-margin-percentage">Default margin <span class="fancy-wrap">percentage<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>The default margin percentage for strategies is now 100.</p>
<p>In v5, the default value of the <code dir="auto">margin_long</code> and <code dir="auto">margin_short</code> parameters is 0, which means that the strategy <strong>does not check</strong> its available funds before creating or managing orders. It can create orders that require <em>more</em> money than is available, and will <strong>not</strong> close short orders even when they lose more money than available to the strategy.</p>
<p>In <em>Pine v6</em>, the default margin percentage is 100. The strategy <strong>does not open</strong> entries that require more money than is available, and short orders are <em>margin called</em> if too much money is lost.</p>
<p>For example, we can see the difference in strategy behavior by running this simple strategy on the “ARM” symbol’s 4h chart using the v5 and v6 default margin values. When using Pine v5, there are no margin calls:</p>
<p><img src="/pine-script-docs/_astro/MigrationGuideTov6-Margin-calls-1.CnzpPLkm_1lRc8h.webp" alt="image" width="1179" height="695" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="41c"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"My&nbsp;strategy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk18">=</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">default_qty_type</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.percent_of_equity</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">default_qty_value</span><span class="mtk18">=</span><span class="mtk12">100</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;v6&nbsp;defaults:&nbsp;margin_long=100,&nbsp;margin_short=100&nbsp;</span></span><br><span><span class="mtk9">//&nbsp;v5&nbsp;defaults:&nbsp;margin_long=0,&nbsp;margin_short=0</span></span><br><span><span></span></span><br><span><span class="mtk33">longCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossover</span><span class="mtk13">(</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">28</span><span class="mtk13">))</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">longCondition</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"My&nbsp;Long&nbsp;Entry&nbsp;Id"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk33">shortCondition</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.crossunder</span><span class="mtk13">(</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.sma</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">28</span><span class="mtk13">))</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">shortCondition</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"My&nbsp;Short&nbsp;Entry&nbsp;Id"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk13">)</span></span><br></code></div>
<p>However, if we adjust this script to <code dir="auto">//@version=6</code> on the same chart, we see that it triggers 14 margin calls because of the new margin percentages:</p>
<p><img src="/pine-script-docs/_astro/MigrationGuideTov6-Margin-calls-2.DY4IZ4xs_ZukbpG.webp" alt="image" width="1175" height="694" loading="lazy" decoding="async"></p>
<p><strong>Fix:</strong> To replicate the previous v5 behavior, set the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy">strategy()</a> function’s <code dir="auto">margin_short</code> and <code dir="auto">margin_long</code> arguments to 0.</p>
<h3 id="excess-orders-are-trimmed" class="md-heading"><a href="#excess-orders-are-trimmed">Excess orders are <span class="fancy-wrap">trimmed<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>Strategy orders above the 9000 limit are trimmed (removed) in v6.</p>
<p>In v5, outside of Deep Backtesting, when a strategy creates more than 9000 orders, it raises a runtime error and halts any further calculations.</p>
<p>For example, this strategy script places several orders on each bar in the dataset. As a result, it can quickly surpass the 9000 order limit and trigger an error in Pine v5:</p>
<div class="pine-colorizer not-content colorized" data-id="rc"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Strategy&nbsp;order&nbsp;limit&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk18">=</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">pyramiding</span><span class="mtk18">=</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;several&nbsp;long&nbsp;orders&nbsp;on&nbsp;every&nbsp;even&nbsp;bar.&nbsp;Th</span><span class="mtk9">is&nbsp;reaches&nbsp;the&nbsp;maximum&nbsp;orders&nbsp;limit&nbsp;in&nbsp;v5&nbsp;and&nbsp;rais</span><span class="mtk9">es&nbsp;a&nbsp;runtime&nbsp;error.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Entry&nbsp;"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">i</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;short&nbsp;orders&nbsp;on&nbsp;every&nbsp;odd&nbsp;bar.</span></span><br><span><span class="mtk18">else</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Short"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">25</span><span class="mtk13">)</span></span><br></code></div>
<p>In v6, when the total number of orders exceeds 9000, the strategy does <em>not</em> halt. Instead, the orders are <em>trimmed</em> from the beginning until the limit is reached, meaning that the strategy only stores the information for the most recent orders.</p>
<p>Trimmed orders no longer show in the Strategy Tester, and referencing them using the <code dir="auto">strategy.closedtrades.*</code> functions returns <a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a>. Use <a href="https://www.tradingview.com/pine-script-reference/v6/#var_strategy.closedtrades.first_index">strategy.closedtrades.first_index</a> to get the index of the first <em>non-trimmed</em> trade:</p>
<p><img src="/pine-script-docs/_astro/MigrationGuideTov6-Order-trimming.CFIVLCGx_Z2iQqmO.webp" alt="image" width="1237" height="606" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="fz"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"Strategy&nbsp;order&nbsp;limit&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk18">=</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">pyramiding</span><span class="mtk18">=</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Count&nbsp;of&nbsp;total&nbsp;orders&nbsp;placed.</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">totalOrders</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;several&nbsp;long&nbsp;orders&nbsp;on&nbsp;every&nbsp;even&nbsp;bar.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Entry&nbsp;"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">i</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">totalOrders</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk9">//&nbsp;Place&nbsp;short&nbsp;orders&nbsp;on&nbsp;every&nbsp;odd&nbsp;bar.</span></span><br><span><span class="mtk18">else</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Short"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.short</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">qty</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">25</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">totalOrders</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Display&nbsp;total&nbsp;orders&nbsp;and&nbsp;index&nbsp;of&nbsp;first&nbsp;non-tri</span><span class="mtk9">mmed&nbsp;trade&nbsp;in&nbsp;a&nbsp;table&nbsp;cell&nbsp;on&nbsp;last&nbsp;bar.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islastconfirmedhistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">table</span><span class="mtk1">&nbsp;</span><span class="mtk33">t</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">table.new</span><span class="mtk13">(</span><span class="mtk11">position.bottom_right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.yellow</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.black</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Display&nbsp;total&nbsp;orders&nbsp;and&nbsp;closed&nbsp;trades&nbsp;counts.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">ordersText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Total&nbsp;orders:&nbsp;"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">totalOrders</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"#,###"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"\n&nbsp;Closed&nbsp;trades:&nbsp;"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk11">strategy.closedtrades</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"#,###"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">t</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">ordersText</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_halign</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">text.align_right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.large</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;first&nbsp;non-trimmed&nbsp;trade&nbsp;index&nbsp;and&nbsp;i</span><span class="mtk9">ts&nbsp;entry&nbsp;price.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">firstTradeIndex</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk11">strategy.closedtrades.first_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"#,###"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">firstTradePrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk16">strategy.closedtrades.entry_price</span><span class="mtk13">(</span><span class="mtk11">strategy.closedtrades.first_index</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"$##.##"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">firstTradeText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.format</span><span class="mtk13">(</span><span class="mtk29">"Index&nbsp;of&nbsp;first&nbsp;non-trimmed&nbsp;trade:&nbsp;{0}\nEntry&nbsp;pric</span><span class="mtk29">e&nbsp;of&nbsp;trade&nbsp;#{0}:&nbsp;{1}"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">firstTradeIndex</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">firstTradePrice</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">t</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">firstTradeText</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_halign</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">text.align_right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.large</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">#61dd5165</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Trying&nbsp;to&nbsp;reference&nbsp;the&nbsp;trimmed&nbsp;trades&nbsp;(e.g.,&nbsp;f</span><span class="mtk9">irst&nbsp;closed&nbsp;trade)&nbsp;returns&nbsp;`na`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">totalOrders</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">9000</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">trimmedTradePrice</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Entry&nbsp;price&nbsp;of&nbsp;trade&nbsp;#0:&nbsp;"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk16">strategy.closedtrades.entry_price</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk13">))</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">t</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">trimmedTradePrice</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.large</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">#dd51c665</span><span class="mtk13">)</span></span><br></code></div>
<h3 id="strategyexit-evaluates-parameter-pairs" class="md-heading"><a href="#strategyexit-evaluates-parameter-pairs"><span>​<code dir="auto">strategy.exit()</code>​ evaluates parameter pairs</span><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> function has three sets of <em>relative</em> and <em>absolute</em> parameters that define price levels for exit order calculations. The relative parameters <code dir="auto">profit</code>, <code dir="auto">loss</code>, and <code dir="auto">trail_points</code> specify the <a href="/pine-script-docs/concepts/strategies/#take-profit-and-stop-loss">take-profit</a> and <a href="/pine-script-docs/concepts/strategies/#take-profit-and-stop-loss">stop-loss</a> levels and <a href="/pine-script-docs/concepts/strategies/#trailing-stops">trailing stop</a> activation level as <em>tick distances</em> from the entry price. In contrast, the absolute parameters <code dir="auto">limit</code>, <code dir="auto">stop</code>, and <code dir="auto">trail_price</code> specify the exit and trail activation <em>prices</em> directly.</p>
<p>In Pine v5, a <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> call containing arguments for both the relative and absolute parameters that define a price level for the same exit order always prioritizes the <em>absolute</em> parameter and ignores the relative one. For instance, a call that includes a <code dir="auto">limit</code> and <code dir="auto">profit</code> argument consistently places take-profit orders at the <code dir="auto">limit</code> value. It never places an exit order using the <code dir="auto">profit</code> distance.</p>
<p>In Pine v6, if a <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> call contains arguments for related absolute and relative parameters, it evaluates <em>both</em> specified levels and uses the one that the market price is expected to <em>trigger first</em>.</p>
<p>The example below demonstrates how the behavior of this command differs for v5 and v6 scripts. This v5 script creates a long <a href="/pine-script-docs/concepts/strategies/#market-orders">market order</a> and an exit order <a href="/pine-script-docs/concepts/strategies/#take-profit-and-stop-loss">bracket</a> on each 28th bar. The <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> call contains arguments for the relative parameters that determine take-profit and stop-loss levels (<code dir="auto">profit</code> and <code dir="auto">loss</code>), and it includes arguments for the absolute parameters (<code dir="auto">limit</code> and <code dir="auto">stop</code>). The <code dir="auto">profit</code> and <code dir="auto">loss</code> arguments are both 0, which would result in consistent exits at the entry price if the command used them. However, the command never uses these values to determine the exit order levels because the <code dir="auto">limit</code> and <code dir="auto">stop</code> parameters <em>always</em> take precedence when they have specified values:</p>
<p><img src="/pine-script-docs/_astro/To-pine-version-6-Strategies-Strategy-exit-evaluates-parameter-pairs-1.Bq0Yb_zb_jLvAa.webp" alt="image" width="1336" height="530" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="38l"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"`strategy.exit()`&nbsp;with&nbsp;parameter&nbsp;pairs&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">margin_long</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">margin_short</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;14-bar&nbsp;Average&nbsp;True&nbsp;Range.&nbsp;</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">atr</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.atr</span><span class="mtk13">(</span><span class="mtk12">14</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">28</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"Exit"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">profit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">2.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">atr</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">loss</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">2.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">atr</span><span class="mtk13">)</span></span><br></code></div>
<p>If we convert the script to Pine v6, its behavior changes. Instead of prioritizing the absolute <code dir="auto">limit</code> and <code dir="auto">stop</code> parameters exclusively, the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_strategy.exit">strategy.exit()</a> command always prioritizes the price levels that will trigger exits <em>first</em>. In this example, the market price reaches the <code dir="auto">limit</code> or <code dir="auto">stop</code> value <em>after</em> the <code dir="auto">profit</code> and <code dir="auto">loss</code> distance of 0 ticks. Consequently, the command ignores the <code dir="auto">limit</code> and <code dir="auto">stop</code> values and places its exit orders at the entry price, which causes the strategy to exit each trade immediately after opening it:</p>
<p><img src="/pine-script-docs/_astro/To-pine-version-6-Strategies-Strategy-exit-evaluates-parameter-pairs-2.Q464KiWa_Z2rlE7N.webp" alt="image" width="1336" height="530" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="t4"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">strategy</span><span class="mtk13">(</span><span class="mtk29">"`strategy.exit()`&nbsp;with&nbsp;parameter&nbsp;pairs&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">margin_long</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">margin_short</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;14-bar&nbsp;Average&nbsp;True&nbsp;Range.&nbsp;</span></span><br><span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">atr</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.atr</span><span class="mtk13">(</span><span class="mtk12">14</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">%</span><span class="mtk1">&nbsp;</span><span class="mtk12">28</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.entry</span><span class="mtk13">(</span><span class="mtk29">"Buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">strategy.long</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">strategy.exit</span><span class="mtk13">(</span><span class="mtk29">"Exit"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Buy"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">profit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">limit</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">2.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">atr</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">loss</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">stop</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">2.0</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk33">atr</span><span class="mtk13">)</span></span><br></code></div>
<h2 id="history-referencing-operator" class="md-heading"><a href="#history-referencing-operator">History-referencing <span class="fancy-wrap">operator<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p>Pine v6 contains several changes to referencing the history of values.</p>
<h3 id="no-history-for-literal-values" class="md-heading"><a href="#no-history-for-literal-values">No history for literal <span class="fancy-wrap">values<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>The history-referencing operator <code dir="auto">[]</code> can no longer be used with literal values or built-in constants.</p>
<p>In v5, the history-referencing operator <code dir="auto">[]</code> can be used with built-in constants, such as <code dir="auto">true</code> and <code dir="auto">color.red</code>, and with <em>literal</em>s, which are raw values used directly in a script that are not stored as variables, such as <code dir="auto">6</code> or <code dir="auto">"myString"</code>, etc.</p>
<p>However, referencing the history of a literal is usually redundant, because by definition every literal represents a fixed value. The only exception where the returned historic value may vary is if the historical offset points to a <em>non-existent</em> bar, in which case referencing the historic literal value returns <a href="https://www.tradingview.com/pine-script-reference/v6/#var_na">na</a>.</p>
<p><img src="/pine-script-docs/_astro/MigrationGuideTov6-History-for-literals-1.CQYj6Sq2_ZChn43.webp" alt="image" width="955" height="285" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="12s"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"History-referencing&nbsp;on&nbsp;literals&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;These&nbsp;lines&nbsp;all&nbsp;use&nbsp;history-referencing&nbsp;on&nbsp;lite</span><span class="mtk9">rals,&nbsp;which&nbsp;works&nbsp;in&nbsp;v5,&nbsp;but&nbsp;is&nbsp;not&nbsp;really&nbsp;useful&nbsp;</span><span class="mtk9">to&nbsp;do&nbsp;here.&nbsp;</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk12">6</span><span class="mtk13">[</span><span class="mtk12">1</span><span class="mtk13">]</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"6[1]"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk11">true</span><span class="mtk13">[</span><span class="mtk12">10</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk13">[</span><span class="mtk12">3</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islastconfirmedhistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Since&nbsp;"string&nbsp;literal"&nbsp;is&nbsp;only&nbsp;defined&nbsp;in&nbsp;the&nbsp;l</span><span class="mtk9">ast&nbsp;bar&nbsp;scope,&nbsp;history-referencing&nbsp;here&nbsp;returns&nbsp;`n</span><span class="mtk9">a`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">labelText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"string&nbsp;literal"</span><span class="mtk13">[</span><span class="mtk12">20</span><span class="mtk13">]</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelText</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">",&nbsp;more&nbsp;text"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.large</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Label&nbsp;output&nbsp;will&nbsp;only&nbsp;show&nbsp;",&nbsp;more&nbsp;text"&nbsp;in&nbsp;v5</span><span class="mtk9">,&nbsp;since&nbsp;`labelText`&nbsp;is&nbsp;`na`.</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;In&nbsp;v6,&nbsp;using&nbsp;any&nbsp;history-referencing&nbsp;on&nbsp;literal</span><span class="mtk9">s&nbsp;or&nbsp;built-in&nbsp;constants&nbsp;causes&nbsp;an&nbsp;error.</span></span><br></code></div>
<p>In <em>Pine v6</em>, you can <strong>no longer</strong> use the history-referencing operator <code dir="auto">[]</code> on literals or built-in constants. Trying to do so triggers a compilation error.</p>
<p><strong>Fix:</strong> Remove any <code dir="auto">[]</code> operators used with literals or constants.</p>
<p><img src="/pine-script-docs/_astro/MigrationGuideTov6-History-for-literals-2.DnTquvm7_1nXvDJ.webp" alt="image" width="954" height="285" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="32e"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"History-referencing&nbsp;on&nbsp;literals&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;We&nbsp;no&nbsp;longer&nbsp;use&nbsp;history-referencing&nbsp;on&nbsp;literal</span><span class="mtk9">s&nbsp;in&nbsp;v6.&nbsp;</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk12">6</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"6"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk11">true</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islastconfirmedhistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">labelText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"string&nbsp;literal"</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">labelText</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">",&nbsp;more&nbsp;text"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.white</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.large</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Label&nbsp;output&nbsp;shows&nbsp;"string&nbsp;literal,&nbsp;more&nbsp;text"&nbsp;</span><span class="mtk9">in&nbsp;v6,&nbsp;since&nbsp;`labelText`&nbsp;is&nbsp;defined&nbsp;without&nbsp;histor</span><span class="mtk9">y-referencing&nbsp;anymore.</span></span><br></code></div>
<h3 id="history-of-udt-fields" class="md-heading"><a href="#history-of-udt-fields">History of UDT <span class="fancy-wrap">fields<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h3>
<p>The history-referencing operator <code dir="auto">[]</code> can no longer be used directly on fields of user-defined types.</p>
<p>In v5, you can use the history-referencing operator <code dir="auto">[]</code> on the <em>fields</em> from <a href="/pine-script-docs/language/objects/">objects</a> of <a href="/pine-script-docs/language/type-system/#user-defined-types">user-defined types</a>. While this does not cause any compilation errors, the behavior itself is erroneous.</p>
<p>For example, the script below draws an arrow <a href="https://www.tradingview.com/pine-script-reference/v6/#type_label">label</a> on each bar and displays its percentage increase/decrease. The label style, color, and text are set based on a bar’s direction (<code dir="auto">close &gt; open</code>). The script defines a <a href="/pine-script-docs/language/objects/">UDT</a> <code dir="auto">LblSettings</code> to initialize an object on each bar that stores these settings. On the last bar, it draws a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_table">table</a> cell that displays the arrow direction and percentage difference from 10 bars back. In v5, we could use the history-referencing operator <code dir="auto">[]</code> on the required <code dir="auto">LblSettings</code> fields directly:</p>
<p><img src="/pine-script-docs/_astro/MigrationGuideTov6-History-for-UDTs.h94G4ccp_wdX75.webp" alt="image" width="1541" height="519" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5t1"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"UDT&nbsp;history-referencing&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@type</span><span class="mtk9">&nbsp;A&nbsp;custom&nbsp;type&nbsp;to&nbsp;hold&nbsp;bar's&nbsp;`label`&nbsp;settings&nbsp;base</span><span class="mtk9">d&nbsp;on&nbsp;bar's&nbsp;direction.</span></span><br><span><span class="mtk9">//Includes&nbsp;bar&nbsp;direction,&nbsp;label&nbsp;style&nbsp;and&nbsp;color,&nbsp;a</span><span class="mtk9">nd&nbsp;"string"&nbsp;percentage&nbsp;difference&nbsp;between&nbsp;bar's&nbsp;`o</span><span class="mtk9">pen`&nbsp;and&nbsp;`close`.&nbsp;</span></span><br><span><span class="mtk18">type</span><span class="mtk1">&nbsp;</span><span class="mtk33">LblSettings</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">isUp</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">false</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">lblStyle</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">lblColor</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">diff</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;`LblSettings`&nbsp;instance&nbsp;declared&nbsp;on&nbsp;every&nbsp;bar.&nbsp;</span></span><br><span><span class="mtk18 mtkb">LblSettings</span><span class="mtk1">&nbsp;</span><span class="mtk33">infoObject</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">LblSettings</span><span class="mtk1">.</span><span class="mtk15">new</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;the&nbsp;`LblSettings`&nbsp;object&nbsp;fields&nbsp;based&nbsp;on&nbsp;cu</span><span class="mtk9">rrent&nbsp;bar's&nbsp;direction&nbsp;and&nbsp;price&nbsp;information.</span></span><br><span><span class="mtk33">infoObject</span><span class="mtk1">.</span><span class="mtk33">isUp</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span></span><br><span><span class="mtk33">infoObject</span><span class="mtk1">.</span><span class="mtk33">lblStyle</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk33">infoObject</span><span class="mtk1">.</span><span class="mtk33">isUp</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_arrowup</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_arrowdown</span></span><br><span><span class="mtk33">infoObject</span><span class="mtk1">.</span><span class="mtk33">lblColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk33">infoObject</span><span class="mtk1">.</span><span class="mtk33">isUp</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span></span><br><span><span class="mtk33">infoObject</span><span class="mtk1">.</span><span class="mtk33">diff</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">((</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"#.##"</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"%"</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Display&nbsp;a&nbsp;new&nbsp;`label`&nbsp;on&nbsp;each&nbsp;bar&nbsp;using&nbsp;its&nbsp;`in</span><span class="mtk9">foObject`&nbsp;settings.</span></span><br><span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">infoObject</span><span class="mtk1">.</span><span class="mtk33">diff</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">infoObject</span><span class="mtk1">.</span><span class="mtk33">lblStyle</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">infoObject</span><span class="mtk1">.</span><span class="mtk33">lblColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">infoObject</span><span class="mtk1">.</span><span class="mtk33">lblColor</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;bar&nbsp;that&nbsp;is&nbsp;10&nbsp;bars&nbsp;back&nbsp;from&nbsp;the</span><span class="mtk9">&nbsp;last&nbsp;bar.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.yellow</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;On&nbsp;last&nbsp;bar,&nbsp;output&nbsp;table&nbsp;cell&nbsp;to&nbsp;display&nbsp;`LblS</span><span class="mtk9">ettings`&nbsp;object's&nbsp;`lblStyle`&nbsp;and&nbsp;`diff`&nbsp;fields&nbsp;fro</span><span class="mtk9">m&nbsp;10&nbsp;bars&nbsp;back.&nbsp;</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islast</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">table</span><span class="mtk1">&nbsp;</span><span class="mtk33">t</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">table.new</span><span class="mtk13">(</span><span class="mtk11">position.bottom_right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.yellow</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;In&nbsp;v5,&nbsp;you&nbsp;could&nbsp;use&nbsp;history-referencing&nbsp;operat</span><span class="mtk9">or&nbsp;`[]`&nbsp;on&nbsp;UDT&nbsp;fields&nbsp;directly.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Text&nbsp;displayed&nbsp;in&nbsp;table&nbsp;cell.&nbsp;Set&nbsp;based&nbsp;on&nbsp;the&nbsp;`l</span><span class="mtk9">blStyle`&nbsp;and&nbsp;`diff`&nbsp;fields&nbsp;from&nbsp;10&nbsp;bars&nbsp;back.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">txt</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"10&nbsp;bars&nbsp;back:&nbsp;Arrow&nbsp;was&nbsp;"</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">infoObject</span><span class="mtk1">.</span><span class="mtk33">lblStyle</span><span class="mtk13">[</span><span class="mtk12">10</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_arrowdown</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk29">"DOWN"</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk29">"UP"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"&nbsp;by&nbsp;"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">infoObject</span><span class="mtk1">.</span><span class="mtk33">diff</span><span class="mtk13">[</span><span class="mtk12">10</span><span class="mtk13">]</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">t</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">txt</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.large</span><span class="mtk13">)</span></span><br></code></div>
<p>In <em>Pine v6</em>, you can <strong>no longer</strong> use the history-referencing operator <code dir="auto">[]</code> on the field of a user-defined type directly.</p>
<p><strong>Fix:</strong> Use the history-referencing operator on the UDT <em>object</em> instead, then retrieve the field of the historic object. To do so, use the syntax <code dir="auto">(myObject[10]).field</code> - ensure the object’s historical reference is wrapped in <em>parentheses</em>, otherwise it is invalid. Alternatively, assign the UDT <em>field</em> to a <em>variable</em> first, and then use the history-referencing operator <code dir="auto">[]</code> on the variable to access its historic value.</p>
<div class="pine-colorizer not-content colorized" data-id="4yz"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//&nbsp;Reference&nbsp;history&nbsp;of&nbsp;object,&nbsp;then&nbsp;retrieve&nbsp;fiel</span><span class="mtk9">d&nbsp;of&nbsp;historic&nbsp;object.</span></span><br><span><span class="mtk13">[</span><span class="mtk33">fieldType</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk33">historicFieldValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">myObject</span><span class="mtk13">[</span><span class="mtk12">10</span><span class="mtk13">])</span><span class="mtk1">.</span><span class="mtk33">field</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Alternative:&nbsp;Assign&nbsp;field&nbsp;to&nbsp;variable,&nbsp;then&nbsp;ref</span><span class="mtk9">erence&nbsp;history&nbsp;of&nbsp;variable&nbsp;to&nbsp;get&nbsp;historic&nbsp;field&nbsp;v</span><span class="mtk9">alue.</span></span><br><span><span class="mtk13">[</span><span class="mtk33">fieldType</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk33">newVariable</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">myObject</span><span class="mtk1">.</span><span class="mtk33">field</span></span><br><span><span class="mtk13">[</span><span class="mtk33">fieldType</span><span class="mtk13">]</span><span class="mtk1">&nbsp;</span><span class="mtk33">historicFieldValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">newVariable</span><span class="mtk13">[</span><span class="mtk12">10</span><span class="mtk13">]</span></span><br></code></div>
<p>Therefore, we can adjust the v5 code to access a historic instance of our <code dir="auto">infoObject</code> on the last bar, wrapped in parentheses. Then, we retrieve our desired field values from the historic object <code dir="auto">(infoObject[10])</code> to display the arrow direction and percentage difference from 10 bars back:</p>
<div class="pine-colorizer not-content colorized" data-id="el"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"UDT&nbsp;history-referencing&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@type</span><span class="mtk9">&nbsp;A&nbsp;custom&nbsp;type&nbsp;to&nbsp;hold&nbsp;bar's&nbsp;`label`&nbsp;settings&nbsp;base</span><span class="mtk9">d&nbsp;on&nbsp;bar's&nbsp;direction.</span></span><br><span><span class="mtk9">//Includes&nbsp;bar&nbsp;direction,&nbsp;label&nbsp;style&nbsp;and&nbsp;color,&nbsp;a</span><span class="mtk9">nd&nbsp;"string"&nbsp;percentage&nbsp;difference&nbsp;between&nbsp;bar's&nbsp;`o</span><span class="mtk9">pen`&nbsp;and&nbsp;`close`.&nbsp;</span></span><br><span><span class="mtk18">type</span><span class="mtk1">&nbsp;</span><span class="mtk33">LblSettings</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">isUp</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">false</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">lblStyle</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">lblColor</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">diff</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;`LblSettings`&nbsp;instance&nbsp;declared&nbsp;on&nbsp;every&nbsp;bar.&nbsp;</span></span><br><span><span class="mtk18 mtkb">LblSettings</span><span class="mtk1">&nbsp;</span><span class="mtk33">infoObject</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">LblSettings</span><span class="mtk1">.</span><span class="mtk15">new</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Set&nbsp;the&nbsp;`LblSettings`&nbsp;object&nbsp;fields&nbsp;based&nbsp;on&nbsp;cu</span><span class="mtk9">rrent&nbsp;bar's&nbsp;direction&nbsp;and&nbsp;price&nbsp;information.</span></span><br><span><span class="mtk33">infoObject</span><span class="mtk1">.</span><span class="mtk33">isUp</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span></span><br><span><span class="mtk33">infoObject</span><span class="mtk1">.</span><span class="mtk33">lblStyle</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk33">infoObject</span><span class="mtk1">.</span><span class="mtk33">isUp</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_arrowup</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_arrowdown</span></span><br><span><span class="mtk33">infoObject</span><span class="mtk1">.</span><span class="mtk33">lblColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk33">infoObject</span><span class="mtk1">.</span><span class="mtk33">isUp</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span></span><br><span><span class="mtk33">infoObject</span><span class="mtk1">.</span><span class="mtk33">diff</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">((</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk1">&nbsp;</span><span class="mtk18">*</span><span class="mtk1">&nbsp;</span><span class="mtk12">100</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"#.##"</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"%"</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Display&nbsp;a&nbsp;new&nbsp;`label`&nbsp;on&nbsp;each&nbsp;bar&nbsp;using&nbsp;its&nbsp;`in</span><span class="mtk9">foObject`&nbsp;settings.</span></span><br><span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">infoObject</span><span class="mtk1">.</span><span class="mtk33">diff</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">style</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">infoObject</span><span class="mtk1">.</span><span class="mtk33">lblStyle</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">infoObject</span><span class="mtk1">.</span><span class="mtk33">lblColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">textcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">infoObject</span><span class="mtk1">.</span><span class="mtk33">lblColor</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;the&nbsp;bar&nbsp;that&nbsp;is&nbsp;10&nbsp;bars&nbsp;back&nbsp;from&nbsp;the</span><span class="mtk9">&nbsp;last&nbsp;bar.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">last_bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.yellow</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;On&nbsp;last&nbsp;bar,&nbsp;output&nbsp;table&nbsp;cell&nbsp;to&nbsp;display&nbsp;`LblS</span><span class="mtk9">ettings`&nbsp;object's&nbsp;`lblStyle`&nbsp;and&nbsp;`diff`&nbsp;fields&nbsp;fro</span><span class="mtk9">m&nbsp;10&nbsp;bars&nbsp;back.&nbsp;</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islast</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">table</span><span class="mtk1">&nbsp;</span><span class="mtk33">t</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">table.new</span><span class="mtk13">(</span><span class="mtk11">position.bottom_right</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.yellow</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;In&nbsp;v6,&nbsp;cannot&nbsp;use&nbsp;`[]`&nbsp;on&nbsp;UDT&nbsp;fields&nbsp;(e.g.,&nbsp;`in</span><span class="mtk9">foObject.lblStyle[10]`&nbsp;is&nbsp;invalid).</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Instead,&nbsp;Use&nbsp;`[]`&nbsp;to&nbsp;reference&nbsp;UDT&nbsp;object's&nbsp;his</span><span class="mtk9">tory,&nbsp;wrapped&nbsp;in&nbsp;parentheses,&nbsp;then&nbsp;retrieve&nbsp;its&nbsp;fi</span><span class="mtk9">elds.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`lblStyle`&nbsp;field&nbsp;value&nbsp;from&nbsp;10&nbsp;bars&nbsp;back.&nbsp;Is&nbsp;</span><span class="mtk9">either&nbsp;`label.style_arrowdown`&nbsp;or&nbsp;`label.style_arr</span><span class="mtk9">owup`.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">historicArrowStyle</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">infoObject</span><span class="mtk13">[</span><span class="mtk12">10</span><span class="mtk13">])</span><span class="mtk1">.</span><span class="mtk33">lblStyle</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;`diff`&nbsp;field&nbsp;value&nbsp;(percentage&nbsp;difference&nbsp;bet</span><span class="mtk9">ween&nbsp;`close`&nbsp;and&nbsp;`open`)&nbsp;from&nbsp;10&nbsp;bars&nbsp;back.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">historicPercentDifference</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">infoObject</span><span class="mtk13">[</span><span class="mtk12">10</span><span class="mtk13">])</span><span class="mtk1">.</span><span class="mtk33">diff</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Text&nbsp;displayed&nbsp;in&nbsp;table&nbsp;cell.&nbsp;Set&nbsp;based&nbsp;on&nbsp;the&nbsp;`l</span><span class="mtk9">blStyle`&nbsp;and&nbsp;`diff`&nbsp;fields&nbsp;from&nbsp;10&nbsp;bars&nbsp;back.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">txt</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"10&nbsp;bars&nbsp;back:&nbsp;Arrow&nbsp;was&nbsp;"</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk13">(</span><span class="mtk33">historicArrowStyle</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk11">label.style_arrowdown</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk29">"DOWN"</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk29">"UP"</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"&nbsp;by&nbsp;"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">historicPercentDifference</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">t</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">txt</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.large</span><span class="mtk13">)</span></span><br></code></div>
<h2 id="timeframes-must-include-a-multiplier" class="md-heading"><a href="#timeframes-must-include-a-multiplier">Timeframes must include a <span class="fancy-wrap">multiplier<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v6/#var_timeframe.period">timeframe.period</a> variable holds a “string” that represents the chart’s timeframe, typically consisting of a <em>quantity</em> (multiplier) and <em>unit</em>.</p>
<p>In v5, the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_timeframe.period">timeframe.period</a> variable does <em>not</em> include a quantity when the chart timeframe has a multiplier of <code dir="auto">1</code>. Instead, the string consists of only the timeframe unit, e.g., <code dir="auto">"D"</code>, <code dir="auto">"W"</code>, <code dir="auto">"M"</code>. This is inconsistent with the timeframe strings for these same units at higher intervals, e.g., <code dir="auto">"2D"</code>, <code dir="auto">"3M"</code>.</p>
<p>To simplify the timeframe format in v6, the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_timeframe.period">timeframe.period</a> variable now <em>always</em> includes a multiplier with its timeframe unit. So, <code dir="auto">"D"</code> becomes <code dir="auto">"1D"</code>, <code dir="auto">"W"</code> becomes <code dir="auto">"1W"</code>, and  <code dir="auto">"M"</code> becomes <code dir="auto">"1M"</code>.</p>
<p>This change might affect the behavior of older scripts that used <code dir="auto">==</code> to compare the value of <a href="https://www.tradingview.com/pine-script-reference/v6/#var_timeframe.period">timeframe.period</a> with the “string” representation of a timeframe directly (e.g., <code dir="auto">timeframe.period == "D"</code>).</p>
<p>To show the difference between the v5 and v6 <a href="https://www.tradingview.com/pine-script-reference/v6/#var_timeframe.period">timeframe.period</a> variables, we ran the script below on a daily chart (1D) for each Pine version. The script displays the <a href="https://www.tradingview.com/pine-script-reference/v6/#var_timeframe.period">timeframe.period</a> string in a <a href="https://www.tradingview.com/pine-script-reference/v6/#type_table">table</a>, and compares the variable’s value with the “string” literals <code dir="auto">"D"</code> and <code dir="auto">"1D"</code>:</p>
<p><img src="/pine-script-docs/_astro/MigrationGuideTov6-Timeframe-multiplier.C0vAAkQ8_ZbC7c2.webp" alt="image" width="1233" height="629" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="34v"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"`timeframe.period`&nbsp;multiplier&nbsp;-&nbsp;v6"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Compares&nbsp;`timeframe.period`&nbsp;to&nbsp;passed&nbsp;`timeframeS</span><span class="mtk9">tring`&nbsp;and&nbsp;outputs&nbsp;result&nbsp;in&nbsp;selected&nbsp;table&nbsp;cell.</span></span><br><span><span class="mtk15">compareTF</span><span class="mtk13">(</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">timeframeString</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">table</span><span class="mtk1">&nbsp;</span><span class="mtk33">t</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">row</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">tfComparison</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">timeframe.period</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk33">timeframeString</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Format&nbsp;table&nbsp;cell&nbsp;text&nbsp;and&nbsp;determine&nbsp;cell&nbsp;color</span><span class="mtk9">&nbsp;based&nbsp;on&nbsp;comparison&nbsp;result.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">displayText</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"`timeframe.period`&nbsp;==&nbsp;'"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk33">timeframeString</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"'?&nbsp;"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk33">tfComparison</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">cellColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">tfComparison</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.rgb</span><span class="mtk13">(</span><span class="mtk12">76</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">175</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">79</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">40</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.rgb</span><span class="mtk13">(</span><span class="mtk12">255</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">82</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">82</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">40</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Display&nbsp;`tfComparison`&nbsp;result.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">t</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">row</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">displayText</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">bgcolor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">cellColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_halign</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">text.align_left</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.large</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Display&nbsp;the&nbsp;chart's&nbsp;timeframe&nbsp;information&nbsp;in&nbsp;a&nbsp;</span><span class="mtk9">table.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">barstate.islastconfirmedhistory</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Table&nbsp;displaying&nbsp;chart&nbsp;timeframe&nbsp;information.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">table</span><span class="mtk1">&nbsp;</span><span class="mtk33">t</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">table.new</span><span class="mtk13">(</span><span class="mtk11">position.middle_center</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">#FFEB3B99</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">border_color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.black</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">border_width</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;text&nbsp;to&nbsp;display&nbsp;in&nbsp;the&nbsp;table,&nbsp;consisting&nbsp;of&nbsp;t</span><span class="mtk9">he&nbsp;chart&nbsp;timeframe&nbsp;and&nbsp;multiplier.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18 mtkb">string</span><span class="mtk1">&nbsp;</span><span class="mtk33">tfInfo</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Chart&nbsp;timeframe:&nbsp;"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk11">timeframe.period</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk29">"\n&nbsp;Chart&nbsp;multiplier:&nbsp;"</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk16">str.tostring</span><span class="mtk13">(</span><span class="mtk11">timeframe.multiplier</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">t</span><span class="mtk1">.</span><span class="mtk15">cell</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">tfInfo</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_halign</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">text.align_left</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">text_size</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">size.large</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Compare&nbsp;the&nbsp;current&nbsp;chart&nbsp;timeframe&nbsp;(daily&nbsp;char</span><span class="mtk9">t)&nbsp;to&nbsp;timeframe&nbsp;strings&nbsp;with&nbsp;and&nbsp;without&nbsp;a&nbsp;multipl</span><span class="mtk9">ier.</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">compareTF</span><span class="mtk13">(</span><span class="mtk29">"D"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">t</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">compareTF</span><span class="mtk13">(</span><span class="mtk29">"1D"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">t</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br></code></div>
<p><strong>Fix:</strong> In general, ensure that all timeframe strings include a multiplier. In this example, change the timeframe comparison “string” (<code dir="auto">timeframe.period == "D"</code>) to ensure the “string” literal includes a multiplier (<code dir="auto">timeframe.period == "1D"</code>).</p>
<h2 id="lazy-evaluation-of-conditions" class="md-heading"><a href="#lazy-evaluation-of-conditions">Lazy evaluation of <span class="fancy-wrap">conditions<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p>The <code dir="auto">and</code> and <code dir="auto">or</code> conditions are now evaluated <em>lazily</em> rather than <em>strictly</em>.</p>
<p>An <code dir="auto">and</code> condition is <code dir="auto">true</code> if <em>all</em> of its arguments are <code dir="auto">true</code>, which means that if the <em>first</em> argument is <code dir="auto">false</code>, we can deduce that the whole condition is <code dir="auto">false</code>, regardless of the value of the second argument. Conversely, an <code dir="auto">or</code> condition is <code dir="auto">true</code> when <em>at least one</em> of the arguments is <code dir="auto">true</code>, so if the <em>first</em> argument is already <code dir="auto">true</code>, then the whole condition is <code dir="auto">true</code>, regardless of the second argument’s state.</p>
<p>Pine v5 evaluates all <a href="https://www.tradingview.com/pine-script-reference/v6/#type_bool">bool</a> expressions except for the <code dir="auto">?:</code> <a href="/pine-script-docs/language/operators/#-ternary-operator">ternary operator</a> <em>strictly</em>, meaning the <em>second</em> part of a conditional expression is <em>always</em> evaluated, regardless of the value of the first argument.</p>
<p>Lazy evaluation can have consequences for script calculation. In the example below, we assign a value of <code dir="auto">true</code> to the <code dir="auto">signal</code> variable <em>only</em> when <code dir="auto">close &gt; open</code> <em>and</em> <code dir="auto">ta.rsi(close, 14) &gt; 50</code>. The <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.rsi">ta.rsi()</a> function must be executed on every bar in order to calculate its result correctly. In v5, the function <em>is</em> called on every bar, even when <code dir="auto">close &gt; open</code> is <em>not</em> <code dir="auto">true</code>, due to the strict bool evaluation, and therefore the function calculates correctly.</p>
<div class="pine-colorizer not-content colorized" data-id="6by"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Evaluation&nbsp;test&nbsp;v5"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;A&nbsp;signal&nbsp;flag.&nbsp;Is&nbsp;`true`&nbsp;if&nbsp;two&nbsp;conditions&nbsp;`close</span><span class="mtk9">&nbsp;&gt;&nbsp;open`&nbsp;and&nbsp;`ta.rsi(close,&nbsp;14)&nbsp;&gt;&nbsp;50`&nbsp;are&nbsp;both&nbsp;`tr</span><span class="mtk9">ue`.</span></span><br><span><span class="mtk18 mtkb">bool</span><span class="mtk1">&nbsp;</span><span class="mtk33">signal</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">false</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk16">ta.rsi</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">14</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk12">50</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">signal</span><span class="mtk1">&nbsp;</span><span class="mtk18">:=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Highlight&nbsp;background&nbsp;on&nbsp;bars&nbsp;where&nbsp;`signal`&nbsp;is&nbsp;</span><span class="mtk9">`true`.</span></span><br><span><span class="mtk16">bgcolor</span><span class="mtk13">(</span><span class="mtk33">signal</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk11">color.green</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">90</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">na</span><span class="mtk13">)</span></span><br></code></div>
<p>In v6, <a href="https://www.tradingview.com/pine-script-reference/v6/#type_bool">bool</a> expressions are evaluated <em>lazily</em>, which means the expression <em>stops evaluating</em> once it determines the overall condition’s result, even if there are other arguments remaining in the expression.</p>
<p>If we convert the script above to v6, we see that the plotted signals <em>differ</em> between the two scripts. This variation occurs because of the lazy bool evaluation – since an <code dir="auto">and</code> condition is only <code dir="auto">true</code> if <em>all</em> its arguments are <code dir="auto">true</code>, when <code dir="auto">close &gt; open</code> is <code dir="auto">false</code>, the <code dir="auto">and</code> condition is <em>definitely</em> <code dir="auto">false</code> regardless of the second argument <code dir="auto">ta.rsi(close, 14) &gt; 50</code>. Consequently, the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_ta.rsi">ta.rsi()</a> call is <em>not</em> evaluated on every bar, which interferes with the internal history that the RSI function stores for its calculation and results in incorrect values:</p>
<p><img src="/pine-script-docs/_astro/MigrationGuideTov6-Lazy-evaluation.DTwy6SAe_64SBs.webp" alt="image" width="1390" height="568" loading="lazy" decoding="async"></p>
<p><strong>Fix:</strong> Ensure that the script evaluates all functions that rely on previous values on each bar. For example, extract calls that rely on historical context to the <em>global scope</em> and assign them to a variable. Then, reference that <em>variable</em> in the <code dir="auto">and</code> and <code dir="auto">or</code> conditions.</p>
<p>Note that you can and should take advantage of the lazy bool evaluation to create smarter, more concise code.</p>
<p>For example, the script below calls <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_array.first">array.first()</a> on an <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a> that is occasionally empty (on bars where <code dir="auto">close &gt; open</code> is <code dir="auto">false</code>). In <em>Pine v5</em>, calling <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_array.first">array.first()</a> on an empty array results in a runtime error, so you must keep the two <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_if">if</a>-conditions that check the array size and first element separated in <em>different scopes</em> to avoid the error. However, in <em>Pine v6</em>, you can have the two conditions in the <em>same</em> <em>scope</em> without error because the <code dir="auto">and</code> condition’s lazy evaluation ensures that <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_array.first">array.first()</a> will only be called if <code dir="auto">array.size() != 0</code> is <code dir="auto">true</code> first:</p>
<div class="pine-colorizer not-content colorized" data-id="1z9"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Lazy&nbsp;evaluation&nbsp;error&nbsp;showcase"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">bool</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">myArray</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">bool</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">myArray</span><span class="mtk1">.</span><span class="mtk15">push</span><span class="mtk13">(</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Causes&nbsp;a&nbsp;runtime&nbsp;error&nbsp;in&nbsp;v5&nbsp;when&nbsp;trying&nbsp;to&nbsp;cal</span><span class="mtk9">l&nbsp;`array.first()`&nbsp;on&nbsp;an&nbsp;empty&nbsp;array.</span></span><br><span><span class="mtk9">//&nbsp;Works&nbsp;in&nbsp;v6&nbsp;because&nbsp;`array.first()`&nbsp;is&nbsp;only&nbsp;cal</span><span class="mtk9">led&nbsp;if&nbsp;the&nbsp;array&nbsp;is&nbsp;not&nbsp;empty.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">myArray</span><span class="mtk1">.</span><span class="mtk15">size</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">!=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">and</span><span class="mtk1">&nbsp;</span><span class="mtk33">myArray</span><span class="mtk1">.</span><span class="mtk15">first</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Test"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;A&nbsp;correct&nbsp;approach&nbsp;for&nbsp;v5:&nbsp;`array.first()`&nbsp;is&nbsp;o</span><span class="mtk9">nly&nbsp;called&nbsp;when&nbsp;we're&nbsp;sure&nbsp;the&nbsp;array&nbsp;is&nbsp;not&nbsp;empty.</span></span><br><span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">myArray</span><span class="mtk1">.</span><span class="mtk15">size</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">!=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">myArray</span><span class="mtk1">.</span><span class="mtk15">first</span><span class="mtk13">()</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk16">label.new</span><span class="mtk13">(</span><span class="mtk11">bar_index</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">high</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Test"</span><span class="mtk13">)</span></span><br></code></div>
<h2 id="cannot-repeat-parameters" class="md-heading"><a href="#cannot-repeat-parameters">Cannot repeat <span class="fancy-wrap">parameters<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p>In v5, you can specify the same parameter in a function more than once. However, doing so raises a <em>compiler warning</em>, and only the <em>first</em> value will be used.</p>
<div class="pine-colorizer not-content colorized" data-id="79k"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//&nbsp;In&nbsp;v5,&nbsp;compiles&nbsp;but&nbsp;raises&nbsp;warning.&nbsp;Only&nbsp;uses&nbsp;f</span><span class="mtk9">irst&nbsp;value,&nbsp;so&nbsp;plot&nbsp;color&nbsp;will&nbsp;be&nbsp;`blue`.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Close"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span><span class="mtk13">)</span></span><br></code></div>
<p>In v6, you can specify a parameter only <em>once</em>, and doing otherwise will result in a <em>compilation error</em>.</p>
<p><strong>Fix:</strong> Remove the duplicate parameters.</p>
<div class="pine-colorizer not-content colorized" data-id="72w"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//&nbsp;In&nbsp;v6,&nbsp;script&nbsp;will&nbsp;not&nbsp;compile&nbsp;if&nbsp;parameter&nbsp;is&nbsp;</span><span class="mtk9">specified&nbsp;more&nbsp;than&nbsp;once.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Close"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk13">)</span></span><br></code></div>
<h2 id="no-series-offset-values" class="md-heading"><a href="#no-series-offset-values"><span>No series ​<code dir="auto">offset</code>​ values</span><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></a></h2>
<p>The <code dir="auto">offset</code> parameter can no longer accept “series” values</p>
<p>In Pine v5, the <code dir="auto">offset</code> parameter in <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plot">plot()</a> and similar functions can accept “<em>series</em> int” arguments. However, passing a “series” argument raises a compiler warning, and the behavior is <em>incorrect</em>: only the <em>last</em> calculated offset is used on the whole chart, regardless of its previous values.</p>
<p>For example, this script uses <code dir="auto">bar_index / 2</code> as a “series” <code dir="auto">offset</code> argument while plotting the high points of each bar’s body. Because the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plot">plot()</a> function uses only the <em>last</em> <code dir="auto">offset</code> value, the plot appears offset by 10 bars here for the <em>entire</em> “GOOGL” 12M chart (since the chart’s last <code dir="auto">bar_index</code> is 20 here):</p>
<p><img src="/pine-script-docs/_astro/MigrationGuideTov6-No-series-offset.DH-Z-RyE_Z1mLK8f.webp" alt="image" width="1310" height="565" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="78v"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"`offset`&nbsp;parameter&nbsp;demo"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">overlay</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">true</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;`series&nbsp;int`&nbsp;value.&nbsp;Used&nbsp;as&nbsp;`offset`&nbsp;parameter&nbsp;va</span><span class="mtk9">lue&nbsp;in&nbsp;`plot()`.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">seriesOffset</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">bar_index</span><span class="mtk1">&nbsp;</span><span class="mtk18">/</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span></span><br><span><span class="mtk9">//&nbsp;In&nbsp;v5,&nbsp;a&nbsp;`series`&nbsp;type&nbsp;`offset`&nbsp;value&nbsp;is&nbsp;valid,</span><span class="mtk9">&nbsp;but&nbsp;only&nbsp;the&nbsp;last&nbsp;calculated&nbsp;value&nbsp;is&nbsp;used.&nbsp;&nbsp;</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk16">math.max</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk13">)</span><span class="mtk18">,</span><span class="mtk29">""</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.orange</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">plot.style_stepline</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">offset</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">seriesOffset</span><span class="mtk13">)</span></span><br></code></div>
<p>In v6, the <code dir="auto">offset</code> parameter accepts an argument qualified as “<em>simple</em>” or weaker. The value used must be the same on every bar.</p>
<p>Remember that the Pine Script <a href="/pine-script-docs/language/type-system/#qualifiers">qualifiers</a> hierarchy means that a parameter expecting a “<a href="/pine-script-docs/language/type-system/#simple">simple</a>” value can also accept values qualified as “<a href="https://www.tradingview.com/pine-script-reference/v6/#type_input">input</a>” or “<a href="https://www.tradingview.com/pine-script-reference/v6/#type_const">const</a>”. However, passing a “series” argument triggers a compilation error.</p>
<p><strong>Fix</strong>: Change any “series” values passed to <code dir="auto">offset</code> to “simple” values.</p>
<h2 id="minimum-linewidth-is-1" class="md-heading"><a href="#minimum-linewidth-is-1"><span>Minimum ​<code dir="auto">linewidth</code>​ is 1</span><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></a></h2>
<p>In v5, the <code dir="auto">linewidth</code> parameter of the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plot">plot()</a> and <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_hline">hline()</a> functions can accept a value smaller than 1, although the width on the chart will still appear as 1 for these drawings:</p>
<p><img src="/pine-script-docs/_astro/MigrationGuideTov6-Minimum-linewidth-1.DK4UaZ1K_ZBnFll.webp" alt="image" width="1154" height="340" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="3do"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Linewidth&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;User-input&nbsp;width&nbsp;for&nbsp;a&nbsp;line.&nbsp;Default&nbsp;value&nbsp;set&nbsp;to</span><span class="mtk9">&nbsp;0,&nbsp;with&nbsp;no&nbsp;minimum&nbsp;limit.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">userWidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Linewidth"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Valid&nbsp;in&nbsp;v5,&nbsp;but&nbsp;line&nbsp;widths&nbsp;on&nbsp;chart&nbsp;all&nbsp;appea</span><span class="mtk9">r&nbsp;as&nbsp;`linewidth=1`.&nbsp;Not&nbsp;valid&nbsp;in&nbsp;v6.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"LW&nbsp;1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk29">"LW&nbsp;0"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">userWidth</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"LW&nbsp;-5"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">-5</span><span class="mtk13">)</span></span><br><span><span class="mtk16">hline</span><span class="mtk13">(</span><span class="mtk12">240</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"hline"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.maroon</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">-3</span><span class="mtk13">)</span></span><br></code></div>
<p>In v6, the <code dir="auto">linewidth</code> argument <strong>must</strong> be 1 or greater. Passing a smaller value causes a compilation error.</p>
<p><strong>Fix:</strong> Replace any <code dir="auto">linewidth</code> argument that is smaller than 1 to ensure all width values are <em>at least</em> 1.</p>
<p><img src="/pine-script-docs/_astro/MigrationGuideTov6-Minimum-linewidth-2.BTZsUVkx_VCJPf.webp" alt="image" width="1157" height="341" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5rl"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Linewidth&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;User-input&nbsp;width&nbsp;for&nbsp;a&nbsp;line.&nbsp;Default&nbsp;value&nbsp;set&nbsp;to</span><span class="mtk9">&nbsp;2,&nbsp;with&nbsp;minimum&nbsp;value&nbsp;set&nbsp;to&nbsp;1.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">userWidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Linewidth"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">minval</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;In&nbsp;v6,&nbsp;all&nbsp;line&nbsp;widths&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;1&nbsp;or&nbsp;gr</span><span class="mtk9">eater.</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk29">"LW&nbsp;1"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;</span><span class="mtk29">"LW&nbsp;2"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">userWidth</span><span class="mtk13">)</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">+</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"LW&nbsp;5"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;&nbsp;&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span class="mtk16">hline</span><span class="mtk13">(</span><span class="mtk12">240</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"hline"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.maroon</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">linewidth</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br></code></div>
<h2 id="negative-indices-in-arrays" class="md-heading"><a href="#negative-indices-in-arrays">Negative indices in <span class="fancy-wrap">arrays<span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></span></a></h2>
<p>Some array functions now accept negative indices.</p>
<p>In v5, array functions that require an element’s <em>index</em> always expect a value <em>greater than or equal to 0</em>. Therefore, functions like <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_array.get">array.get()</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_array.insert">array.insert()</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_array.set">array.set()</a>, and <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_array.remove">array.remove()</a> raise a runtime error if a negative index is passed.</p>
<p>In v6, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_array.get">array.get()</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_array.insert">array.insert()</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_array.set">array.set()</a>, and <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_array.remove">array.remove()</a> allow you to pass a <em>negative index</em> to request items from the <em>end</em> of the array. For example, <code dir="auto">-1</code> refers to the last item in the array, <code dir="auto">-2</code> refers to the second to last, and so forth.</p>
<div class="pine-colorizer not-content colorized" data-id="eb"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Array&nbsp;of&nbsp;"int"&nbsp;numbers&nbsp;from&nbsp;1&nbsp;to&nbsp;5.</span></span><br><span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">int</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">countingArray</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span class="mtk9">//&nbsp;Array&nbsp;indexing&nbsp;starts&nbsp;from&nbsp;0&nbsp;to&nbsp;retrieve&nbsp;first&nbsp;</span><span class="mtk9">element&nbsp;in&nbsp;both&nbsp;v5&nbsp;and&nbsp;v6.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">firstValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">countingArray</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">0</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//Returns&nbsp;"1"</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;In&nbsp;v6,&nbsp;can&nbsp;retrieve&nbsp;last&nbsp;array&nbsp;element&nbsp;using&nbsp;ne</span><span class="mtk9">gative&nbsp;index.&nbsp;This&nbsp;index&nbsp;is&nbsp;invalid&nbsp;in&nbsp;v5.</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lastValue</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">countingArray</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk12">-1</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//Returns&nbsp;"5"</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Other&nbsp;`array.*()`&nbsp;functions&nbsp;also&nbsp;accept&nbsp;negativ</span><span class="mtk9">e&nbsp;indexing&nbsp;in&nbsp;v6.&nbsp;These&nbsp;lines&nbsp;raise&nbsp;runtime&nbsp;errors</span><span class="mtk9">&nbsp;in&nbsp;v5.</span></span><br><span><span class="mtk33">countingArray</span><span class="mtk1">.</span><span class="mtk15">set</span><span class="mtk13">(</span><span class="mtk12">-2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">10</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Updated&nbsp;array:&nbsp;[1,&nbsp;2,&nbsp;3,&nbsp;10,&nbsp;5]</span></span><br><span><span class="mtk33">countingArray</span><span class="mtk1">.</span><span class="mtk15">remove</span><span class="mtk13">(</span><span class="mtk12">-5</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Updated&nbsp;array:&nbsp;[2,&nbsp;3,&nbsp;10,&nbsp;5]</span></span><br><span><span class="mtk33">countingArray</span><span class="mtk1">.</span><span class="mtk15">insert</span><span class="mtk13">(</span><span class="mtk12">-1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">20</span><span class="mtk13">)</span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Updated&nbsp;array:&nbsp;[2,&nbsp;3,&nbsp;10,&nbsp;20,&nbsp;5]&nbsp;</span></span><br></code></div>
<p>As a result, scripts that return a runtime error for using negative indices in v5 can be executed without error in v6.</p>
<p>However, if you create or update a script in v6, you must be aware of this new behavior to ensure that the script does not behave unexpectedly.</p>
<p>Keep in mind that negative indexing is still bound by the size of the array. Therefore, an array of 5 elements only accepts indexing from 0 to 4 (first to last element) or -1 to -5 (last to first element). Any other indices are out of bounds and raise a runtime error:</p>
<div class="pine-colorizer not-content colorized" data-id="7kf"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;Array&nbsp;of&nbsp;"int"&nbsp;numbers&nbsp;from&nbsp;1&nbsp;to&nbsp;5.</span></span><br><span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">int</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">countingArray</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.from</span><span class="mtk13">(</span><span class="mtk12">1</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">2</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">4</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">5</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Trying&nbsp;to&nbsp;index&nbsp;negatively&nbsp;beyond&nbsp;the&nbsp;size&nbsp;of&nbsp;t</span><span class="mtk9">he&nbsp;array&nbsp;causes&nbsp;a&nbsp;runtime&nbsp;error.</span></span><br><span><span class="mtk33">countingArray</span><span class="mtk1">.</span><span class="mtk15">remove</span><span class="mtk13">(</span><span class="mtk12">-6</span><span class="mtk13">)</span></span><br></code></div>
<h2 id="the-transp-parameter-is-removed" class="md-heading"><a href="#the-transp-parameter-is-removed"><span>The ​<code dir="auto">transp</code>​ parameter is removed</span><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></a></h2>
<p>In Pine v4 and earlier, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plot">plot()</a> and similar functions had a <code dir="auto">transp</code> parameter that specified the transparency of the resulting plot.</p>
<p>Pine v5 deprecated and hid the <code dir="auto">transp</code> parameter, because it is not fully compatible with the color system that Pine currently uses. Using both transparency settings together can result in unexpected behavior, as the <code dir="auto">transp</code> parameter can get overwritten by the transparency of the color passed to the function. In v5, using the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_color.new">color.new()</a> function and not the <code dir="auto">transp</code> parameter avoids any such conflicts.</p>
<p>Pine v6 removes the <code dir="auto">transp</code> parameter completely from the following functions: <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_bgcolor">bgcolor()</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_fill">fill()</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plot">plot()</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plotarrow">plotarrow()</a>, <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plotchar">plotchar()</a>, and <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_plotshape">plotshape()</a>. Whenever the <a href="/pine-script-docs/migration-guides/to-pine-version-6/#converting-v5-to-v6-using-the-pine-editor">converter</a> encounters a <code dir="auto">transp</code> argument, it removes the argument from the converted v6 script.</p>
<p><strong>Fix:</strong> To set the transparency of a drawn plot, use the <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_color.new">color.new()</a> function. Pass the color value as the first argument, and the desired transparency value as the second.</p>
<p>For example, this v5 code uses the hidden <code dir="auto">transp</code> parameter to set the color of the plot to <code dir="auto">80</code> transparency:</p>
<div class="pine-colorizer not-content colorized" data-id="6yz"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Transparency&nbsp;demo&nbsp;v5"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">myColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">myColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">transp</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">)</span></span><br></code></div>
<p>In Pine v6, the same result can be achieved using <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_color.new">color.new()</a>:</p>
<div class="pine-colorizer not-content colorized" data-id="5r8"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"Transparency&nbsp;demo&nbsp;v6"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk18 mtkb">color</span><span class="mtk1">&nbsp;</span><span class="mtk33">myColor</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk11">close</span><span class="mtk1">&nbsp;</span><span class="mtk18">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">open</span><span class="mtk1">&nbsp;</span><span class="mtk18">?</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.green</span><span class="mtk1">&nbsp;</span><span class="mtk18">:</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.red</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk33">color</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">color.new</span><span class="mtk13">(</span><span class="mtk33">myColor</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">80</span><span class="mtk13">))</span></span><br></code></div>
<p>If you need to preserve the color inputs in the “Settings/Style” menu, you must ensure that every color that gets passed to every <a href="https://www.tradingview.com/pine-script-reference/v6/#fun_color.new">color.new()</a> call is qualified as either “const” or “input”. If at least one of these <a href="https://www.tradingview.com/pine-script-reference/v6/#type_color">color</a> values is calculated dynamically (like the code above), the color selector does not appear in the settings:</p>
<p><img src="/pine-script-docs/_astro/MigrationGuideTov6-Transp-removed.UbKaK0oO_ZOtPJe.webp" alt="image" width="457" height="212" loading="lazy" decoding="async"></p>
<p>You can learn more about why this happens and how to avoid it <a href="/pine-script-docs/visuals/colors/#maintaining-automatic-color-selectors">here</a>.</p>
<h2 id="dynamic-for-loop-boundaries" class="md-heading"><a href="#dynamic-for-loop-boundaries"><span>Dynamic ​<code dir="auto">for</code>​ loop boundaries</span><span class="icon icon-link" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 28 28"><g fill="currentColor" clip-path="url(#a)"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h28v28H0z"></path></clipPath></defs></svg></span></a></h2>
<p>A <a href="/pine-script-docs/language/loops/#for-loops">for</a> loop is a <em>count-controlled</em> loop that executes successive iterations of its local block based on a counter variable. The counter starts with an <em>initial value</em> (<code dir="auto">from_num</code>) and increases or decreases by a fixed amount after every iteration until it reaches the specified <em>final value</em> (<code dir="auto">to_num</code>).</p>
<p>In Pine v5, a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop statement establishes its final counter value strictly <em>before</em> starting its iterations. If the script changes the value of a variable or expression used as the loop’s <code dir="auto">to_num</code> argument during the loop’s iterations, those changes do <strong>not</strong> affect the counter’s boundaries. This behavior differs from <a href="/pine-script-docs/language/loops/#while-loops">while</a> and <a href="/pine-script-docs/language/loops/#forin-loops">for…in</a> loops, which have control criteria that can change across iterations.</p>
<p>In Pine v6, all <a href="/pine-script-docs/language/loops/#for-loops">for</a> loops <em>dynamically</em> evaluate their stopping criteria before <strong>each iteration</strong>. Variables and expressions used as the <code dir="auto">to_num</code> argument that depend on values or objects modified in the loop’s scope can <em>update</em> the counter variable’s boundaries across iterations. This behavior enables scripts to use a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop for iterative tasks where the exact iteration boundaries are unknown before the loop starts.</p>
<p>Because <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop boundaries can be <em>dynamic</em> in Pine v6, a v5 script using this loop structure with a mutated variable or dynamic expression such as <code dir="auto">array.size(id) - 1</code> as the <code dir="auto">to_num</code> argument can behave differently after conversion to v6.</p>
<p><strong>Fix:</strong> If a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop requires only <strong>one</strong> evaluation of an expression used as the <code dir="auto">to_num</code> argument across iterations, assign the expression to a variable <em>outside</em> the loop’s scope, then use that variable as the <code dir="auto">to_num</code> argument instead.</p>
<p>The following v5 example uses two <a href="/pine-script-docs/language/methods/#user-defined-methods">user-defined methods</a> to manage the elements in an <a href="https://www.tradingview.com/pine-script-reference/v6/#type_array">array</a>. The script calls the <code dir="auto">dequeue()</code> method before a <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop to remove the first element from the <code dir="auto">data</code> array. Then, it calls the <code dir="auto">queue()</code> method inside the loop statement to add the current bar’s <a href="https://www.tradingview.com/pine-script-reference/v6/#var_close">close</a> into the array and return the array’s size for the loop’s end boundary. Within the loop’s scope, the script increments the <code dir="auto">belowCount</code> variable by one for each element with a value below the current bar’s <a href="https://www.tradingview.com/pine-script-reference/v6/#var_ohlc4">ohlc4</a> value:</p>
<p><img src="/pine-script-docs/_astro/To-pine-version-6-Dynamic-for-loop-boundaries-1.n43JfWKr_19ifCF.webp" alt="image" width="2462" height="1030" loading="lazy" decoding="async"></p>
<div class="pine-colorizer not-content colorized" data-id="5v7"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">5</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"v5&nbsp;vs&nbsp;v6&nbsp;`to_num`&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;size&nbsp;of&nbsp;the&nbsp;`data`&nbsp;array.&nbsp;</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">sizeInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Size"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Appends&nbsp;a&nbsp;new&nbsp;`value`&nbsp;to&nbsp;`this`&nbsp;array&nbsp;and&nbsp;returns</span><span class="mtk9">&nbsp;the&nbsp;array's&nbsp;size.&nbsp;</span></span><br><span><span class="mtk18">method</span><span class="mtk1">&nbsp;</span><span class="mtk33">queue</span><span class="mtk13">(</span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">value</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">push</span><span class="mtk13">(</span><span class="mtk33">value</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">size</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Removes&nbsp;the&nbsp;first&nbsp;value&nbsp;from&nbsp;`this`&nbsp;array&nbsp;if&nbsp;the&nbsp;</span><span class="mtk9">size&nbsp;equals&nbsp;the&nbsp;`sizeInput`.</span></span><br><span><span class="mtk18">method</span><span class="mtk1">&nbsp;</span><span class="mtk33">dequeue</span><span class="mtk13">(</span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">size</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk33">sizeInput</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">shift</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;array&nbsp;that&nbsp;holds&nbsp;`sizeInput`&nbsp;recent&nbsp;`close`&nbsp;pr</span><span class="mtk9">ices.&nbsp;</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">data</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;elements&nbsp;in&nbsp;the&nbsp;`data`&nbsp;array&nbsp;that&nbsp;a</span><span class="mtk9">re&nbsp;below&nbsp;the&nbsp;current&nbsp;bar's&nbsp;`ohlc4`.&nbsp;</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">belowCount</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Remove&nbsp;the&nbsp;oldest&nbsp;element&nbsp;from&nbsp;the&nbsp;`data`&nbsp;array</span><span class="mtk9">&nbsp;when&nbsp;its&nbsp;size&nbsp;reaches&nbsp;the&nbsp;`sizeInput`.&nbsp;</span></span><br><span><span class="mtk33">data</span><span class="mtk1">.</span><span class="mtk15">dequeue</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Push&nbsp;the&nbsp;bar's&nbsp;`close`&nbsp;into&nbsp;`data`&nbsp;and&nbsp;loop&nbsp;fro</span><span class="mtk9">m&nbsp;zero&nbsp;to&nbsp;one&nbsp;less&nbsp;than&nbsp;the&nbsp;array's&nbsp;size.&nbsp;</span></span><br><span><span class="mtk9">//&nbsp;In&nbsp;v5,&nbsp;the&nbsp;loop&nbsp;evaluates&nbsp;the&nbsp;`data.queue()`&nbsp;ca</span><span class="mtk9">ll&nbsp;*once*,&nbsp;meaning&nbsp;the&nbsp;final&nbsp;counter&nbsp;value&nbsp;is&nbsp;fixe</span><span class="mtk9">d&nbsp;across&nbsp;iterations.</span></span><br><span><span class="mtk9">//&nbsp;In&nbsp;v6,&nbsp;it&nbsp;evaluates&nbsp;the&nbsp;call&nbsp;before&nbsp;*every*&nbsp;ite</span><span class="mtk9">ration,&nbsp;causing&nbsp;the&nbsp;array&nbsp;and&nbsp;loop&nbsp;boundary&nbsp;to&nbsp;exp</span><span class="mtk9">and&nbsp;indefinitely.&nbsp;&nbsp;&nbsp;&nbsp;</span></span><br><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">data</span><span class="mtk1">.</span><span class="mtk15">queue</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;1&nbsp;to&nbsp;`belowCount`&nbsp;when&nbsp;the&nbsp;`data`&nbsp;element&nbsp;a</span><span class="mtk9">t&nbsp;index&nbsp;`i`&nbsp;is&nbsp;less&nbsp;than&nbsp;the&nbsp;`ohlc4`&nbsp;value.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">data</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk33">i</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">ohlc4</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">belowCount</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`belowCount`&nbsp;in&nbsp;a&nbsp;separate&nbsp;pane.&nbsp;</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">belowCount</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Closes&nbsp;below&nbsp;OHLC4"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br></code></div>
<p>In v5, the above loop statement evaluates <code dir="auto">data.queue(close) - 1</code> only <strong>once</strong>, before it starts the first iteration. It does <em>not</em> execute that expression again across iterations. As such, each script execution queues exactly one new value into the <code dir="auto">data</code> array, and the number of times the loop executes its local code <em>does not change</em> while the loop runs.</p>
<p>However, the script does not work after conversion to v6, because the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop evaluates <code dir="auto">data.queue(close) - 1</code> before <strong>every iteration</strong>. Each evaluation of the expression adds a <em>new element</em> to the <code dir="auto">data</code> array and <em>increases</em> the <code dir="auto">to_num</code> boundary, causing the loop to iterate indefinitely until the script raises a runtime error:</p>
<p><img src="/pine-script-docs/_astro/To-pine-version-6-Dynamic-for-loop-boundaries-2.XWLzv4MJ_Z1AU5wL.webp" alt="image" width="1990" height="790" loading="lazy" decoding="async"></p>
<p>We can fix the script’s behavior by assigning the expression’s initial result to a variable outside the loop’s scope and using that variable in the <a href="https://www.tradingview.com/pine-script-reference/v6/#kw_for">for</a> loop statement. This change prevents the expression from modifying the array’s size or altering the loop’s end boundary between iterations:</p>
<div class="pine-colorizer not-content colorized" data-id="3to"><div class="pine-colorizer__header"><a class="pine-colorizer__title" href="https://tradingview.com/pine-script-docs" target="_blank" rel="noopener"><span>Pine Script®</span></a><button class="pine-colorizer__copy-btn"><div class="pine-colorizer__tooltip">Copied</div></button></div><code class="monaco-editor-tv-pine-light"><span><span class="mtk9">//</span><span class="mtk9 mtkb">@version=</span><span class="mtk9">6</span></span><br><span><span class="mtk16">indicator</span><span class="mtk13">(</span><span class="mtk29">"v5&nbsp;to&nbsp;v6&nbsp;fixed&nbsp;`to_num`&nbsp;demo"</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;size&nbsp;of&nbsp;the&nbsp;`data`&nbsp;array.&nbsp;</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">sizeInput</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">input.int</span><span class="mtk13">(</span><span class="mtk12">20</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Size"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span><span class="mtk13">)</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Appends&nbsp;a&nbsp;new&nbsp;`value`&nbsp;to&nbsp;`this`&nbsp;array&nbsp;and&nbsp;returns</span><span class="mtk9">&nbsp;the&nbsp;array's&nbsp;size.&nbsp;</span></span><br><span><span class="mtk18">method</span><span class="mtk1">&nbsp;</span><span class="mtk33">queue</span><span class="mtk13">(</span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">float</span><span class="mtk1">&nbsp;</span><span class="mtk33">value</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">push</span><span class="mtk13">(</span><span class="mtk33">value</span><span class="mtk13">)</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">size</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@function</span><span class="mtk9">&nbsp;Removes&nbsp;the&nbsp;first&nbsp;value&nbsp;from&nbsp;`this`&nbsp;array&nbsp;if&nbsp;the&nbsp;</span><span class="mtk9">size&nbsp;equals&nbsp;the&nbsp;`sizeInput`.</span></span><br><span><span class="mtk18">method</span><span class="mtk1">&nbsp;</span><span class="mtk33">dequeue</span><span class="mtk13">(</span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">=&gt;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">size</span><span class="mtk13">()</span><span class="mtk1">&nbsp;</span><span class="mtk18">==</span><span class="mtk1">&nbsp;</span><span class="mtk33">sizeInput</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">this</span><span class="mtk1">.</span><span class="mtk15">shift</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;An&nbsp;array&nbsp;that&nbsp;holds&nbsp;`sizeInput`&nbsp;recent&nbsp;`close`&nbsp;pr</span><span class="mtk9">ices.&nbsp;</span></span><br><span><span class="mtk18">var</span><span class="mtk1">&nbsp;</span><span class="mtk18 mtkb">array</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;</span><span class="mtk1">&nbsp;</span><span class="mtk33">data</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk16">array.new</span><span class="mtk13">&lt;</span><span class="mtk18 mtkb">float</span><span class="mtk13">&gt;()</span></span><br><span><span></span></span><br><span><span class="mtk9">//</span><span class="mtk9 mtkb">@variable</span><span class="mtk9">&nbsp;The&nbsp;number&nbsp;of&nbsp;elements&nbsp;in&nbsp;the&nbsp;`data`&nbsp;array&nbsp;that&nbsp;a</span><span class="mtk9">re&nbsp;below&nbsp;the&nbsp;current&nbsp;bar's&nbsp;`ohlc4`.&nbsp;</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">belowCount</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Remove&nbsp;the&nbsp;oldest&nbsp;element&nbsp;from&nbsp;the&nbsp;`data`&nbsp;array</span><span class="mtk9">&nbsp;when&nbsp;its&nbsp;size&nbsp;reaches&nbsp;the&nbsp;`sizeInput`.&nbsp;</span></span><br><span><span class="mtk33">data</span><span class="mtk1">.</span><span class="mtk15">dequeue</span><span class="mtk13">()</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Push&nbsp;the&nbsp;`close`&nbsp;into&nbsp;the&nbsp;`data`&nbsp;array&nbsp;and&nbsp;assi</span><span class="mtk9">gn&nbsp;one&nbsp;less&nbsp;than&nbsp;the&nbsp;array's&nbsp;size&nbsp;to&nbsp;a&nbsp;variable,&nbsp;</span></span><br><span><span class="mtk9">//&nbsp;ensuring&nbsp;only&nbsp;one&nbsp;evaluation&nbsp;per&nbsp;script&nbsp;executi</span><span class="mtk9">on.&nbsp;</span></span><br><span><span class="mtk18 mtkb">int</span><span class="mtk1">&nbsp;</span><span class="mtk33">lastCount</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk33">data</span><span class="mtk1">.</span><span class="mtk15">queue</span><span class="mtk13">(</span><span class="mtk11">close</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">-</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Use&nbsp;`lastCount`&nbsp;as&nbsp;the&nbsp;`to_num`&nbsp;in&nbsp;the&nbsp;`for`&nbsp;lo</span><span class="mtk9">op&nbsp;statement.&nbsp;</span></span><br><span><span class="mtk9">//&nbsp;This&nbsp;change&nbsp;prevents&nbsp;the&nbsp;array&nbsp;and&nbsp;loop&nbsp;from&nbsp;ex</span><span class="mtk9">panding&nbsp;indefinitely,&nbsp;</span></span><br><span><span class="mtk9">//&nbsp;because&nbsp;the&nbsp;value&nbsp;is&nbsp;calculated&nbsp;*outside*&nbsp;the&nbsp;l</span><span class="mtk9">oop's&nbsp;scope.</span></span><br><span><span class="mtk18">for</span><span class="mtk1">&nbsp;</span><span class="mtk33">i</span><span class="mtk1">&nbsp;</span><span class="mtk18">=</span><span class="mtk1">&nbsp;</span><span class="mtk12">0</span><span class="mtk1">&nbsp;</span><span class="mtk18">to</span><span class="mtk1">&nbsp;</span><span class="mtk33">lastCount</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk9">//&nbsp;Add&nbsp;1&nbsp;to&nbsp;`belowCount`&nbsp;when&nbsp;the&nbsp;`data`&nbsp;element&nbsp;a</span><span class="mtk9">t&nbsp;index&nbsp;`i`&nbsp;is&nbsp;less&nbsp;than&nbsp;the&nbsp;`ohlc4`&nbsp;value.&nbsp;</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk18">if</span><span class="mtk1">&nbsp;</span><span class="mtk33">data</span><span class="mtk1">.</span><span class="mtk15">get</span><span class="mtk13">(</span><span class="mtk33">i</span><span class="mtk13">)</span><span class="mtk1">&nbsp;</span><span class="mtk18">&lt;</span><span class="mtk1">&nbsp;</span><span class="mtk11">ohlc4</span></span><br><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk33">belowCount</span><span class="mtk1">&nbsp;</span><span class="mtk18">+=</span><span class="mtk1">&nbsp;</span><span class="mtk12">1</span></span><br><span><span></span></span><br><span><span class="mtk9">//&nbsp;Plot&nbsp;the&nbsp;`belowCount`&nbsp;in&nbsp;a&nbsp;separate&nbsp;pane.&nbsp;</span></span><br><span><span class="mtk16">plot</span><span class="mtk13">(</span><span class="mtk33">belowCount</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk29">"Closes&nbsp;below&nbsp;OHLC4"</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk11">color.blue</span><span class="mtk18">,</span><span class="mtk1">&nbsp;</span><span class="mtk12">3</span><span class="mtk13">)</span></span><br></code></div>      </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a href="/pine-script-docs/migration-guides/overview" class="pagination-card" data-pagefind-ignore="" data-astro-cid-assl6cvf=""> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-assl6cvf="" data-icon="theme/arrow-back">  <use xlink:href="#ai:local:theme/arrow-back"></use>  </svg> Overview  </h4> </a>  <a href="/pine-script-docs/migration-guides/to-pine-version-5" class="pagination-card" data-pagefind-ignore="" data-astro-cid-assl6cvf=""> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  To Pine Script® version 5 <svg width="28" height="28" viewBox="0 0 28 28" data-astro-cid-assl6cvf="" data-icon="theme/arrow">  <symbol id="ai:local:theme/arrow"><path fill="none" stroke="var(--arrow-fill-color, #131722)" d="m11 8 6 6-6 6"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use>  </svg> </h4> </a>  </div>  </main>   <div id="toc" data-pagefind-ignore="all" data-astro-cid-oor6cujd=""><aside class="document-toc-container ml-4 w-48" data-astro-cid-oor6cujd=""><section id="toc-scroll-section" class="slick-scroll" data-astro-cid-oor6cujd=""><header data-astro-cid-oor6cujd=""><h2 class="toc-header" data-astro-cid-oor6cujd="">On this page</h2></header><ul class="" id="toc-entries" data-astro-cid-oor6cujd=""><a href="#introduction" aria-current="true" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-current="" data-astro-cid-oor6cujd="">Introduction</li></a><a href="#converting-v5-to-v6-using-the-pine-editor" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">Converting v5 to v6 using the Pine Editor</li></a><a href="#dynamic-requests" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">Dynamic requests</li></a><a href="#types" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">Types</li></a><a href="#explicit-bool-casting" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Explicit “bool” casting</li></a><a href="#boolean-values-cannot-be-na" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Boolean values cannot be <code>na</code></li></a><a href="#unique-parameters-cannot-be-na" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Unique parameters cannot be <code>na</code></li></a><a href="#constants" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">Constants</li></a><a href="#fractional-division-of-constants" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Fractional division of constants</li></a><a href="#mutable-variables-are-always-series" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Mutable variables are always “series”</li></a><a href="#color-changes" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Color changes</li></a><a href="#strategies" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">Strategies</li></a><a href="#removal-of-when-parameter" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Removal of <code>when</code> parameter</li></a><a href="#default-margin-percentage" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Default margin percentage</li></a><a href="#excess-orders-are-trimmed" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">Excess orders are trimmed</li></a><a href="#strategyexit-evaluates-parameter-pairs" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd=""><code>strategy.exit()</code> evaluates parameter pairs</li></a><a href="#history-referencing-operator" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">History-referencing operator</li></a><a href="#no-history-for-literal-values" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">No history for literal values</li></a><a href="#history-of-udt-fields" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-3" data-astro-cid-oor6cujd="">History of UDT fields</li></a><a href="#timeframes-must-include-a-multiplier" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">Timeframes must include a multiplier</li></a><a href="#lazy-evaluation-of-conditions" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">Lazy evaluation of conditions</li></a><a href="#cannot-repeat-parameters" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">Cannot repeat parameters</li></a><a href="#no-series-offset-values" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">No series <code>offset</code> values</li></a><a href="#minimum-linewidth-is-1" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">Minimum <code>linewidth</code> is 1</li></a><a href="#negative-indices-in-arrays" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">Negative indices in arrays</li></a><a href="#the-transp-parameter-is-removed" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">The <code>transp</code> parameter is removed</li></a><a href="#dynamic-for-loop-boundaries" class="document-toc-link" data-astro-cid-oor6cujd=""><li class="l-2" data-astro-cid-oor6cujd="">Dynamic <code>for</code> loop boundaries</li></a></ul></section><div class="toc-bottom-fade" data-astro-cid-oor6cujd=""></div><div class="back-top-space" data-astro-cid-oor6cujd=""><div class="not-content" style="" data-astro-cid-pkzv2hgs=""> <a id="back-top-button" title="Back to top" href="#top" data-astro-cid-pkzv2hgs="" class="floating-button not-content stvb-base stvb-pointer stvb-gray stvb-medium stvb-secondary stvb-icon stvb-icon-force-color stvb-force-no-border"> <svg width="18" height="18" viewBox="0 0 18 18" data-astro-cid-oor6cujd="" data-icon="theme/arrow-up">  <symbol id="ai:local:theme/arrow-up"><g fill="none"><g clip-path="url(#a)"><path fill="currentColor" fill-rule="evenodd" d="m9 3.5.5.44 4 3.5-1 1.12-2.75-2.4V14h-1.5V6.15L5.49 8.56l-.98-1.12 4-3.5z" clip-rule="evenodd"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h18v18H0z"></path></clipPath></defs></g></symbol><use xlink:href="#ai:local:theme/arrow-up"></use>  </svg> </a> </div> </div></aside></div> </main> </div>   <footer data-astro-cid-b6pf7ola=""> <div class="footer-content" data-astro-cid-b6pf7ola="">  <ul data-astro-cid-b6pf7ola=""> <li data-astro-cid-b6pf7ola=""> <a href="https://www.tradingview.com/chat/#BfmVowG1TZkKO235" data-astro-cid-b6pf7ola="">Pine Q&amp;A chat</a>  </li><li data-astro-cid-b6pf7ola=""> <a href="https://stackoverflow.com/questions/tagged/pine-script" data-astro-cid-b6pf7ola="">Stack Overflow</a>  ↗ </li><li data-astro-cid-b6pf7ola=""> <a href="https://t.me/PineCodersQA" data-astro-cid-b6pf7ola="">Telegram</a>  ↗ </li><li data-astro-cid-b6pf7ola=""> <a href="https://www.reddit.com/r/TradingView/" data-astro-cid-b6pf7ola="">Reddit</a>  ↗ </li> </ul> <div class="flex" data-astro-cid-b6pf7ola=""></div> <div class="copyright" data-astro-cid-b6pf7ola="">Copyright © 2025 TradingView, Inc.</div> </div> </footer>         </body></html>